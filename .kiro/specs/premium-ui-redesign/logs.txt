2025-10-28 12:03:43.155 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - Starting async itinerary generation for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1 with ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:03:43.155 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - Starting pipeline generation
2025-10-28 12:03:43.155 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - Generated executionId: exec_1761633223155 for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:03:43.160 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - === PIPELINE ORCHESTRATOR: STARTING ===
2025-10-28 12:03:43.160 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:03:43.160 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - Destination: Turkey, Turkey, Duration: 4 days
2025-10-28 12:03:43.160 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - Parallel: true
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - === CREATE ITINERARY RESPONSE ===
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - ExecutionId: exec_1761633223155
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - Status: generating
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - Ownership established: YES
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - Async generation started: YES
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - Async callbacks attached: YES
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - Error handling enabled: YES
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - User can now access /itineraries/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19/json
2025-10-28 12:03:43.160 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ItineraryService - =====================================
2025-10-28 12:03:43.161 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 1: SKELETON GENERATION ===
2025-10-28 12:03:43.161 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase skeleton started: Creating day structure...
2025-10-28 12:03:43.165 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Enhanced itinerary creation response prepared: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:03:43.165 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Execution ID: exec_44cc11cd-f29c-4730-aef4-0ece86edf125
2025-10-28 12:03:43.165 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Real-time updates will be sent via WebSocket
2025-10-28 12:03:43.165 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Estimated completion: 2025-10-28T12:04:39.160290400
2025-10-28 12:03:43.168 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:03:43.171 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:03:43.172 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [ItineraryCreationResponse{itinerary=it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19, executionId='exec_44cc1 (truncated)...]
2025-10-28 12:03:43.173 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Starting skeleton generation with timeout: 120000 ms
2025-10-28 12:03:43.173 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Request details: destination=Turkey, Turkey, duration=4 days
2025-10-28 12:03:43.174 [Pipeline-95] INFO  com.tripplanner.service.PipelineOrchestrator - SkeletonPlannerAgent.generateSkeleton() started for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:03:43.174 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT ===
2025-10-28 12:03:43.174 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating lightweight skeleton for 4 days
2025-10-28 12:03:43.174 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Destination: Turkey, Turkey
2025-10-28 12:03:43.174 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-28 12:03:43.175 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:03:43.175 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:03:43.175 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:03:43.175 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent ID: c6ea7dfc-6043-4f4a-958a-fbc3f1d3bf5b
2025-10-28 12:03:43.175 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-28 12:03:43.175 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:03:43.175 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-28 12:03:43.175 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 1 structure
2025-10-28 12:03:43.175 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-28 12:03:43.175 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:33:43.175311700Z
2025-10-28 12:03:43.176 [Pipeline-95] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 1 with minimal prompt
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2933
2025-10-28 12:03:43.176 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-28 12:03:43.177 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-28 12:03:43.177 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3347
2025-10-28 12:03:43.182 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-28 12:03:43.411 [http-nio-8080-exec-3] WARN  c.t.config.FirebaseAuthConfig$FirebaseAuthFilter - Missing or invalid Authorization header for path: /api/v1/analytics/events
2025-10-28 12:03:43.414 [http-nio-8080-exec-6] WARN  c.t.config.FirebaseAuthConfig$FirebaseAuthFilter - Missing or invalid Authorization header for path: /api/v1/analytics/events
2025-10-28 12:03:49.937 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/undefined/json
2025-10-28 12:03:49.943 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:49.943 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:49.943 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:03:49.943 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:03:49.944 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:03:49.944 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:03:50.324 [http-nio-8080-exec-4] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:03:50.324 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:03:50.324 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:03:50.325 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:03:50.325 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:03:51.925 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:51.926 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:51.926 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:03:51.927 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:03:51.927 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:03:51.928 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:03:52.287 [http-nio-8080-exec-7] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:03:52.288 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:03:52.288 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:03:52.288 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:03:52.288 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:03:54.927 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:54.928 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:54.929 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:03:54.929 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:03:54.930 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:03:54.930 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:03:55.278 [http-nio-8080-exec-8] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:03:55.279 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:03:55.279 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:03:55.279 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:03:55.279 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:03:55.281 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:55.282 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:55.282 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:03:55.282 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:03:55.282 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:03:55.282 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:03:56.586 [http-nio-8080-exec-9] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:03:56.588 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:03:56.588 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:03:56.588 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:03:56.589 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:03:56.934 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:56.936 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:56.936 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:03:56.937 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:03:56.938 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:03:56.938 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:03:57.210 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-28 12:03:57.210 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-28 12:03:57.210 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Length: 2658
2025-10-28 12:03:57.210 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 1,\n  \"date\": \"2025-11-24\",\n  \"location\": \"Turkey, Turkey\",\n  \"summary\": \"First day exploring the destination.\",\n  \"nodes\": [\n    {\n      \"id\": \"day1_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast at Accommodation\",\n      \"location\": {\n        \"name\": \"Hotel Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day1_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Exploration Activity\",\n      \"location\": {\n        \"name\": \"Central District\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:30\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day1_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Local Eatery\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day1_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Cultural Site Visit\",\n      \"location\": {\n        \"name\": \"Historic Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:00\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day1_node5\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner Experience\",\n      \"location\": {\n        \"name\": \"Restaurant District\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"20:30\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day1_node6\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Assigned Accommodation\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:00\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 660\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 838,
    "candidatesTokenCount": 648,
    "totalTokenCount": 2865,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 838
      }
    ],
    "thoughtsTokenCount": 1379
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "1WMAae4Dtqe-vQ-F8Yz5Aw"
}

2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-923876229_20251028_120357.json
2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1827
2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 1,
  "date": "2025-11-24",
  "location": "Turkey, Turkey",
  "summary": "First day exploring the destination.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast at Accommodation",
      "location": {
        "name": "Hotel Area"
  ...
2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - âœ… Provider 1 (GeminiClient) succeeded
2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 1
2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 1,
  "date": "2025-11-24",
  "location": "Turkey, Turkey",
  "summary": "First day exploring the destination.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast at Accommodation",
      "location": {
        "name": "Hotel Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node2",
      "type": "attraction",
      "title": "Morning Exploration Activity",
      "location": {
        "name": "Central District"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day1_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node4",
      "type": "attraction",
      "title": "Afternoon Cultural Site Visit",
      "location": {
        "name": "Historic Area"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day1_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Restaurant District"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day1_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Assigned Accommodation"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
```
2025-10-28 12:03:57.219 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-28 12:03:57.221 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 1,
  "date": "2025-11-24",
  "location": "Turkey, Turkey",
  "summary": "First day exploring the destination.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast at Accommodation",
      "location": {
        "name": "Hotel Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node2",
      "type": "attraction",
      "title": "Morning Exploration Activity",
      "location": {
        "name": "Central District"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day1_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node4",
      "type": "attraction",
      "title": "Afternoon Cultural Site Visit",
      "location": {
        "name": "Historic Area"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day1_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Restaurant District"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day1_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Assigned Accommodation"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
2025-10-28 12:03:57.292 [http-nio-8080-exec-5] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:03:57.293 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:03:57.293 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:03:57.293 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:03:57.294 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:03:58.676 [Pipeline-95] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"day_completed","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84c...(truncated)
2025-10-28 12:03:58.676 [Pipeline-95] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19, day=1, activities=6
2025-10-28 12:03:58.676 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 1 created and saved
2025-10-28 12:03:58.677 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:03:58.677 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:03:58.677 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent ID: c6ea7dfc-6043-4f4a-958a-fbc3f1d3bf5b
2025-10-28 12:03:58.677 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-28 12:03:58.677 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:03:58.677 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Progress: 35
2025-10-28 12:03:58.677 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 2 structure
2025-10-28 12:03:58.677 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-28 12:03:58.677 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:33:58.677331500Z
2025-10-28 12:03:58.678 [Pipeline-95] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:03:58.678 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:03:58.678 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 2 with minimal prompt
2025-10-28 12:03:58.679 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-28 12:03:58.679 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-28 12:03:58.679 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-28 12:03:58.679 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-28 12:03:58.679 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-28 12:03:58.679 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-28 12:03:58.679 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2933
2025-10-28 12:03:58.679 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-28 12:03:58.679 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-28 12:03:58.680 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3347
2025-10-28 12:03:58.680 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-28 12:03:59.927 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:59.928 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:03:59.928 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:03:59.928 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:03:59.929 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:03:59.929 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:00.282 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:00.283 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:00.283 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:00.283 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:00.283 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:00.287 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:00.287 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:00.287 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:00.288 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:00.288 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:00.288 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:01.616 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:01.617 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:01.618 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:01.618 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:01.619 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:01.627 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:01.628 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:01.628 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:01.629 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:01.629 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:01.629 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:01.985 [http-nio-8080-exec-6] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:01.986 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:01.986 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:01.986 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:01.986 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:01.992 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:01.993 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:01.993 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:01.994 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:01.994 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:01.995 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:03.300 [http-nio-8080-exec-2] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:03.300 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:03.300 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:03.301 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:03.301 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:04.026 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:04.026 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:04.026 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:04.027 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:04.027 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:04.027 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:04.464 [http-nio-8080-exec-4] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:04.464 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:04.466 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:04.466 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:04.466 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:05.321 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:05.321 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:05.321 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:05.321 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:05.322 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:05.322 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:05.691 [http-nio-8080-exec-7] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:05.691 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:05.691 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:05.692 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:05.692 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:05.694 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:05.695 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:05.695 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:05.695 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:05.696 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:05.696 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:06.960 [http-nio-8080-exec-8] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:06.961 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:06.961 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:06.962 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:06.962 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:06.969 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:06.971 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:06.971 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:06.971 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:06.971 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:06.972 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:07.359 [http-nio-8080-exec-9] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:07.359 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:07.359 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:07.360 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:07.360 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:08.972 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:08.973 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:08.973 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:08.974 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:08.974 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:08.974 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:09.347 [http-nio-8080-exec-5] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:09.348 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:09.348 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:09.348 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:09.348 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:09.354 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:09.355 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:09.355 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:09.355 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:09.357 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:09.358 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:10.629 [http-nio-8080-exec-10] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:10.629 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:10.629 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:10.629 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:10.629 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:10.633 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:10.634 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:10.634 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:10.634 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:10.634 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:10.634 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:11.078 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:11.078 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:11.079 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:11.079 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:11.079 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:11.640 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:11.641 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:11.641 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:11.641 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:11.641 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:11.641 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:12.237 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-28 12:04:12.237 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-28 12:04:12.237 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Length: 2969
2025-10-28 12:04:12.237 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 2,\n  \"date\": \"2025-11-25\",\n  \"location\": \"Turkey, Turkey\",\n  \"summary\": \"A full day of activities, meals, and exploration in Turkey.\",\n  \"nodes\": [\n    {\n      \"id\": \"day2_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Breakfast Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day2_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Activity\",\n      \"location\": {\n        \"name\": \"Morning Activity Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:30\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day2_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Lunch Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day2_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Exploration\",\n      \"location\": {\n        \"name\": \"Afternoon Activity Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:00\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day2_node5\",\n      \"type\": \"transport\",\n      \"title\": \"Travel to Evening Area\",\n      \"location\": {\n        \"name\": \"Transit Route\"\n      },\n      \"timing\": {\n        \"startTime\": \"17:00\",\n        \"endTime\": \"17:45\",\n        \"durationMin\": 45\n      }\n    },\n    {\n      \"id\": \"day2_node6\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner\",\n      \"location\": {\n        \"name\": \"Dinner Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"20:30\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day2_node7\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Accommodation Location\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:00\",\n        \"endTime\": \"23:59\",\n        \"durationMin\": 180\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 838,
    "candidatesTokenCount": 747,
    "totalTokenCount": 2390,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 838
      }
    ],
    "thoughtsTokenCount": 805
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "5GMAadDvAuunvr0Ph5OL-QE"
}

2025-10-28 12:04:12.239 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-248173833_20251028_120412.json
2025-10-28 12:04:12.240 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-28 12:04:12.240 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content length: 2095
2025-10-28 12:04:12.240 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 2,
  "date": "2025-11-25",
  "location": "Turkey, Turkey",
  "summary": "A full day of activities, meals, and exploration in Turkey.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Breakfas...
2025-10-28 12:04:12.240 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-28 12:04:12.240 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - âœ… Provider 1 (GeminiClient) succeeded
2025-10-28 12:04:12.240 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-28 12:04:12.240 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 2
2025-10-28 12:04:12.240 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 2,
  "date": "2025-11-25",
  "location": "Turkey, Turkey",
  "summary": "A full day of activities, meals, and exploration in Turkey.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Breakfast Spot"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node2",
      "type": "attraction",
      "title": "Morning Activity",
      "location": {
        "name": "Morning Activity Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day2_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Lunch Spot"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node4",
      "type": "attraction",
      "title": "Afternoon Exploration",
      "location": {
        "name": "Afternoon Activity Area"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day2_node5",
      "type": "transport",
      "title": "Travel to Evening Area",
      "location": {
        "name": "Transit Route"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "17:45",
        "durationMin": 45
      }
    },
    {
      "id": "day2_node6",
      "type": "meal",
      "title": "Dinner",
      "location": {
        "name": "Dinner Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day2_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Accommodation Location"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "23:59",
        "durationMin": 180
      }
    }
  ]
}
```
2025-10-28 12:04:12.240 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-28 12:04:12.242 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 2,
  "date": "2025-11-25",
  "location": "Turkey, Turkey",
  "summary": "A full day of activities, meals, and exploration in Turkey.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Breakfast Spot"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node2",
      "type": "attraction",
      "title": "Morning Activity",
      "location": {
        "name": "Morning Activity Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day2_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Lunch Spot"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node4",
      "type": "attraction",
      "title": "Afternoon Exploration",
      "location": {
        "name": "Afternoon Activity Area"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day2_node5",
      "type": "transport",
      "title": "Travel to Evening Area",
      "location": {
        "name": "Transit Route"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "17:45",
        "durationMin": 45
      }
    },
    {
      "id": "day2_node6",
      "type": "meal",
      "title": "Dinner",
      "location": {
        "name": "Dinner Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day2_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Accommodation Location"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "23:59",
        "durationMin": 180
      }
    }
  ]
}
2025-10-28 12:04:12.287 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:12.287 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:12.287 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:12.288 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:12.288 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:13.375 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:13.376 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:13.376 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:13.376 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:13.377 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:13.377 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:13.392 [Pipeline-95] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"day_completed","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84c...(truncated)
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19, day=2, activities=7
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 2 created and saved
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent ID: c6ea7dfc-6043-4f4a-958a-fbc3f1d3bf5b
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Progress: 50
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 3 structure
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:34:13.392736300Z
2025-10-28 12:04:13.392 [Pipeline-95] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 3 with minimal prompt
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-28 12:04:13.392 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-28 12:04:13.394 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-28 12:04:13.394 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-28 12:04:13.394 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2933
2025-10-28 12:04:13.394 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-28 12:04:13.394 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-28 12:04:13.394 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3347
2025-10-28 12:04:13.394 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-28 12:04:13.927 [http-nio-8080-exec-6] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:13.929 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:13.929 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:13.929 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:13.929 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:14.020 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:14.021 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:14.021 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:14.021 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:14.021 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:14.021 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:15.102 [http-nio-8080-exec-2] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:15.102 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:15.102 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:15.102 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:15.102 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:15.107 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:15.107 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:15.108 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:15.108 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:15.108 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:15.108 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:15.733 [http-nio-8080-exec-4] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:15.734 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:15.734 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:15.734 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:15.734 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:16.118 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:16.119 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:16.119 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:16.119 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:16.119 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:16.119 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:16.745 [http-nio-8080-exec-7] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:16.745 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:16.745 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:16.745 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:16.746 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:18.756 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:18.757 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:18.757 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:18.757 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:18.757 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:18.757 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:19.104 [http-nio-8080-exec-8] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:19.106 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:19.106 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:19.106 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:19.106 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:19.110 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:19.111 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:19.111 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:19.111 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:19.112 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:19.112 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:20.385 [http-nio-8080-exec-9] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:20.386 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:20.386 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:20.386 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:20.386 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:20.390 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:20.391 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:20.391 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:20.391 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:20.392 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:20.392 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:20.772 [http-nio-8080-exec-5] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:20.772 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:20.772 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:20.773 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:20.773 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:21.395 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:21.396 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:21.396 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:21.396 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:21.397 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:21.397 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:22.043 [http-nio-8080-exec-10] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:22.045 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:22.045 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:22.045 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:22.045 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:23.119 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:23.120 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:23.120 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:23.120 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:23.121 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:23.121 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:23.468 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:23.468 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:23.468 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:23.468 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:23.469 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:24.023 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:24.024 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:24.024 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:24.024 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:24.025 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:24.025 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:24.222 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-28 12:04:24.222 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-28 12:04:24.222 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Length: 2711
2025-10-28 12:04:24.222 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 3,\n  \"date\": \"2025-11-26\",\n  \"location\": \"Turkey\",\n  \"summary\": \"A day focused on exploring local markets, enjoying culinary experiences, and capturing memorable moments.\",\n  \"nodes\": [\n    {\n      \"id\": \"day3_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Accommodation Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day3_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Market Exploration\",\n      \"location\": {\n        \"name\": \"Local Market District\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:30\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day3_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Local Eatery\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day3_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Photography Walk\",\n      \"location\": {\n        \"name\": \"Scenic Neighborhood\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:00\",\n        \"endTime\": \"17:30\",\n        \"durationMin\": 210\n      }\n    },\n    {\n      \"id\": \"day3_node5\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner Experience\",\n      \"location\": {\n        \"name\": \"Dinner Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"20:30\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day3_node6\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Hotel/Accommodation\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:00\",\n        \"endTime\": \"07:00\",\n        \"durationMin\": 600\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 838,
    "candidatesTokenCount": 655,
    "totalTokenCount": 2202,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 838
      }
    ],
    "thoughtsTokenCount": 709
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "72MAaYLyO5-4vr0PrLrl0Qw"
}

2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_427528563_20251028_120424.json
2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1880
2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 3,
  "date": "2025-11-26",
  "location": "Turkey",
  "summary": "A day focused on exploring local markets, enjoying culinary experiences, and capturing memorable moments.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "...
2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - âœ… Provider 1 (GeminiClient) succeeded
2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 3
2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 3,
  "date": "2025-11-26",
  "location": "Turkey",
  "summary": "A day focused on exploring local markets, enjoying culinary experiences, and capturing memorable moments.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node2",
      "type": "attraction",
      "title": "Morning Market Exploration",
      "location": {
        "name": "Local Market District"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day3_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node4",
      "type": "attraction",
      "title": "Afternoon Photography Walk",
      "location": {
        "name": "Scenic Neighborhood"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:30",
        "durationMin": 210
      }
    },
    {
      "id": "day3_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Dinner Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day3_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel/Accommodation"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "07:00",
        "durationMin": 600
      }
    }
  ]
}
```
2025-10-28 12:04:24.224 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-28 12:04:24.226 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 3,
  "date": "2025-11-26",
  "location": "Turkey",
  "summary": "A day focused on exploring local markets, enjoying culinary experiences, and capturing memorable moments.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node2",
      "type": "attraction",
      "title": "Morning Market Exploration",
      "location": {
        "name": "Local Market District"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day3_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node4",
      "type": "attraction",
      "title": "Afternoon Photography Walk",
      "location": {
        "name": "Scenic Neighborhood"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:30",
        "durationMin": 210
      }
    },
    {
      "id": "day3_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Dinner Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day3_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel/Accommodation"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "07:00",
        "durationMin": 600
      }
    }
  ]
}
2025-10-28 12:04:24.779 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:24.781 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:24.782 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:24.782 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:24.782 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:24.787 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:24.788 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:24.788 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:24.788 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:24.789 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:24.789 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:25.757 [Pipeline-95] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"day_completed","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84c...(truncated)
2025-10-28 12:04:25.757 [Pipeline-95] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19, day=3, activities=6
2025-10-28 12:04:25.757 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 3 created and saved
2025-10-28 12:04:25.757 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:04:25.757 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:04:25.757 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent ID: c6ea7dfc-6043-4f4a-958a-fbc3f1d3bf5b
2025-10-28 12:04:25.757 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-28 12:04:25.757 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:04:25.757 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Progress: 65
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 4 structure
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:34:25.757224300Z
2025-10-28 12:04:25.758 [Pipeline-95] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 4 with minimal prompt
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2933
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3347
2025-10-28 12:04:25.758 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-28 12:04:25.949 [http-nio-8080-exec-6] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:25.950 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:25.950 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:25.950 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:25.950 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:25.954 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:25.955 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:25.955 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:25.955 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:25.955 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:25.955 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:26.452 [http-nio-8080-exec-2] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:26.453 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:26.453 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:26.453 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:26.453 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:28.464 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:28.464 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:28.464 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:28.465 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:28.465 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:28.465 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:28.814 [http-nio-8080-exec-4] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:28.815 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:28.815 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:28.815 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:28.815 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:29.022 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:29.022 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:29.022 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:29.022 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:29.023 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:29.023 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:30.115 [http-nio-8080-exec-7] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:30.115 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:30.115 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:30.115 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:30.115 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:30.118 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:30.119 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:30.119 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:30.119 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:30.119 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:30.119 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:30.670 [http-nio-8080-exec-8] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:30.670 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:30.670 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:30.670 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:30.670 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:31.125 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:31.125 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:31.125 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:31.126 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:31.126 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:31.126 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:31.769 [http-nio-8080-exec-9] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:31.769 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:31.770 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:31.770 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:31.770 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:32.835 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:32.836 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:32.837 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:32.837 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:32.839 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:32.839 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:33.173 [http-nio-8080-exec-5] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:33.173 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:33.173 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:33.174 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:33.174 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:33.788 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:33.789 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:33.789 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:33.789 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:33.790 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:33.790 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:34.459 [http-nio-8080-exec-10] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:34.460 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:34.460 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:34.460 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:34.460 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:34.465 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:34.466 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:34.466 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:34.466 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:34.467 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:34.467 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:35.438 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:35.438 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:35.439 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:35.439 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:35.439 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:36.451 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:36.452 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:36.452 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:36.452 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:36.453 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:36.453 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:36.800 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:36.801 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:36.801 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:36.801 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:36.801 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:38.472 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:38.472 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:38.473 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:38.473 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:38.473 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:38.473 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:38.814 [http-nio-8080-exec-6] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:38.815 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:38.815 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:38.815 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:38.815 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:38.817 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:38.818 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:38.818 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:38.818 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:38.818 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:38.818 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:40.153 [http-nio-8080-exec-2] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:40.153 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:40.153 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:40.154 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:40.154 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:40.156 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:40.158 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:40.158 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:40.158 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:40.158 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:40.158 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:40.504 [http-nio-8080-exec-4] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:40.504 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:40.504 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:40.504 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:40.504 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:41.480 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-28 12:04:41.480 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-28 12:04:41.480 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Length: 2681
2025-10-28 12:04:41.480 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 4,\n  \"date\": \"2025-11-27\",\n  \"location\": \"Turkey, Turkey\",\n  \"summary\": \"Day 4 activities focusing on shopping, photography, and local cuisine.\",\n  \"nodes\": [\n    {\n      \"id\": \"day4_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Hotel/Local Cafe\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day4_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Shopping & Photography\",\n      \"location\": {\n        \"name\": \"Local Market/Bazaar\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:30\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day4_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch\",\n      \"location\": {\n        \"name\": \"Local Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day4_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Photography Walk\",\n      \"location\": {\n        \"name\": \"Scenic City Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:30\",\n        \"endTime\": \"17:30\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day4_node5\",\n      \"type\": \"meal\",\n      \"title\": \"Farewell Dinner\",\n      \"location\": {\n        \"name\": \"Specialty Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:30\",\n        \"endTime\": \"21:00\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day4_node6\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Hotel Accommodation\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:30\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 630\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 838,
    "candidatesTokenCount": 659,
    "totalTokenCount": 3381,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 838
      }
    ],
    "thoughtsTokenCount": 1884
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "AWQAaaPqE-ee1e8PqOu28Q0"
}

2025-10-28 12:04:41.481 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_1103230959_20251028_120441.json
2025-10-28 12:04:41.482 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-28 12:04:41.482 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1849
2025-10-28 12:04:41.482 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 4,
  "date": "2025-11-27",
  "location": "Turkey, Turkey",
  "summary": "Day 4 activities focusing on shopping, photography, and local cuisine.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name"...
2025-10-28 12:04:41.482 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-28 12:04:41.482 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - âœ… Provider 1 (GeminiClient) succeeded
2025-10-28 12:04:41.482 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-28 12:04:41.482 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 4
2025-10-28 12:04:41.482 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 4,
  "date": "2025-11-27",
  "location": "Turkey, Turkey",
  "summary": "Day 4 activities focusing on shopping, photography, and local cuisine.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Hotel/Local Cafe"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node2",
      "type": "attraction",
      "title": "Morning Shopping & Photography",
      "location": {
        "name": "Local Market/Bazaar"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day4_node3",
      "type": "meal",
      "title": "Lunch",
      "location": {
        "name": "Local Restaurant"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node4",
      "type": "attraction",
      "title": "Afternoon Photography Walk",
      "location": {
        "name": "Scenic City Area"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:30",
        "durationMin": 180
      }
    },
    {
      "id": "day4_node5",
      "type": "meal",
      "title": "Farewell Dinner",
      "location": {
        "name": "Specialty Restaurant"
      },
      "timing": {
        "startTime": "19:30",
        "endTime": "21:00",
        "durationMin": 90
      }
    },
    {
      "id": "day4_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel Accommodation"
      },
      "timing": {
        "startTime": "21:30",
        "endTime": "08:00",
        "durationMin": 630
      }
    }
  ]
}
```
2025-10-28 12:04:41.482 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-28 12:04:41.484 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 4,
  "date": "2025-11-27",
  "location": "Turkey, Turkey",
  "summary": "Day 4 activities focusing on shopping, photography, and local cuisine.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Hotel/Local Cafe"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node2",
      "type": "attraction",
      "title": "Morning Shopping & Photography",
      "location": {
        "name": "Local Market/Bazaar"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day4_node3",
      "type": "meal",
      "title": "Lunch",
      "location": {
        "name": "Local Restaurant"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node4",
      "type": "attraction",
      "title": "Afternoon Photography Walk",
      "location": {
        "name": "Scenic City Area"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:30",
        "durationMin": 180
      }
    },
    {
      "id": "day4_node5",
      "type": "meal",
      "title": "Farewell Dinner",
      "location": {
        "name": "Specialty Restaurant"
      },
      "timing": {
        "startTime": "19:30",
        "endTime": "21:00",
        "durationMin": 90
      }
    },
    {
      "id": "day4_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel Accommodation"
      },
      "timing": {
        "startTime": "21:30",
        "endTime": "08:00",
        "durationMin": 630
      }
    }
  ]
}
2025-10-28 12:04:41.519 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:41.520 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:41.520 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:41.520 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:41.521 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:41.521 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:41.961 [Pipeline-95] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"day_completed","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84c...(truncated)
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19, day=4, activities=6
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 4 created and saved
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent ID: c6ea7dfc-6043-4f4a-958a-fbc3f1d3bf5b
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Message: Skeleton complete
2025-10-28 12:04:41.961 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_complete
2025-10-28 12:04:41.962 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:34:41.961641700Z
2025-10-28 12:04:41.962 [Pipeline-95] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:04:41.962 [Pipeline-95] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:04:43.196 [http-nio-8080-exec-7] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:43.197 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:43.197 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:43.197 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:43.197 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:43.354 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON COMPLETE ===
2025-10-28 12:04:43.355 [Pipeline-95] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generated 4 days with 25 total node placeholders
2025-10-28 12:04:43.355 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Skeleton generation completed successfully for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:04:43.355 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 1 complete: 4 days created (60195 ms)
2025-10-28 12:04:43.355 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase skeleton completed in 60195 ms
2025-10-28 12:04:43.357 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:04:43.357 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 2: POPULATION ===
2025-10-28 12:04:43.357 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase population started: Populating node details...
2025-10-28 12:04:43.357 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:04:43.357 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"phase_transition","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d...(truncated)
2025-10-28 12:04:43.358 [Pipeline-94] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19, skeletonâ†’population, progress=40%
2025-10-28 12:04:43.358 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Running population agents in PARALLEL
2025-10-28 12:04:43.359 [Pipeline-98] INFO  com.tripplanner.service.PipelineOrchestrator - [ActivityAgent] Starting...
2025-10-28 12:04:43.359 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT ===
2025-10-28 12:04:43.360 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - Populating attraction nodes for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:04:43.360 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - [MealAgent] Starting...
2025-10-28 12:04:43.360 [Pipeline-95] INFO  com.tripplanner.service.PipelineOrchestrator - [TransportAgent] Starting...
2025-10-28 12:04:43.360 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT ===
2025-10-28 12:04:43.360 [Pipeline-95] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT ===
2025-10-28 12:04:43.360 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - Populating meal nodes for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:04:43.360 [Pipeline-95] INFO  com.tripplanner.agents.TransportAgent - Populating transport nodes for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:04:43.362 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - Found 8 attraction nodes to populate
2025-10-28 12:04:43.362 [Pipeline-95] INFO  com.tripplanner.agents.TransportAgent - Found 1 transport nodes to populate
2025-10-28 12:04:43.362 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - Found 12 meal nodes to populate
2025-10-28 12:04:43.362 [Pipeline-95] INFO  com.tripplanner.agents.TransportAgent - Calling AI to populate 1 transport segments
2025-10-28 12:04:43.363 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-28 12:04:43.363 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-28 12:04:43.363 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-28 12:04:43.363 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - Calling AI to populate 8 attractions
2025-10-28 12:04:43.363 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-28 12:04:43.363 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-28 12:04:43.363 [Pipeline-98] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-28 12:04:43.363 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-28 12:04:43.363 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-28 12:04:43.363 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2043
2025-10-28 12:04:43.363 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-28 12:04:43.363 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - Calling AI to populate 12 meals
2025-10-28 12:04:43.363 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-28 12:04:43.363 [Pipeline-99] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-28 12:04:43.363 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-28 12:04:43.363 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-28 12:04:43.363 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-28 12:04:43.364 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a transportation and logistics expert for travel planning.

Your task: Suggest SPECIFIC transport modes and routes for getting around.

Guidelines:
1. Suggest practical transport modes based o...
2025-10-28 12:04:43.364 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-28 12:04:43.364 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-28 12:04:43.364 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2649
2025-10-28 12:04:43.364 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-28 12:04:43.364 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-28 12:04:43.364 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-28 12:04:43.364 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel expert specializing in attractions and activities.

Your task: Suggest SPECIFIC attractions for placeholder activity nodes.

CRITICAL: Use the EXACT node IDs provided in the user prom...
2025-10-28 12:04:43.364 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-28 12:04:43.364 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 3160
2025-10-28 12:04:43.364 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-28 12:04:43.364 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a culinary travel expert specializing in dining recommendations.

Your task: Suggest SPECIFIC restaurants and dining places for meal slots.

CRITICAL: Use the EXACT node IDs provided in the us...
2025-10-28 12:04:43.364 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2964
2025-10-28 12:04:43.364 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3495
2025-10-28 12:04:43.364 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-28 12:04:43.364 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-28 12:04:43.365 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2348
2025-10-28 12:04:43.365 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-28 12:04:44.020 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:44.020 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:44.020 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:44.021 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:44.021 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:44.021 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:44.363 [http-nio-8080-exec-8] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:44.364 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:44.364 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:44.364 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:44.364 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:44.367 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:44.367 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:44.367 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:44.368 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:44.368 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:44.368 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:45.703 [http-nio-8080-exec-9] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:45.703 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:45.704 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:45.704 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:45.704 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:45.707 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:45.708 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:45.708 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:45.708 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:45.708 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:45.708 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:46.051 [http-nio-8080-exec-5] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:46.051 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:46.051 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:46.051 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:46.051 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:46.055 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:46.055 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:46.055 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:46.055 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:46.056 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:46.056 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:47.349 [http-nio-8080-exec-10] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:47.349 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:47.349 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:47.349 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:47.349 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:49.021 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:49.022 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:49.022 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:49.023 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:49.023 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:49.023 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:49.367 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:49.368 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:49.368 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:49.368 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:49.368 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:49.372 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:49.372 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:49.373 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:49.373 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:49.373 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:49.373 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:50.706 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:50.706 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:50.706 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:50.707 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:50.707 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:50.710 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:50.711 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:50.711 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:50.711 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:50.712 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:50.712 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:51.040 [http-nio-8080-exec-6] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:51.040 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:51.040 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:51.040 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:51.040 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:51.044 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:51.045 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:51.045 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:51.045 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:51.046 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:51.046 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:52.381 [http-nio-8080-exec-2] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:52.382 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:52.382 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:52.382 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:52.382 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:54.020 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:54.021 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:54.021 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:54.022 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:54.022 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:54.022 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:54.371 [http-nio-8080-exec-4] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:54.371 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:54.371 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:54.371 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:54.371 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:54.403 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:54.403 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:54.404 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:54.404 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:54.404 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:54.404 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:55.674 [http-nio-8080-exec-7] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:55.674 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:55.675 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:55.675 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:55.675 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:55.679 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:55.680 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:55.680 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:55.680 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:55.680 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:55.680 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:56.042 [http-nio-8080-exec-8] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:56.043 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:56.043 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:56.043 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:56.043 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:56.048 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:56.048 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:56.049 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:56.049 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:56.049 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:56.049 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:57.333 [http-nio-8080-exec-9] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:57.334 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:57.334 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:57.334 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:57.334 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:59.016 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:59.017 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:59.017 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:59.017 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:59.017 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:59.017 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:04:59.329 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-28 12:04:59.330 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-28 12:04:59.330 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Response Length: 4407
2025-10-28 12:04:59.330 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"attractions\": [\n    {\n      \"nodeId\": \"day1_node2\",\n      \"title\": \"Hagia Sophia Grand Mosque\",\n      \"description\": \"Step into a masterpiece of Byzantine architecture and Ottoman grandeur. This iconic structure has served as a church, mosque, and museum, offering a breathtaking glimpse into Istanbul's rich history and stunning photographic opportunities.\",\n      \"category\": \"landmark\",\n      \"durationMinutes\": 150,\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day1_node4\",\n      \"title\": \"Bosphorus Dinner Cruise\",\n      \"description\": \"Experience the magic of Istanbul illuminated at night from the waters of the Bosphorus. Enjoy a delicious dinner, traditional Turkish entertainment, and unparalleled views of palaces, mosques, and bridges that connect two continents.\",\n      \"category\": \"experience\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day2_node2\",\n      \"title\": \"Grand Bazaar\",\n      \"description\": \"Immerse yourself in one of the world's oldest and largest covered markets. Wander through labyrinthine alleys filled with thousands of shops selling carpets, jewelry, ceramics, spices, and more â€“ a true paradise for shoppers and photographers.\",\n      \"category\": \"shopping\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day2_node4\",\n      \"title\": \"Spice Bazaar (Egyptian Bazaar)\",\n      \"description\": \"Delight your senses with the vibrant colors and intoxicating aromas of the Spice Bazaar. This bustling market offers an incredible array of spices, Turkish delight, nuts, dried fruits, and local delicacies, perfect for food enthusiasts and photography.\",\n      \"category\": \"shopping\",\n      \"durationMinutes\": 120,\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day3_node2\",\n      \"title\": \"Topkapi Palace Museum\",\n      \"description\": \"Discover the opulent former residence of Ottoman sultans for nearly 400 years. Explore its stunning courtyards, treasury, Harem, and extensive collections of artifacts, offering a deep dive into imperial history and fantastic photo ops of the Bosphorus.\",\n      \"category\": \"museum\",\n      \"durationMinutes\": 210,\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day3_node4\",\n      \"title\": \"Blue Mosque (Sultan Ahmed Mosque)\",\n      \"description\": \"Marvel at the exquisite beauty of the Blue Mosque, famous for its six minarets and stunning interior adorned with thousands of blue Iznik tiles. This active mosque is a breathtaking example of classical Ottoman architecture and a must-see for photography.\",\n      \"category\": \"temple_shrine\",\n      \"durationMinutes\": 90,\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day4_node2\",\n      \"title\": \"Galata Tower\",\n      \"description\": \"Ascend to the top of the medieval Galata Tower for unparalleled panoramic views of Istanbul's historic peninsula, the Golden Horn, and the Bosphorus. It's an ideal spot for capturing breathtaking cityscape photographs.\",\n      \"category\": \"landmark\",\n      \"durationMinutes\": 90,\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day4_node4\",\n      \"title\": \"Istiklal Avenue & Taksim Square\",\n      \"description\": \"Stroll down Istiklal Avenue, a vibrant pedestrian street bustling with shops, cafes, cinemas, and historical buildings. Enjoy street food, browse for souvenirs, and soak in the lively atmosphere of modern Istanbul, leading to the iconic Taksim Square.\",\n      \"category\": \"shopping\",\n      \"durationMinutes\": 150,\n      \"locationName\": \"Istanbul\"\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 787,
    "candidatesTokenCount": 907,
    "totalTokenCount": 2885,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 787
      }
    ],
    "thoughtsTokenCount": 1191
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "E2QAaY_eCqe6vr0P1dyQ2A0"
}

2025-10-28 12:04:59.332 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-322153444_20251028_120459.json
2025-10-28 12:04:59.333 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-28 12:04:59.333 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Generated content length: 3611
2025-10-28 12:04:59.333 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Hagia Sophia Grand Mosque",
      "description": "Step into a masterpiece of Byzantine architecture and Ottoman grandeur. This iconic structure has served as a church, mosque, and museum, offering a breathtaking glimpse...
2025-10-28 12:04:59.333 [Pipeline-98] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-28 12:04:59.333 [Pipeline-98] INFO  com.tripplanner.service.ai.ResilientAiClient - âœ… Provider 1 (GeminiClient) succeeded
2025-10-28 12:04:59.333 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT - FULL LLM RESPONSE ===
2025-10-28 12:04:59.333 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - Contexts to populate: 8
2025-10-28 12:04:59.333 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - Raw Response: ```json
{
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Hagia Sophia Grand Mosque",
      "description": "Step into a masterpiece of Byzantine architecture and Ottoman grandeur. This iconic structure has served as a church, mosque, and museum, offering a breathtaking glimpse into Istanbul's rich history and stunning photographic opportunities.",
      "category": "landmark",
      "durationMinutes": 150,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day1_node4",
      "title": "Bosphorus Dinner Cruise",
      "description": "Experience the magic of Istanbul illuminated at night from the waters of the Bosphorus. Enjoy a delicious dinner, traditional Turkish entertainment, and unparalleled views of palaces, mosques, and bridges that connect two continents.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node2",
      "title": "Grand Bazaar",
      "description": "Immerse yourself in one of the world's oldest and largest covered markets. Wander through labyrinthine alleys filled with thousands of shops selling carpets, jewelry, ceramics, spices, and more â€“ a true paradise for shoppers and photographers.",
      "category": "shopping",
      "durationMinutes": 180,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node4",
      "title": "Spice Bazaar (Egyptian Bazaar)",
      "description": "Delight your senses with the vibrant colors and intoxicating aromas of the Spice Bazaar. This bustling market offers an incredible array of spices, Turkish delight, nuts, dried fruits, and local delicacies, perfect for food enthusiasts and photography.",
      "category": "shopping",
      "durationMinutes": 120,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node2",
      "title": "Topkapi Palace Museum",
      "description": "Discover the opulent former residence of Ottoman sultans for nearly 400 years. Explore its stunning courtyards, treasury, Harem, and extensive collections of artifacts, offering a deep dive into imperial history and fantastic photo ops of the Bosphorus.",
      "category": "museum",
      "durationMinutes": 210,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node4",
      "title": "Blue Mosque (Sultan Ahmed Mosque)",
      "description": "Marvel at the exquisite beauty of the Blue Mosque, famous for its six minarets and stunning interior adorned with thousands of blue Iznik tiles. This active mosque is a breathtaking example of classical Ottoman architecture and a must-see for photography.",
      "category": "temple_shrine",
      "durationMinutes": 90,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node2",
      "title": "Galata Tower",
      "description": "Ascend to the top of the medieval Galata Tower for unparalleled panoramic views of Istanbul's historic peninsula, the Golden Horn, and the Bosphorus. It's an ideal spot for capturing breathtaking cityscape photographs.",
      "category": "landmark",
      "durationMinutes": 90,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node4",
      "title": "Istiklal Avenue & Taksim Square",
      "description": "Stroll down Istiklal Avenue, a vibrant pedestrian street bustling with shops, cafes, cinemas, and historical buildings. Enjoy street food, browse for souvenirs, and soak in the lively atmosphere of modern Istanbul, leading to the iconic Taksim Square.",
      "category": "shopping",
      "durationMinutes": 150,
      "locationName": "Istanbul"
    }
  ]
}
```
2025-10-28 12:04:59.334 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - === END ACTIVITY AGENT RESPONSE ===
2025-10-28 12:04:59.334 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - Cleaned Response: {
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Hagia Sophia Grand Mosque",
      "description": "Step into a masterpiece of Byzantine architecture and Ottoman grandeur. This iconic structure has served as a church, mosque, and museum, offering a breathtaking glimpse into Istanbul's rich history and stunning photographic opportunities.",
      "category": "landmark",
      "durationMinutes": 150,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day1_node4",
      "title": "Bosphorus Dinner Cruise",
      "description": "Experience the magic of Istanbul illuminated at night from the waters of the Bosphorus. Enjoy a delicious dinner, traditional Turkish entertainment, and unparalleled views of palaces, mosques, and bridges that connect two continents.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node2",
      "title": "Grand Bazaar",
      "description": "Immerse yourself in one of the world's oldest and largest covered markets. Wander through labyrinthine alleys filled with thousands of shops selling carpets, jewelry, ceramics, spices, and more â€“ a true paradise for shoppers and photographers.",
      "category": "shopping",
      "durationMinutes": 180,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node4",
      "title": "Spice Bazaar (Egyptian Bazaar)",
      "description": "Delight your senses with the vibrant colors and intoxicating aromas of the Spice Bazaar. This bustling market offers an incredible array of spices, Turkish delight, nuts, dried fruits, and local delicacies, perfect for food enthusiasts and photography.",
      "category": "shopping",
      "durationMinutes": 120,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node2",
      "title": "Topkapi Palace Museum",
      "description": "Discover the opulent former residence of Ottoman sultans for nearly 400 years. Explore its stunning courtyards, treasury, Harem, and extensive collections of artifacts, offering a deep dive into imperial history and fantastic photo ops of the Bosphorus.",
      "category": "museum",
      "durationMinutes": 210,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node4",
      "title": "Blue Mosque (Sultan Ahmed Mosque)",
      "description": "Marvel at the exquisite beauty of the Blue Mosque, famous for its six minarets and stunning interior adorned with thousands of blue Iznik tiles. This active mosque is a breathtaking example of classical Ottoman architecture and a must-see for photography.",
      "category": "temple_shrine",
      "durationMinutes": 90,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node2",
      "title": "Galata Tower",
      "description": "Ascend to the top of the medieval Galata Tower for unparalleled panoramic views of Istanbul's historic peninsula, the Golden Horn, and the Bosphorus. It's an ideal spot for capturing breathtaking cityscape photographs.",
      "category": "landmark",
      "durationMinutes": 90,
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node4",
      "title": "Istiklal Avenue & Taksim Square",
      "description": "Stroll down Istiklal Avenue, a vibrant pedestrian street bustling with shops, cafes, cinemas, and historical buildings. Enjoy street food, browse for souvenirs, and soak in the lively atmosphere of modern Istanbul, leading to the iconic Taksim Square.",
      "category": "shopping",
      "durationMinutes": 150,
      "locationName": "Istanbul"
    }
  ]
}
2025-10-28 12:04:59.356 [http-nio-8080-exec-5] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:04:59.357 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:04:59.357 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:04:59.357 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:04:59.357 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:04:59.362 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:59.362 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:04:59.362 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:04:59.363 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:04:59.363 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:04:59.363 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:00.832 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - Saved itinerary with populated attractions
2025-10-28 12:05:00.832 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT COMPLETE ===
2025-10-28 12:05:00.832 [Pipeline-98] INFO  com.tripplanner.agents.ActivityAgent - Populated 8 attractions
2025-10-28 12:05:00.832 [Pipeline-98] INFO  com.tripplanner.service.PipelineOrchestrator - [ActivityAgent] Complete
2025-10-28 12:05:00.985 [http-nio-8080-exec-10] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:00.987 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:00.987 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:00.987 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:00.987 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:00.990 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:00.991 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:00.991 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:00.992 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:00.993 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:00.993 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:01.346 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:01.346 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:01.346 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:01.347 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:01.347 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:01.351 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:01.351 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:01.351 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:01.352 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:01.352 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:01.352 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:02.140 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-28 12:05:02.140 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-28 12:05:02.140 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Length: 2296
2025-10-28 12:05:02.140 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"transports\": [\n    {\n      \"nodeId\": \"day2_node5\",\n      \"title\": \"Rideshare/Taxi to Dinner\",\n      \"description\": \"For convenient, door-to-door transport from your afternoon activity to the dinner restaurant. In major Turkish cities like Istanbul, you can use local apps like BiTaksi, or international ones like Uber (where available). This is ideal for moderate distances or if you prefer not to navigate public transport. Fares are metered for taxis, and rideshare apps provide upfront estimates. Consider splitting the cost if traveling with others.\",\n      \"mode\": \"rideshare\",\n      \"durationMinutes\": 20\n    },\n    {\n      \"nodeId\": \"day2_node5\",\n      \"title\": \"Public Bus/Metro/Tram to Dinner\",\n      \"description\": \"A cost-effective way to get to dinner, especially if your activity and restaurant are well-connected by public transport. In cities like Turkey, you'll likely need a city-specific public transport card (e.g., Istanbulkart in Istanbul) for easy tap-and-go access. Use Google Maps or local transport apps to plan your route. Be prepared for some walking to/from stops and potential transfers.\",\n      \"mode\": \"bus\",\n      \"durationMinutes\": 35\n    },\n    {\n      \"nodeId\": \"day2_node5\",\n      \"title\": \"Walk to Dinner\",\n      \"description\": \"If the dinner restaurant is within a 1-2 km radius of your afternoon activity, walking is an excellent option. It's free, allows you to soak in the local atmosphere, and provides some light exercise. Check a map app for the precise distance and estimated walking time. This is also a great way to discover hidden gems.\",\n      \"mode\": \"walk\",\n      \"durationMinutes\": 15\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 523,
    "candidatesTokenCount": 422,
    "totalTokenCount": 3041,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 523
      }
    ],
    "thoughtsTokenCount": 2096
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "FWQAacXuOrebvr0Pm-2h4QU"
}

2025-10-28 12:05:02.143 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_1288523183_20251028_120502.json
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1665
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "transports": [
    {
      "nodeId": "day2_node5",
      "title": "Rideshare/Taxi to Dinner",
      "description": "For convenient, door-to-door transport from your afternoon activity to the dinner restaurant. In major Turkish cities like Istanbul, you can use local apps like BiTaksi, o...
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.service.ai.ResilientAiClient - âœ… Provider 1 (GeminiClient) succeeded
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT - FULL LLM RESPONSE ===
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.agents.TransportAgent - Contexts to populate: 1
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.agents.TransportAgent - Raw Response: ```json
{
  "transports": [
    {
      "nodeId": "day2_node5",
      "title": "Rideshare/Taxi to Dinner",
      "description": "For convenient, door-to-door transport from your afternoon activity to the dinner restaurant. In major Turkish cities like Istanbul, you can use local apps like BiTaksi, or international ones like Uber (where available). This is ideal for moderate distances or if you prefer not to navigate public transport. Fares are metered for taxis, and rideshare apps provide upfront estimates. Consider splitting the cost if traveling with others.",
      "mode": "rideshare",
      "durationMinutes": 20
    },
    {
      "nodeId": "day2_node5",
      "title": "Public Bus/Metro/Tram to Dinner",
      "description": "A cost-effective way to get to dinner, especially if your activity and restaurant are well-connected by public transport. In cities like Turkey, you'll likely need a city-specific public transport card (e.g., Istanbulkart in Istanbul) for easy tap-and-go access. Use Google Maps or local transport apps to plan your route. Be prepared for some walking to/from stops and potential transfers.",
      "mode": "bus",
      "durationMinutes": 35
    },
    {
      "nodeId": "day2_node5",
      "title": "Walk to Dinner",
      "description": "If the dinner restaurant is within a 1-2 km radius of your afternoon activity, walking is an excellent option. It's free, allows you to soak in the local atmosphere, and provides some light exercise. Check a map app for the precise distance and estimated walking time. This is also a great way to discover hidden gems.",
      "mode": "walk",
      "durationMinutes": 15
    }
  ]
}
```
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.agents.TransportAgent - === END TRANSPORT AGENT RESPONSE ===
2025-10-28 12:05:02.144 [Pipeline-95] INFO  com.tripplanner.agents.TransportAgent - Cleaned Response: {
  "transports": [
    {
      "nodeId": "day2_node5",
      "title": "Rideshare/Taxi to Dinner",
      "description": "For convenient, door-to-door transport from your afternoon activity to the dinner restaurant. In major Turkish cities like Istanbul, you can use local apps like BiTaksi, or international ones like Uber (where available). This is ideal for moderate distances or if you prefer not to navigate public transport. Fares are metered for taxis, and rideshare apps provide upfront estimates. Consider splitting the cost if traveling with others.",
      "mode": "rideshare",
      "durationMinutes": 20
    },
    {
      "nodeId": "day2_node5",
      "title": "Public Bus/Metro/Tram to Dinner",
      "description": "A cost-effective way to get to dinner, especially if your activity and restaurant are well-connected by public transport. In cities like Turkey, you'll likely need a city-specific public transport card (e.g., Istanbulkart in Istanbul) for easy tap-and-go access. Use Google Maps or local transport apps to plan your route. Be prepared for some walking to/from stops and potential transfers.",
      "mode": "bus",
      "durationMinutes": 35
    },
    {
      "nodeId": "day2_node5",
      "title": "Walk to Dinner",
      "description": "If the dinner restaurant is within a 1-2 km radius of your afternoon activity, walking is an excellent option. It's free, allows you to soak in the local atmosphere, and provides some light exercise. Check a map app for the precise distance and estimated walking time. This is also a great way to discover hidden gems.",
      "mode": "walk",
      "durationMinutes": 15
    }
  ]
}
2025-10-28 12:05:02.146 [Pipeline-95] ERROR com.tripplanner.agents.TransportAgent - Failed to populate transport for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
java.lang.IllegalStateException: Duplicate key day2_node5 (attempted merging values com.tripplanner.agents.TransportAgent$PopulatedTransport@44c03157 and com.tripplanner.agents.TransportAgent$PopulatedTransport@d9d0c36)
	at java.base/java.util.stream.Collectors.duplicateKeyException(Collectors.java:135)
	at java.base/java.util.stream.Collectors.lambda$uniqKeysMapAccumulator$1(Collectors.java:182)
	at java.base/java.util.stream.ReduceOps$3ReducingSink.accept(ReduceOps.java:169)
	at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682)
	at com.tripplanner.agents.TransportAgent.updateItineraryWithTransport(TransportAgent.java:188)
	at com.tripplanner.agents.TransportAgent.populateTransport(TransportAgent.java:93)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executePopulationPhase$6(PipelineOrchestrator.java:241)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-28 12:05:02.146 [Pipeline-95] INFO  com.tripplanner.service.PipelineOrchestrator - [TransportAgent] Complete
2025-10-28 12:05:02.675 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-28 12:05:02.676 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-28 12:05:02.676 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Response Length: 6113
2025-10-28 12:05:02.676 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"meals\": [\n    {\n      \"nodeId\": \"day1_node1\",\n      \"title\": \"Deraliye Terrace Restaurant\",\n      \"description\": \"Savor authentic Ottoman cuisine in a historic setting near Sultanahmet. Indulge in rich, slow-cooked stews and flavorful rice dishes that transport you back to imperial times, offering a taste of Turkey's grand culinary heritage.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day1_node3\",\n      \"title\": \"Ciya Sofrasi\",\n      \"description\": \"Experience the true taste of Anatolia at this renowned eatery in KadÄ±kÃ¶y. Enjoy a rotating menu of regional specialties, from hearty stews and unique vegetable dishes to delicious kebabs, all prepared with love and tradition.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day1_node5\",\n      \"title\": \"Hafiz Mustafa 1864\",\n      \"description\": \"End your day with a sweet indulgence at this historic patisserie, a true institution in Istanbul. Treat yourself to exquisite baklava, kÃ¼nefe, or a rich milk pudding, perfectly paired with traditional Turkish tea or coffee.\",\n      \"cuisineType\": \"cafe\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day2_node1\",\n      \"title\": \"Hoca Pasa Pidecisi\",\n      \"description\": \"Enjoy a casual and delicious lunch featuring freshly baked Pide, often called Turkish pizza, hot from a stone oven. Choose from various savory toppings like minced meat, cheese, or sucuk, for a truly authentic experience.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day2_node3\",\n      \"title\": \"Balikci Sabahattin\",\n      \"description\": \"Delight in fresh, expertly prepared seafood overlooking the Marmara Sea, a classic Istanbul dining experience. Choose your catch of the day and enjoy it grilled or pan-fried, accompanied by traditional mezes and Raki.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day2_node6\",\n      \"title\": \"Karakoy Lokantasi\",\n      \"description\": \"Immerse yourself in a lively atmosphere while savoring classic Turkish dishes in the vibrant KarakÃ¶y neighborhood. Their menu offers a delightful array of mezes and main courses, perfect for a traditional evening meal.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day3_node1\",\n      \"title\": \"Sariyer Borekcisi\",\n      \"description\": \"Discover the ultimate comfort food with a visit to a local borek shop, known for its flaky, delicious pastries. Enjoy savory borek filled with cheese, spinach, or minced meat, perfect for a quick yet satisfying lunch.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day3_node3\",\n      \"title\": \"Nicole Restaurant\",\n      \"description\": \"Experience sophisticated fine dining with breathtaking panoramic views of Istanbul from the historic Franciscan monastery building. This elegant restaurant offers a contemporary menu blending Mediterranean and Turkish flavors, crafted with seasonal ingredients.\",\n      \"cuisineType\": \"international\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day3_node5\",\n      \"title\": \"ZUMA Istanbul\",\n      \"description\": \"Step into a chic, modern setting for an upscale Japanese dining experience in the heart of Istanbul. Indulge in exquisite sushi, sashimi, and robata grill dishes, perfect for those seeking international flavors and a vibrant atmosphere.\",\n      \"cuisineType\": \"japanese\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day4_node1\",\n      \"title\": \"Grand Bazaar Food Stalls\",\n      \"description\": \"Dive into the bustling energy of Istanbul's historic Grand Bazaar and sample an array of delicious street food. From simit and dÃ¶ner to kokoreÃ§ and fresh fruit juices, it's a sensory feast perfect for a casual lunch.\",\n      \"cuisineType\": \"street_food\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day4_node3\",\n      \"title\": \"Hamdi Restaurant\",\n      \"description\": \"Enjoy spectacular Bosphorus views while feasting on some of Istanbul's finest kebabs, a true culinary landmark. Their extensive menu features a variety of perfectly grilled meats and traditional Turkish dishes, all prepared with fresh ingredients.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Istanbul\"\n    },\n    {\n      \"nodeId\": \"day4_node5\",\n      \"title\": \"Sunset Grill & Bar\",\n      \"description\": \"Conclude your culinary journey with an unforgettable meal at this renowned rooftop restaurant, offering stunning panoramic views of the city skyline and Bosphorus. Savor gourmet international cuisine with a strong emphasis on fresh, high-quality ingredients.\",\n      \"cuisineType\": \"international\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Istanbul\"\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 1015,
    "candidatesTokenCount": 1317,
    "totalTokenCount": 4032,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 1015
      }
    ],
    "thoughtsTokenCount": 1700
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "FmQAac-xHMq5vr0P0ce30Aw"
}

2025-10-28 12:05:02.687 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_418353149_20251028_120502.json
2025-10-28 12:05:02.689 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-28 12:05:02.689 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Generated content length: 5170
2025-10-28 12:05:02.689 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "Deraliye Terrace Restaurant",
      "description": "Savor authentic Ottoman cuisine in a historic setting near Sultanahmet. Indulge in rich, slow-cooked stews and flavorful rice dishes that transport you back to imperial time...
2025-10-28 12:05:02.689 [Pipeline-99] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-28 12:05:02.689 [Pipeline-99] INFO  com.tripplanner.service.ai.ResilientAiClient - âœ… Provider 1 (GeminiClient) succeeded
2025-10-28 12:05:02.689 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT - FULL LLM RESPONSE ===
2025-10-28 12:05:02.689 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - Contexts to populate: 12
2025-10-28 12:05:02.689 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - Raw Response: ```json
{
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "Deraliye Terrace Restaurant",
      "description": "Savor authentic Ottoman cuisine in a historic setting near Sultanahmet. Indulge in rich, slow-cooked stews and flavorful rice dishes that transport you back to imperial times, offering a taste of Turkey's grand culinary heritage.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day1_node3",
      "title": "Ciya Sofrasi",
      "description": "Experience the true taste of Anatolia at this renowned eatery in KadÄ±kÃ¶y. Enjoy a rotating menu of regional specialties, from hearty stews and unique vegetable dishes to delicious kebabs, all prepared with love and tradition.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day1_node5",
      "title": "Hafiz Mustafa 1864",
      "description": "End your day with a sweet indulgence at this historic patisserie, a true institution in Istanbul. Treat yourself to exquisite baklava, kÃ¼nefe, or a rich milk pudding, perfectly paired with traditional Turkish tea or coffee.",
      "cuisineType": "cafe",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node1",
      "title": "Hoca Pasa Pidecisi",
      "description": "Enjoy a casual and delicious lunch featuring freshly baked Pide, often called Turkish pizza, hot from a stone oven. Choose from various savory toppings like minced meat, cheese, or sucuk, for a truly authentic experience.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node3",
      "title": "Balikci Sabahattin",
      "description": "Delight in fresh, expertly prepared seafood overlooking the Marmara Sea, a classic Istanbul dining experience. Choose your catch of the day and enjoy it grilled or pan-fried, accompanied by traditional mezes and Raki.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node6",
      "title": "Karakoy Lokantasi",
      "description": "Immerse yourself in a lively atmosphere while savoring classic Turkish dishes in the vibrant KarakÃ¶y neighborhood. Their menu offers a delightful array of mezes and main courses, perfect for a traditional evening meal.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node1",
      "title": "Sariyer Borekcisi",
      "description": "Discover the ultimate comfort food with a visit to a local borek shop, known for its flaky, delicious pastries. Enjoy savory borek filled with cheese, spinach, or minced meat, perfect for a quick yet satisfying lunch.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node3",
      "title": "Nicole Restaurant",
      "description": "Experience sophisticated fine dining with breathtaking panoramic views of Istanbul from the historic Franciscan monastery building. This elegant restaurant offers a contemporary menu blending Mediterranean and Turkish flavors, crafted with seasonal ingredients.",
      "cuisineType": "international",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node5",
      "title": "ZUMA Istanbul",
      "description": "Step into a chic, modern setting for an upscale Japanese dining experience in the heart of Istanbul. Indulge in exquisite sushi, sashimi, and robata grill dishes, perfect for those seeking international flavors and a vibrant atmosphere.",
      "cuisineType": "japanese",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node1",
      "title": "Grand Bazaar Food Stalls",
      "description": "Dive into the bustling energy of Istanbul's historic Grand Bazaar and sample an array of delicious street food. From simit and dÃ¶ner to kokoreÃ§ and fresh fruit juices, it's a sensory feast perfect for a casual lunch.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node3",
      "title": "Hamdi Restaurant",
      "description": "Enjoy spectacular Bosphorus views while feasting on some of Istanbul's finest kebabs, a true culinary landmark. Their extensive menu features a variety of perfectly grilled meats and traditional Turkish dishes, all prepared with fresh ingredients.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node5",
      "title": "Sunset Grill & Bar",
      "description": "Conclude your culinary journey with an unforgettable meal at this renowned rooftop restaurant, offering stunning panoramic views of the city skyline and Bosphorus. Savor gourmet international cuisine with a strong emphasis on fresh, high-quality ingredients.",
      "cuisineType": "international",
      "mealType": "dinner",
      "locationName": "Istanbul"
    }
  ]
}
```
2025-10-28 12:05:02.692 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - === END MEAL AGENT RESPONSE ===
2025-10-28 12:05:02.693 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - Cleaned Response: {
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "Deraliye Terrace Restaurant",
      "description": "Savor authentic Ottoman cuisine in a historic setting near Sultanahmet. Indulge in rich, slow-cooked stews and flavorful rice dishes that transport you back to imperial times, offering a taste of Turkey's grand culinary heritage.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day1_node3",
      "title": "Ciya Sofrasi",
      "description": "Experience the true taste of Anatolia at this renowned eatery in KadÄ±kÃ¶y. Enjoy a rotating menu of regional specialties, from hearty stews and unique vegetable dishes to delicious kebabs, all prepared with love and tradition.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day1_node5",
      "title": "Hafiz Mustafa 1864",
      "description": "End your day with a sweet indulgence at this historic patisserie, a true institution in Istanbul. Treat yourself to exquisite baklava, kÃ¼nefe, or a rich milk pudding, perfectly paired with traditional Turkish tea or coffee.",
      "cuisineType": "cafe",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node1",
      "title": "Hoca Pasa Pidecisi",
      "description": "Enjoy a casual and delicious lunch featuring freshly baked Pide, often called Turkish pizza, hot from a stone oven. Choose from various savory toppings like minced meat, cheese, or sucuk, for a truly authentic experience.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node3",
      "title": "Balikci Sabahattin",
      "description": "Delight in fresh, expertly prepared seafood overlooking the Marmara Sea, a classic Istanbul dining experience. Choose your catch of the day and enjoy it grilled or pan-fried, accompanied by traditional mezes and Raki.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day2_node6",
      "title": "Karakoy Lokantasi",
      "description": "Immerse yourself in a lively atmosphere while savoring classic Turkish dishes in the vibrant KarakÃ¶y neighborhood. Their menu offers a delightful array of mezes and main courses, perfect for a traditional evening meal.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node1",
      "title": "Sariyer Borekcisi",
      "description": "Discover the ultimate comfort food with a visit to a local borek shop, known for its flaky, delicious pastries. Enjoy savory borek filled with cheese, spinach, or minced meat, perfect for a quick yet satisfying lunch.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node3",
      "title": "Nicole Restaurant",
      "description": "Experience sophisticated fine dining with breathtaking panoramic views of Istanbul from the historic Franciscan monastery building. This elegant restaurant offers a contemporary menu blending Mediterranean and Turkish flavors, crafted with seasonal ingredients.",
      "cuisineType": "international",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day3_node5",
      "title": "ZUMA Istanbul",
      "description": "Step into a chic, modern setting for an upscale Japanese dining experience in the heart of Istanbul. Indulge in exquisite sushi, sashimi, and robata grill dishes, perfect for those seeking international flavors and a vibrant atmosphere.",
      "cuisineType": "japanese",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node1",
      "title": "Grand Bazaar Food Stalls",
      "description": "Dive into the bustling energy of Istanbul's historic Grand Bazaar and sample an array of delicious street food. From simit and dÃ¶ner to kokoreÃ§ and fresh fruit juices, it's a sensory feast perfect for a casual lunch.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node3",
      "title": "Hamdi Restaurant",
      "description": "Enjoy spectacular Bosphorus views while feasting on some of Istanbul's finest kebabs, a true culinary landmark. Their extensive menu features a variety of perfectly grilled meats and traditional Turkish dishes, all prepared with fresh ingredients.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Istanbul"
    },
    {
      "nodeId": "day4_node5",
      "title": "Sunset Grill & Bar",
      "description": "Conclude your culinary journey with an unforgettable meal at this renowned rooftop restaurant, offering stunning panoramic views of the city skyline and Bosphorus. Savor gourmet international cuisine with a strong emphasis on fresh, high-quality ingredients.",
      "cuisineType": "international",
      "mealType": "dinner",
      "locationName": "Istanbul"
    }
  ]
}
2025-10-28 12:05:02.706 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:02.706 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:02.706 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:02.706 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:02.707 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:03.206 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - Saved itinerary with populated meals
2025-10-28 12:05:03.206 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT COMPLETE ===
2025-10-28 12:05:03.206 [Pipeline-99] INFO  com.tripplanner.agents.MealAgent - Populated 12 meals
2025-10-28 12:05:03.206 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - [MealAgent] Complete
2025-10-28 12:05:03.207 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - All population agents completed successfully
2025-10-28 12:05:03.207 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 2 complete (19852 ms)
2025-10-28 12:05:03.207 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase population completed in 19852 ms
2025-10-28 12:05:03.208 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:03.208 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 3: ENRICHMENT ===
2025-10-28 12:05:03.208 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase ENRICHMENT started: Adding location details...
2025-10-28 12:05:03.210 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:03.213 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"phase_transition","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d...(truncated)
2025-10-28 12:05:03.213 [Pipeline-94] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19, unknownâ†’ENRICHMENT, progress=0%
2025-10-28 12:05:03.213 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Starting enrichment phase for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:03.213 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Enrichment will add: coordinates, place IDs, photos, reviews, ratings
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.service.PipelineOrchestrator - Calling EnrichmentAgent.execute() for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - === AGENT EXECUTION START ===
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Agent Kind: ENRICHMENT
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Request Type: ApplyResult
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Request Data: {taskType=enrich}
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Request Details: {taskType=enrich}
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - =============================
2025-10-28 12:05:03.215 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:03.216 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:03.216 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:03.216 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:03.216 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: queued
2025-10-28 12:05:03.216 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 0
2025-10-28 12:05:03.216 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Agent queued for execution
2025-10-28 12:05:03.216 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-28 12:05:03.216 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:03.215428200Z
2025-10-28 12:05:03.217 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Agent started
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-28 12:05:03.217 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:03.217425900Z
2025-10-28 12:05:03.218 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:03.218 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:03.218 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Executing agent-specific logic for: ENRICHMENT
2025-10-28 12:05:03.218 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - === ENRICHMENT AGENT PROCESSING ===
2025-10-28 12:05:03.218 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:04.019 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:04.019 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:04.019 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:04.019 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:04.020 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:04.020 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:04.625 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:04.625 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:04.625 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:04.625 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:04.625 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:05:04.625 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-28 12:05:04.627 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Loading itinerary
2025-10-28 12:05:04.627 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: loading
2025-10-28 12:05:04.627 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:04.625910300Z
2025-10-28 12:05:04.627 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:04.627 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:04.627 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:04.628 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:04.628 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:04.628 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:04.628 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:05:04.628 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-28 12:05:04.628 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Enriching places with Google Places data
2025-10-28 12:05:04.628 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: ENRICHMENT
2025-10-28 12:05:04.628 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:04.627082400Z
2025-10-28 12:05:04.628 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:04.628 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:04.644 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Istanbul&key=
2025-10-28 12:05:04.658 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-28 12:05:04.855 [http-nio-8080-exec-6] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:04.855 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:04.855 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:04.855 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:04.855 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:04.860 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:04.860 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:04.860 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:04.861 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:04.861 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:04.861 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:04.913 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-28 12:05:04.914 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-28 12:05:04.915 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-28 12:05:04.915 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 1
2025-10-28 12:05:04.916 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Istanbul&key=
2025-10-28 12:05:04.916 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-28 12:05:05.178 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-28 12:05:05.178 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-28 12:05:05.178 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-28 12:05:05.178 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 2
2025-10-28 12:05:05.179 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Istanbul&key=
2025-10-28 12:05:05.179 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-28 12:05:05.361 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-28 12:05:05.361 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-28 12:05:05.363 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-28 12:05:05.363 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 3
2025-10-28 12:05:05.363 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Istanbul&key=
2025-10-28 12:05:05.363 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-28 12:05:05.540 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-28 12:05:05.540 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-28 12:05:05.541 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-28 12:05:05.541 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 4
2025-10-28 12:05:05.542 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Istanbul&key=
2025-10-28 12:05:05.542 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-28 12:05:05.642 [http-nio-8080-exec-2] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:05.642 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:05.643 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:05.643 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:05.643 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:05.647 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:05.648 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:05.648 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:05.648 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:05.649 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:05.649 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:05.650 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-28 12:05:05.650 [Pipeline-98] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-28 12:05:05.650 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-28 12:05:05.652 [Pipeline-98] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 5
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.service.GooglePlacesService - Google Places API failure threshold reached (5), opening circuit breaker
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node1 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node2 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node3 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node4 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node6 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node1 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node2 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node3 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node4 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node5 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node1 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node2 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node3 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node4 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node5 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:05.652 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Created 0 ENRICHMENT operations
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 40
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Validating opening hours
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: validation
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:05.653105200Z
2025-10-28 12:05:05.653 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:05.653 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:05.654 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:05.654 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:05.654 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:05.654 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:05.654 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:05:05.654 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 60
2025-10-28 12:05:05.654 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Calculating pacing
2025-10-28 12:05:05.654 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: pacing
2025-10-28 12:05:05.654 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:05.654100500Z
2025-10-28 12:05:05.655 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:05.655 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:05.656 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:05.656 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:05.656 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:05.656 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:05.656 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:05:05.656 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-28 12:05:05.656 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Computing transit durations
2025-10-28 12:05:05.656 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: transit
2025-10-28 12:05:05.656 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:05.656105300Z
2025-10-28 12:05:05.656 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 90
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Applying enrichments
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: applying
2025-10-28 12:05:05.657 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:05.657102500Z
2025-10-28 12:05:05.658 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:05.658 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:05.658 [Pipeline-98] INFO  com.tripplanner.service.ChangeEngine - Applying changes for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:06.611 [http-nio-8080-exec-4] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:06.611 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:06.612 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:06.612 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:06.612 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:06.616 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:06.616 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:06.617 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:06.617 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:06.617 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:06.617 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:07.301 [http-nio-8080-exec-7] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:07.302 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:07.302 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:07.302 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:07.302 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:07.523 [Pipeline-98] INFO  com.tripplanner.service.ChangeEngine - === ITINERARY STATE IN CHANGE ENGINE ===
2025-10-28 12:05:07.525 [Pipeline-98] INFO  com.tripplanner.service.ChangeEngine - Day 1: 6 nodes - IDs: [day1_node1, day1_node2, day1_node3, day1_node4, day1_node5, day1_node6]
2025-10-28 12:05:07.525 [Pipeline-98] INFO  com.tripplanner.service.ChangeEngine - Day 2: 7 nodes - IDs: [day2_node1, day2_node2, day2_node3, day2_node4, day2_node5, day2_node6, day2_node7]
2025-10-28 12:05:07.525 [Pipeline-98] INFO  com.tripplanner.service.ChangeEngine - Day 3: 6 nodes - IDs: [day3_node1, day3_node2, day3_node3, day3_node4, day3_node5, day3_node6]
2025-10-28 12:05:07.525 [Pipeline-98] INFO  com.tripplanner.service.ChangeEngine - Day 4: 6 nodes - IDs: [day4_node1, day4_node2, day4_node3, day4_node4, day4_node5, day4_node6]
2025-10-28 12:05:07.525 [Pipeline-98] INFO  com.tripplanner.service.ChangeEngine - =========================================
2025-10-28 12:05:09.018 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:09.018 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:09.019 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:09.019 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:09.019 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:09.019 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:09.904 [http-nio-8080-exec-8] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:09.905 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:09.905 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:09.905 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:09.905 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:09.908 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:09.909 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:09.909 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:09.909 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:09.909 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:09.909 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:10.883 [http-nio-8080-exec-9] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:10.884 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:10.884 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:10.884 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:10.884 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:10.889 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:10.890 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:10.890 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:10.890 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:10.891 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:10.891 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:12.279 [http-nio-8080-exec-5] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:12.280 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:12.280 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:12.280 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:12.280 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:12.284 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:12.284 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:12.284 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:12.285 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:12.285 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:12.285 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:13.232 [http-nio-8080-exec-10] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:13.232 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:13.232 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:13.232 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:13.233 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:14.017 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:14.017 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:14.017 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:14.018 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:14.018 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:14.018 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:15.545 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:15.545 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:15.545 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:15.545 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:15.546 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:15.550 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:15.550 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:15.550 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:15.551 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:15.551 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:15.551 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:15.890 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:15.892 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:15.892 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:15.892 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:15.892 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:15.895 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:15.895 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:15.895 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:15.895 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:15.895 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:15.895 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:17.262 [http-nio-8080-exec-6] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:17.263 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:17.263 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:17.263 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:17.263 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:17.266 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:17.267 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:17.267 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:17.267 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:17.268 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:17.268 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:18.841 [http-nio-8080-exec-2] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:18.842 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:18.842 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:18.842 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:18.842 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:19.016 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:19.017 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:19.017 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:19.017 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:19.018 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:19.018 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:20.563 [http-nio-8080-exec-4] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:20.564 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:20.564 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:20.564 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:20.564 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:20.853 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:20.854 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:20.854 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:20.854 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:20.855 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:20.855 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:22.320 [http-nio-8080-exec-7] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:22.321 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:22.321 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:22.321 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:22.321 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:22.324 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:22.325 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:22.325 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:22.325 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:22.326 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:22.326 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:22.666 [http-nio-8080-exec-8] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:22.667 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:22.667 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:22.667 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:22.667 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:22.671 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:22.671 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:22.671 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:22.672 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:22.672 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:22.672 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:23.279 [http-nio-8080-exec-9] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:23.279 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:23.280 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:23.280 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:23.280 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:24.017 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:24.017 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:24.018 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:24.018 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:24.018 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:24.018 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:24.351 [http-nio-8080-exec-5] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:24.351 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:24.351 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:24.351 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:24.351 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:25.022 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node1_to_day1_node2, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node2_to_day1_node3, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node3_to_day1_node4, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node4_to_day1_node5, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node5_to_day1_node6, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node1_to_day2_node2, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node2_to_day2_node3, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node3_to_day2_node4, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node4_to_day2_node5, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node5_to_day2_node6, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node6_to_day2_node7, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node1_to_day3_node2, op=update_edge
2025-10-28 12:05:25.023 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node2_to_day3_node3, op=update_edge
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node3_to_day3_node4, op=update_edge
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node4_to_day3_node5, op=update_edge
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node5_to_day3_node6, op=update_edge
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node1_to_day4_node2, op=update_edge
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node2_to_day4_node3, op=update_edge
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node3_to_day4_node4, op=update_edge
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node4_to_day4_node5, op=update_edge
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-28 12:05:25.024 [Pipeline-98] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node5_to_day4_node6, op=update_edge
2025-10-28 12:05:25.026 [Pipeline-98] INFO  com.tripplanner.service.RevisionService - Saving revision rev_1761633325024_928b3bbf for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:25.296 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:25.296 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:25.296 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:25.297 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:25.297 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:25.297 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:25.478 [Pipeline-98] INFO  com.tripplanner.service.RevisionService - Successfully saved revision rev_1761633325024_928b3bbf for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:25.659 [http-nio-8080-exec-10] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:25.660 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:25.660 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:25.660 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:25.661 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:25.665 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:25.666 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:25.666 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:25.666 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:25.667 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:25.667 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:26.002 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:26.002 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:26.003 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:26.003 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:26.003 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:26.068 [Pipeline-98] INFO  com.tripplanner.service.ChangeEngine - Triggering auto-enrichment for 21 nodes in itinerary it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:26.069 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:26.069 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:26.069 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:26.069 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:26.069 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-28 12:05:26.069 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-28 12:05:26.069 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Enrichment complete
2025-10-28 12:05:26.069 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: complete
2025-10-28 12:05:26.069 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:26.069256700Z
2025-10-28 12:05:26.069 [AsyncTask-2] INFO  com.tripplanner.service.EnrichmentService - Starting async enrichment for 21 nodes in itinerary it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:26.070 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - === ENRICHMENT COMPLETE ===
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Applied 42 ENRICHMENT operations
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - New version: 2
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 0d5b1d7b-e5a1-4c16-a16c-480e6eb67c74
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Status: completed
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Message: Agent completed successfully
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-28 12:05:26.070 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-28T06:35:26.070264300Z
2025-10-28 12:05:26.071 [Pipeline-98] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:26.071 [Pipeline-98] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-28 12:05:26.071 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - === AGENT EXECUTION COMPLETED ===
2025-10-28 12:05:26.071 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Agent Kind: ENRICHMENT
2025-10-28 12:05:26.072 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:26.072 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Result Type: ApplyResult
2025-10-28 12:05:26.072 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - Result: com.tripplanner.service.ChangeEngine$ApplyResult@47ecee22
2025-10-28 12:05:26.072 [Pipeline-98] INFO  com.tripplanner.agents.EnrichmentAgent - =================================
2025-10-28 12:05:26.072 [Pipeline-98] INFO  com.tripplanner.service.PipelineOrchestrator - Enrichment completed successfully. Version: 2
2025-10-28 12:05:26.072 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Enrichment phase completed for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:26.072 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 3 complete (22865 ms)
2025-10-28 12:05:26.072 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase ENRICHMENT completed in 22865 ms
2025-10-28 12:05:26.072 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:26.073 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 4: COST ESTIMATION ===
2025-10-28 12:05:26.073 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase cost_estimation started: Estimating costs...
2025-10-28 12:05:26.073 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:26.073 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"phase_transition","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d...(truncated)
2025-10-28 12:05:26.073 [Pipeline-94] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19, unknownâ†’cost_estimation, progress=0%
2025-10-28 12:05:26.073 [Pipeline-94] INFO  com.tripplanner.agents.CostEstimatorAgent - === COST ESTIMATOR AGENT ===
2025-10-28 12:05:26.073 [Pipeline-94] INFO  com.tripplanner.agents.CostEstimatorAgent - Estimating costs for itinerary: it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19
2025-10-28 12:05:26.331 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:26.331 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/undefined/json
2025-10-28 12:05:26.331 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/undefined/json", parameters={}
2025-10-28 12:05:26.332 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-28 12:05:26.332 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: undefined
2025-10-28 12:05:26.332 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-28 12:05:26.539 [AsyncTask-2] INFO  com.tripplanner.service.EnrichmentService - Enriching 16 out of 21 nodes (others already have coordinates)
2025-10-28 12:05:26.539 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node2 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.539 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node3 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.539 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node4 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.539 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node5 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.539 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node2 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.539 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node3 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.539 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node4 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.539 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node6 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.539 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node2 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.540 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node3 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.540 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node4 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.540 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node5 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.540 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node2 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.540 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node3 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.540 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node4 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.540 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node5 (Istanbul): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-28 12:05:26.540 [AsyncTask-2] INFO  com.tripplanner.service.EnrichmentService - Successfully enriched 0 out of 16 nodes in itinerary it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 (took 471ms)
2025-10-28 12:05:26.700 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User PEoULmiNa2dBOZrlBcXs8EZIkXs1 does not own itinerary: undefined
2025-10-28 12:05:26.700 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-28 12:05:26.700 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-28 12:05:26.700 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 404 NOT_FOUND
2025-10-28 12:05:26.700 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-28 12:05:26.868 [Pipeline-94] INFO  com.tripplanner.agents.CostEstimatorAgent - === COST ESTIMATOR COMPLETE ===
2025-10-28 12:05:26.868 [Pipeline-94] INFO  com.tripplanner.agents.CostEstimatorAgent - Estimated costs for 25 nodes
2025-10-28 12:05:26.869 [Pipeline-94] INFO  com.tripplanner.agents.CostEstimatorAgent - Total estimated cost: â‚¹22400 per person
2025-10-28 12:05:26.869 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 4 complete (797 ms)
2025-10-28 12:05:26.869 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase cost_estimation completed in 797 ms
2025-10-28 12:05:26.869 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:26.869 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 5: FINALIZATION ===
2025-10-28 12:05:26.869 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Phase finalization started: Finalizing itinerary...
2025-10-28 12:05:26.869 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"agent_progress","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d84...(truncated)
2025-10-28 12:05:26.870 [Pipeline-94] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19 session=null payload={"updateType":"phase_transition","itineraryId":"it_70a5dca6-f00f-4edd-bbd2-9882d...(truncated)
2025-10-28 12:05:26.870 [Pipeline-94] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_70a5dca6-f00f-4edd-bbd2-9882d84cdb19, enrichmentâ†’finalization, progress=90%
2025-10-28 12:05:27.868 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - === PIPELINE COMPLETE ===
2025-10-28 12:05:27.868 [Pipeline-94] INFO  com.tripplanner.service.PipelineOrchestrator - Total time: 104708 ms