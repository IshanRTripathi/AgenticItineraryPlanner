2025-10-13 00:04:18.308 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 00:04:18.318 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 00:04:18.318 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 00:04:18.318 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 00:04:18.320 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 00:04:18.320 [http-nio-8080-exec-5] WARN  com.tripplanner.controller.ItinerariesController - User ID not found in request, using anonymous for development
2025-10-13 00:04:18.320 [http-nio-8080-exec-5] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: anonymous
2025-10-13 00:04:20.138 [http-nio-8080-exec-5] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: anonymous
2025-10-13 00:04:20.139 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: anonymous
2025-10-13 00:04:20.139 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 00:04:20.140 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_105ebb3d-b1a7-491c-a811-1af7fff0ecf1, destination=Almaty, Kazakhstan, startDate= (truncated)...]
2025-10-13 00:04:20.141 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 00:04:20.141 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 00:10:12.404 [SpringApplicationShutdownHook] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-10-13 00:10:12.590 [tomcat-shutdown] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Graceful shutdown complete
2025-10-13 00:10:12.594 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 00:10:12.595 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 00:10:12.595 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopping...
2025-10-13 00:10:12.595 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@7db2b614]]
2025-10-13 00:10:12.595 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@7db2b614]
2025-10-13 00:10:12.595 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@7db2b614]
2025-10-13 00:10:12.595 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopped.
2025-10-13 00:10:12.595 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:10:12.596 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:10:12.617 [SpringApplicationShutdownHook] INFO  com.tripplanner.service.GeminiClient - Gemini client cleanup completed
2025-10-13 00:10:12.617 [SpringApplicationShutdownHook] INFO  c.tripplanner.service.openrouter.OpenRouterClient - OpenRouter client cleanup completed
2025-10-13 00:10:26.349 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 24100 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-13 00:10:26.353 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-13 00:10:28.228 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-13 00:10:28.246 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-13 00:10:28.246 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-13 00:10:28.348 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-13 00:10:28.348 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1937 ms
2025-10-13 00:10:28.504 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-13 00:10:28.574 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-13 00:10:28.593 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-13 00:10:28.593 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: gemini
2025-10-13 00:10:28.593 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-13 00:10:28.593 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-13 00:10:28.803 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free  | apiKey=MISSING
2025-10-13 00:10:28.808 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-13 00:10:28.810 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-13 00:10:28.810 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-13 00:10:28.811 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-13 00:10:28.811 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with Gemini as primary, OpenRouter as fallback
2025-10-13 00:10:28.811 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-13 00:10:28.814 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-13 00:10:28.814 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: GeminiClient (available: true)
2025-10-13 00:10:28.814 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: OpenRouterClient (available: false)
2025-10-13 00:10:28.814 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-13 00:10:28.884 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-13 00:10:28.885 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-13 00:10:29.919 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-13 00:10:30.060 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-13 00:10:30.060 [main] INFO  com.tripplanner.service.AgentRegistry - Found 12 agents to register
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: planneragent -> PlannerAgent with capabilities: [create]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 12
2025-10-13 00:10:30.061 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-13 00:10:30.070 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192]
2025-10-13 00:10:30.072 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192]
2025-10-13 00:10:30.072 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-13 00:10:30.073 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-13 00:10:30.073 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-13 00:10:30.098 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-13 00:10:30.100 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-13 00:10:30.100 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-13 00:10:30.100 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-13 00:10:30.100 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-13 00:10:30.100 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-13 00:10:30.112 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-13 00:10:30.113 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-13 00:10:30.168 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Initializing Task Lifecycle Manager
2025-10-13 00:10:33.151 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Started monitoring 0 existing running tasks
2025-10-13 00:10:33.151 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Task Lifecycle Manager initialized
2025-10-13 00:10:33.162 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-13 00:10:33.162 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-13 00:10:33.163 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-13 00:10:33.163 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-13 00:10:33.163 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-13 00:10:33.163 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-13 00:10:33.163 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-13 00:10:33.242 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-13 00:10:33.246 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-13 00:10:33.273 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-13 00:10:33.377 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 45 mappings in 'requestMappingHandlerMapping'
2025-10-13 00:10:33.428 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-13 00:10:33.462 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-13 00:10:33.549 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-13 00:10:33.613 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.AgentController:
	
2025-10-13 00:10:33.613 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-13 00:10:33.614 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-13 00:10:33.614 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-13 00:10:33.614 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-13 00:10:33.614 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-13 00:10:33.614 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-13 00:10:33.618 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
2025-10-13 00:10:33.620 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-13 00:10:33.679 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-13 00:10:33.725 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-13 00:10:33.885 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 00:10:33.887 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 00:10:33.887 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-13 00:10:33.887 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1be4a7e3]
2025-10-13 00:10:33.887 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1be4a7e3]
2025-10-13 00:10:33.888 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1be4a7e3]]
2025-10-13 00:10:33.889 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-13 00:10:33.889 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:10:33.889 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:10:33.902 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-13 00:10:33.913 [main] INFO  com.tripplanner.App - Started App in 8.252 seconds (process running for 9.367)
2025-10-13 00:10:56.136 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-13 00:10:56.136 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-13 00:10:56.137 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-13 00:10:56.137 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-13 00:10:56.137 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-13 00:10:56.139 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@a80a896
2025-10-13 00:10:56.139 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@50d05167
2025-10-13 00:10:56.140 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-13 00:10:56.140 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 4 ms
2025-10-13 00:10:56.180 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 00:10:56.238 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 00:10:56.244 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 00:10:56.247 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 00:10:56.278 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 00:10:56.278 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User ID not found in request, using anonymous for development
2025-10-13 00:10:56.278 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: anonymous
2025-10-13 00:10:57.158 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: anonymous
2025-10-13 00:10:57.163 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: anonymous
2025-10-13 00:10:57.234 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 00:10:57.253 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_105ebb3d-b1a7-491c-a811-1af7fff0ecf1, destination=Almaty, Kazakhstan, startDate= (truncated)...]
2025-10-13 00:10:57.339 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 00:10:57.341 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 00:11:33.903 [MessageBroker-1] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2025-10-13 00:17:44.133 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 00:17:44.137 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 00:17:44.138 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 00:17:44.139 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 00:17:44.141 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 00:17:44.141 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User ID not found in request, using anonymous for development
2025-10-13 00:17:44.142 [http-nio-8080-exec-3] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: anonymous
2025-10-13 00:17:46.156 [http-nio-8080-exec-3] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: anonymous
2025-10-13 00:17:46.158 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: anonymous
2025-10-13 00:17:46.197 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 00:17:46.201 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_105ebb3d-b1a7-491c-a811-1af7fff0ecf1, destination=Almaty, Kazakhstan, startDate= (truncated)...]
2025-10-13 00:17:46.207 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 00:17:46.208 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 00:22:16.911 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 00:22:16.915 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 00:22:16.916 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 00:22:16.917 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 00:22:16.919 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 00:22:16.920 [http-nio-8080-exec-2] WARN  com.tripplanner.controller.ItinerariesController - User ID not found in request, using anonymous for development
2025-10-13 00:22:16.920 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: anonymous
2025-10-13 00:22:18.792 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: anonymous
2025-10-13 00:22:18.794 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: anonymous
2025-10-13 00:22:18.796 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 00:22:18.798 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_105ebb3d-b1a7-491c-a811-1af7fff0ecf1, destination=Almaty, Kazakhstan, startDate= (truncated)...]
2025-10-13 00:22:18.804 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 00:22:18.804 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 00:24:42.926 [SpringApplicationShutdownHook] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-10-13 00:24:43.187 [tomcat-shutdown] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Graceful shutdown complete
2025-10-13 00:24:43.190 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 00:24:43.190 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 00:24:43.190 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopping...
2025-10-13 00:24:43.190 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1be4a7e3]]
2025-10-13 00:24:43.190 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1be4a7e3]
2025-10-13 00:24:43.191 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1be4a7e3]
2025-10-13 00:24:43.191 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopped.
2025-10-13 00:24:43.191 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:24:43.191 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:24:43.216 [SpringApplicationShutdownHook] INFO  com.tripplanner.service.GeminiClient - Gemini client cleanup completed
2025-10-13 00:24:43.217 [SpringApplicationShutdownHook] INFO  c.tripplanner.service.openrouter.OpenRouterClient - OpenRouter client cleanup completed
2025-10-13 00:24:49.005 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 13780 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-13 00:24:49.008 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-13 00:24:50.635 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-13 00:24:50.652 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-13 00:24:50.652 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-13 00:24:50.739 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-13 00:24:50.739 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1665 ms
2025-10-13 00:24:50.832 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-13 00:24:50.914 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-13 00:24:50.937 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-13 00:24:50.937 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: gemini
2025-10-13 00:24:50.937 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-13 00:24:50.937 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-13 00:24:51.098 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free  | apiKey=MISSING
2025-10-13 00:24:51.102 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-13 00:24:51.104 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-13 00:24:51.105 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-13 00:24:51.106 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-13 00:24:51.106 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with Gemini as primary, OpenRouter as fallback
2025-10-13 00:24:51.106 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-13 00:24:51.108 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-13 00:24:51.108 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: GeminiClient (available: true)
2025-10-13 00:24:51.109 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: OpenRouterClient (available: false)
2025-10-13 00:24:51.109 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-13 00:24:51.190 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-13 00:24:51.191 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-13 00:24:52.106 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-13 00:24:52.246 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-13 00:24:52.247 [main] INFO  com.tripplanner.service.AgentRegistry - Found 12 agents to register
2025-10-13 00:24:52.248 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-13 00:24:52.248 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-13 00:24:52.248 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-13 00:24:52.248 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-13 00:24:52.248 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-13 00:24:52.249 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-13 00:24:52.249 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-13 00:24:52.249 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-13 00:24:52.249 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-13 00:24:52.249 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: planneragent -> PlannerAgent with capabilities: [create]
2025-10-13 00:24:52.249 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-13 00:24:52.249 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-13 00:24:52.249 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 12
2025-10-13 00:24:52.249 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-13 00:24:52.256 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192]
2025-10-13 00:24:52.257 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192]
2025-10-13 00:24:52.257 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-13 00:24:52.258 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-13 00:24:52.258 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-13 00:24:52.282 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-13 00:24:52.285 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-13 00:24:52.285 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-13 00:24:52.285 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-13 00:24:52.285 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-13 00:24:52.285 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-13 00:24:52.297 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-13 00:24:52.297 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-13 00:24:52.349 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Initializing Task Lifecycle Manager
2025-10-13 00:24:54.710 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Started monitoring 0 existing running tasks
2025-10-13 00:24:54.710 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Task Lifecycle Manager initialized
2025-10-13 00:24:54.721 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-13 00:24:54.722 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-13 00:24:54.722 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-13 00:24:54.722 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-13 00:24:54.722 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-13 00:24:54.722 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-13 00:24:54.722 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-13 00:24:54.815 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-13 00:24:54.820 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-13 00:24:54.848 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-13 00:24:54.994 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 45 mappings in 'requestMappingHandlerMapping'
2025-10-13 00:24:55.043 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-13 00:24:55.081 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-13 00:24:55.185 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-13 00:24:55.258 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.AgentController:
	
2025-10-13 00:24:55.259 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-13 00:24:55.259 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-13 00:24:55.259 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-13 00:24:55.259 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-13 00:24:55.259 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-13 00:24:55.259 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-13 00:24:55.264 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
2025-10-13 00:24:55.266 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-13 00:24:55.354 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-13 00:24:55.471 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-13 00:24:55.788 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 00:24:55.789 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 00:24:55.790 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-13 00:24:55.790 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]
2025-10-13 00:24:55.790 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]
2025-10-13 00:24:55.791 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]]
2025-10-13 00:24:55.792 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-13 00:24:55.792 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:24:55.792 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:24:55.825 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-13 00:24:55.836 [main] INFO  com.tripplanner.App - Started App in 7.495 seconds (process running for 8.36)
2025-10-13 00:25:00.175 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-13 00:25:00.175 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-13 00:25:00.176 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-13 00:25:00.176 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-13 00:25:00.176 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-13 00:25:00.179 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@8167f57
2025-10-13 00:25:00.180 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@5cf33d25
2025-10-13 00:25:00.181 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-13 00:25:00.181 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 6 ms
2025-10-13 00:25:00.227 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 00:25:00.280 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 00:25:00.285 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 00:25:00.289 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 00:25:00.319 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 00:25:00.319 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User ID not found in request, using anonymous for development
2025-10-13 00:25:00.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: anonymous
2025-10-13 00:25:01.091 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: anonymous
2025-10-13 00:25:01.097 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: anonymous
2025-10-13 00:25:01.187 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 00:25:01.207 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_105ebb3d-b1a7-491c-a811-1af7fff0ecf1, destination=Almaty, Kazakhstan, startDate= (truncated)...]
2025-10-13 00:25:01.314 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 00:25:01.316 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 00:25:55.799 [MessageBroker-1] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2025-10-13 00:30:06.552 [SpringApplicationShutdownHook] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-10-13 00:30:06.765 [tomcat-shutdown] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Graceful shutdown complete
2025-10-13 00:30:06.770 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 00:30:06.770 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 00:30:06.770 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopping...
2025-10-13 00:30:06.771 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]]
2025-10-13 00:30:06.771 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]
2025-10-13 00:30:06.771 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]
2025-10-13 00:30:06.771 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopped.
2025-10-13 00:30:06.771 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:30:06.772 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:30:06.794 [SpringApplicationShutdownHook] INFO  com.tripplanner.service.GeminiClient - Gemini client cleanup completed
2025-10-13 00:30:06.794 [SpringApplicationShutdownHook] INFO  c.tripplanner.service.openrouter.OpenRouterClient - OpenRouter client cleanup completed
2025-10-13 00:32:09.717 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 15668 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-13 00:32:09.720 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-13 00:32:11.415 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-13 00:32:11.430 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-13 00:32:11.430 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-13 00:32:11.511 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-13 00:32:11.512 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1727 ms
2025-10-13 00:32:11.588 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-13 00:32:11.666 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-13 00:32:11.687 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-13 00:32:11.687 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: gemini
2025-10-13 00:32:11.687 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-13 00:32:11.687 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-13 00:32:11.831 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free  | apiKey=MISSING
2025-10-13 00:32:11.835 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-13 00:32:11.836 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-13 00:32:11.837 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-13 00:32:11.837 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-13 00:32:11.837 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with Gemini as primary, OpenRouter as fallback
2025-10-13 00:32:11.837 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-13 00:32:11.841 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-13 00:32:11.841 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: GeminiClient (available: true)
2025-10-13 00:32:11.841 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: OpenRouterClient (available: false)
2025-10-13 00:32:11.841 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-13 00:32:11.922 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-13 00:32:11.924 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-13 00:32:12.893 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-13 00:32:13.044 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-13 00:32:13.044 [main] INFO  com.tripplanner.service.AgentRegistry - Found 12 agents to register
2025-10-13 00:32:13.045 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-13 00:32:13.046 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-13 00:32:13.046 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-13 00:32:13.046 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-13 00:32:13.046 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-13 00:32:13.046 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-13 00:32:13.047 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-13 00:32:13.047 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-13 00:32:13.047 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-13 00:32:13.047 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: planneragent -> PlannerAgent with capabilities: [create]
2025-10-13 00:32:13.047 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-13 00:32:13.047 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-13 00:32:13.047 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 12
2025-10-13 00:32:13.048 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-13 00:32:13.056 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192]
2025-10-13 00:32:13.057 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192]
2025-10-13 00:32:13.059 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-13 00:32:13.059 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-13 00:32:13.059 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-13 00:32:13.088 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-13 00:32:13.090 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-13 00:32:13.090 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-13 00:32:13.090 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-13 00:32:13.090 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-13 00:32:13.090 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-13 00:32:13.105 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-13 00:32:13.106 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-13 00:32:13.170 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Initializing Task Lifecycle Manager
2025-10-13 00:32:15.770 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Started monitoring 0 existing running tasks
2025-10-13 00:32:15.770 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Task Lifecycle Manager initialized
2025-10-13 00:32:15.779 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-13 00:32:15.779 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-13 00:32:15.779 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-13 00:32:15.779 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-13 00:32:15.779 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-13 00:32:15.779 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-13 00:32:15.779 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-13 00:32:15.863 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-13 00:32:15.866 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-13 00:32:15.890 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-13 00:32:15.989 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 45 mappings in 'requestMappingHandlerMapping'
2025-10-13 00:32:16.036 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-13 00:32:16.070 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-13 00:32:16.158 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-13 00:32:16.224 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.AgentController:
	
2025-10-13 00:32:16.224 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-13 00:32:16.224 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-13 00:32:16.224 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-13 00:32:16.224 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-13 00:32:16.225 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-13 00:32:16.225 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-13 00:32:16.231 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
2025-10-13 00:32:16.232 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-13 00:32:16.299 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-13 00:32:16.345 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-13 00:32:16.492 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 00:32:16.494 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 00:32:16.495 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-13 00:32:16.495 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]
2025-10-13 00:32:16.496 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]
2025-10-13 00:32:16.496 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]]
2025-10-13 00:32:16.497 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-13 00:32:16.498 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:32:16.498 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:32:16.511 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-13 00:32:16.519 [main] INFO  com.tripplanner.App - Started App in 7.485 seconds (process running for 8.333)
2025-10-13 00:32:26.783 [SpringApplicationShutdownHook] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-10-13 00:32:26.943 [tomcat-shutdown] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Graceful shutdown complete
2025-10-13 00:32:26.945 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 00:32:26.946 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 00:32:26.946 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopping...
2025-10-13 00:32:26.946 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]]
2025-10-13 00:32:26.946 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]
2025-10-13 00:32:26.946 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5b430541]
2025-10-13 00:32:26.946 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopped.
2025-10-13 00:32:26.946 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:32:26.946 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:32:26.966 [SpringApplicationShutdownHook] INFO  com.tripplanner.service.GeminiClient - Gemini client cleanup completed
2025-10-13 00:32:26.966 [SpringApplicationShutdownHook] INFO  c.tripplanner.service.openrouter.OpenRouterClient - OpenRouter client cleanup completed
2025-10-13 00:32:37.061 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 17688 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-13 00:32:37.064 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-13 00:32:38.913 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-13 00:32:38.928 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-13 00:32:38.929 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-13 00:32:39.019 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-13 00:32:39.020 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1885 ms
2025-10-13 00:32:39.203 [main] ERROR com.tripplanner.config.FirestoreConfig - Failed to resolve Firestore credentials
java.io.IOException: Your default credentials were not found. To set up Application Default Credentials for your environment, see https://cloud.google.com/docs/authentication/external/set-up-adc.
	at com.google.auth.oauth2.DefaultCredentialsProvider.getDefaultCredentials(DefaultCredentialsProvider.java:127)
	at com.google.auth.oauth2.GoogleCredentials.getApplicationDefault(GoogleCredentials.java:129)
	at com.google.auth.oauth2.GoogleCredentials.getApplicationDefault(GoogleCredentials.java:101)
	at com.tripplanner.config.FirestoreConfig.resolveCredentials(FirestoreConfig.java:132)
	at com.tripplanner.config.FirestoreConfig.firebaseAuth(FirestoreConfig.java:100)
	at com.tripplanner.config.FirestoreConfig$$SpringCGLIB$$0.CGLIB$firebaseAuth$0(<generated>)
	at com.tripplanner.config.FirestoreConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258)
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:400)
	at com.tripplanner.config.FirestoreConfig$$SpringCGLIB$$0.firebaseAuth(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:172)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:89)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:169)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:489)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1690)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1635)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:785)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:768)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:146)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1459)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:606)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:413)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:207)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:230)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:221)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addServletContextInitializerBeans(ServletContextInitializerBeans.java:106)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.<init>(ServletContextInitializerBeans.java:95)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.getServletContextInitializerBeans(ServletWebServerApplicationContext.java:271)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.selfInitialize(ServletWebServerApplicationContext.java:245)
	at org.springframework.boot.web.embedded.tomcat.TomcatStarter.onStartup(TomcatStarter.java:52)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4464)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:772)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:203)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardService.startInternal(StandardService.java:412)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:870)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.startup.Tomcat.start(Tomcat.java:438)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:128)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.<init>(TomcatWebServer.java:107)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:517)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:219)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:193)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:167)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:621)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:318)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350)
	at com.tripplanner.App.main(App.java:9)
2025-10-13 00:32:39.212 [main] ERROR com.tripplanner.config.FirestoreConfig - Failed to initialize Firebase Auth
java.lang.NullPointerException: FirebaseOptions must be initialized with setCredentials().
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:921)
	at com.google.firebase.FirebaseOptions.<init>(FirebaseOptions.java:91)
	at com.google.firebase.FirebaseOptions.<init>(FirebaseOptions.java:43)
	at com.google.firebase.FirebaseOptions$Builder.build(FirebaseOptions.java:504)
	at com.tripplanner.config.FirestoreConfig.firebaseAuth(FirestoreConfig.java:105)
	at com.tripplanner.config.FirestoreConfig$$SpringCGLIB$$0.CGLIB$firebaseAuth$0(<generated>)
	at com.tripplanner.config.FirestoreConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258)
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:400)
	at com.tripplanner.config.FirestoreConfig$$SpringCGLIB$$0.firebaseAuth(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:172)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:89)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:169)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:489)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1690)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1635)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:785)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:768)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:146)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1459)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:606)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:413)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:207)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:230)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:221)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addServletContextInitializerBeans(ServletContextInitializerBeans.java:106)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.<init>(ServletContextInitializerBeans.java:95)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.getServletContextInitializerBeans(ServletWebServerApplicationContext.java:271)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.selfInitialize(ServletWebServerApplicationContext.java:245)
	at org.springframework.boot.web.embedded.tomcat.TomcatStarter.onStartup(TomcatStarter.java:52)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4464)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:772)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:203)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardService.startInternal(StandardService.java:412)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:870)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.startup.Tomcat.start(Tomcat.java:438)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:128)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.<init>(TomcatWebServer.java:107)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:517)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:219)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:193)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:167)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:621)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:318)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350)
	at com.tripplanner.App.main(App.java:9)
2025-10-13 00:32:39.224 [main] ERROR o.s.boot.web.embedded.tomcat.TomcatStarter - Error starting Tomcat context. Exception: org.springframework.beans.factory.UnsatisfiedDependencyException. Message: Error creating bean with name 'firebaseAuthConfig': Unsatisfied dependency expressed through field 'firebaseAuth': Error creating bean with name 'firebaseAuth' defined in class path resource [com/tripplanner/config/FirestoreConfig.class]: Failed to instantiate [com.google.firebase.auth.FirebaseAuth]: Factory method 'firebaseAuth' threw exception with message: Failed to initialize Firebase Auth
2025-10-13 00:32:39.279 [main] INFO  org.apache.catalina.core.StandardService - Stopping service [Tomcat]
2025-10-13 00:32:39.287 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Unable to start web server
2025-10-13 00:32:39.300 [main] INFO  o.s.b.a.logging.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-13 00:32:39.334 [main] ERROR org.springframework.boot.SpringApplication - Application run failed
org.springframework.context.ApplicationContextException: Unable to start web server
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:170)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:621)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:318)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350)
	at com.tripplanner.App.main(App.java:9)
Caused by: org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:147)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.<init>(TomcatWebServer.java:107)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:517)
	at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:219)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:193)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:167)
	... 8 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'firebaseAuthConfig': Unsatisfied dependency expressed through field 'firebaseAuth': Error creating bean with name 'firebaseAuth' defined in class path resource [com/tripplanner/config/FirestoreConfig.class]: Failed to instantiate [com.google.firebase.auth.FirebaseAuth]: Factory method 'firebaseAuth' threw exception with message: Failed to initialize Firebase Auth
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:788)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:768)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:146)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1459)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:606)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:413)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:207)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:230)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.getOrderedBeansOfType(ServletContextInitializerBeans.java:221)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.addServletContextInitializerBeans(ServletContextInitializerBeans.java:106)
	at org.springframework.boot.web.servlet.ServletContextInitializerBeans.<init>(ServletContextInitializerBeans.java:95)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.getServletContextInitializerBeans(ServletWebServerApplicationContext.java:271)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.selfInitialize(ServletWebServerApplicationContext.java:245)
	at org.springframework.boot.web.embedded.tomcat.TomcatStarter.onStartup(TomcatStarter.java:52)
	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4464)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:772)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)
	at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)
	at java.base/java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:145)
	at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)
	at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:203)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardService.startInternal(StandardService.java:412)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:870)
	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)
	at org.apache.catalina.startup.Tomcat.start(Tomcat.java:438)
	at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:128)
	... 13 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'firebaseAuth' defined in class path resource [com/tripplanner/config/FirestoreConfig.class]: Failed to instantiate [com.google.firebase.auth.FirebaseAuth]: Factory method 'firebaseAuth' threw exception with message: Failed to initialize Firebase Auth
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:657)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:489)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1375)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1205)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1690)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1635)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:785)
	... 63 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [com.google.firebase.auth.FirebaseAuth]: Factory method 'firebaseAuth' threw exception with message: Failed to initialize Firebase Auth
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:200)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:89)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:169)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653)
	... 75 common frames omitted
Caused by: java.lang.RuntimeException: Failed to initialize Firebase Auth
	at com.tripplanner.config.FirestoreConfig.firebaseAuth(FirestoreConfig.java:112)
	at com.tripplanner.config.FirestoreConfig$$SpringCGLIB$$0.CGLIB$firebaseAuth$0(<generated>)
	at com.tripplanner.config.FirestoreConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258)
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:400)
	at com.tripplanner.config.FirestoreConfig$$SpringCGLIB$$0.firebaseAuth(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:172)
	... 78 common frames omitted
Caused by: java.lang.NullPointerException: FirebaseOptions must be initialized with setCredentials().
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:921)
	at com.google.firebase.FirebaseOptions.<init>(FirebaseOptions.java:91)
	at com.google.firebase.FirebaseOptions.<init>(FirebaseOptions.java:43)
	at com.google.firebase.FirebaseOptions$Builder.build(FirebaseOptions.java:504)
	at com.tripplanner.config.FirestoreConfig.firebaseAuth(FirestoreConfig.java:105)
	... 88 common frames omitted
2025-10-13 00:33:48.154 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 22112 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-13 00:33:48.158 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-13 00:33:50.152 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-13 00:33:50.168 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-13 00:33:50.170 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-13 00:33:50.267 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-13 00:33:50.267 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2038 ms
2025-10-13 00:33:50.350 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-13 00:33:50.429 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-13 00:33:50.450 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-13 00:33:50.450 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: openrouter
2025-10-13 00:33:50.450 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-13 00:33:50.450 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-13 00:33:50.604 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free  | apiKey=MISSING
2025-10-13 00:33:50.608 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-13 00:33:50.611 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-13 00:33:50.612 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-13 00:33:50.612 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-13 00:33:50.612 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with OpenRouter as primary, Gemini as fallback
2025-10-13 00:33:50.612 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-13 00:33:50.615 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-13 00:33:50.615 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: OpenRouterClient (available: false)
2025-10-13 00:33:50.615 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: GeminiClient (available: true)
2025-10-13 00:33:50.615 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-13 00:33:50.725 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-13 00:33:50.729 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-13 00:33:51.682 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-13 00:33:51.826 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-13 00:33:51.826 [main] INFO  com.tripplanner.service.AgentRegistry - Found 12 agents to register
2025-10-13 00:33:51.827 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-13 00:33:51.828 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-13 00:33:51.828 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-13 00:33:51.828 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-13 00:33:51.828 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-13 00:33:51.830 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-13 00:33:51.830 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-13 00:33:51.830 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-13 00:33:51.830 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-13 00:33:51.830 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: planneragent -> PlannerAgent with capabilities: [create]
2025-10-13 00:33:51.830 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-13 00:33:51.830 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-13 00:33:51.830 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 12
2025-10-13 00:33:51.830 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-13 00:33:51.839 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192, Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535]
2025-10-13 00:33:51.841 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192, Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535]
2025-10-13 00:33:51.842 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-13 00:33:51.842 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-13 00:33:51.842 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-13 00:33:51.869 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-13 00:33:51.872 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-13 00:33:51.872 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-13 00:33:51.872 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-13 00:33:51.872 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-13 00:33:51.872 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-13 00:33:51.885 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-13 00:33:51.886 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-13 00:33:51.941 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Initializing Task Lifecycle Manager
2025-10-13 00:33:54.615 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Started monitoring 0 existing running tasks
2025-10-13 00:33:54.615 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Task Lifecycle Manager initialized
2025-10-13 00:33:54.628 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-13 00:33:54.628 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-13 00:33:54.629 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-13 00:33:54.629 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-13 00:33:54.629 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-13 00:33:54.629 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-13 00:33:54.629 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-13 00:33:54.752 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-13 00:33:54.758 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-13 00:33:54.800 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-13 00:33:54.988 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 45 mappings in 'requestMappingHandlerMapping'
2025-10-13 00:33:55.071 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-13 00:33:55.132 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-13 00:33:55.328 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-13 00:33:55.433 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.AgentController:
	
2025-10-13 00:33:55.433 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-13 00:33:55.434 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-13 00:33:55.434 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-13 00:33:55.434 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-13 00:33:55.434 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-13 00:33:55.434 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-13 00:33:55.441 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
2025-10-13 00:33:55.443 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-13 00:33:55.547 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-13 00:33:55.602 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-13 00:33:55.731 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 00:33:55.731 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 00:33:55.732 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-13 00:33:55.732 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@73d7d676]
2025-10-13 00:33:55.732 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@73d7d676]
2025-10-13 00:33:55.733 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@73d7d676]]
2025-10-13 00:33:55.733 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-13 00:33:55.735 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:33:55.735 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 00:33:55.750 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-13 00:33:55.759 [main] INFO  com.tripplanner.App - Started App in 8.425 seconds (process running for 9.153)
2025-10-13 00:34:54.974 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-13 00:34:54.975 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-13 00:34:54.976 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-13 00:34:54.976 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-13 00:34:54.977 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-13 00:34:54.979 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@6843fdc4
2025-10-13 00:34:54.980 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@59b1edab
2025-10-13 00:34:54.981 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-13 00:34:54.981 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 6 ms
2025-10-13 00:34:55.030 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 00:34:55.098 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 00:34:55.103 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 00:34:55.107 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 00:34:55.137 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 00:34:55.138 [http-nio-8080-exec-1] WARN  com.tripplanner.controller.ItinerariesController - User ID not found in request, using anonymous for development
2025-10-13 00:34:55.138 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: anonymous
2025-10-13 00:34:55.749 [MessageBroker-1] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2025-10-13 00:34:55.896 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: anonymous
2025-10-13 00:34:55.900 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: anonymous
2025-10-13 00:34:55.976 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 00:34:56.003 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_105ebb3d-b1a7-491c-a811-1af7fff0ecf1, destination=Almaty, Kazakhstan, startDate= (truncated)...]
2025-10-13 00:34:56.104 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 00:34:56.106 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 06:30:12.081 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 19784 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-13 06:30:12.087 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-13 06:30:15.609 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-13 06:30:15.666 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-13 06:30:15.669 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-13 06:30:15.982 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-13 06:30:15.984 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3793 ms
2025-10-13 06:30:16.301 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-13 06:30:16.483 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-13 06:30:16.508 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-13 06:30:16.510 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: openrouter
2025-10-13 06:30:16.510 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-13 06:30:16.510 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-13 06:30:16.883 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free  | apiKey=MISSING
2025-10-13 06:30:16.890 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-13 06:30:16.894 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-13 06:30:16.895 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-13 06:30:16.895 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-13 06:30:16.895 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with OpenRouter as primary, Gemini as fallback
2025-10-13 06:30:16.896 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-13 06:30:16.902 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-13 06:30:16.903 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: OpenRouterClient (available: false)
2025-10-13 06:30:16.904 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: GeminiClient (available: true)
2025-10-13 06:30:16.904 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-13 06:30:17.077 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-13 06:30:17.082 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-13 06:30:18.870 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-13 06:30:19.184 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-13 06:30:19.185 [main] INFO  com.tripplanner.service.AgentRegistry - Found 12 agents to register
2025-10-13 06:30:19.187 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-13 06:30:19.187 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-13 06:30:19.187 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-13 06:30:19.187 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-13 06:30:19.188 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-13 06:30:19.188 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-13 06:30:19.188 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-13 06:30:19.188 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-13 06:30:19.189 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-13 06:30:19.189 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: planneragent -> PlannerAgent with capabilities: [create]
2025-10-13 06:30:19.189 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-13 06:30:19.189 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-13 06:30:19.190 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 12
2025-10-13 06:30:19.191 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-13 06:30:19.203 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192, Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535]
2025-10-13 06:30:19.205 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192, Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535]
2025-10-13 06:30:19.206 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-13 06:30:19.208 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-13 06:30:19.209 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-13 06:30:19.268 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-13 06:30:19.271 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-13 06:30:19.271 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-13 06:30:19.271 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-13 06:30:19.273 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-13 06:30:19.273 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-13 06:30:19.297 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-13 06:30:19.299 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-13 06:30:19.408 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Initializing Task Lifecycle Manager
2025-10-13 06:30:22.963 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Started monitoring 0 existing running tasks
2025-10-13 06:30:22.963 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Task Lifecycle Manager initialized
2025-10-13 06:30:22.984 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-13 06:30:22.985 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-13 06:30:22.985 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-13 06:30:22.985 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-13 06:30:22.986 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-13 06:30:22.986 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-13 06:30:22.986 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-13 06:30:23.199 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-13 06:30:23.209 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-13 06:30:23.278 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-13 06:30:23.515 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 45 mappings in 'requestMappingHandlerMapping'
2025-10-13 06:30:23.604 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-13 06:30:23.668 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-13 06:30:23.906 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-13 06:30:23.995 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.AgentController:
	
2025-10-13 06:30:23.996 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-13 06:30:23.997 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-13 06:30:23.998 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-13 06:30:23.998 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-13 06:30:23.998 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-13 06:30:23.998 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-13 06:30:24.005 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
2025-10-13 06:30:24.006 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-13 06:30:24.117 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-13 06:30:24.204 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-13 06:30:24.434 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 06:30:24.434 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 06:30:24.435 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-13 06:30:24.435 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3023f157]
2025-10-13 06:30:24.435 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3023f157]
2025-10-13 06:30:24.436 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3023f157]]
2025-10-13 06:30:24.438 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-13 06:30:24.439 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 06:30:24.439 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 06:30:24.465 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-13 06:30:24.481 [main] INFO  com.tripplanner.App - Started App in 13.428 seconds (process running for 14.14)
2025-10-13 06:30:43.372 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-13 06:30:43.372 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-13 06:30:43.373 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-13 06:30:43.373 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-13 06:30:43.373 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-13 06:30:43.375 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@6f430ea8
2025-10-13 06:30:43.375 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@5305f936
2025-10-13 06:30:43.375 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-13 06:30:43.375 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2025-10-13 06:30:43.412 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries
2025-10-13 06:30:43.490 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 06:30:43.497 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 06:30:43.502 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 06:30:43.507 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 06:30:43.540 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 06:30:43.540 [http-nio-8080-exec-2] WARN  com.tripplanner.controller.ItinerariesController - User ID not found in request, using anonymous for development
2025-10-13 06:30:43.540 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: anonymous
2025-10-13 06:30:44.185 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: anonymous
2025-10-13 06:30:44.189 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: anonymous
2025-10-13 06:30:44.255 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 06:30:44.276 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_105ebb3d-b1a7-491c-a811-1af7fff0ecf1, destination=Almaty, Kazakhstan, startDate= (truncated)...]
2025-10-13 06:30:44.338 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 06:30:44.341 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 06:30:51.256 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 06:30:51.262 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 06:30:51.263 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 06:30:51.266 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 06:30:51.268 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 06:30:51.269 [http-nio-8080-exec-3] WARN  com.tripplanner.controller.ItinerariesController - User ID not found in request, using anonymous for development
2025-10-13 06:30:51.270 [http-nio-8080-exec-3] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: anonymous
2025-10-13 06:30:51.698 [http-nio-8080-exec-3] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: anonymous
2025-10-13 06:30:51.709 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: anonymous
2025-10-13 06:30:51.717 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 06:30:51.724 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_105ebb3d-b1a7-491c-a811-1af7fff0ecf1, destination=Almaty, Kazakhstan, startDate= (truncated)...]
2025-10-13 06:30:51.735 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 06:30:51.737 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 06:31:24.463 [MessageBroker-1] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2025-10-13 06:31:27.320 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 06:31:27.323 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 06:31:27.323 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 06:31:27.323 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 06:31:27.324 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 06:31:27.324 [http-nio-8080-exec-4] WARN  com.tripplanner.controller.ItinerariesController - User ID not found in request, using anonymous for development
2025-10-13 06:31:27.324 [http-nio-8080-exec-4] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: anonymous
2025-10-13 06:31:27.755 [http-nio-8080-exec-4] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: anonymous
2025-10-13 06:31:27.757 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: anonymous
2025-10-13 06:31:27.759 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 06:31:27.761 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_105ebb3d-b1a7-491c-a811-1af7fff0ecf1, destination=Almaty, Kazakhstan, startDate= (truncated)...]
2025-10-13 06:31:27.769 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 06:31:27.770 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 06:36:37.421 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 16484 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-13 06:36:37.424 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-13 06:36:40.490 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-13 06:36:40.505 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-13 06:36:40.506 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-13 06:36:40.658 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-13 06:36:40.658 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3139 ms
2025-10-13 06:36:40.823 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-13 06:36:40.957 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-13 06:36:40.987 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-13 06:36:40.987 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: openrouter
2025-10-13 06:36:40.987 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-13 06:36:40.987 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-13 06:36:41.223 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free  | apiKey=MISSING
2025-10-13 06:36:41.230 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-13 06:36:41.233 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-13 06:36:41.234 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-13 06:36:41.235 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-13 06:36:41.235 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with OpenRouter as primary, Gemini as fallback
2025-10-13 06:36:41.235 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-13 06:36:41.238 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-13 06:36:41.238 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: OpenRouterClient (available: false)
2025-10-13 06:36:41.239 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: GeminiClient (available: true)
2025-10-13 06:36:41.239 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-13 06:36:41.380 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-13 06:36:41.382 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-13 06:36:43.161 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-13 06:36:43.435 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-13 06:36:43.435 [main] INFO  com.tripplanner.service.AgentRegistry - Found 12 agents to register
2025-10-13 06:36:43.437 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-13 06:36:43.437 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-13 06:36:43.437 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-13 06:36:43.438 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-13 06:36:43.438 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-13 06:36:43.438 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-13 06:36:43.438 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-13 06:36:43.438 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-13 06:36:43.439 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-13 06:36:43.439 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: planneragent -> PlannerAgent with capabilities: [create]
2025-10-13 06:36:43.439 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-13 06:36:43.439 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-13 06:36:43.439 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 12
2025-10-13 06:36:43.439 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-13 06:36:43.452 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192, Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535]
2025-10-13 06:36:43.453 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free , Temperature: 0.70, Max Tokens: 8192, Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535]
2025-10-13 06:36:43.454 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-13 06:36:43.455 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-13 06:36:43.455 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-13 06:36:43.494 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-13 06:36:43.498 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-13 06:36:43.499 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-13 06:36:43.499 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-13 06:36:43.499 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-13 06:36:43.499 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-13 06:36:43.523 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-13 06:36:43.526 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-13 06:36:43.645 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Initializing Task Lifecycle Manager
2025-10-13 06:36:46.909 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Started monitoring 0 existing running tasks
2025-10-13 06:36:46.910 [main] INFO  com.tripplanner.service.TaskLifecycleManager - Task Lifecycle Manager initialized
2025-10-13 06:36:46.950 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-13 06:36:46.950 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-13 06:36:46.951 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-13 06:36:46.951 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-13 06:36:46.951 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-13 06:36:46.951 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-13 06:36:46.952 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-13 06:36:47.166 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-13 06:36:47.175 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-13 06:36:47.272 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-13 06:36:47.537 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 45 mappings in 'requestMappingHandlerMapping'
2025-10-13 06:36:47.637 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-13 06:36:47.698 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-13 06:36:47.982 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-13 06:36:48.152 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.AgentController:
	
2025-10-13 06:36:48.153 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-13 06:36:48.153 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-13 06:36:48.154 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-13 06:36:48.154 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-13 06:36:48.155 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-13 06:36:48.155 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-13 06:36:48.169 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
2025-10-13 06:36:48.172 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-13 06:36:48.354 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-13 06:36:48.472 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-13 06:36:48.760 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-13 06:36:48.760 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-13 06:36:48.762 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-13 06:36:48.763 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@58b5d5fc]
2025-10-13 06:36:48.763 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@58b5d5fc]
2025-10-13 06:36:48.764 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@58b5d5fc]]
2025-10-13 06:36:48.766 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-13 06:36:48.768 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 06:36:48.768 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-13 06:36:48.794 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-13 06:36:48.816 [main] INFO  com.tripplanner.App - Started App in 12.508 seconds (process running for 13.324)
2025-10-13 06:36:48.960 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-13 06:36:48.960 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-13 06:36:48.962 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-13 06:36:48.962 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-13 06:36:48.962 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-13 06:36:48.963 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@59b1edab
2025-10-13 06:36:48.964 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@3f033664
2025-10-13 06:36:48.965 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-13 06:36:48.965 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2025-10-13 06:36:49.624 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 06:36:49.706 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 06:36:49.713 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 06:36:49.719 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 06:36:49.762 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 06:36:49.763 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-13 06:36:50.244 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Found 0 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-13 06:36:50.246 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Found 0 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-13 06:36:50.327 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 06:36:50.331 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-13 06:36:50.368 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 06:36:50.371 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 06:37:40.672 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-13 06:37:40.674 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-13 06:37:40.675 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-13 06:37:40.676 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-13 06:37:40.677 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-13 06:37:40.677 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-13 06:37:41.125 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Found 0 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-13 06:37:41.125 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Found 0 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-13 06:37:41.126 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-13 06:37:41.126 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-13 06:37:41.128 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-13 06:37:41.128 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-13 06:37:48.776 [MessageBroker-1] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2025-10-18 18:12:18.676 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 20804 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-18 18:12:18.679 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-18 18:12:24.431 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-18 18:12:24.450 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-18 18:12:24.451 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-18 18:12:24.559 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-18 18:12:24.560 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5795 ms
2025-10-18 18:12:24.727 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-18 18:12:24.835 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-18 18:12:24.860 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-18 18:12:24.860 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: gemini
2025-10-18 18:12:24.860 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-18 18:12:24.860 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-18 18:12:25.168 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free | apiKey=MISSING
2025-10-18 18:12:25.172 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-18 18:12:25.174 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-18 18:12:25.175 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-18 18:12:25.175 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-18 18:12:25.175 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with Gemini as primary, OpenRouter as fallback
2025-10-18 18:12:25.175 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-18 18:12:25.179 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-18 18:12:25.179 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: GeminiClient (available: true)
2025-10-18 18:12:25.179 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: OpenRouterClient (available: false)
2025-10-18 18:12:25.179 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-18 18:12:25.290 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-18 18:12:25.293 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-18 18:12:26.510 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-18 18:12:26.666 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-18 18:12:26.667 [main] INFO  com.tripplanner.service.AgentRegistry - Found 11 agents to register
2025-10-18 18:12:26.668 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-18 18:12:26.669 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-18 18:12:26.669 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-18 18:12:26.669 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-18 18:12:26.669 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-18 18:12:26.669 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-18 18:12:26.669 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-18 18:12:26.670 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-18 18:12:26.670 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-18 18:12:26.670 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-18 18:12:26.670 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-18 18:12:26.670 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 11
2025-10-18 18:12:26.670 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-18 18:12:26.683 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-18 18:12:26.684 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-18 18:12:26.685 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-18 18:12:26.685 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-18 18:12:26.685 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-18 18:12:26.715 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-18 18:12:26.718 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-18 18:12:26.718 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-18 18:12:26.718 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-18 18:12:26.718 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-18 18:12:26.718 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-18 18:12:26.735 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-18 18:12:26.736 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-18 18:12:26.783 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-18 18:12:26.783 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-18 18:12:26.783 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-18 18:12:26.783 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-18 18:12:26.783 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-18 18:12:26.783 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-18 18:12:26.783 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-18 18:12:26.910 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-18 18:12:26.916 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-18 18:12:26.956 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-18 18:12:27.098 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 42 mappings in 'requestMappingHandlerMapping'
2025-10-18 18:12:27.151 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-18 18:12:27.196 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-18 18:12:27.331 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-18 18:12:27.406 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.AgentController:
	
2025-10-18 18:12:27.406 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-18 18:12:27.407 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-18 18:12:27.407 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-18 18:12:27.407 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-18 18:12:27.407 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-18 18:12:27.407 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-18 18:12:27.414 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
2025-10-18 18:12:27.416 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-18 18:12:27.514 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-18 18:12:27.588 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-18 18:12:27.812 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-18 18:12:27.813 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-18 18:12:27.813 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-18 18:12:27.813 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1d1fd2aa]
2025-10-18 18:12:27.813 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1d1fd2aa]
2025-10-18 18:12:27.814 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1d1fd2aa]]
2025-10-18 18:12:27.815 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-18 18:12:27.815 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 18:12:27.815 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 18:12:27.832 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-18 18:12:27.842 [main] INFO  com.tripplanner.App - Started App in 10.057 seconds (process running for 12.599)
2025-10-18 18:12:41.811 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-18 18:12:41.812 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-18 18:12:41.812 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-18 18:12:41.812 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-18 18:12:41.812 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-18 18:12:41.813 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@7096d451
2025-10-18 18:12:41.815 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@46a97805
2025-10-18 18:12:41.815 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-18 18:12:41.815 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2025-10-18 18:12:41.846 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries
2025-10-18 18:12:42.354 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-18 18:12:42.357 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-18 18:12:42.360 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-18 18:12:42.363 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-18 18:12:42.381 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-18 18:12:42.381 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:12:45.194 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Found 11 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:12:45.197 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Found 11 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:12:45.234 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:12:45.244 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0, destination=Iraq, Iraq, startDate=2026-01- (truncated)...]
2025-10-18 18:12:45.287 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:12:45.288 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:12:54.434 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/json
2025-10-18 18:12:54.440 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/json
2025-10-18 18:12:54.441 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/json
2025-10-18 18:12:54.441 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/json", parameters={}
2025-10-18 18:12:54.442 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:12:54.461 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0
2025-10-18 18:12:54.462 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:12:56.767 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0
2025-10-18 18:12:56.773 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:12:56.814 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0', version=1, userId='null', (truncated)...]
2025-10-18 18:12:56.841 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:12:56.841 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:12:56.908 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/chat/history
2025-10-18 18:12:56.908 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/json
2025-10-18 18:12:56.909 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/json
2025-10-18 18:12:56.909 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/json", parameters={}
2025-10-18 18:12:56.909 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:12:56.909 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0
2025-10-18 18:12:56.910 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:12:56.912 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/chat/history
2025-10-18 18:12:56.913 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/chat/history
2025-10-18 18:12:56.913 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0/chat/history", parameters={}
2025-10-18 18:12:56.914 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:12:57.919 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791377912
2025-10-18 18:12:57.921 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791377912
2025-10-18 18:12:57.922 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791377912", parameters={masked}
2025-10-18 18:12:57.922 [http-nio-8080-exec-8] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:12:57.926 [http-nio-8080-exec-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791377912
2025-10-18 18:12:57.926 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:12:57.926 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:12:57.931 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/683/qmyu2hoy/websocket
2025-10-18 18:12:57.931 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/683/qmyu2hoy/websocket
2025-10-18 18:12:57.931 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/683/qmyu2hoy/websocket", parameters={}
2025-10-18 18:12:57.931 [http-nio-8080-exec-9] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:12:57.933 [http-nio-8080-exec-9] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/683/qmyu2hoy/websocket
2025-10-18 18:12:57.941 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:12:57.966 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:12:57.984 [http-nio-8080-exec-9] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=qmyu2hoy]
2025-10-18 18:12:58.007 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=qmyu2hoy
2025-10-18 18:12:58.013 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0 id=sub-0 session=qmyu2hoy
2025-10-18 18:12:58.013 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0 id=sub-1 session=qmyu2hoy
2025-10-18 18:12:58.016 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0 id=sub-2 session=qmyu2hoy
2025-10-18 18:12:59.066 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0
2025-10-18 18:12:59.067 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:12:59.069 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0', version=1, userId='null', (truncated)...]
2025-10-18 18:12:59.071 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:12:59.071 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:12:59.416 [http-nio-8080-exec-7] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_65e5dac1-cc53-4ae3-94bd-a13d7b633fa0
2025-10-18 18:12:59.417 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:12:59.417 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=kkwZejp6D06w0UVbdUnJ, message=extend one more day please, add new locations to visit for day 5  (truncated)...]
2025-10-18 18:12:59.420 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:12:59.420 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:13:27.815 [MessageBroker-7] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 13], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 13], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 7]
2025-10-18 18:13:29.628 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=qmyu2hoy
2025-10-18 18:13:29.628 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=qmyu2hoy
2025-10-18 18:13:29.629 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=qmyu2hoy
2025-10-18 18:13:29.629 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=qmyu2hoy
2025-10-18 18:13:29.683 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=qmyu2hoy] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:13:29.683 [http-nio-8080-exec-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session qmyu2hoy
2025-10-18 18:13:29.683 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=qmyu2hoy
2025-10-18 18:13:29.683 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={}, simpSessionId=qmyu2hoy}], simpSessionId=qmyu2hoy}]
2025-10-18 18:13:37.948 [MessageBroker-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [qmyu2hoy]
2025-10-18 18:14:16.124 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries
2025-10-18 18:14:16.124 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries
2025-10-18 18:14:16.125 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries", parameters={}
2025-10-18 18:14:16.125 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#create(CreateItineraryReq, HttpServletRequest)
2025-10-18 18:14:16.140 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateItineraryReq(destination=Poland, Poland, startLocation=Bengaluru, India, startDate=2026-01-24, (truncated)...]
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Creating itinerary with real-time updates
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Request: CreateItineraryReq(destination=Poland, Poland, startLocation=Bengaluru, India, startDate=2026-01-24, endDate=2026-01-27, party=PartyDto(adults=1, children=0, infants=0, rooms=1), budgetTier=luxury, interests=[relaxation, nature, cuisine], constraints=[budgetFriendly], language=en)
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - === CREATE ITINERARY REQUEST ===
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Request Details:
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService -   Destination: Poland, Poland
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService -   Start Date: 2026-01-24
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService -   End Date: 2026-01-27
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService -   Duration: 4 days
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService -   Budget Tier: luxury
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService -   Language: en
2025-10-18 18:14:16.167 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService -   Party: 1 adults, 0 children, 0 infants, 1 rooms
2025-10-18 18:14:16.168 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService -   Interests: relaxation, nature, cuisine
2025-10-18 18:14:16.168 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService -   Constraints: budgetFriendly
2025-10-18 18:14:16.168 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Creating initial itinerary and establishing ownership synchronously
2025-10-18 18:14:16.168 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - === ITINERARY INITIALIZATION SERVICE: CREATING INITIAL ITINERARY ===
2025-10-18 18:14:16.168 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:16.168 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - Destination: Poland, Poland
2025-10-18 18:14:16.168 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:16.169 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - Step 1: Creating initial itinerary structure
2025-10-18 18:14:16.169 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - Step 2: Saving initial itinerary to ItineraryJsonService
2025-10-18 18:14:16.614 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - Step 3: Establishing ownership by saving trip metadata
2025-10-18 18:14:16.614 [http-nio-8080-exec-8] INFO  com.tripplanner.service.UserDataService - Saving trip metadata it_ba231c6a-0791-4520-b86f-c60fb598125b for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:18.015 [http-nio-8080-exec-8] INFO  com.tripplanner.service.UserDataService - Successfully saved trip metadata it_ba231c6a-0791-4520-b86f-c60fb598125b for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:18.015 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - === INITIAL ITINERARY CREATED AND OWNERSHIP ESTABLISHED ===
2025-10-18 18:14:18.015 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:18.015 [http-nio-8080-exec-8] INFO  c.t.service.ItineraryInitializationService - User can now access /itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json endpoint
2025-10-18 18:14:18.015 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Waiting 2 seconds for frontend SSE connection to establish...
2025-10-18 18:14:20.021 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Starting async itinerary generation for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1 with ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.021 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Starting pipeline generation
2025-10-18 18:14:20.021 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Generated executionId: exec_1760791460021 for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.032 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - === PIPELINE ORCHESTRATOR: STARTING ===
2025-10-18 18:14:20.032 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.033 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - Destination: Poland, Poland, Duration: 4 days
2025-10-18 18:14:20.033 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - Parallel: true
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - === CREATE ITINERARY RESPONSE ===
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - ExecutionId: exec_1760791460021
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Status: generating
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Ownership established: YES
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Async generation started: YES
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Async callbacks attached: YES
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - Error handling enabled: YES
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - User can now access /itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:14:20.033 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ItineraryService - =====================================
2025-10-18 18:14:20.034 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 1: SKELETON GENERATION ===
2025-10-18 18:14:20.034 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Starting skeleton generation with timeout: 120000 ms
2025-10-18 18:14:20.034 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Request details: destination=Poland, Poland, duration=4 days
2025-10-18 18:14:20.034 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - SkeletonPlannerAgent.generateSkeleton() started for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.034 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT ===
2025-10-18 18:14:20.034 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating lightweight skeleton for 4 days
2025-10-18 18:14:20.034 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Destination: Poland, Poland
2025-10-18 18:14:20.034 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Enhanced itinerary creation response prepared: it_ba231c6a-0791-4520-b86f-c60fb598125b for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:20.035 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - SSE endpoint: /api/v1/itineraries/patches?itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b&executionId=exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5
2025-10-18 18:14:20.035 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Execution ID: exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5
2025-10-18 18:14:20.035 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Estimated completion: 2025-10-18T18:15:19.033305200
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 2558609e-9995-42db-b081-609ce843ad94
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 1 structure
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:44:20.035952Z
2025-10-18 18:14:20.035 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 1 with minimal prompt
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2935
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 18:14:20.035 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-18 18:14:20.036 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3349
2025-10-18 18:14:20.042 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:14:20.043 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 18:14:20.044 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [ItineraryCreationResponse{itinerary=it_ba231c6a-0791-4520-b86f-c60fb598125b, executionId='exec_7fe81 (truncated)...]
2025-10-18 18:14:20.047 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:14:20.047 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:14:20.065 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/patches?itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b&executionId=exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5&token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:20.066 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/patches?itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b&executionId=exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5&token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:20.066 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/patches?itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b&executionId=exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5&token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA", parameters={masked}
2025-10-18 18:14:20.066 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getPatches(String, String)
2025-10-18 18:14:20.068 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Opening enhanced SSE connection for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b, execution: exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5
2025-10-18 18:14:20.068 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:20.069 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:20.069 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA", parameters={masked}
2025-10-18 18:14:20.070 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.AgentController#streamEvents(String, HttpServletRequest)
2025-10-18 18:14:20.070 [http-nio-8080-exec-9] INFO  com.tripplanner.service.SseConnectionManager - Registering SSE connection for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b, execution: exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - === SSE EVENTS REQUEST ===
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - Request Time: 18:14:20.071896500
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - Client requesting SSE events connection
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - Created SSE emitter: SseEmitter@4047586c
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.service.AgentEventBus - === SSE EMITTER REGISTRATION ===
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.service.AgentEventBus - Emitter: SseEmitter@4047586c
2025-10-18 18:14:20.071 [http-nio-8080-exec-10] INFO  com.tripplanner.service.AgentEventBus - Total emitters for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b: 1
2025-10-18 18:14:20.073 [http-nio-8080-exec-10] INFO  com.tripplanner.service.AgentEventBus - Total active itineraries: 1
2025-10-18 18:14:20.073 [http-nio-8080-exec-10] INFO  com.tripplanner.service.AgentEventBus - ===============================
2025-10-18 18:14:20.073 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:14:20.074 [http-nio-8080-exec-9] INFO  com.tripplanner.service.SseConnectionManager - SSE connection registered successfully. Total connections for it_ba231c6a-0791-4520-b86f-c60fb598125b: 1
2025-10-18 18:14:20.074 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - Initial SSE events connection event sent successfully
2025-10-18 18:14:20.075 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Enhanced SSE connection established for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b, execution: exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5
2025-10-18 18:14:20.075 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - === SSE EVENTS STREAM ESTABLISHED ===
2025-10-18 18:14:20.075 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.075 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - Emitter registered and ready
2025-10-18 18:14:20.075 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.AgentController - =============================
2025-10-18 18:14:20.078 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:20.079 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:14:20.079 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:20.079 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA", parameters={masked}
2025-10-18 18:14:20.079 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:14:20.079 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:14:20.079 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.AgentController#streamEvents(String, HttpServletRequest)
2025-10-18 18:14:20.079 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - === SSE EVENTS REQUEST ===
2025-10-18 18:14:20.080 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.080 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - Request Time: 18:14:20.080680700
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - Client requesting SSE events connection
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - Created SSE emitter: SseEmitter@7588da4c
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.service.AgentEventBus - === SSE EMITTER REGISTRATION ===
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.service.AgentEventBus - Emitter: SseEmitter@7588da4c
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.service.AgentEventBus - Total emitters for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b: 2
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.service.AgentEventBus - Total active itineraries: 1
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.service.AgentEventBus - ===============================
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - Initial SSE events connection event sent successfully
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - === SSE EVENTS STREAM ESTABLISHED ===
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - Emitter registered and ready
2025-10-18 18:14:20.080 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.AgentController - =============================
2025-10-18 18:14:20.082 [http-nio-8080-exec-10] DEBUG o.s.web.context.request.async.WebAsyncManager - Started async request for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:14:20.082 [http-nio-8080-exec-9] DEBUG o.s.web.context.request.async.WebAsyncManager - Started async request for "/api/v1/itineraries/patches"
2025-10-18 18:14:20.082 [http-nio-8080-exec-7] DEBUG o.s.web.context.request.async.WebAsyncManager - Started async request for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:14:20.087 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Exiting but response remains open for further handling
2025-10-18 18:14:20.087 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Exiting but response remains open for further handling
2025-10-18 18:14:20.087 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:14:20.087 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:14:20.088 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Exiting but response remains open for further handling
2025-10-18 18:14:20.089 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:14:21.881 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:21.882 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:14:21.882 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='PEoULm (truncated)...]
2025-10-18 18:14:21.883 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:14:21.884 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:14:21.892 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:14:21.892 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:21.893 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:14:21.893 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:14:21.893 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:21.893 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:14:21.893 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA", parameters={masked}
2025-10-18 18:14:21.893 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.AgentController#streamEvents(String, HttpServletRequest)
2025-10-18 18:14:21.893 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:21.893 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - === SSE EVENTS REQUEST ===
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - Request Time: 18:14:21.894600
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - Client requesting SSE events connection
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - Created SSE emitter: SseEmitter@14a932ea
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.service.AgentEventBus - === SSE EMITTER REGISTRATION ===
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.service.AgentEventBus - Emitter: SseEmitter@14a932ea
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.service.AgentEventBus - Total emitters for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b: 3
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.service.AgentEventBus - Total active itineraries: 1
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.service.AgentEventBus - ===============================
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - Initial SSE events connection event sent successfully
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - === SSE EVENTS STREAM ESTABLISHED ===
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - Emitter registered and ready
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.AgentController - =============================
2025-10-18 18:14:21.894 [http-nio-8080-exec-3] DEBUG o.s.web.context.request.async.WebAsyncManager - Started async request for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:14:21.895 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Exiting but response remains open for further handling
2025-10-18 18:14:21.895 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:14:23.778 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:23.780 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:14:23.780 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='PEoULm (truncated)...]
2025-10-18 18:14:23.781 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:14:23.781 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:14:32.535 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 18:14:32.535 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 18:14:32.535 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Length: 3014
2025-10-18 18:14:32.535 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 1,\n  \"date\": \"2026-01-24\",\n  \"location\": \"Poland\",\n  \"summary\": \"Day 1 itinerary focusing on relaxation, nature, and cuisine.\",\n  \"nodes\": [\n    {\n      \"id\": \"day1_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Accommodation Dining Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day1_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Nature Walk / Relaxation\",\n      \"location\": {\n        \"name\": \"Local Natural Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day1_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Local Eatery\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day1_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Spa / Wellness Session\",\n      \"location\": {\n        \"name\": \"Wellness Center\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:00\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day1_node5\",\n      \"type\": \"attraction\",\n      \"title\": \"Pre-Dinner Relaxation\",\n      \"location\": {\n        \"name\": \"Accommodation Lounge\"\n      },\n      \"timing\": {\n        \"startTime\": \"17:30\",\n        \"endTime\": \"19:00\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day1_node6\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner Experience\",\n      \"location\": {\n        \"name\": \"Fine Dining Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:30\",\n        \"endTime\": \"21:00\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day1_node7\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Luxury Hotel / Resort\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:30\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 630\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 838,
    "candidatesTokenCount": 756,
    "totalTokenCount": 2798,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 838
      }
    ],
    "thoughtsTokenCount": 1204
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "sIvzaKisE5qj1e8P8JLtoQY"
}

2025-10-18 18:14:32.542 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_1639619564_20251018_181432.json
2025-10-18 18:14:32.543 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 18:14:32.543 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content length: 2139
2025-10-18 18:14:32.543 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 1,
  "date": "2026-01-24",
  "location": "Poland",
  "summary": "Day 1 itinerary focusing on relaxation, nature, and cuisine.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation D...
2025-10-18 18:14:32.543 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 18:14:32.543 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 18:14:32.543 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-18 18:14:32.543 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 1
2025-10-18 18:14:32.543 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 1,
  "date": "2026-01-24",
  "location": "Poland",
  "summary": "Day 1 itinerary focusing on relaxation, nature, and cuisine.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Dining Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node2",
      "type": "attraction",
      "title": "Morning Nature Walk / Relaxation",
      "location": {
        "name": "Local Natural Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day1_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node4",
      "type": "attraction",
      "title": "Afternoon Spa / Wellness Session",
      "location": {
        "name": "Wellness Center"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day1_node5",
      "type": "attraction",
      "title": "Pre-Dinner Relaxation",
      "location": {
        "name": "Accommodation Lounge"
      },
      "timing": {
        "startTime": "17:30",
        "endTime": "19:00",
        "durationMin": 90
      }
    },
    {
      "id": "day1_node6",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Fine Dining Restaurant"
      },
      "timing": {
        "startTime": "19:30",
        "endTime": "21:00",
        "durationMin": 90
      }
    },
    {
      "id": "day1_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel / Resort"
      },
      "timing": {
        "startTime": "21:30",
        "endTime": "08:00",
        "durationMin": 630
      }
    }
  ]
}
```
2025-10-18 18:14:32.543 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-18 18:14:32.545 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 1,
  "date": "2026-01-24",
  "location": "Poland",
  "summary": "Day 1 itinerary focusing on relaxation, nature, and cuisine.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Dining Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node2",
      "type": "attraction",
      "title": "Morning Nature Walk / Relaxation",
      "location": {
        "name": "Local Natural Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day1_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node4",
      "type": "attraction",
      "title": "Afternoon Spa / Wellness Session",
      "location": {
        "name": "Wellness Center"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day1_node5",
      "type": "attraction",
      "title": "Pre-Dinner Relaxation",
      "location": {
        "name": "Accommodation Lounge"
      },
      "timing": {
        "startTime": "17:30",
        "endTime": "19:00",
        "durationMin": 90
      }
    },
    {
      "id": "day1_node6",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Fine Dining Restaurant"
      },
      "timing": {
        "startTime": "19:30",
        "endTime": "21:00",
        "durationMin": 90
      }
    },
    {
      "id": "day1_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel / Resort"
      },
      "timing": {
        "startTime": "21:30",
        "endTime": "08:00",
        "durationMin": 630
      }
    }
  ]
}
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event: itinerary=it_ba231c6a-0791-4520-b86f-c60fb598125b, day=1, activities=7
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 1 created and saved
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 2558609e-9995-42db-b081-609ce843ad94
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 35
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 2 structure
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-18 18:14:32.992 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:44:32.992665900Z
2025-10-18 18:14:33.001 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - Failed to send event to SSE emitter for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b (client likely disconnected)
2025-10-18 18:14:33.002 [http-nio-8080-exec-4] DEBUG o.s.web.context.request.async.WebAsyncManager - Servlet container error notification for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:14:33.002 [http-nio-8080-exec-4] DEBUG o.s.web.context.request.async.WebAsyncManager - Async result set for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:14:33.002 [http-nio-8080-exec-4] DEBUG o.s.web.context.request.async.WebAsyncManager - Performing async dispatch for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:14:33.002 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Event sent to 2 SSE emitters successfully, 1 failed for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 2 with minimal prompt
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2935
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3349
2025-10-18 18:14:33.003 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 18:14:33.011 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:33.011 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:14:33.012 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - "ASYNC" dispatch for GET "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA", parameters={masked}
2025-10-18 18:14:33.012 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - Resume with async result [java.io.IOException: An established connection was aborted by the software in your host machine]
2025-10-18 18:14:33.016 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.tripplanner.exception.GlobalExceptionHandler#handleGenericException(Exception, WebRequest)
2025-10-18 18:14:33.016 [http-nio-8080-exec-4] ERROR com.tripplanner.exception.GlobalExceptionHandler - === GENERIC EXCEPTION ===
2025-10-18 18:14:33.016 [http-nio-8080-exec-4] ERROR com.tripplanner.exception.GlobalExceptionHandler - Type: IOException
2025-10-18 18:14:33.016 [http-nio-8080-exec-4] ERROR com.tripplanner.exception.GlobalExceptionHandler - Error: An established connection was aborted by the software in your host machine
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.AgentEventBus.publish(AgentEventBus.java:96)
	at com.tripplanner.agents.BaseAgent.emitEvent(BaseAgent.java:206)
	at com.tripplanner.agents.BaseAgent.emitProgress(BaseAgent.java:187)
	at com.tripplanner.agents.SkeletonPlannerAgent.generateSkeleton(SkeletonPlannerAgent.java:94)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executeSkeletonPhase$3(PipelineOrchestrator.java:189)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:14:33.024 [http-nio-8080-exec-4] ERROR com.tripplanner.exception.GlobalExceptionHandler - Request: uri=/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:33.024 [http-nio-8080-exec-4] ERROR com.tripplanner.exception.GlobalExceptionHandler - =========================
2025-10-18 18:14:33.027 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Found 'Content-Type:text/event-stream' in response
2025-10-18 18:14:33.027 [http-nio-8080-exec-4] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.tripplanner.exception.GlobalExceptionHandler#handleGenericException(Exception, WebRequest)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.tripplanner.exception.ErrorResponse] with preset Content-Type 'text/event-stream'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:365)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:263)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:471)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:73)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:182)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1360)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:612)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:540)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:511)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:599)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:342)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:14:33.029 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Unresolved failure from "ASYNC" dispatch: java.io.IOException: An established connection was aborted by the software in your host machine
2025-10-18 18:14:33.029 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:14:33.029 [http-nio-8080-exec-4] ERROR o.a.c.c.C.[.[localhost].[/].[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] threw exception
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.AgentEventBus.publish(AgentEventBus.java:96)
	at com.tripplanner.agents.BaseAgent.emitEvent(BaseAgent.java:206)
	at com.tripplanner.agents.BaseAgent.emitProgress(BaseAgent.java:187)
	at com.tripplanner.agents.SkeletonPlannerAgent.generateSkeleton(SkeletonPlannerAgent.java:94)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executeSkeletonPhase$3(PipelineOrchestrator.java:189)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:14:33.031 [http-nio-8080-exec-4] ERROR o.a.c.c.C.[.[localhost].[/].[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.AgentEventBus.publish(AgentEventBus.java:96)
	at com.tripplanner.agents.BaseAgent.emitEvent(BaseAgent.java:206)
	at com.tripplanner.agents.BaseAgent.emitProgress(BaseAgent.java:187)
	at com.tripplanner.agents.SkeletonPlannerAgent.generateSkeleton(SkeletonPlannerAgent.java:94)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executeSkeletonPhase$3(PipelineOrchestrator.java:189)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:14:43.383 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 18:14:43.383 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 18:14:43.383 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Length: 2681
2025-10-18 18:14:43.383 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 2,\n  \"date\": \"2026-01-25\",\n  \"location\": \"Poland\",\n  \"summary\": \"A day focused on relaxation, nature, and local cuisine in Poland.\",\n  \"nodes\": [\n    {\n      \"id\": \"day2_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Accommodation Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day2_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Nature Walk / Relaxation Session\",\n      \"location\": {\n        \"name\": \"Natural Surroundings\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day2_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Local Eatery\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day2_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Scenic Exploration\",\n      \"location\": {\n        \"name\": \"Picturesque Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:30\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day2_node5\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner Experience\",\n      \"location\": {\n        \"name\": \"Fine Dining Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"20:30\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day2_node6\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Luxury Hotel\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:00\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 660\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 838,
    "candidatesTokenCount": 656,
    "totalTokenCount": 2439,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 838
      }
    ],
    "thoughtsTokenCount": 945
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "u4vzaNbyELej1e8Pl7qaqAY"
}

2025-10-18 18:14:43.387 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-59401496_20251018_181443.json
2025-10-18 18:14:43.388 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 18:14:43.388 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1850
2025-10-18 18:14:43.388 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 2,
  "date": "2026-01-25",
  "location": "Poland",
  "summary": "A day focused on relaxation, nature, and local cuisine in Poland.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodat...
2025-10-18 18:14:43.388 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 18:14:43.388 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 18:14:43.388 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-18 18:14:43.388 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 2
2025-10-18 18:14:43.389 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 2,
  "date": "2026-01-25",
  "location": "Poland",
  "summary": "A day focused on relaxation, nature, and local cuisine in Poland.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node2",
      "type": "attraction",
      "title": "Morning Nature Walk / Relaxation Session",
      "location": {
        "name": "Natural Surroundings"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day2_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node4",
      "type": "attraction",
      "title": "Afternoon Scenic Exploration",
      "location": {
        "name": "Picturesque Area"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day2_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Fine Dining Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day2_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
```
2025-10-18 18:14:43.389 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-18 18:14:43.391 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 2,
  "date": "2026-01-25",
  "location": "Poland",
  "summary": "A day focused on relaxation, nature, and local cuisine in Poland.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node2",
      "type": "attraction",
      "title": "Morning Nature Walk / Relaxation Session",
      "location": {
        "name": "Natural Surroundings"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day2_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node4",
      "type": "attraction",
      "title": "Afternoon Scenic Exploration",
      "location": {
        "name": "Picturesque Area"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day2_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Fine Dining Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day2_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event: itinerary=it_ba231c6a-0791-4520-b86f-c60fb598125b, day=2, activities=6
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 2 created and saved
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 2558609e-9995-42db-b081-609ce843ad94
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 50
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 3 structure
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-18 18:14:43.921 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:44:43.921810300Z
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Event sent to 2 SSE emitters successfully, 0 failed for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 3 with minimal prompt
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 18:14:43.923 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2935
2025-10-18 18:14:43.924 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 18:14:43.924 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-18 18:14:43.924 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3349
2025-10-18 18:14:43.924 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 18:14:55.043 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 18:14:55.043 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 18:14:55.043 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Length: 2990
2025-10-18 18:14:55.043 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 3,\n  \"date\": \"2026-01-26\",\n  \"location\": \"Poland, Poland\",\n  \"summary\": \"A day focused on relaxation, nature, and exquisite cuisine in Poland.\",\n  \"nodes\": [\n    {\n      \"id\": \"day3_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Hotel Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day3_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Nature Exploration\",\n      \"location\": {\n        \"name\": \"Nature Reserve\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day3_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Local Eatery\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day3_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Relaxation Spot\",\n      \"location\": {\n        \"name\": \"Spa/Wellness Center\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:00\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day3_node5\",\n      \"type\": \"transport\",\n      \"title\": \"Travel to Dinner Area\",\n      \"location\": {\n        \"name\": \"City Center\"\n      },\n      \"timing\": {\n        \"startTime\": \"17:00\",\n        \"endTime\": \"17:30\",\n        \"durationMin\": 30\n      }\n    },\n    {\n      \"id\": \"day3_node6\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner Experience\",\n      \"location\": {\n        \"name\": \"Fine Dining Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"18:30\",\n        \"endTime\": \"20:00\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day3_node7\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Luxury Hotel\"\n      },\n      \"timing\": {\n        \"startTime\": \"20:30\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 690\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 838,
    "candidatesTokenCount": 752,
    "totalTokenCount": 2736,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 838
      }
    ],
    "thoughtsTokenCount": 1146
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "xovzaJqgOOm_1e8P9LzY-AU"
}

2025-10-18 18:14:55.045 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-1758422556_20251018_181455.json
2025-10-18 18:14:55.046 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 18:14:55.046 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content length: 2115
2025-10-18 18:14:55.046 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 3,
  "date": "2026-01-26",
  "location": "Poland, Poland",
  "summary": "A day focused on relaxation, nature, and exquisite cuisine in Poland.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name":...
2025-10-18 18:14:55.046 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 18:14:55.046 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 18:14:55.046 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-18 18:14:55.046 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 3
2025-10-18 18:14:55.046 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 3,
  "date": "2026-01-26",
  "location": "Poland, Poland",
  "summary": "A day focused on relaxation, nature, and exquisite cuisine in Poland.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Hotel Restaurant"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node2",
      "type": "attraction",
      "title": "Morning Nature Exploration",
      "location": {
        "name": "Nature Reserve"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation Spot",
      "location": {
        "name": "Spa/Wellness Center"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day3_node5",
      "type": "transport",
      "title": "Travel to Dinner Area",
      "location": {
        "name": "City Center"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "17:30",
        "durationMin": 30
      }
    },
    {
      "id": "day3_node6",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Fine Dining Restaurant"
      },
      "timing": {
        "startTime": "18:30",
        "endTime": "20:00",
        "durationMin": 90
      }
    },
    {
      "id": "day3_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel"
      },
      "timing": {
        "startTime": "20:30",
        "endTime": "08:00",
        "durationMin": 690
      }
    }
  ]
}
```
2025-10-18 18:14:55.046 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-18 18:14:55.048 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 3,
  "date": "2026-01-26",
  "location": "Poland, Poland",
  "summary": "A day focused on relaxation, nature, and exquisite cuisine in Poland.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Hotel Restaurant"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node2",
      "type": "attraction",
      "title": "Morning Nature Exploration",
      "location": {
        "name": "Nature Reserve"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation Spot",
      "location": {
        "name": "Spa/Wellness Center"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day3_node5",
      "type": "transport",
      "title": "Travel to Dinner Area",
      "location": {
        "name": "City Center"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "17:30",
        "durationMin": 30
      }
    },
    {
      "id": "day3_node6",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Fine Dining Restaurant"
      },
      "timing": {
        "startTime": "18:30",
        "endTime": "20:00",
        "durationMin": 90
      }
    },
    {
      "id": "day3_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel"
      },
      "timing": {
        "startTime": "20:30",
        "endTime": "08:00",
        "durationMin": 690
      }
    }
  ]
}
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event: itinerary=it_ba231c6a-0791-4520-b86f-c60fb598125b, day=3, activities=7
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 3 created and saved
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 2558609e-9995-42db-b081-609ce843ad94
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 65
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 4 structure
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-18 18:14:55.518 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:44:55.518255600Z
2025-10-18 18:14:55.519 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Event sent to 2 SSE emitters successfully, 0 failed for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:14:55.519 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:14:55.519 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 4 with minimal prompt
2025-10-18 18:14:55.519 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-18 18:14:55.519 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 18:14:55.519 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 18:14:55.520 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 18:14:55.520 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 18:14:55.520 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 18:14:55.520 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2935
2025-10-18 18:14:55.520 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 18:14:55.520 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-18 18:14:55.520 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3349
2025-10-18 18:14:55.520 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 18:15:05.200 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-18 18:15:05.201 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-18 18:15:05.201 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-18 18:15:05.201 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-18 18:15:05.201 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-18 18:15:05.201 [http-nio-8080-exec-6] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:15:05.630 [http-nio-8080-exec-6] INFO  com.tripplanner.service.UserDataService - Found 12 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:15:05.630 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Found 12 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:15:05.631 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:05.631 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_ba231c6a-0791-4520-b86f-c60fb598125b, destination=Poland, Poland, startDate=2026 (truncated)...]
2025-10-18 18:15:05.632 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:05.632 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:12.432 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:12.433 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:12.433 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:15:12.433 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:15:12.433 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:12.433 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:15:14.377 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:14.378 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:14.379 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:15:14.381 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:14.381 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:14.582 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 18:15:14.582 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 18:15:14.582 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Length: 2742
2025-10-18 18:15:14.582 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 4,\n  \"date\": \"2026-01-27\",\n  \"location\": \"Poland, Poland\",\n  \"summary\": \"A final day in Poland, focusing on relaxation, local cuisine, and preparing for departure.\",\n  \"nodes\": [\n    {\n      \"id\": \"day4_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Hotel Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day4_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Relaxation Activity\",\n      \"location\": {\n        \"name\": \"Local Park or Spa\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day4_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Local Eatery\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day4_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Leisure & Last Minute Souvenirs\",\n      \"location\": {\n        \"name\": \"City Center / Shopping Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:00\",\n        \"endTime\": \"16:00\",\n        \"durationMin\": 120\n      }\n    },\n    {\n      \"id\": \"day4_node5\",\n      \"type\": \"transport\",\n      \"title\": \"Transport to Departure Point\",\n      \"location\": {\n        \"name\": \"Hotel to Airport/Station\"\n      },\n      \"timing\": {\n        \"startTime\": \"16:30\",\n        \"endTime\": \"18:00\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day4_node6\",\n      \"type\": \"meal\",\n      \"title\": \"Farewell Meal\",\n      \"location\": {\n        \"name\": \"Airport/Station Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"18:30\",\n        \"endTime\": \"19:30\",\n        \"durationMin\": 60\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 838,
    "candidatesTokenCount": 672,
    "totalTokenCount": 3727,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 838
      }
    ],
    "thoughtsTokenCount": 2217
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "2ovzaPrGGtTQ1e8PqoCp0AY"
}

2025-10-18 18:15:14.584 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_837523680_20251018_181514.json
2025-10-18 18:15:14.584 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 18:15:14.584 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1910
2025-10-18 18:15:14.584 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 4,
  "date": "2026-01-27",
  "location": "Poland, Poland",
  "summary": "A final day in Poland, focusing on relaxation, local cuisine, and preparing for departure.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Breakfast",
      "locatio...
2025-10-18 18:15:14.584 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 18:15:14.584 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 18:15:14.585 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-18 18:15:14.585 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 4
2025-10-18 18:15:14.585 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 4,
  "date": "2026-01-27",
  "location": "Poland, Poland",
  "summary": "A final day in Poland, focusing on relaxation, local cuisine, and preparing for departure.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Hotel Restaurant"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node2",
      "type": "attraction",
      "title": "Morning Relaxation Activity",
      "location": {
        "name": "Local Park or Spa"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day4_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node4",
      "type": "attraction",
      "title": "Afternoon Leisure & Last Minute Souvenirs",
      "location": {
        "name": "City Center / Shopping Area"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "16:00",
        "durationMin": 120
      }
    },
    {
      "id": "day4_node5",
      "type": "transport",
      "title": "Transport to Departure Point",
      "location": {
        "name": "Hotel to Airport/Station"
      },
      "timing": {
        "startTime": "16:30",
        "endTime": "18:00",
        "durationMin": 90
      }
    },
    {
      "id": "day4_node6",
      "type": "meal",
      "title": "Farewell Meal",
      "location": {
        "name": "Airport/Station Restaurant"
      },
      "timing": {
        "startTime": "18:30",
        "endTime": "19:30",
        "durationMin": 60
      }
    }
  ]
}
```
2025-10-18 18:15:14.585 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-18 18:15:14.586 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 4,
  "date": "2026-01-27",
  "location": "Poland, Poland",
  "summary": "A final day in Poland, focusing on relaxation, local cuisine, and preparing for departure.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Hotel Restaurant"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node2",
      "type": "attraction",
      "title": "Morning Relaxation Activity",
      "location": {
        "name": "Local Park or Spa"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day4_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node4",
      "type": "attraction",
      "title": "Afternoon Leisure & Last Minute Souvenirs",
      "location": {
        "name": "City Center / Shopping Area"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "16:00",
        "durationMin": 120
      }
    },
    {
      "id": "day4_node5",
      "type": "transport",
      "title": "Transport to Departure Point",
      "location": {
        "name": "Hotel to Airport/Station"
      },
      "timing": {
        "startTime": "16:30",
        "endTime": "18:00",
        "durationMin": 90
      }
    },
    {
      "id": "day4_node6",
      "type": "meal",
      "title": "Farewell Meal",
      "location": {
        "name": "Airport/Station Restaurant"
      },
      "timing": {
        "startTime": "18:30",
        "endTime": "19:30",
        "durationMin": 60
      }
    }
  ]
}
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event: itinerary=it_ba231c6a-0791-4520-b86f-c60fb598125b, day=4, activities=6
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 4 created and saved
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 2558609e-9995-42db-b081-609ce843ad94
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Skeleton complete
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_complete
2025-10-18 18:15:15.075 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:45:15.075776800Z
2025-10-18 18:15:15.077 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - Failed to send event to SSE emitter for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b (client likely disconnected)
2025-10-18 18:15:15.077 [http-nio-8080-exec-5] DEBUG o.s.web.context.request.async.WebAsyncManager - Servlet container error notification for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:15:15.077 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Event sent to 1 SSE emitters successfully, 1 failed for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:15.077 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:15:15.077 [http-nio-8080-exec-5] DEBUG o.s.web.context.request.async.WebAsyncManager - Async result set for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:15:15.077 [http-nio-8080-exec-5] DEBUG o.s.web.context.request.async.WebAsyncManager - Performing async dispatch for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:15:15.078 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:15:15.078 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:15:15.078 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - "ASYNC" dispatch for GET "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA", parameters={masked}
2025-10-18 18:15:15.079 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - Resume with async result [java.io.IOException: An established connection was aborted by the software in your host machine]
2025-10-18 18:15:15.080 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.tripplanner.exception.GlobalExceptionHandler#handleGenericException(Exception, WebRequest)
2025-10-18 18:15:15.080 [http-nio-8080-exec-5] ERROR com.tripplanner.exception.GlobalExceptionHandler - === GENERIC EXCEPTION ===
2025-10-18 18:15:15.080 [http-nio-8080-exec-5] ERROR com.tripplanner.exception.GlobalExceptionHandler - Type: IOException
2025-10-18 18:15:15.080 [http-nio-8080-exec-5] ERROR com.tripplanner.exception.GlobalExceptionHandler - Error: An established connection was aborted by the software in your host machine
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.AgentEventBus.publish(AgentEventBus.java:96)
	at com.tripplanner.agents.BaseAgent.emitEvent(BaseAgent.java:206)
	at com.tripplanner.agents.BaseAgent.emitProgress(BaseAgent.java:187)
	at com.tripplanner.agents.SkeletonPlannerAgent.generateSkeleton(SkeletonPlannerAgent.java:121)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executeSkeletonPhase$3(PipelineOrchestrator.java:189)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:15.081 [http-nio-8080-exec-5] ERROR com.tripplanner.exception.GlobalExceptionHandler - Request: uri=/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:15.081 [http-nio-8080-exec-5] ERROR com.tripplanner.exception.GlobalExceptionHandler - =========================
2025-10-18 18:15:15.081 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Found 'Content-Type:text/event-stream' in response
2025-10-18 18:15:15.081 [http-nio-8080-exec-5] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.tripplanner.exception.GlobalExceptionHandler#handleGenericException(Exception, WebRequest)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.tripplanner.exception.ErrorResponse] with preset Content-Type 'text/event-stream'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:365)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:263)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:471)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:73)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:182)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1360)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:612)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:540)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:511)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:599)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:342)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:15.082 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Unresolved failure from "ASYNC" dispatch: java.io.IOException: An established connection was aborted by the software in your host machine
2025-10-18 18:15:15.082 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:15.083 [http-nio-8080-exec-5] ERROR o.a.c.c.C.[.[localhost].[/].[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] threw exception
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.AgentEventBus.publish(AgentEventBus.java:96)
	at com.tripplanner.agents.BaseAgent.emitEvent(BaseAgent.java:206)
	at com.tripplanner.agents.BaseAgent.emitProgress(BaseAgent.java:187)
	at com.tripplanner.agents.SkeletonPlannerAgent.generateSkeleton(SkeletonPlannerAgent.java:121)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executeSkeletonPhase$3(PipelineOrchestrator.java:189)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:15.083 [http-nio-8080-exec-5] ERROR o.a.c.c.C.[.[localhost].[/].[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.AgentEventBus.publish(AgentEventBus.java:96)
	at com.tripplanner.agents.BaseAgent.emitEvent(BaseAgent.java:206)
	at com.tripplanner.agents.BaseAgent.emitProgress(BaseAgent.java:187)
	at com.tripplanner.agents.SkeletonPlannerAgent.generateSkeleton(SkeletonPlannerAgent.java:121)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executeSkeletonPhase$3(PipelineOrchestrator.java:189)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:15.296 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:15:15.298 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:15.299 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:15.299 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:15:15.300 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:15:15.300 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:15.300 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:15:15.302 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:15:15.302 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:15:15.303 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:15:15.303 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:15:16.303 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791516302
2025-10-18 18:15:16.304 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791516302
2025-10-18 18:15:16.304 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791516302", parameters={masked}
2025-10-18 18:15:16.304 [http-nio-8080-exec-1] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:15:16.305 [http-nio-8080-exec-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791516302
2025-10-18 18:15:16.305 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:16.305 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:16.309 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/809/iegbf5sf/websocket
2025-10-18 18:15:16.310 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/809/iegbf5sf/websocket
2025-10-18 18:15:16.310 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/809/iegbf5sf/websocket", parameters={}
2025-10-18 18:15:16.310 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:15:16.310 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/809/iegbf5sf/websocket
2025-10-18 18:15:16.310 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:16.311 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:15:16.312 [http-nio-8080-exec-3] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=iegbf5sf]
2025-10-18 18:15:16.313 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=iegbf5sf
2025-10-18 18:15:16.316 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=iegbf5sf
2025-10-18 18:15:16.316 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=iegbf5sf
2025-10-18 18:15:16.316 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=iegbf5sf
2025-10-18 18:15:16.479 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON COMPLETE ===
2025-10-18 18:15:16.479 [Pipeline-75] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generated 4 days with 26 total node placeholders
2025-10-18 18:15:16.479 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Skeleton generation completed successfully for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:16.479 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 1 complete: 4 days created (56446 ms)
2025-10-18 18:15:16.479 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Phase skeleton completed in 56446 ms
2025-10-18 18:15:16.481 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 2: POPULATION ===
2025-10-18 18:15:16.481 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Phase population started: Populating node details...
2025-10-18 18:15:16.483 [Pipeline-74] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event: itinerary=it_ba231c6a-0791-4520-b86f-c60fb598125b, skeletonpopulation, progress=40%
2025-10-18 18:15:16.483 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Running population agents in PARALLEL
2025-10-18 18:15:16.484 [Pipeline-79] INFO  com.tripplanner.service.PipelineOrchestrator - [ActivityAgent] Starting...
2025-10-18 18:15:16.484 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT ===
2025-10-18 18:15:16.485 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - Populating attraction nodes for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:16.485 [Pipeline-80] INFO  com.tripplanner.service.PipelineOrchestrator - [MealAgent] Starting...
2025-10-18 18:15:16.485 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT ===
2025-10-18 18:15:16.485 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - Populating meal nodes for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:16.485 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - [TransportAgent] Starting...
2025-10-18 18:15:16.485 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT ===
2025-10-18 18:15:16.485 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - Populating transport nodes for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:16.485 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - Found 9 attraction nodes to populate
2025-10-18 18:15:16.485 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - Found 2 transport nodes to populate
2025-10-18 18:15:16.485 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - Found 12 meal nodes to populate
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - Calling AI to populate 9 attractions
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 18:15:16.486 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - Calling AI to populate 2 transport segments
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 18:15:16.486 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - Calling AI to populate 12 meals
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-18 18:15:16.486 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2691
2025-10-18 18:15:16.486 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 18:15:16.486 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel expert specializing in attractions and activities.

Your task: Suggest SPECIFIC attractions for placeholder activity nodes.

CRITICAL: Use the EXACT node IDs provided in the user prom...
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 18:15:16.486 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 3109
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 18:15:16.486 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a culinary travel expert specializing in dining recommendations.

Your task: Suggest SPECIFIC restaurants and dining places for meal slots.

CRITICAL: Use the EXACT node IDs provided in the us...
2025-10-18 18:15:16.486 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 18:15:16.486 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3007
2025-10-18 18:15:16.486 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2156
2025-10-18 18:15:16.487 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 18:15:16.487 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 18:15:16.487 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3443
2025-10-18 18:15:16.487 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a transportation and logistics expert for travel planning.

Your task: Suggest SPECIFIC transport modes and routes for getting around.

Guidelines:
1. Suggest practical transport modes based o...
2025-10-18 18:15:16.487 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 18:15:16.488 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2464
2025-10-18 18:15:16.488 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 18:15:17.430 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:17.430 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:17.430 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:15:17.433 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:17.433 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:18.775 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:18.775 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:18.775 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:15:18.776 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:18.776 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:19.915 [http-nio-8080-exec-6] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=iegbf5sf] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:15:19.916 [http-nio-8080-exec-6] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session iegbf5sf
2025-10-18 18:15:19.916 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=iegbf5sf
2025-10-18 18:15:19.916 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=iegbf5sf}], simpSessionId=iegbf5sf}]
2025-10-18 18:15:20.157 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:20.157 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:20.157 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:15:20.158 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:15:20.159 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:20.616 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:20.617 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:20.617 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:15:20.618 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:20.618 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:20.686 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:20.686 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:20.687 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:15:20.687 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:15:20.687 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:20.687 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:15:20.689 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:15:20.689 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:15:20.689 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:15:20.689 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:15:21.691 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791521689
2025-10-18 18:15:21.691 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791521689
2025-10-18 18:15:21.691 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791521689", parameters={masked}
2025-10-18 18:15:21.691 [http-nio-8080-exec-1] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:15:21.692 [http-nio-8080-exec-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791521689
2025-10-18 18:15:21.692 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:21.692 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:21.696 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/526/uqf00h5f/websocket
2025-10-18 18:15:21.696 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/526/uqf00h5f/websocket
2025-10-18 18:15:21.696 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/526/uqf00h5f/websocket", parameters={}
2025-10-18 18:15:21.696 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:15:21.697 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/526/uqf00h5f/websocket
2025-10-18 18:15:21.697 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:21.697 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:15:21.698 [http-nio-8080-exec-3] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=uqf00h5f]
2025-10-18 18:15:21.700 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=uqf00h5f
2025-10-18 18:15:21.703 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=uqf00h5f
2025-10-18 18:15:21.703 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=uqf00h5f
2025-10-18 18:15:21.703 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=uqf00h5f
2025-10-18 18:15:22.564 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:22.564 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:22.565 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:15:22.566 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:22.566 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:23.711 [http-nio-8080-exec-10] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:23.712 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:23.712 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:15:23.713 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:23.713 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:27.939 [MessageBroker-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [iegbf5sf]
2025-10-18 18:15:33.120 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 18:15:33.120 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 18:15:33.120 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Length: 1836
2025-10-18 18:15:33.120 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"transports\": [\n    {\n      \"nodeId\": \"day3_node5\",\n      \"title\": \"Rideshare/Taxi to Fine Dining\",\n      \"description\": \"For a convenient and direct transfer from your spa to the restaurant, use a rideshare app like Uber or Bolt, widely available in major Polish cities. Taxis are also a reliable option. This ensures a comfortable and timely arrival for your evening plans without worrying about parking or multiple transfers. Book via app or hail a licensed taxi.\",\n      \"mode\": \"rideshare\",\n      \"durationMinutes\": 20\n    },\n    {\n      \"nodeId\": \"day4_node5\",\n      \"title\": \"Train/Bus to Airport/Station\",\n      \"description\": \"Utilize Poland's efficient public transport for transfers to airports or main stations. Many major cities offer direct train or express bus services from the city center (e.g., train to Warsaw Chopin or Krakow Balice airports). Check local transport apps like 'Jakdojade' for routes and schedules. Tickets can be purchased at station kiosks, ticket machines, or sometimes on board. This is a cost-effective and often traffic-free option. For heavy luggage or late-night travel, a taxi/rideshare is an alternative.\",\n      \"mode\": \"train\",\n      \"durationMinutes\": 30\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 571,
    "candidatesTokenCount": 305,
    "totalTokenCount": 2596,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 571
      }
    ],
    "thoughtsTokenCount": 1720
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "7YvzaMSHAbnE1e8PnMSrkQk"
}

2025-10-18 18:15:33.122 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-1356033554_20251018_181533.json
2025-10-18 18:15:33.122 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 18:15:33.122 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1230
2025-10-18 18:15:33.123 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "transports": [
    {
      "nodeId": "day3_node5",
      "title": "Rideshare/Taxi to Fine Dining",
      "description": "For a convenient and direct transfer from your spa to the restaurant, use a rideshare app like Uber or Bolt, widely available in major Polish cities. Taxis are also a...
2025-10-18 18:15:33.123 [Pipeline-75] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 18:15:33.123 [Pipeline-75] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 18:15:33.123 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT - FULL LLM RESPONSE ===
2025-10-18 18:15:33.123 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - Contexts to populate: 2
2025-10-18 18:15:33.123 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - Raw Response: ```json
{
  "transports": [
    {
      "nodeId": "day3_node5",
      "title": "Rideshare/Taxi to Fine Dining",
      "description": "For a convenient and direct transfer from your spa to the restaurant, use a rideshare app like Uber or Bolt, widely available in major Polish cities. Taxis are also a reliable option. This ensures a comfortable and timely arrival for your evening plans without worrying about parking or multiple transfers. Book via app or hail a licensed taxi.",
      "mode": "rideshare",
      "durationMinutes": 20
    },
    {
      "nodeId": "day4_node5",
      "title": "Train/Bus to Airport/Station",
      "description": "Utilize Poland's efficient public transport for transfers to airports or main stations. Many major cities offer direct train or express bus services from the city center (e.g., train to Warsaw Chopin or Krakow Balice airports). Check local transport apps like 'Jakdojade' for routes and schedules. Tickets can be purchased at station kiosks, ticket machines, or sometimes on board. This is a cost-effective and often traffic-free option. For heavy luggage or late-night travel, a taxi/rideshare is an alternative.",
      "mode": "train",
      "durationMinutes": 30
    }
  ]
}
```
2025-10-18 18:15:33.123 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - === END TRANSPORT AGENT RESPONSE ===
2025-10-18 18:15:33.123 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - Cleaned Response: {
  "transports": [
    {
      "nodeId": "day3_node5",
      "title": "Rideshare/Taxi to Fine Dining",
      "description": "For a convenient and direct transfer from your spa to the restaurant, use a rideshare app like Uber or Bolt, widely available in major Polish cities. Taxis are also a reliable option. This ensures a comfortable and timely arrival for your evening plans without worrying about parking or multiple transfers. Book via app or hail a licensed taxi.",
      "mode": "rideshare",
      "durationMinutes": 20
    },
    {
      "nodeId": "day4_node5",
      "title": "Train/Bus to Airport/Station",
      "description": "Utilize Poland's efficient public transport for transfers to airports or main stations. Many major cities offer direct train or express bus services from the city center (e.g., train to Warsaw Chopin or Krakow Balice airports). Check local transport apps like 'Jakdojade' for routes and schedules. Tickets can be purchased at station kiosks, ticket machines, or sometimes on board. This is a cost-effective and often traffic-free option. For heavy luggage or late-night travel, a taxi/rideshare is an alternative.",
      "mode": "train",
      "durationMinutes": 30
    }
  ]
}
2025-10-18 18:15:33.635 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - Saved itinerary with populated transport
2025-10-18 18:15:33.635 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT COMPLETE ===
2025-10-18 18:15:33.635 [Pipeline-75] INFO  com.tripplanner.agents.TransportAgent - Populated 2 transport segments
2025-10-18 18:15:33.635 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - [TransportAgent] Complete
2025-10-18 18:15:39.216 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 18:15:39.216 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 18:15:39.216 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Response Length: 5022
2025-10-18 18:15:39.216 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"attractions\": [\n    {\n      \"nodeId\": \"day1_node2\",\n      \"title\": \"Planty Park Stroll\",\n      \"description\": \"Escape the city bustle with a leisurely walk through Planty Park, the beautiful green belt encircling Krakow's Old Town. This tranquil oasis offers shaded paths, charming benches, and a peaceful atmosphere perfect for unwinding after arrival.\",\n      \"category\": \"park\",\n      \"durationMinutes\": 90,\n      \"locationName\": \"Krakow\"\n    },\n    {\n      \"nodeId\": \"day1_node4\",\n      \"title\": \"Polish Pierogi Making Class\",\n      \"description\": \"Immerse yourself in Polish culinary traditions by learning to make authentic pierogi. This hands-on experience will teach you the secrets of preparing this beloved national dish, culminating in a delicious meal of your own creations.\",\n      \"category\": \"experience\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"Krakow\"\n    },\n    {\n      \"nodeId\": \"day1_node5\",\n      \"title\": \"Main Market Square Evening Ambiance\",\n      \"description\": \"Soak in the enchanting evening atmosphere of Krakow's Main Market Square (Rynek Gwny), one of Europe's largest medieval squares. Enjoy the illuminated Cloth Hall, St. Mary's Basilica, and the vibrant street life while perhaps enjoying a traditional Polish dessert or drink.\",\n      \"category\": \"landmark\",\n      \"durationMinutes\": 90,\n      \"locationName\": \"Krakow\"\n    },\n    {\n      \"nodeId\": \"day2_node2\",\n      \"title\": \"Ojcw National Park Exploration\",\n      \"description\": \"Discover the stunning natural beauty of Ojcw National Park, a serene escape just outside Krakow. Explore its dramatic limestone cliffs, picturesque valleys, and ancient caves, offering gentle hiking trails and breathtaking views perfect for nature lovers.\",\n      \"category\": \"nature\",\n      \"durationMinutes\": 240,\n      \"locationName\": \"Ojcw\"\n    },\n    {\n      \"nodeId\": \"day2_node4\",\n      \"title\": \"Wieliczka Salt Mine Tour\",\n      \"description\": \"Descend into the UNESCO-listed Wieliczka Salt Mine, an extraordinary underground world carved entirely from salt. Marvel at the intricate chapels, sculptures, and saline lakes, offering a unique and awe-inspiring historical experience.\",\n      \"category\": \"landmark\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"Wieliczka\"\n    },\n    {\n      \"nodeId\": \"day3_node2\",\n      \"title\": \"Tatra National Park & Kasprowy Wierch\",\n      \"description\": \"Journey to the majestic Tatra Mountains and ascend Kasprowy Wierch by cable car for unparalleled panoramic views of the Polish Tatras. Enjoy gentle walks along the ridge or simply relax and take in the spectacular alpine scenery, a true highlight for nature and relaxation.\",\n      \"category\": \"nature\",\n      \"durationMinutes\": 300,\n      \"locationName\": \"Zakopane\"\n    },\n    {\n      \"nodeId\": \"day3_node4\",\n      \"title\": \"Chocholowskie Termy Thermal Baths\",\n      \"description\": \"Indulge in ultimate relaxation at Chocholowskie Termy, one of Poland's largest thermal bath complexes. Unwind in mineral-rich geothermal pools, both indoor and outdoor, surrounded by the stunning mountain landscape, perfect for soothing tired muscles.\",\n      \"category\": \"experience\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"Chocholow\"\n    },\n    {\n      \"nodeId\": \"day4_node2\",\n      \"title\": \"Krakow Cloth Hall (Sukiennice) & Souvenirs\",\n      \"description\": \"Explore the historic Cloth Hall (Sukiennice) in Krakow's Main Market Square, a beautiful Renaissance building. Browse for unique local souvenirs, amber jewelry, and traditional crafts, soaking in the atmosphere of one of Europe's oldest shopping centers.\",\n      \"category\": \"shopping\",\n      \"durationMinutes\": 120,\n      \"locationName\": \"Krakow\"\n    },\n    {\n      \"nodeId\": \"day4_node4\",\n      \"title\": \"Kazimierz (Jewish Quarter) Culinary Exploration\",\n      \"description\": \"Conclude your trip with a culinary exploration of Kazimierz, Krakow's historic Jewish Quarter. Wander through its charming streets, discover unique cafes, and savor delicious local and Jewish-inspired cuisine in a relaxed, bohemian setting.\",\n      \"category\": \"experience\",\n      \"durationMinutes\": 150,\n      \"locationName\": \"Krakow\"\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 816,
    "candidatesTokenCount": 1081,
    "totalTokenCount": 4547,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 816
      }
    ],
    "thoughtsTokenCount": 2650
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "84vzaJH7Bu6i1e8P4fHdiAU"
}

2025-10-18 18:15:39.219 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_364504557_20251018_181539.json
2025-10-18 18:15:39.219 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 18:15:39.219 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Generated content length: 4195
2025-10-18 18:15:39.219 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Planty Park Stroll",
      "description": "Escape the city bustle with a leisurely walk through Planty Park, the beautiful green belt encircling Krakow's Old Town. This tranquil oasis offers shaded paths, charming bench...
2025-10-18 18:15:39.219 [Pipeline-79] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 18:15:39.219 [Pipeline-79] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 18:15:39.219 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT - FULL LLM RESPONSE ===
2025-10-18 18:15:39.219 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - Contexts to populate: 9
2025-10-18 18:15:39.219 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - Raw Response: ```json
{
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Planty Park Stroll",
      "description": "Escape the city bustle with a leisurely walk through Planty Park, the beautiful green belt encircling Krakow's Old Town. This tranquil oasis offers shaded paths, charming benches, and a peaceful atmosphere perfect for unwinding after arrival.",
      "category": "park",
      "durationMinutes": 90,
      "locationName": "Krakow"
    },
    {
      "nodeId": "day1_node4",
      "title": "Polish Pierogi Making Class",
      "description": "Immerse yourself in Polish culinary traditions by learning to make authentic pierogi. This hands-on experience will teach you the secrets of preparing this beloved national dish, culminating in a delicious meal of your own creations.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "Krakow"
    },
    {
      "nodeId": "day1_node5",
      "title": "Main Market Square Evening Ambiance",
      "description": "Soak in the enchanting evening atmosphere of Krakow's Main Market Square (Rynek Gwny), one of Europe's largest medieval squares. Enjoy the illuminated Cloth Hall, St. Mary's Basilica, and the vibrant street life while perhaps enjoying a traditional Polish dessert or drink.",
      "category": "landmark",
      "durationMinutes": 90,
      "locationName": "Krakow"
    },
    {
      "nodeId": "day2_node2",
      "title": "Ojcw National Park Exploration",
      "description": "Discover the stunning natural beauty of Ojcw National Park, a serene escape just outside Krakow. Explore its dramatic limestone cliffs, picturesque valleys, and ancient caves, offering gentle hiking trails and breathtaking views perfect for nature lovers.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Ojcw"
    },
    {
      "nodeId": "day2_node4",
      "title": "Wieliczka Salt Mine Tour",
      "description": "Descend into the UNESCO-listed Wieliczka Salt Mine, an extraordinary underground world carved entirely from salt. Marvel at the intricate chapels, sculptures, and saline lakes, offering a unique and awe-inspiring historical experience.",
      "category": "landmark",
      "durationMinutes": 180,
      "locationName": "Wieliczka"
    },
    {
      "nodeId": "day3_node2",
      "title": "Tatra National Park & Kasprowy Wierch",
      "description": "Journey to the majestic Tatra Mountains and ascend Kasprowy Wierch by cable car for unparalleled panoramic views of the Polish Tatras. Enjoy gentle walks along the ridge or simply relax and take in the spectacular alpine scenery, a true highlight for nature and relaxation.",
      "category": "nature",
      "durationMinutes": 300,
      "locationName": "Zakopane"
    },
    {
      "nodeId": "day3_node4",
      "title": "Chocholowskie Termy Thermal Baths",
      "description": "Indulge in ultimate relaxation at Chocholowskie Termy, one of Poland's largest thermal bath complexes. Unwind in mineral-rich geothermal pools, both indoor and outdoor, surrounded by the stunning mountain landscape, perfect for soothing tired muscles.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "Chocholow"
    },
    {
      "nodeId": "day4_node2",
      "title": "Krakow Cloth Hall (Sukiennice) & Souvenirs",
      "description": "Explore the historic Cloth Hall (Sukiennice) in Krakow's Main Market Square, a beautiful Renaissance building. Browse for unique local souvenirs, amber jewelry, and traditional crafts, soaking in the atmosphere of one of Europe's oldest shopping centers.",
      "category": "shopping",
      "durationMinutes": 120,
      "locationName": "Krakow"
    },
    {
      "nodeId": "day4_node4",
      "title": "Kazimierz (Jewish Quarter) Culinary Exploration",
      "description": "Conclude your trip with a culinary exploration of Kazimierz, Krakow's historic Jewish Quarter. Wander through its charming streets, discover unique cafes, and savor delicious local and Jewish-inspired cuisine in a relaxed, bohemian setting.",
      "category": "experience",
      "durationMinutes": 150,
      "locationName": "Krakow"
    }
  ]
}
```
2025-10-18 18:15:39.220 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - === END ACTIVITY AGENT RESPONSE ===
2025-10-18 18:15:39.220 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - Cleaned Response: {
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Planty Park Stroll",
      "description": "Escape the city bustle with a leisurely walk through Planty Park, the beautiful green belt encircling Krakow's Old Town. This tranquil oasis offers shaded paths, charming benches, and a peaceful atmosphere perfect for unwinding after arrival.",
      "category": "park",
      "durationMinutes": 90,
      "locationName": "Krakow"
    },
    {
      "nodeId": "day1_node4",
      "title": "Polish Pierogi Making Class",
      "description": "Immerse yourself in Polish culinary traditions by learning to make authentic pierogi. This hands-on experience will teach you the secrets of preparing this beloved national dish, culminating in a delicious meal of your own creations.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "Krakow"
    },
    {
      "nodeId": "day1_node5",
      "title": "Main Market Square Evening Ambiance",
      "description": "Soak in the enchanting evening atmosphere of Krakow's Main Market Square (Rynek Gwny), one of Europe's largest medieval squares. Enjoy the illuminated Cloth Hall, St. Mary's Basilica, and the vibrant street life while perhaps enjoying a traditional Polish dessert or drink.",
      "category": "landmark",
      "durationMinutes": 90,
      "locationName": "Krakow"
    },
    {
      "nodeId": "day2_node2",
      "title": "Ojcw National Park Exploration",
      "description": "Discover the stunning natural beauty of Ojcw National Park, a serene escape just outside Krakow. Explore its dramatic limestone cliffs, picturesque valleys, and ancient caves, offering gentle hiking trails and breathtaking views perfect for nature lovers.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Ojcw"
    },
    {
      "nodeId": "day2_node4",
      "title": "Wieliczka Salt Mine Tour",
      "description": "Descend into the UNESCO-listed Wieliczka Salt Mine, an extraordinary underground world carved entirely from salt. Marvel at the intricate chapels, sculptures, and saline lakes, offering a unique and awe-inspiring historical experience.",
      "category": "landmark",
      "durationMinutes": 180,
      "locationName": "Wieliczka"
    },
    {
      "nodeId": "day3_node2",
      "title": "Tatra National Park & Kasprowy Wierch",
      "description": "Journey to the majestic Tatra Mountains and ascend Kasprowy Wierch by cable car for unparalleled panoramic views of the Polish Tatras. Enjoy gentle walks along the ridge or simply relax and take in the spectacular alpine scenery, a true highlight for nature and relaxation.",
      "category": "nature",
      "durationMinutes": 300,
      "locationName": "Zakopane"
    },
    {
      "nodeId": "day3_node4",
      "title": "Chocholowskie Termy Thermal Baths",
      "description": "Indulge in ultimate relaxation at Chocholowskie Termy, one of Poland's largest thermal bath complexes. Unwind in mineral-rich geothermal pools, both indoor and outdoor, surrounded by the stunning mountain landscape, perfect for soothing tired muscles.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "Chocholow"
    },
    {
      "nodeId": "day4_node2",
      "title": "Krakow Cloth Hall (Sukiennice) & Souvenirs",
      "description": "Explore the historic Cloth Hall (Sukiennice) in Krakow's Main Market Square, a beautiful Renaissance building. Browse for unique local souvenirs, amber jewelry, and traditional crafts, soaking in the atmosphere of one of Europe's oldest shopping centers.",
      "category": "shopping",
      "durationMinutes": 120,
      "locationName": "Krakow"
    },
    {
      "nodeId": "day4_node4",
      "title": "Kazimierz (Jewish Quarter) Culinary Exploration",
      "description": "Conclude your trip with a culinary exploration of Kazimierz, Krakow's historic Jewish Quarter. Wander through its charming streets, discover unique cafes, and savor delicious local and Jewish-inspired cuisine in a relaxed, bohemian setting.",
      "category": "experience",
      "durationMinutes": 150,
      "locationName": "Krakow"
    }
  ]
}
2025-10-18 18:15:39.743 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 18:15:39.743 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 18:15:39.743 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Response Length: 5992
2025-10-18 18:15:39.743 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"meals\": [\n    {\n      \"nodeId\": \"day1_node1\",\n      \"title\": \"Bar Prasowy\",\n      \"description\": \"Step back in time at a classic 'milk bar' for an authentic and budget-friendly Polish lunch. Enjoy hearty, home-style dishes like pierogi, gobki (cabbage rolls), or tomato soup, served in a no-frills, nostalgic setting.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Warsaw\"\n    },\n    {\n      \"nodeId\": \"day1_node3\",\n      \"title\": \"Stary Dom Restaurant\",\n      \"description\": \"Experience traditional Polish hospitality and cuisine in an elegant, rustic setting. Feast on expertly prepared classics like pork knuckle, duck with apples, or a rich urek soup, often accompanied by live piano music.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Warsaw\"\n    },\n    {\n      \"nodeId\": \"day1_node6\",\n      \"title\": \"Trattoria Rucola\",\n      \"description\": \"Craving something different? This popular trattoria offers a delightful array of authentic Italian dishes. Enjoy freshly made pasta, wood-fired pizzas, and delicious antipasti in a cozy, inviting atmosphere.\",\n      \"cuisineType\": \"italian\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Warsaw\"\n    },\n    {\n      \"nodeId\": \"day2_node1\",\n      \"title\": \"Plac Nowy Street Food\",\n      \"description\": \"Dive into Krakow's vibrant Kazimierz district for an iconic street food experience. Sample a 'zapiekanka,' a toasted open-faced baguette with various toppings, or explore other local snacks from the bustling stalls.\",\n      \"cuisineType\": \"street_food\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Krakow\"\n    },\n    {\n      \"nodeId\": \"day2_node3\",\n      \"title\": \"Pod Wawelem Kompania Kuflowa\",\n      \"description\": \"Indulge in a hearty Polish feast near Wawel Castle, known for its generous portions and lively atmosphere. Savor traditional dishes like grilled meats, goulash, and various regional specialties, perfectly paired with local beers.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Krakow\"\n    },\n    {\n      \"nodeId\": \"day2_node5\",\n      \"title\": \"Youmiko Vegan Sushi\",\n      \"description\": \"Discover innovative and delicious plant-based sushi creations at this highly-rated vegan sushi spot. Enjoy beautifully crafted rolls, nigiri, and other Japanese-inspired dishes that are as flavorful as they are artistic.\",\n      \"cuisineType\": \"japanese\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Warsaw\"\n    },\n    {\n      \"nodeId\": \"day3_node1\",\n      \"title\": \"Charlotte Chleb i Wino\",\n      \"description\": \"Enjoy a chic and relaxed cafe experience with a French-inspired menu. Perfect for a light lunch, offering freshly baked bread, delicious sandwiches, salads, and an excellent selection of wines and pastries.\",\n      \"cuisineType\": \"cafe\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Krakow\"\n    },\n    {\n      \"nodeId\": \"day3_node3\",\n      \"title\": \"Atelier Amaro\",\n      \"description\": \"Embark on a culinary journey at Poland's first Michelin-starred restaurant, offering 'Nature's Calendar' cuisine. Experience innovative, modern Polish dishes crafted from seasonal, local ingredients, presented as edible art.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Warsaw\"\n    },\n    {\n      \"nodeId\": \"day3_node6\",\n      \"title\": \"Zapiecek Polskie Pierogarnie\",\n      \"description\": \"A must-visit for pierogi lovers, this charming restaurant specializes in Poland's beloved dumplings. Choose from a vast selection of fillings  boiled, baked, or fried  both savory and sweet, served in a traditional folk-inspired setting.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Warsaw\"\n    },\n    {\n      \"nodeId\": \"day4_node1\",\n      \"title\": \"Obwarzanek Krakowski Street Vendors\",\n      \"description\": \"Grab a quick and iconic snack from one of the many street vendors in Krakow. The 'obwarzanek' is a braided, ring-shaped bread, boiled and baked, similar to a bagel, often topped with salt, poppy seeds, or sesame seeds  perfect for a light bite.\",\n      \"cuisineType\": \"street_food\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Krakow\"\n    },\n    {\n      \"nodeId\": \"day4_node3\",\n      \"title\": \"Gospoda Kwiaty Polskie\",\n      \"description\": \"Savor an authentic Polish dining experience in a rustic and welcoming setting. This restaurant offers traditional regional dishes with a focus on fresh ingredients, providing a true taste of Polish home cooking.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Warsaw\"\n    },\n    {\n      \"nodeId\": \"day4_node6\",\n      \"title\": \"Cukiernia Sowa\",\n      \"description\": \"End your trip on a sweet note at a popular Polish patisserie. Indulge in exquisite cakes, pastries, and traditional Polish sweets like pczki (donuts) or sernik (cheesecake), paired with a perfect coffee or tea.\",\n      \"cuisineType\": \"cafe\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Krakow\"\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 1005,
    "candidatesTokenCount": 1361,
    "totalTokenCount": 3861,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 1005
      }
    ],
    "thoughtsTokenCount": 1495
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "84vzaI3_Ja6n1e8Pi5TviQU"
}

2025-10-18 18:15:39.744 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - Saved itinerary with populated attractions
2025-10-18 18:15:39.744 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT COMPLETE ===
2025-10-18 18:15:39.744 [Pipeline-79] INFO  com.tripplanner.agents.ActivityAgent - Populated 9 attractions
2025-10-18 18:15:39.744 [Pipeline-79] INFO  com.tripplanner.service.PipelineOrchestrator - [ActivityAgent] Complete
2025-10-18 18:15:39.746 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-924391051_20251018_181539.json
2025-10-18 18:15:39.746 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 18:15:39.746 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Generated content length: 5049
2025-10-18 18:15:39.746 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "Bar Prasowy",
      "description": "Step back in time at a classic 'milk bar' for an authentic and budget-friendly Polish lunch. Enjoy hearty, home-style dishes like pierogi, gobki (cabbage rolls), or tomato soup, served in...
2025-10-18 18:15:39.746 [Pipeline-80] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 18:15:39.746 [Pipeline-80] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 18:15:39.746 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT - FULL LLM RESPONSE ===
2025-10-18 18:15:39.746 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - Contexts to populate: 12
2025-10-18 18:15:39.746 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - Raw Response: ```json
{
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "Bar Prasowy",
      "description": "Step back in time at a classic 'milk bar' for an authentic and budget-friendly Polish lunch. Enjoy hearty, home-style dishes like pierogi, gobki (cabbage rolls), or tomato soup, served in a no-frills, nostalgic setting.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day1_node3",
      "title": "Stary Dom Restaurant",
      "description": "Experience traditional Polish hospitality and cuisine in an elegant, rustic setting. Feast on expertly prepared classics like pork knuckle, duck with apples, or a rich urek soup, often accompanied by live piano music.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day1_node6",
      "title": "Trattoria Rucola",
      "description": "Craving something different? This popular trattoria offers a delightful array of authentic Italian dishes. Enjoy freshly made pasta, wood-fired pizzas, and delicious antipasti in a cozy, inviting atmosphere.",
      "cuisineType": "italian",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day2_node1",
      "title": "Plac Nowy Street Food",
      "description": "Dive into Krakow's vibrant Kazimierz district for an iconic street food experience. Sample a 'zapiekanka,' a toasted open-faced baguette with various toppings, or explore other local snacks from the bustling stalls.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Krakow"
    },
    {
      "nodeId": "day2_node3",
      "title": "Pod Wawelem Kompania Kuflowa",
      "description": "Indulge in a hearty Polish feast near Wawel Castle, known for its generous portions and lively atmosphere. Savor traditional dishes like grilled meats, goulash, and various regional specialties, perfectly paired with local beers.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Krakow"
    },
    {
      "nodeId": "day2_node5",
      "title": "Youmiko Vegan Sushi",
      "description": "Discover innovative and delicious plant-based sushi creations at this highly-rated vegan sushi spot. Enjoy beautifully crafted rolls, nigiri, and other Japanese-inspired dishes that are as flavorful as they are artistic.",
      "cuisineType": "japanese",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day3_node1",
      "title": "Charlotte Chleb i Wino",
      "description": "Enjoy a chic and relaxed cafe experience with a French-inspired menu. Perfect for a light lunch, offering freshly baked bread, delicious sandwiches, salads, and an excellent selection of wines and pastries.",
      "cuisineType": "cafe",
      "mealType": "lunch",
      "locationName": "Krakow"
    },
    {
      "nodeId": "day3_node3",
      "title": "Atelier Amaro",
      "description": "Embark on a culinary journey at Poland's first Michelin-starred restaurant, offering 'Nature's Calendar' cuisine. Experience innovative, modern Polish dishes crafted from seasonal, local ingredients, presented as edible art.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day3_node6",
      "title": "Zapiecek Polskie Pierogarnie",
      "description": "A must-visit for pierogi lovers, this charming restaurant specializes in Poland's beloved dumplings. Choose from a vast selection of fillings  boiled, baked, or fried  both savory and sweet, served in a traditional folk-inspired setting.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day4_node1",
      "title": "Obwarzanek Krakowski Street Vendors",
      "description": "Grab a quick and iconic snack from one of the many street vendors in Krakow. The 'obwarzanek' is a braided, ring-shaped bread, boiled and baked, similar to a bagel, often topped with salt, poppy seeds, or sesame seeds  perfect for a light bite.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Krakow"
    },
    {
      "nodeId": "day4_node3",
      "title": "Gospoda Kwiaty Polskie",
      "description": "Savor an authentic Polish dining experience in a rustic and welcoming setting. This restaurant offers traditional regional dishes with a focus on fresh ingredients, providing a true taste of Polish home cooking.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day4_node6",
      "title": "Cukiernia Sowa",
      "description": "End your trip on a sweet note at a popular Polish patisserie. Indulge in exquisite cakes, pastries, and traditional Polish sweets like pczki (donuts) or sernik (cheesecake), paired with a perfect coffee or tea.",
      "cuisineType": "cafe",
      "mealType": "dinner",
      "locationName": "Krakow"
    }
  ]
}
```
2025-10-18 18:15:39.747 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - === END MEAL AGENT RESPONSE ===
2025-10-18 18:15:39.747 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - Cleaned Response: {
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "Bar Prasowy",
      "description": "Step back in time at a classic 'milk bar' for an authentic and budget-friendly Polish lunch. Enjoy hearty, home-style dishes like pierogi, gobki (cabbage rolls), or tomato soup, served in a no-frills, nostalgic setting.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day1_node3",
      "title": "Stary Dom Restaurant",
      "description": "Experience traditional Polish hospitality and cuisine in an elegant, rustic setting. Feast on expertly prepared classics like pork knuckle, duck with apples, or a rich urek soup, often accompanied by live piano music.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day1_node6",
      "title": "Trattoria Rucola",
      "description": "Craving something different? This popular trattoria offers a delightful array of authentic Italian dishes. Enjoy freshly made pasta, wood-fired pizzas, and delicious antipasti in a cozy, inviting atmosphere.",
      "cuisineType": "italian",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day2_node1",
      "title": "Plac Nowy Street Food",
      "description": "Dive into Krakow's vibrant Kazimierz district for an iconic street food experience. Sample a 'zapiekanka,' a toasted open-faced baguette with various toppings, or explore other local snacks from the bustling stalls.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Krakow"
    },
    {
      "nodeId": "day2_node3",
      "title": "Pod Wawelem Kompania Kuflowa",
      "description": "Indulge in a hearty Polish feast near Wawel Castle, known for its generous portions and lively atmosphere. Savor traditional dishes like grilled meats, goulash, and various regional specialties, perfectly paired with local beers.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Krakow"
    },
    {
      "nodeId": "day2_node5",
      "title": "Youmiko Vegan Sushi",
      "description": "Discover innovative and delicious plant-based sushi creations at this highly-rated vegan sushi spot. Enjoy beautifully crafted rolls, nigiri, and other Japanese-inspired dishes that are as flavorful as they are artistic.",
      "cuisineType": "japanese",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day3_node1",
      "title": "Charlotte Chleb i Wino",
      "description": "Enjoy a chic and relaxed cafe experience with a French-inspired menu. Perfect for a light lunch, offering freshly baked bread, delicious sandwiches, salads, and an excellent selection of wines and pastries.",
      "cuisineType": "cafe",
      "mealType": "lunch",
      "locationName": "Krakow"
    },
    {
      "nodeId": "day3_node3",
      "title": "Atelier Amaro",
      "description": "Embark on a culinary journey at Poland's first Michelin-starred restaurant, offering 'Nature's Calendar' cuisine. Experience innovative, modern Polish dishes crafted from seasonal, local ingredients, presented as edible art.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day3_node6",
      "title": "Zapiecek Polskie Pierogarnie",
      "description": "A must-visit for pierogi lovers, this charming restaurant specializes in Poland's beloved dumplings. Choose from a vast selection of fillings  boiled, baked, or fried  both savory and sweet, served in a traditional folk-inspired setting.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day4_node1",
      "title": "Obwarzanek Krakowski Street Vendors",
      "description": "Grab a quick and iconic snack from one of the many street vendors in Krakow. The 'obwarzanek' is a braided, ring-shaped bread, boiled and baked, similar to a bagel, often topped with salt, poppy seeds, or sesame seeds  perfect for a light bite.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Krakow"
    },
    {
      "nodeId": "day4_node3",
      "title": "Gospoda Kwiaty Polskie",
      "description": "Savor an authentic Polish dining experience in a rustic and welcoming setting. This restaurant offers traditional regional dishes with a focus on fresh ingredients, providing a true taste of Polish home cooking.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Warsaw"
    },
    {
      "nodeId": "day4_node6",
      "title": "Cukiernia Sowa",
      "description": "End your trip on a sweet note at a popular Polish patisserie. Indulge in exquisite cakes, pastries, and traditional Polish sweets like pczki (donuts) or sernik (cheesecake), paired with a perfect coffee or tea.",
      "cuisineType": "cafe",
      "mealType": "dinner",
      "locationName": "Krakow"
    }
  ]
}
2025-10-18 18:15:40.764 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=uqf00h5f] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:15:40.764 [http-nio-8080-exec-7] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session uqf00h5f
2025-10-18 18:15:40.764 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=uqf00h5f
2025-10-18 18:15:40.764 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=uqf00h5f}], simpSessionId=uqf00h5f}]
2025-10-18 18:15:40.976 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:40.977 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:40.977 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:15:40.977 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:15:40.977 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.200 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - Saved itinerary with populated meals
2025-10-18 18:15:41.200 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT COMPLETE ===
2025-10-18 18:15:41.200 [Pipeline-80] INFO  com.tripplanner.agents.MealAgent - Populated 12 meals
2025-10-18 18:15:41.200 [Pipeline-80] INFO  com.tripplanner.service.PipelineOrchestrator - [MealAgent] Complete
2025-10-18 18:15:41.200 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - All population agents completed successfully
2025-10-18 18:15:41.200 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 2 complete (24721 ms)
2025-10-18 18:15:41.200 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Phase population completed in 24721 ms
2025-10-18 18:15:41.201 [http-nio-8080-exec-6] DEBUG o.s.web.context.request.async.WebAsyncManager - Servlet container error notification for "/api/v1/itineraries/patches"
2025-10-18 18:15:41.201 [Pipeline-74] WARN  com.tripplanner.service.SseConnectionManager - Failed to send SSE event to connection, marking as dead: ServletOutputStream failed to flush: java.io.IOException: An established connection was aborted by the software in your host machine
2025-10-18 18:15:41.201 [Pipeline-74] INFO  com.tripplanner.service.SseConnectionManager - Cleaning up 1 dead SSE connections for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.201 [http-nio-8080-exec-6] WARN  com.tripplanner.service.SseConnectionManager - SSE connection error for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b, execution: exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5: An established connection was aborted by the software in your host machine
2025-10-18 18:15:41.201 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 3: ENRICHMENT ===
2025-10-18 18:15:41.201 [http-nio-8080-exec-6] DEBUG o.s.web.context.request.async.WebAsyncManager - Async result set for "/api/v1/itineraries/patches"
2025-10-18 18:15:41.201 [http-nio-8080-exec-6] DEBUG o.s.web.context.request.async.WebAsyncManager - Performing async dispatch for "/api/v1/itineraries/patches"
2025-10-18 18:15:41.201 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - === AGENT EXECUTION START ===
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Agent Kind: ENRICHMENT
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Request Type: ApplyResult
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Request Data: {taskType=enrich}
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Request Details: {taskType=enrich}
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - =============================
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: queued
2025-10-18 18:15:41.202 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/patches?itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b&executionId=exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5&token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 0
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Agent queued for execution
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 18:15:41.202 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:45:41.202865600Z
2025-10-18 18:15:41.202 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/patches?itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b&executionId=exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5&token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:15:41.204 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - "ASYNC" dispatch for GET "/api/v1/itineraries/patches?itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b&executionId=exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5&token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA", parameters={masked}
2025-10-18 18:15:41.204 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - Failed to send event to SSE emitter for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b (client likely disconnected)
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Event sent to 0 SSE emitters successfully, 1 failed for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Agent started
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:45:41.204122400Z
2025-10-18 18:15:41.204 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:15:41.204 [http-nio-8080-exec-8] DEBUG o.s.web.context.request.async.WebAsyncManager - Servlet container error notification for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:15:41.204 [http-nio-8080-exec-8] DEBUG o.s.web.context.request.async.WebAsyncManager - Async result set for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:15:41.204 [http-nio-8080-exec-8] DEBUG o.s.web.context.request.async.WebAsyncManager - Performing async dispatch for "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b"
2025-10-18 18:15:41.204 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - Resume with async result [java.io.IOException: An established connection was aborted by the software in your host machine]
2025-10-18 18:15:41.205 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.tripplanner.exception.GlobalExceptionHandler#handleGenericException(Exception, WebRequest)
2025-10-18 18:15:41.205 [http-nio-8080-exec-6] ERROR com.tripplanner.exception.GlobalExceptionHandler - === GENERIC EXCEPTION ===
2025-10-18 18:15:41.204 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Executing agent-specific logic for: ENRICHMENT
2025-10-18 18:15:41.206 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - === ENRICHMENT AGENT PROCESSING ===
2025-10-18 18:15:41.206 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.206 [http-nio-8080-exec-6] ERROR com.tripplanner.exception.GlobalExceptionHandler - Type: IOException
2025-10-18 18:15:41.208 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:15:41.206 [http-nio-8080-exec-6] ERROR com.tripplanner.exception.GlobalExceptionHandler - Error: An established connection was aborted by the software in your host machine
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.SseConnectionManager.broadcastUpdate(SseConnectionManager.java:78)
	at com.tripplanner.service.AgentEventPublisher.publishProgress(AgentEventPublisher.java:112)
	at com.tripplanner.service.PipelineOrchestrator.publishPhaseComplete(PipelineOrchestrator.java:388)
	at com.tripplanner.service.PipelineOrchestrator.lambda$generateItinerary$2(PipelineOrchestrator.java:125)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:41.209 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA
2025-10-18 18:15:41.210 [http-nio-8080-exec-6] ERROR com.tripplanner.exception.GlobalExceptionHandler - Request: uri=/api/v1/itineraries/patches
2025-10-18 18:15:41.210 [http-nio-8080-exec-6] ERROR com.tripplanner.exception.GlobalExceptionHandler - =========================
2025-10-18 18:15:41.210 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - "ASYNC" dispatch for GET "/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b?token=eyJhbGciOiJSUzI1NiIsImtpZCI6IjlkMjEzMGZlZjAyNTg3ZmQ4ODYxODg2OTgyMjczNGVmNzZhMTExNjUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoiQ2xvdWRDcnVzYWRlciIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NKbHZpNUJ4X0NxZlNyMWI2MjQtMmlEa0NTRUxLb3hrXzBSVkZCYmluejZfY3pKcmc9czk2LWMiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdHJpcGFpcGxhbm5lci00Yzk1MSIsImF1ZCI6InRyaXBhaXBsYW5uZXItNGM5NTEiLCJhdXRoX3RpbWUiOjE3NjAzMTc2MDUsInVzZXJfaWQiOiJQRW9VTG1pTmEyZEJPWnJsQmNYczhFWklrWHMxIiwic3ViIjoiUEVvVUxtaU5hMmRCT1pybEJjWHM4RVpJa1hzMSIsImlhdCI6MTc2MDc5MTM2MCwiZXhwIjoxNzYwNzk0OTYwLCJlbWFpbCI6ImNsb3VkY3J1c2FkZXIzNjBAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZ29vZ2xlLmNvbSI6WyIxMDcxNjU5NTI3MTg3ODIyOTIwNzUiXSwiZW1haWwiOlsiY2xvdWRjcnVzYWRlcjM2MEBnbWFpbC5jb20iXX0sInNpZ25faW5fcHJvdmlkZXIiOiJnb29nbGUuY29tIn19.r9VOnltZaKFtMiqAX6d0lL33C3VhpwHsb209UENKjXfq3mT5cQybFHaBwmQtovHo_DVmov5d3eBlJ1u6QnmYRLD_n0tY2IChxjfzsaKevduVgVj5rE1hfCMXwz3hv-Z4nxnKjV2bz-ctbZG4eaDvCRUxyyFuJ-u0QFHrAb0LGu6-xiOrgIKAqROKBMsWkIMxpb4nVrb6LluK3W0wY-O6aWs9d08csH6yiB8Mv5QHtH4XJ9OAPLJrSmmgMIKnPBCC4JUFExIO6rcmyAOJHojawxtkjPBEMj9nDelKjTQ1ldyzdaA9DJA6gbWNPoMy9Vo4ExXUvF_Gh7y-Ux_u2oTHjA", parameters={masked}
2025-10-18 18:15:41.210 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Found 'Content-Type:text/event-stream' in response
2025-10-18 18:15:41.211 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - Resume with async result [java.io.IOException: An established connection was aborted by the software in your host machine]
2025-10-18 18:15:41.210 [http-nio-8080-exec-6] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.tripplanner.exception.GlobalExceptionHandler#handleGenericException(Exception, WebRequest)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.tripplanner.exception.ErrorResponse] with preset Content-Type 'text/event-stream'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:365)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:263)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:471)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:73)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:182)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1360)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:612)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:540)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:511)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:599)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:342)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:41.211 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.tripplanner.exception.GlobalExceptionHandler#handleGenericException(Exception, WebRequest)
2025-10-18 18:15:41.211 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Unresolved failure from "ASYNC" dispatch: java.io.IOException: An established connection was aborted by the software in your host machine
2025-10-18 18:15:41.211 [http-nio-8080-exec-8] ERROR com.tripplanner.exception.GlobalExceptionHandler - === GENERIC EXCEPTION ===
2025-10-18 18:15:41.211 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:41.213 [http-nio-8080-exec-8] ERROR com.tripplanner.exception.GlobalExceptionHandler - Type: IOException
2025-10-18 18:15:41.213 [http-nio-8080-exec-6] ERROR o.a.c.c.C.[.[localhost].[/].[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] threw exception
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.SseConnectionManager.broadcastUpdate(SseConnectionManager.java:78)
	at com.tripplanner.service.AgentEventPublisher.publishProgress(AgentEventPublisher.java:112)
	at com.tripplanner.service.PipelineOrchestrator.publishPhaseComplete(PipelineOrchestrator.java:388)
	at com.tripplanner.service.PipelineOrchestrator.lambda$generateItinerary$2(PipelineOrchestrator.java:125)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:41.213 [http-nio-8080-exec-8] ERROR com.tripplanner.exception.GlobalExceptionHandler - Error: An established connection was aborted by the software in your host machine
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.AgentEventBus.publish(AgentEventBus.java:96)
	at com.tripplanner.agents.BaseAgent.emitEvent(BaseAgent.java:206)
	at com.tripplanner.agents.BaseAgent.execute(BaseAgent.java:78)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executeEnrichmentPhase$7(PipelineOrchestrator.java:296)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:41.213 [http-nio-8080-exec-8] ERROR com.tripplanner.exception.GlobalExceptionHandler - Request: uri=/api/v1/agents/events/it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.213 [http-nio-8080-exec-6] INFO  com.tripplanner.service.SseConnectionManager - SSE connection completed for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b, execution: exec_7fe81cf6-63da-4dc1-9eac-f0fa113a85b5
2025-10-18 18:15:41.213 [http-nio-8080-exec-8] ERROR com.tripplanner.exception.GlobalExceptionHandler - =========================
2025-10-18 18:15:41.214 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Found 'Content-Type:text/event-stream' in response
2025-10-18 18:15:41.214 [http-nio-8080-exec-6] ERROR o.a.c.c.C.[.[localhost].[/].[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.SseConnectionManager.broadcastUpdate(SseConnectionManager.java:78)
	at com.tripplanner.service.AgentEventPublisher.publishProgress(AgentEventPublisher.java:112)
	at com.tripplanner.service.PipelineOrchestrator.publishPhaseComplete(PipelineOrchestrator.java:388)
	at com.tripplanner.service.PipelineOrchestrator.lambda$generateItinerary$2(PipelineOrchestrator.java:125)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:41.214 [http-nio-8080-exec-8] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.tripplanner.exception.GlobalExceptionHandler#handleGenericException(Exception, WebRequest)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.tripplanner.exception.ErrorResponse] with preset Content-Type 'text/event-stream'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:365)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:263)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:471)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:73)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:182)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1360)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:612)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:540)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:511)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:599)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:342)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:41.215 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Unresolved failure from "ASYNC" dispatch: java.io.IOException: An established connection was aborted by the software in your host machine
2025-10-18 18:15:41.215 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:41.215 [http-nio-8080-exec-8] ERROR o.a.c.c.C.[.[localhost].[/].[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] threw exception
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.AgentEventBus.publish(AgentEventBus.java:96)
	at com.tripplanner.agents.BaseAgent.emitEvent(BaseAgent.java:206)
	at com.tripplanner.agents.BaseAgent.execute(BaseAgent.java:78)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executeEnrichmentPhase$7(PipelineOrchestrator.java:296)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:41.215 [http-nio-8080-exec-8] ERROR o.a.c.c.C.[.[localhost].[/].[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception
java.io.IOException: An established connection was aborted by the software in your host machine
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:132)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:97)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:53)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:532)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:125)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1411)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:732)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:698)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:683)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1273)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:300)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:266)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:133)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:415)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:153)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1205)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:485)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:135)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:315)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$DefaultSseEmitterHandler.send(ResponseBodyEmitterReturnValueHandler.java:302)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:226)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:217)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:134)
	at com.tripplanner.service.AgentEventBus.publish(AgentEventBus.java:96)
	at com.tripplanner.agents.BaseAgent.emitEvent(BaseAgent.java:206)
	at com.tripplanner.agents.BaseAgent.execute(BaseAgent.java:78)
	at com.tripplanner.service.PipelineOrchestrator.lambda$executeEnrichmentPhase$7(PipelineOrchestrator.java:296)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-18 18:15:41.815 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.816 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:41.816 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:15:41.817 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:41.817 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:41.857 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:15:41.857 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:41.857 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:15:41.857 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:15:41.857 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:15:41.857 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:15:41.858 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:15:41.858 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:15:41.858 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:41.858 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:15:42.858 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791542857
2025-10-18 18:15:42.858 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791542857
2025-10-18 18:15:42.858 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791542857", parameters={masked}
2025-10-18 18:15:42.859 [http-nio-8080-exec-2] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:15:42.859 [http-nio-8080-exec-2] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791542857
2025-10-18 18:15:42.859 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:42.859 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:42.862 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/980/sdpluez1/websocket
2025-10-18 18:15:42.862 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/980/sdpluez1/websocket
2025-10-18 18:15:42.862 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/980/sdpluez1/websocket", parameters={}
2025-10-18 18:15:42.862 [http-nio-8080-exec-4] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:15:42.863 [http-nio-8080-exec-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/980/sdpluez1/websocket
2025-10-18 18:15:42.863 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:42.863 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:15:42.863 [http-nio-8080-exec-4] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=sdpluez1]
2025-10-18 18:15:42.865 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=sdpluez1
2025-10-18 18:15:42.867 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=sdpluez1
2025-10-18 18:15:42.867 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=sdpluez1
2025-10-18 18:15:42.867 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=sdpluez1
2025-10-18 18:15:43.044 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:15:43.044 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.044 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:15:43.044 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:15:43.044 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:15:43.044 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Loading itinerary
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: loading
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:45:43.044734Z
2025-10-18 18:15:43.045 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Enriching places with Google Places data
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: ENRICHMENT
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:45:43.045740800Z
2025-10-18 18:15:43.045 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.045 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:15:43.054 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Warsaw&key=
2025-10-18 18:15:43.066 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-18 18:15:43.247 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-18 18:15:43.249 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-18 18:15:43.250 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-18 18:15:43.250 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 1
2025-10-18 18:15:43.250 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Krakow&key=
2025-10-18 18:15:43.251 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-18 18:15:43.351 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-18 18:15:43.351 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-18 18:15:43.352 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-18 18:15:43.352 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 2
2025-10-18 18:15:43.352 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Warsaw&key=
2025-10-18 18:15:43.352 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-18 18:15:43.448 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-18 18:15:43.448 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-18 18:15:43.449 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-18 18:15:43.449 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 3
2025-10-18 18:15:43.449 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Krakow&key=
2025-10-18 18:15:43.450 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-18 18:15:43.545 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-18 18:15:43.545 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-18 18:15:43.546 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-18 18:15:43.546 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 4
2025-10-18 18:15:43.546 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Krakow&key=
2025-10-18 18:15:43.546 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-18 18:15:43.640 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-18 18:15:43.641 [Pipeline-75] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-18 18:15:43.641 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-18 18:15:43.641 [Pipeline-75] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 5
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.service.GooglePlacesService - Google Places API failure threshold reached (5), opening circuit breaker
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day1_node6 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node1 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node2 (Ojcw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node3 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node4 (Wieliczka): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node5 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node1 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node2 (Zakopane): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node3 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node4 (Chocholow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.641 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node6 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.642 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node1 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.642 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node2 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.642 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node3 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.642 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node4 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.642 [Pipeline-75] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node6 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Created 0 ENRICHMENT operations
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 40
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Validating opening hours
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: validation
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:45:43.642588900Z
2025-10-18 18:15:43.642 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.642 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 60
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Calculating pacing
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: pacing
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:45:43.643578600Z
2025-10-18 18:15:43.643 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.643 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Computing transit durations
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: transit
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:45:43.643578600Z
2025-10-18 18:15:43.644 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 90
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Applying enrichments
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: applying
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:45:43.644543200Z
2025-10-18 18:15:43.644 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:15:43.644 [Pipeline-75] INFO  com.tripplanner.service.ChangeEngine - Applying changes for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.913 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:43.914 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:43.914 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:15:43.916 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:43.916 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:45.430 [http-nio-8080-exec-3] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:15:45.430 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:15:45.430 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:15:45.431 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:15:45.431 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:15:47.948 [MessageBroker-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [uqf00h5f]
2025-10-18 18:16:02.387 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:16:02.387 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:16:02.388 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:16:02.388 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:16:02.388 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:16:02.388 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:16:02.388 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:16:02.388 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:16:02.388 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:02.388 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:16:04.934 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:04.934 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:16:04.935 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:16:04.936 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:16:04.936 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node1_to_day1_node2, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node2_to_day1_node3, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node3_to_day1_node4, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node4_to_day1_node5, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node5_to_day1_node6, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node6_to_day1_node7, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node1_to_day2_node2, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node2_to_day2_node3, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node3_to_day2_node4, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node4_to_day2_node5, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node5_to_day2_node6, op=update_edge
2025-10-18 18:16:05.230 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node1_to_day3_node2, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node2_to_day3_node3, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node3_to_day3_node4, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node4_to_day3_node5, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node5_to_day3_node6, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node6_to_day3_node7, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node1_to_day4_node2, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node2_to_day4_node3, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node3_to_day4_node4, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node4_to_day4_node5, op=update_edge
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-18 18:16:05.231 [Pipeline-75] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node5_to_day4_node6, op=update_edge
2025-10-18 18:16:05.232 [Pipeline-75] INFO  com.tripplanner.service.RevisionService - Saving revision rev_1760791565231_092019f7 for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:05.942 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:05.943 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:16:05.943 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:16:05.944 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:16:05.944 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:16:06.332 [Pipeline-75] INFO  com.tripplanner.service.RevisionService - Successfully saved revision rev_1760791565231_092019f7 for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.ChangeEngine - Triggering auto-enrichment for 22 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Enrichment complete
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: complete
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:46:07.298782900Z
2025-10-18 18:16:07.298 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:16:07.298 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - === ENRICHMENT COMPLETE ===
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Applied 44 ENRICHMENT operations
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - New version: 2
2025-10-18 18:16:07.299 [AsyncTask-2] INFO  com.tripplanner.service.EnrichmentService - Starting async enrichment for 22 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 6eb3c796-f4b5-4b9e-87e1-7699536461b1
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Status: completed
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Message: Agent completed successfully
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:46:07.299783900Z
2025-10-18 18:16:07.299 [Pipeline-75] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - === AGENT EXECUTION COMPLETED ===
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Agent Kind: ENRICHMENT
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Result Type: ApplyResult
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - Result: com.tripplanner.service.ChangeEngine$ApplyResult@54b344de
2025-10-18 18:16:07.299 [Pipeline-75] INFO  com.tripplanner.agents.EnrichmentAgent - =================================
2025-10-18 18:16:07.299 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 3 complete (26099 ms)
2025-10-18 18:16:07.299 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 4: COST ESTIMATION ===
2025-10-18 18:16:07.299 [Pipeline-74] INFO  com.tripplanner.agents.CostEstimatorAgent - === COST ESTIMATOR AGENT ===
2025-10-18 18:16:07.299 [Pipeline-74] INFO  com.tripplanner.agents.CostEstimatorAgent - Estimating costs for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:07.358 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=sdpluez1
2025-10-18 18:16:07.358 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=sdpluez1
2025-10-18 18:16:07.359 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=sdpluez1
2025-10-18 18:16:07.359 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=sdpluez1
2025-10-18 18:16:07.384 [http-nio-8080-exec-9] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=sdpluez1] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:16:07.384 [http-nio-8080-exec-9] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session sdpluez1
2025-10-18 18:16:07.384 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=sdpluez1
2025-10-18 18:16:07.384 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=sdpluez1}], simpSessionId=sdpluez1}]
2025-10-18 18:16:08.409 [AsyncTask-2] INFO  com.tripplanner.service.EnrichmentService - Enriching 17 out of 22 nodes (others already have coordinates)
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node2 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node3 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node4 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node5 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node6 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node2 (Ojcw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node3 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node4 (Wieliczka): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node5 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.409 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node2 (Zakopane): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.410 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node3 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.410 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node4 (Chocholow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.410 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node6 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.410 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node2 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.410 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node3 (Warsaw): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.410 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node4 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.410 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node6 (Krakow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-18 18:16:08.410 [AsyncTask-2] INFO  com.tripplanner.service.EnrichmentService - Successfully enriched 0 out of 17 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b (took 1111ms)
2025-10-18 18:16:09.367 [Pipeline-74] INFO  com.tripplanner.agents.CostEstimatorAgent - === COST ESTIMATOR COMPLETE ===
2025-10-18 18:16:09.367 [Pipeline-74] INFO  com.tripplanner.agents.CostEstimatorAgent - Estimated costs for 26 nodes
2025-10-18 18:16:09.367 [Pipeline-74] INFO  com.tripplanner.agents.CostEstimatorAgent - Total estimated cost: 48900 per person
2025-10-18 18:16:09.367 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 4 complete (2068 ms)
2025-10-18 18:16:09.367 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 5: FINALIZATION ===
2025-10-18 18:16:11.407 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - === PIPELINE COMPLETE ===
2025-10-18 18:16:11.407 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Total time: 111374 ms
2025-10-18 18:16:11.408 [Pipeline-74] INFO  com.tripplanner.service.PipelineOrchestrator - Days: 4, Nodes: 26
2025-10-18 18:16:11.408 [AsyncTask-1] INFO  com.tripplanner.service.ItineraryService - Pipeline generation completed successfully for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b, executionId: exec_1760791460021
2025-10-18 18:16:12.935 [MessageBroker-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [sdpluez1]
2025-10-18 18:16:27.664 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:16:27.664 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:16:27.664 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:16:27.664 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:16:27.664 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:16:27.664 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:16:27.665 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:16:27.665 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:16:27.665 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:27.665 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:16:28.672 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791588671
2025-10-18 18:16:28.673 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791588671
2025-10-18 18:16:28.673 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791588671", parameters={masked}
2025-10-18 18:16:28.673 [http-nio-8080-exec-5] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:16:28.673 [http-nio-8080-exec-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791588671
2025-10-18 18:16:28.673 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:16:28.673 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:16:28.677 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/576/rvbj2jcj/websocket
2025-10-18 18:16:28.677 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/576/rvbj2jcj/websocket
2025-10-18 18:16:28.677 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/576/rvbj2jcj/websocket", parameters={}
2025-10-18 18:16:28.677 [http-nio-8080-exec-10] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:16:28.677 [http-nio-8080-exec-10] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/576/rvbj2jcj/websocket
2025-10-18 18:16:28.678 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:16:28.678 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:16:28.679 [http-nio-8080-exec-10] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=rvbj2jcj]
2025-10-18 18:16:28.682 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=rvbj2jcj
2025-10-18 18:16:28.683 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=rvbj2jcj
2025-10-18 18:16:28.683 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=rvbj2jcj
2025-10-18 18:16:28.684 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=rvbj2jcj
2025-10-18 18:16:29.465 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:29.465 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:16:29.465 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:16:29.466 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:16:29.466 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:16:30.370 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:16:30.371 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:16:30.371 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:16:30.373 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:16:30.373 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:09.898 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=rvbj2jcj
2025-10-18 18:17:09.898 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=rvbj2jcj
2025-10-18 18:17:09.898 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=rvbj2jcj
2025-10-18 18:17:09.898 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=rvbj2jcj
2025-10-18 18:17:09.903 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:17:09.903 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:17:09.903 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:17:09.903 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:17:09.903 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:17:09.903 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:17:09.904 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:17:09.904 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:17:09.904 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:17:09.904 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:17:09.918 [http-nio-8080-exec-9] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=rvbj2jcj] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:17:09.918 [http-nio-8080-exec-9] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session rvbj2jcj
2025-10-18 18:17:09.919 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=rvbj2jcj
2025-10-18 18:17:09.919 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=rvbj2jcj}], simpSessionId=rvbj2jcj}]
2025-10-18 18:17:10.934 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791630933
2025-10-18 18:17:10.935 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791630933
2025-10-18 18:17:10.935 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791630933", parameters={masked}
2025-10-18 18:17:10.935 [http-nio-8080-exec-5] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:17:10.935 [http-nio-8080-exec-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791630933
2025-10-18 18:17:10.937 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:17:10.937 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:10.941 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/480/q0wu5pnj/websocket
2025-10-18 18:17:10.941 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/480/q0wu5pnj/websocket
2025-10-18 18:17:10.941 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/480/q0wu5pnj/websocket", parameters={}
2025-10-18 18:17:10.941 [http-nio-8080-exec-10] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:17:10.942 [http-nio-8080-exec-10] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/480/q0wu5pnj/websocket
2025-10-18 18:17:10.942 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:10.942 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:17:10.943 [http-nio-8080-exec-10] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=q0wu5pnj]
2025-10-18 18:17:10.945 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=q0wu5pnj
2025-10-18 18:17:10.946 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=q0wu5pnj
2025-10-18 18:17:10.947 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=q0wu5pnj
2025-10-18 18:17:10.947 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=q0wu5pnj
2025-10-18 18:17:11.995 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:17:11.996 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:17:11.996 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:17:11.999 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:17:11.999 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:12.008 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:17:12.312 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:17:12.312 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:17:12.312 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:17:12.313 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:17:12.313 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:12.315 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:17:12.316 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:17:12.316 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:17:12.316 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:17:14.360 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:17:14.360 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:17:14.360 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:17:14.361 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:17:14.361 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:17.944 [MessageBroker-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [rvbj2jcj]
2025-10-18 18:17:33.691 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=q0wu5pnj
2025-10-18 18:17:33.691 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=q0wu5pnj
2025-10-18 18:17:33.691 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=q0wu5pnj
2025-10-18 18:17:33.691 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=q0wu5pnj
2025-10-18 18:17:33.704 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:17:33.704 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:17:33.705 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:17:33.705 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:17:33.705 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:17:33.705 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:17:33.705 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:17:33.705 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:17:33.705 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:17:33.705 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:17:33.758 [http-nio-8080-exec-10] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=q0wu5pnj] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:17:33.758 [http-nio-8080-exec-10] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session q0wu5pnj
2025-10-18 18:17:33.758 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=q0wu5pnj
2025-10-18 18:17:33.758 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=q0wu5pnj}], simpSessionId=q0wu5pnj}]
2025-10-18 18:17:34.716 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791654713
2025-10-18 18:17:34.716 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791654713
2025-10-18 18:17:34.716 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791654713", parameters={masked}
2025-10-18 18:17:34.717 [http-nio-8080-exec-1] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:17:34.717 [http-nio-8080-exec-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791654713
2025-10-18 18:17:34.717 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:17:34.717 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:34.722 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/102/uzgmsvop/websocket
2025-10-18 18:17:34.722 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/102/uzgmsvop/websocket
2025-10-18 18:17:34.722 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/102/uzgmsvop/websocket", parameters={}
2025-10-18 18:17:34.722 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:17:34.722 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/102/uzgmsvop/websocket
2025-10-18 18:17:34.723 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:34.723 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:17:34.723 [http-nio-8080-exec-3] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=uzgmsvop]
2025-10-18 18:17:34.725 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=uzgmsvop
2025-10-18 18:17:34.727 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=uzgmsvop
2025-10-18 18:17:34.727 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=uzgmsvop
2025-10-18 18:17:34.727 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=uzgmsvop
2025-10-18 18:17:35.772 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:17:35.772 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:17:35.773 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:17:35.774 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:17:35.774 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:36.114 [http-nio-8080-exec-5] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:17:36.115 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:17:36.115 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:17:36.117 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:17:36.117 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:17:42.948 [MessageBroker-2] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [q0wu5pnj]
2025-10-18 18:18:45.834 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=uzgmsvop
2025-10-18 18:18:45.834 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=uzgmsvop
2025-10-18 18:18:45.834 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=uzgmsvop
2025-10-18 18:18:45.834 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=uzgmsvop
2025-10-18 18:18:45.840 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:18:45.840 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:18:45.841 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:18:45.841 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:18:45.841 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:18:45.841 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:18:45.841 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:18:45.841 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:18:45.841 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:18:45.841 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:18:45.856 [http-nio-8080-exec-6] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=uzgmsvop] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:18:45.856 [http-nio-8080-exec-6] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session uzgmsvop
2025-10-18 18:18:45.856 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=uzgmsvop
2025-10-18 18:18:45.856 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=uzgmsvop}], simpSessionId=uzgmsvop}]
2025-10-18 18:18:46.855 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791726853
2025-10-18 18:18:46.855 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791726853
2025-10-18 18:18:46.856 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791726853", parameters={masked}
2025-10-18 18:18:46.856 [http-nio-8080-exec-4] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:18:46.856 [http-nio-8080-exec-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791726853
2025-10-18 18:18:46.857 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:18:46.857 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:18:46.861 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/163/fmh2n43j/websocket
2025-10-18 18:18:46.861 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/163/fmh2n43j/websocket
2025-10-18 18:18:46.861 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/163/fmh2n43j/websocket", parameters={}
2025-10-18 18:18:46.862 [http-nio-8080-exec-9] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:18:46.862 [http-nio-8080-exec-9] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/163/fmh2n43j/websocket
2025-10-18 18:18:46.862 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:18:46.862 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:18:46.863 [http-nio-8080-exec-9] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=fmh2n43j]
2025-10-18 18:18:46.865 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=fmh2n43j
2025-10-18 18:18:46.866 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=fmh2n43j
2025-10-18 18:18:46.867 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=fmh2n43j
2025-10-18 18:18:46.867 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=fmh2n43j
2025-10-18 18:18:47.959 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:18:47.959 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:18:47.960 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:18:47.961 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:18:47.961 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:18:48.270 [http-nio-8080-exec-3] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:18:48.270 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:18:48.270 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:18:48.271 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:18:48.271 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:18:48.274 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:18:48.275 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:18:48.275 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:18:48.275 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:18:50.355 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:18:50.355 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:18:50.356 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:18:50.356 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:18:50.356 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:18:52.941 [MessageBroker-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [uzgmsvop]
2025-10-18 18:19:09.702 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=fmh2n43j
2025-10-18 18:19:09.702 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=fmh2n43j
2025-10-18 18:19:09.702 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=fmh2n43j
2025-10-18 18:19:09.702 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=fmh2n43j
2025-10-18 18:19:09.716 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:19:09.716 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:19:09.717 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:19:09.717 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:19:09.717 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:19:09.717 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:19:09.718 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:19:09.718 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:19:09.718 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:19:09.718 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:19:09.789 [http-nio-8080-exec-8] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=fmh2n43j] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:19:09.789 [http-nio-8080-exec-8] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session fmh2n43j
2025-10-18 18:19:09.789 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=fmh2n43j
2025-10-18 18:19:09.789 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=fmh2n43j}], simpSessionId=fmh2n43j}]
2025-10-18 18:19:10.734 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791750732
2025-10-18 18:19:10.734 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791750732
2025-10-18 18:19:10.734 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791750732", parameters={masked}
2025-10-18 18:19:10.734 [http-nio-8080-exec-1] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:19:10.735 [http-nio-8080-exec-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791750732
2025-10-18 18:19:10.735 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:19:10.735 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:19:10.743 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/180/ysowngxl/websocket
2025-10-18 18:19:10.743 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/180/ysowngxl/websocket
2025-10-18 18:19:10.743 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/180/ysowngxl/websocket", parameters={}
2025-10-18 18:19:10.743 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:19:10.744 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/180/ysowngxl/websocket
2025-10-18 18:19:10.744 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:19:10.744 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:19:10.745 [http-nio-8080-exec-3] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=ysowngxl]
2025-10-18 18:19:10.746 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=ysowngxl
2025-10-18 18:19:10.748 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=ysowngxl
2025-10-18 18:19:10.749 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=ysowngxl
2025-10-18 18:19:10.749 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=ysowngxl
2025-10-18 18:19:11.506 [http-nio-8080-exec-5] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:19:11.506 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:19:11.507 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:19:11.507 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:19:11.507 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:19:12.419 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:19:12.419 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:19:12.420 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:19:12.421 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:19:12.422 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:19:13.204 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=ysowngxl
2025-10-18 18:19:13.204 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=ysowngxl
2025-10-18 18:19:13.204 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=ysowngxl
2025-10-18 18:19:13.204 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=ysowngxl
2025-10-18 18:19:13.233 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=ysowngxl] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:19:13.233 [http-nio-8080-exec-7] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session ysowngxl
2025-10-18 18:19:13.233 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=ysowngxl
2025-10-18 18:19:13.233 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=ysowngxl}], simpSessionId=ysowngxl}]
2025-10-18 18:19:17.945 [MessageBroker-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [fmh2n43j]
2025-10-18 18:19:22.942 [MessageBroker-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [ysowngxl]
2025-10-18 18:20:20.548 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:20:20.548 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:20:20.549 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:20:20.549 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:20:20.549 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:20:20.549 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:20:20.549 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:20:20.549 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:20:20.550 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:20.550 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:20:21.566 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791821564
2025-10-18 18:20:21.567 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791821564
2025-10-18 18:20:21.567 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791821564", parameters={masked}
2025-10-18 18:20:21.567 [http-nio-8080-exec-10] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:20:21.567 [http-nio-8080-exec-10] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791821564
2025-10-18 18:20:21.568 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:20:21.568 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:20:21.571 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/775/03kdym1l/websocket
2025-10-18 18:20:21.571 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/775/03kdym1l/websocket
2025-10-18 18:20:21.571 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/775/03kdym1l/websocket", parameters={}
2025-10-18 18:20:21.572 [http-nio-8080-exec-5] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:20:21.572 [http-nio-8080-exec-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/775/03kdym1l/websocket
2025-10-18 18:20:21.572 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:20:21.572 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:20:21.573 [http-nio-8080-exec-5] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=03kdym1l]
2025-10-18 18:20:21.575 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=03kdym1l
2025-10-18 18:20:21.577 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=03kdym1l
2025-10-18 18:20:21.577 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=03kdym1l
2025-10-18 18:20:21.577 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=03kdym1l
2025-10-18 18:20:22.333 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:22.333 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:20:22.335 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:20:22.335 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:20:22.335 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:20:22.652 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:22.652 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:20:22.652 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=1, userId='null', (truncated)...]
2025-10-18 18:20:22.653 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:20:22.653 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:20:22.661 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:20:22.661 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:20:22.663 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:20:22.663 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:20:23.544 [http-nio-8080-exec-7] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:23.545 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:20:23.545 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-18 18:20:23.545 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:20:23.545 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:20:33.536 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:20:33.536 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:20:33.536 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:20:33.537 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-18 18:20:33.538 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4, sender=user, t (truncated)...]
2025-10-18 18:20:34.421 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:34.422 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:20:34.422 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this place (truncated)...]
2025-10-18 18:20:34.423 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-18 18:20:34.424 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:20:34.428 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat
2025-10-18 18:20:34.432 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat
2025-10-18 18:20:34.432 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat
2025-10-18 18:20:34.432 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat", parameters={}
2025-10-18 18:20:34.433 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#sendChatMessage(String, ChatRequest, HttpServletRequest)
2025-10-18 18:20:34.436 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedN (truncated)...]
2025-10-18 18:20:34.436 [http-nio-8080-exec-1] INFO  com.tripplanner.service.OrchestratorService - Routing chat request: ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedNodeId='null', text='Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}
2025-10-18 18:20:35.452 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 1 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:35.453 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting content generation with provider 1 (GeminiClient)
2025-10-18 18:20:35.453 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 18:20:35.453 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 18:20:35.453 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 18:20:35.453 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 18:20:35.453 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 18:20:35.453 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2376
2025-10-18 18:20:35.453 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 18:20:35.453 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an AI assistant that classifies user intents for travel itinerary management.

Context:
Itinerary: 4-day trip to Poland with 26 activities (estimated 48900 per person)
Days: 4
Currency: INR
D...
2025-10-18 18:20:35.454 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2655
2025-10-18 18:20:35.454 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 18:20:37.787 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 18:20:37.787 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 18:20:37.787 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Response Length: 769
2025-10-18 18:20:37.787 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"intent\": \"add_activity_to_day\",\n  \"taskType\": \"edit\",\n  \"entities\": {\n    \"activity_name\": \"Muzeum Sportu i Turystyki w Warszawie\",\n    \"day_number\": 4\n  },\n  \"confidence\": 0.98\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 679,
    "candidatesTokenCount": 78,
    "totalTokenCount": 810,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 679
      }
    ],
    "thoughtsTokenCount": 53
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "HY3zaNapJtKj1e8PiJ_CiQU"
}

2025-10-18 18:20:37.789 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_662147004_20251018_182037.json
2025-10-18 18:20:37.790 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 18:20:37.790 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Generated content length: 196
2025-10-18 18:20:37.790 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "intent": "add_activity_to_day",
  "taskType": "edit",
  "entities": {
    "activity_name": "Muzeum Sportu i Turystyki w Warszawie",
    "day_number": 4
  },
  "confidence": 0.98
}
```
2025-10-18 18:20:37.790 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 18:20:37.790 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentRegistry - Created execution plan for 'edit': 1 agents, primary: EditorAgent
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.OrchestratorService - Executing agent plan: Task: edit, Agents: 1, Fallback: true, MaxRetries: 2, Timeout: 60000ms
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION START ===
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Agent ID: ff3ed168-e2fe-40bb-ba99-66c616ac03a7
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Request Type: Map
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Request Data: {chatRequest=ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedNodeId='null', text='Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b, scope=trip, text=Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Request Details: {chatRequest=ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedNodeId='null', text='Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b, scope=trip, text=Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - =============================
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent ID: ff3ed168-e2fe-40bb-ba99-66c616ac03a7
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Status: queued
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Progress: 0
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Message: Agent queued for execution
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:50:38.319484200Z
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent ID: ff3ed168-e2fe-40bb-ba99-66c616ac03a7
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Message: Agent started
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:50:38.319484200Z
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Executing agent-specific logic for: EDITOR
2025-10-18 18:20:38.319 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - EditorAgent executing for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent ID: ff3ed168-e2fe-40bb-ba99-66c616ac03a7
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Message: Loading itinerary
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Step: load
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:50:38.320494100Z
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.320 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent ID: ff3ed168-e2fe-40bb-ba99-66c616ac03a7
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Progress: 40
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Message: Generating summary
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Step: summarize
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:50:38.870930200Z
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent ID: ff3ed168-e2fe-40bb-ba99-66c616ac03a7
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Progress: 60
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Message: Generating changes
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Step: llm
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:50:38.870930200Z
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:20:38.870 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 7796
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an expert travel itinerary editor.

You must respond with valid JSON that matches this exact schema:
{
  "type": "object",
  "properties": {
    "ops": {
      "type": "array",
      "descript...
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 8395
2025-10-18 18:20:39.393 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 18:21:31.735 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 18:21:31.735 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 18:21:31.735 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Response Length: 1603
2025-10-18 18:21:31.735 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"ops\": [\n    {\n      \"op\": \"insert\",\n      \"id\": \"day4_museum_sportu_id\",\n      \"after\": \"day4_node3\",\n      \"startTime\": \"13:30\",\n      \"endTime\": \"15:30\",\n      \"node\": {\n        \"title\": \"Muzeum Sportu i Turystyki w Warszawie\",\n        \"type\": \"attraction\",\n        \"location\": {\n          \"name\": \"Muzeum Sportu i Turystyki w Warszawie\",\n          \"address\": \"Wybrzee Gdyskie 4, 01-531 Warszawa, Poland\"\n        }\n      }\n    },\n    {\n      \"op\": \"replace\",\n      \"id\": \"day4_node4\",\n      \"startTime\": \"16:00\"\n    },\n    {\n      \"op\": \"replace\",\n      \"id\": \"day4_node5\",\n      \"startTime\": \"18:30\"\n    },\n    {\n      \"op\": \"replace\",\n      \"id\": \"day4_node6\",\n      \"startTime\": \"20:30\"\n    }\n  ],\n  \"day\": 4,\n  \"reason\": \"Added Muzeum Sportu i Turystyki w Warszawie to Day 4 after the meal in Warsaw and adjusted subsequent activities by 2 hours to accommodate the visit.\",\n  \"agent\": \"EditorAgent\"\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 2679,
    "candidatesTokenCount": 340,
    "totalTokenCount": 10095,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 2679
      }
    ],
    "thoughtsTokenCount": 7076
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "U43zaKT0I7rEvr0P5cHqiQU"
}

2025-10-18 18:21:31.737 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-371378947_20251018_182131.json
2025-10-18 18:21:31.737 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 18:21:31.737 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Generated content length: 925
2025-10-18 18:21:31.737 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "ops": [
    {
      "op": "insert",
      "id": "day4_museum_sportu_id",
      "after": "day4_node3",
      "startTime": "13:30",
      "endTime": "15:30",
      "node": {
        "title": "Muzeum Sportu i Turystyki w Warszawie",
        "type": "attraction",
        "location": {
     ...
2025-10-18 18:21:31.737 [http-nio-8080-exec-1] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 18:21:31.737 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - === EDITOR AGENT - FULL LLM RESPONSE ===
2025-10-18 18:21:31.737 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - User Request: Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4
2025-10-18 18:21:31.737 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Raw Response: ```json
{
  "ops": [
    {
      "op": "insert",
      "id": "day4_museum_sportu_id",
      "after": "day4_node3",
      "startTime": "13:30",
      "endTime": "15:30",
      "node": {
        "title": "Muzeum Sportu i Turystyki w Warszawie",
        "type": "attraction",
        "location": {
          "name": "Muzeum Sportu i Turystyki w Warszawie",
          "address": "Wybrzee Gdyskie 4, 01-531 Warszawa, Poland"
        }
      }
    },
    {
      "op": "replace",
      "id": "day4_node4",
      "startTime": "16:00"
    },
    {
      "op": "replace",
      "id": "day4_node5",
      "startTime": "18:30"
    },
    {
      "op": "replace",
      "id": "day4_node6",
      "startTime": "20:30"
    }
  ],
  "day": 4,
  "reason": "Added Muzeum Sportu i Turystyki w Warszawie to Day 4 after the meal in Warsaw and adjusted subsequent activities by 2 hours to accommodate the visit.",
  "agent": "EditorAgent"
}
```
2025-10-18 18:21:31.737 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - === END EDITOR AGENT RESPONSE ===
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Successfully generated ChangeSet with 4 operations
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent ID: ff3ed168-e2fe-40bb-ba99-66c616ac03a7
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Message: Applying changes
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Step: apply
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:51:31.742446400Z
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:21:31.742 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChangeEngine - Applying changes for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:32.275 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChangeEngine - Generated ID for new node: Muzeum Sportu i Turystyki w Warszawie -> node_att_day4_2274_7de9e730
2025-10-18 18:21:32.618 [http-nio-8080-exec-1] WARN  com.tripplanner.service.ChangeEngine - Could not find node with ID 'day4_node4', using fallback node 'day4_node1' for replace result
2025-10-18 18:21:32.968 [http-nio-8080-exec-1] WARN  com.tripplanner.service.ChangeEngine - Could not find node with ID 'day4_node5', using fallback node 'day4_node1' for replace result
2025-10-18 18:21:33.319 [http-nio-8080-exec-1] WARN  com.tripplanner.service.ChangeEngine - Could not find node with ID 'day4_node6', using fallback node 'day4_node1' for replace result
2025-10-18 18:21:33.319 [http-nio-8080-exec-1] INFO  com.tripplanner.service.RevisionService - Saving revision rev_1760791893319_a985bb97 for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:33.711 [http-nio-8080-exec-1] INFO  com.tripplanner.service.RevisionService - Successfully saved revision rev_1760791893319_a985bb97 for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChangeEngine - Triggering auto-enrichment for 1 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent ID: ff3ed168-e2fe-40bb-ba99-66c616ac03a7
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Message: Changes applied successfully
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Step: complete
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:51:34.277656800Z
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:34.277 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent ID: ff3ed168-e2fe-40bb-ba99-66c616ac03a7
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Status: completed
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Message: Agent completed successfully
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T12:51:34.277656800Z
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:34.278 [AsyncTask-3] INFO  com.tripplanner.service.EnrichmentService - Starting async enrichment for 1 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION COMPLETED ===
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Result Type: ApplyResult
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - Result: com.tripplanner.service.ChangeEngine$ApplyResult@7c2413d1
2025-10-18 18:21:34.278 [http-nio-8080-exec-1] INFO  com.tripplanner.agents.EditorAgent - =================================
2025-10-18 18:21:34.280 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:21:34.285 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [ChatResponse{intent='Changes applied successfully', message='Your itinerary has been updated.', chan (truncated)...]
2025-10-18 18:21:34.287 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:21:34.288 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:34.292 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:21:34.292 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:21:34.292 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:21:34.292 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-18 18:21:34.293 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{intent=Changes applied successfully, message=Your itinerary has been updated., changeSet=null, diff (truncated)...]
2025-10-18 18:21:34.810 [AsyncTask-3] INFO  com.tripplanner.service.EnrichmentService - Enriching 1 out of 1 nodes (others already have coordinates)
2025-10-18 18:21:34.810 [AsyncTask-3] INFO  com.tripplanner.service.GooglePlacesService - Circuit breaker timeout reached, attempting to close circuit breaker
2025-10-18 18:21:34.810 [AsyncTask-3] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Muzeum%2520Sportu%2520i%2520Turystyki%2520w%2520Warszawie&key=
2025-10-18 18:21:34.810 [AsyncTask-3] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-18 18:21:35.057 [AsyncTask-3] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-18 18:21:35.057 [AsyncTask-3] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-18 18:21:35.058 [AsyncTask-3] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-18 18:21:35.058 [AsyncTask-3] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 1
2025-10-18 18:21:35.058 [AsyncTask-3] WARN  com.tripplanner.service.EnrichmentService - No place found for node node_att_day4_2274_7de9e730 (Muzeum Sportu i Turystyki w Warszawie)
2025-10-18 18:21:35.058 [AsyncTask-3] INFO  com.tripplanner.service.EnrichmentService - Successfully enriched 0 out of 1 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b (took 780ms)
2025-10-18 18:21:35.708 [http-nio-8080-exec-5] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:35.708 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:21:35.708 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{applied=true, warnings=[], diff={added=[{nodeId=node_att_day4_2274_7de9e730, day=4, fields=null, ti (truncated)...]
2025-10-18 18:21:35.709 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-18 18:21:35.709 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:39.180 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=03kdym1l
2025-10-18 18:21:39.180 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=03kdym1l
2025-10-18 18:21:39.182 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=03kdym1l
2025-10-18 18:21:39.182 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=03kdym1l
2025-10-18 18:21:39.195 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:21:39.195 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:21:39.197 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:21:39.197 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:21:39.197 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:21:39.197 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:21:39.197 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:21:39.197 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:21:39.197 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:39.198 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:21:39.245 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=03kdym1l] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:21:39.245 [http-nio-8080-exec-7] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session 03kdym1l
2025-10-18 18:21:39.246 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=03kdym1l
2025-10-18 18:21:39.246 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=03kdym1l}], simpSessionId=03kdym1l}]
2025-10-18 18:21:40.081 [http-nio-8080-exec-3] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:40.081 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:21:40.081 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 18:21:40.082 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:21:40.082 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:40.202 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791900200
2025-10-18 18:21:40.203 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791900200
2025-10-18 18:21:40.203 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791900200", parameters={masked}
2025-10-18 18:21:40.203 [http-nio-8080-exec-4] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:21:40.203 [http-nio-8080-exec-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791900200
2025-10-18 18:21:40.204 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:21:40.204 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:40.207 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/244/gr2j4eaf/websocket
2025-10-18 18:21:40.207 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/244/gr2j4eaf/websocket
2025-10-18 18:21:40.207 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/244/gr2j4eaf/websocket", parameters={}
2025-10-18 18:21:40.207 [http-nio-8080-exec-8] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:21:40.208 [http-nio-8080-exec-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/244/gr2j4eaf/websocket
2025-10-18 18:21:40.208 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:40.208 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:21:40.208 [http-nio-8080-exec-8] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=gr2j4eaf]
2025-10-18 18:21:40.210 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=gr2j4eaf
2025-10-18 18:21:40.212 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=gr2j4eaf
2025-10-18 18:21:40.212 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=gr2j4eaf
2025-10-18 18:21:40.212 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=gr2j4eaf
2025-10-18 18:21:40.534 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:40.534 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:21:40.535 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=2, userId='null', (truncated)...]
2025-10-18 18:21:40.536 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:21:40.536 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:47.937 [MessageBroker-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [03kdym1l]
2025-10-18 18:21:50.267 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=gr2j4eaf
2025-10-18 18:21:50.267 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=gr2j4eaf
2025-10-18 18:21:50.267 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=gr2j4eaf
2025-10-18 18:21:50.267 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=gr2j4eaf
2025-10-18 18:21:50.271 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:21:50.271 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:21:50.272 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:21:50.272 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:21:50.272 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:21:50.272 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:21:50.272 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:21:50.272 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:21:50.272 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:50.272 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:21:50.288 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=gr2j4eaf] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:21:50.288 [http-nio-8080-exec-7] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session gr2j4eaf
2025-10-18 18:21:50.288 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=gr2j4eaf
2025-10-18 18:21:50.288 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=gr2j4eaf}], simpSessionId=gr2j4eaf}]
2025-10-18 18:21:51.156 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:51.156 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:21:51.156 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 18:21:51.157 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:21:51.157 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:51.277 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791911275
2025-10-18 18:21:51.277 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791911275
2025-10-18 18:21:51.277 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791911275", parameters={masked}
2025-10-18 18:21:51.277 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:21:51.278 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791911275
2025-10-18 18:21:51.278 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:21:51.278 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:51.280 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/342/l0eukjqb/websocket
2025-10-18 18:21:51.280 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/342/l0eukjqb/websocket
2025-10-18 18:21:51.282 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/342/l0eukjqb/websocket", parameters={}
2025-10-18 18:21:51.282 [http-nio-8080-exec-4] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:21:51.282 [http-nio-8080-exec-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/342/l0eukjqb/websocket
2025-10-18 18:21:51.282 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:51.283 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:21:51.283 [http-nio-8080-exec-4] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=l0eukjqb]
2025-10-18 18:21:51.285 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=l0eukjqb
2025-10-18 18:21:51.286 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=l0eukjqb
2025-10-18 18:21:51.286 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=l0eukjqb
2025-10-18 18:21:51.286 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=l0eukjqb
2025-10-18 18:21:51.846 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:51.846 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:21:51.847 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=2, userId='null', (truncated)...]
2025-10-18 18:21:51.849 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:21:51.849 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:51.862 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:21:51.863 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:21:51.863 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:21:51.863 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:21:52.749 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:21:52.749 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:21:52.750 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 18:21:52.750 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:21:52.750 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:21:57.944 [MessageBroker-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [gr2j4eaf]
2025-10-18 18:22:13.960 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=l0eukjqb
2025-10-18 18:22:13.960 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=l0eukjqb
2025-10-18 18:22:13.960 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=l0eukjqb
2025-10-18 18:22:13.960 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=l0eukjqb
2025-10-18 18:22:13.971 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:22:13.971 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:22:13.972 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:22:13.972 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:22:13.972 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:22:13.972 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:22:13.972 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:22:13.972 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:22:13.972 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:22:13.972 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:22:14.025 [http-nio-8080-exec-6] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=l0eukjqb] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:22:14.025 [http-nio-8080-exec-6] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session l0eukjqb
2025-10-18 18:22:14.025 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=l0eukjqb
2025-10-18 18:22:14.025 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=l0eukjqb}], simpSessionId=l0eukjqb}]
2025-10-18 18:22:14.858 [http-nio-8080-exec-7] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:22:14.858 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:22:14.859 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 18:22:14.859 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:22:14.859 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:22:14.972 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791934971
2025-10-18 18:22:14.973 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791934971
2025-10-18 18:22:14.973 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791934971", parameters={masked}
2025-10-18 18:22:14.973 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:22:14.974 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791934971
2025-10-18 18:22:14.974 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:22:14.974 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:22:14.977 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/649/nzhz1jjm/websocket
2025-10-18 18:22:14.977 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/649/nzhz1jjm/websocket
2025-10-18 18:22:14.977 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/649/nzhz1jjm/websocket", parameters={}
2025-10-18 18:22:14.977 [http-nio-8080-exec-4] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:22:14.978 [http-nio-8080-exec-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/649/nzhz1jjm/websocket
2025-10-18 18:22:14.978 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:22:14.978 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:22:14.980 [http-nio-8080-exec-4] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=nzhz1jjm]
2025-10-18 18:22:14.982 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=nzhz1jjm
2025-10-18 18:22:14.983 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=nzhz1jjm
2025-10-18 18:22:14.984 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=nzhz1jjm
2025-10-18 18:22:14.984 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=nzhz1jjm
2025-10-18 18:22:15.308 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:22:15.308 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:22:15.309 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=2, userId='null', (truncated)...]
2025-10-18 18:22:15.310 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:22:15.310 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:22:22.941 [MessageBroker-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [l0eukjqb]
2025-10-18 18:22:50.589 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=nzhz1jjm
2025-10-18 18:22:50.589 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=nzhz1jjm
2025-10-18 18:22:50.589 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=nzhz1jjm
2025-10-18 18:22:50.589 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=nzhz1jjm
2025-10-18 18:22:50.592 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:22:50.592 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:22:50.593 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 18:22:50.593 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:22:50.593 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 18:22:50.593 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:22:50.593 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:22:50.593 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 18:22:50.593 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:22:50.593 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 18:22:50.607 [http-nio-8080-exec-6] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=nzhz1jjm] closed with CloseStatus[code=1000, reason=null]
2025-10-18 18:22:50.607 [http-nio-8080-exec-6] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session nzhz1jjm
2025-10-18 18:22:50.607 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=nzhz1jjm
2025-10-18 18:22:50.607 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=nzhz1jjm}], simpSessionId=nzhz1jjm}]
2025-10-18 18:22:51.411 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:22:51.412 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:22:51.414 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=2, userId='null', (truncated)...]
2025-10-18 18:22:51.415 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:22:51.416 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:22:51.609 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760791971607
2025-10-18 18:22:51.609 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760791971607
2025-10-18 18:22:51.609 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760791971607", parameters={masked}
2025-10-18 18:22:51.610 [http-nio-8080-exec-7] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:22:51.610 [http-nio-8080-exec-7] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760791971607
2025-10-18 18:22:51.610 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:22:51.611 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:22:51.614 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/750/rdf0lq2h/websocket
2025-10-18 18:22:51.614 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/750/rdf0lq2h/websocket
2025-10-18 18:22:51.614 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/750/rdf0lq2h/websocket", parameters={}
2025-10-18 18:22:51.614 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@6eb00cbe
2025-10-18 18:22:51.615 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/750/rdf0lq2h/websocket
2025-10-18 18:22:51.615 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:22:51.615 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 18:22:51.616 [http-nio-8080-exec-3] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=rdf0lq2h]
2025-10-18 18:22:51.618 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=rdf0lq2h
2025-10-18 18:22:51.620 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=rdf0lq2h
2025-10-18 18:22:51.620 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=rdf0lq2h
2025-10-18 18:22:51.620 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=rdf0lq2h
2025-10-18 18:22:51.768 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:22:51.769 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:22:51.769 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 18:22:51.769 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:22:51.770 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:22:51.771 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:22:51.772 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 18:22:51.772 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 18:22:51.772 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 18:22:52.592 [http-nio-8080-exec-10] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 18:22:52.592 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 18:22:52.592 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 18:22:52.593 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 18:22:52.593 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 18:22:57.939 [MessageBroker-7] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [nzhz1jjm]
2025-10-18 18:43:27.825 [MessageBroker-1] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 14 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(14)-CONNECTED(14)-DISCONNECT(11)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 377], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 377], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 424]
2025-10-18 19:13:27.828 [MessageBroker-3] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 14 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(14)-CONNECTED(14)-DISCONNECT(11)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 377], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 377], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 857]
2025-10-18 19:43:27.837 [MessageBroker-5] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 14 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(14)-CONNECTED(14)-DISCONNECT(11)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 377], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 377], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 1290]
2025-10-18 19:58:33.499 [SpringApplicationShutdownHook] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-10-18 19:58:34.140 [tomcat-shutdown] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Graceful shutdown complete
2025-10-18 19:58:34.144 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-18 19:58:34.144 [SpringApplicationShutdownHook] DEBUG o.s.w.s.s.t.session.WebSocketServerSockJsSession - Closing SockJS session rdf0lq2h with CloseStatus[code=1001, reason=null]
2025-10-18 19:58:34.145 [SpringApplicationShutdownHook] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - Transport error in WebSocketServerSockJsSession[id=rdf0lq2h]
java.io.IOException: java.nio.channels.ClosedChannelException
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:326)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsSession.sendCloseMessage(WsSession.java:778)
	at org.apache.tomcat.websocket.WsSession.doClose(WsSession.java:575)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:324)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:250)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:223)
	at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendText(WsRemoteEndpointBasic.java:48)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketSession.sendTextMessage(StandardWebSocketSession.java:217)
	at org.springframework.web.socket.adapter.AbstractWebSocketSession.sendMessage(AbstractWebSocketSession.java:108)
	at org.springframework.web.socket.sockjs.transport.session.WebSocketServerSockJsSession.writeFrameInternal(WebSocketServerSockJsSession.java:228)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.close(AbstractSockJsSession.java:188)
	at org.springframework.web.socket.handler.WebSocketSessionDecorator.close(WebSocketSessionDecorator.java:164)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.close(ConcurrentWebSocketSessionDecorator.java:279)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:308)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:321)
	at org.springframework.context.support.DefaultLifecycleProcessor.doStop(DefaultLifecycleProcessor.java:463)
	at org.springframework.context.support.DefaultLifecycleProcessor$LifecycleGroup.stop(DefaultLifecycleProcessor.java:618)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.context.support.DefaultLifecycleProcessor.stopBeans(DefaultLifecycleProcessor.java:432)
	at org.springframework.context.support.DefaultLifecycleProcessor.onClose(DefaultLifecycleProcessor.java:323)
	at org.springframework.context.support.AbstractApplicationContext.doClose(AbstractApplicationContext.java:1172)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.doClose(ServletWebServerApplicationContext.java:179)
	at org.springframework.context.support.AbstractApplicationContext.close(AbstractApplicationContext.java:1126)
	at org.springframework.boot.SpringApplicationShutdownHook.closeAndWait(SpringApplicationShutdownHook.java:147)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.boot.SpringApplicationShutdownHook.run(SpringApplicationShutdownHook.java:116)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: java.nio.channels.ClosedChannelException: null
	at org.apache.tomcat.util.net.NioChannel$1.write(NioChannel.java:282)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper$NioOperationState.run(NioEndpoint.java:1665)
	at org.apache.tomcat.util.net.SocketWrapperBase$OperationState.start(SocketWrapperBase.java:987)
	at org.apache.tomcat.util.net.SocketWrapperBase.vectoredOperation(SocketWrapperBase.java:1358)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1287)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1262)
	at org.apache.tomcat.websocket.server.WsRemoteEndpointImplServer.doWrite(WsRemoteEndpointImplServer.java:171)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.writeMessagePart(WsRemoteEndpointImplBase.java:521)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:313)
	... 24 common frames omitted
2025-10-18 19:58:34.145 [SpringApplicationShutdownHook] DEBUG o.s.w.s.s.t.session.WebSocketServerSockJsSession - Failure while sending SockJS close frame
java.io.IOException: java.nio.channels.ClosedChannelException
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:326)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:250)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:223)
	at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendText(WsRemoteEndpointBasic.java:48)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketSession.sendTextMessage(StandardWebSocketSession.java:217)
	at org.springframework.web.socket.adapter.AbstractWebSocketSession.sendMessage(AbstractWebSocketSession.java:108)
	at org.springframework.web.socket.sockjs.transport.session.WebSocketServerSockJsSession.writeFrameInternal(WebSocketServerSockJsSession.java:228)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.close(AbstractSockJsSession.java:188)
	at org.springframework.web.socket.handler.WebSocketSessionDecorator.close(WebSocketSessionDecorator.java:164)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.close(ConcurrentWebSocketSessionDecorator.java:279)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:308)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:321)
	at org.springframework.context.support.DefaultLifecycleProcessor.doStop(DefaultLifecycleProcessor.java:463)
	at org.springframework.context.support.DefaultLifecycleProcessor$LifecycleGroup.stop(DefaultLifecycleProcessor.java:618)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.context.support.DefaultLifecycleProcessor.stopBeans(DefaultLifecycleProcessor.java:432)
	at org.springframework.context.support.DefaultLifecycleProcessor.onClose(DefaultLifecycleProcessor.java:323)
	at org.springframework.context.support.AbstractApplicationContext.doClose(AbstractApplicationContext.java:1172)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.doClose(ServletWebServerApplicationContext.java:179)
	at org.springframework.context.support.AbstractApplicationContext.close(AbstractApplicationContext.java:1126)
	at org.springframework.boot.SpringApplicationShutdownHook.closeAndWait(SpringApplicationShutdownHook.java:147)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.boot.SpringApplicationShutdownHook.run(SpringApplicationShutdownHook.java:116)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: java.nio.channels.ClosedChannelException: null
	at org.apache.tomcat.util.net.NioChannel$1.write(NioChannel.java:282)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper$NioOperationState.run(NioEndpoint.java:1665)
	at org.apache.tomcat.util.net.SocketWrapperBase$OperationState.start(SocketWrapperBase.java:987)
	at org.apache.tomcat.util.net.SocketWrapperBase.vectoredOperation(SocketWrapperBase.java:1358)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1287)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1262)
	at org.apache.tomcat.websocket.server.WsRemoteEndpointImplServer.doWrite(WsRemoteEndpointImplServer.java:171)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.writeMessagePart(WsRemoteEndpointImplBase.java:521)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:313)
	... 24 common frames omitted
2025-10-18 19:58:34.147 [SpringApplicationShutdownHook] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=rdf0lq2h] closed with CloseStatus[code=1001, reason=null]
2025-10-18 19:58:34.147 [SpringApplicationShutdownHook] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session rdf0lq2h
2025-10-18 19:58:34.148 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=rdf0lq2h
2025-10-18 19:58:34.148 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-18 19:58:34.148 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopping...
2025-10-18 19:58:34.148 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1d1fd2aa]]
2025-10-18 19:58:34.148 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1d1fd2aa]
2025-10-18 19:58:34.148 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1d1fd2aa]
2025-10-18 19:58:34.148 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopped.
2025-10-18 19:58:34.148 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 19:58:34.148 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 19:58:34.161 [SpringApplicationShutdownHook] INFO  com.tripplanner.service.GeminiClient - Gemini client cleanup completed
2025-10-18 19:58:34.162 [SpringApplicationShutdownHook] INFO  c.tripplanner.service.openrouter.OpenRouterClient - OpenRouter client cleanup completed
2025-10-18 19:58:54.220 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 26920 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-18 19:58:54.225 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-18 19:58:56.694 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-18 19:58:56.713 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-18 19:58:56.713 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-18 19:58:56.822 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-18 19:58:56.822 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2536 ms
2025-10-18 19:58:56.929 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-18 19:58:57.021 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-18 19:58:57.041 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-18 19:58:57.041 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: gemini
2025-10-18 19:58:57.042 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-18 19:58:57.042 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-18 19:58:57.226 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free | apiKey=MISSING
2025-10-18 19:58:57.230 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-18 19:58:57.233 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-18 19:58:57.234 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-18 19:58:57.235 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-18 19:58:57.235 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with Gemini as primary, OpenRouter as fallback
2025-10-18 19:58:57.235 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-18 19:58:57.239 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-18 19:58:57.239 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: GeminiClient (available: true)
2025-10-18 19:58:57.239 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: OpenRouterClient (available: false)
2025-10-18 19:58:57.240 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-18 19:58:57.340 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-18 19:58:57.343 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-18 19:58:58.319 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-18 19:58:58.470 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-18 19:58:58.472 [main] INFO  com.tripplanner.service.AgentRegistry - Found 11 agents to register
2025-10-18 19:58:58.473 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-18 19:58:58.474 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-18 19:58:58.474 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-18 19:58:58.474 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-18 19:58:58.474 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-18 19:58:58.474 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-18 19:58:58.475 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-18 19:58:58.475 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-18 19:58:58.475 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-18 19:58:58.475 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-18 19:58:58.475 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-18 19:58:58.475 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 11
2025-10-18 19:58:58.475 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-18 19:58:58.485 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-18 19:58:58.486 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-18 19:58:58.487 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-18 19:58:58.487 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-18 19:58:58.487 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-18 19:58:58.517 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-18 19:58:58.520 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-18 19:58:58.521 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-18 19:58:58.521 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-18 19:58:58.521 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-18 19:58:58.521 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-18 19:58:58.536 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-18 19:58:58.536 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-18 19:58:58.579 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-18 19:58:58.579 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-18 19:58:58.580 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-18 19:58:58.580 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-18 19:58:58.580 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-18 19:58:58.580 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-18 19:58:58.580 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-18 19:58:58.673 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-18 19:58:58.677 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-18 19:58:58.705 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-18 19:58:58.812 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 42 mappings in 'requestMappingHandlerMapping'
2025-10-18 19:58:58.854 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-18 19:58:58.884 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-18 19:58:58.972 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-18 19:58:59.037 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.AgentController:
	
2025-10-18 19:58:59.038 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-18 19:58:59.038 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-18 19:58:59.038 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-18 19:58:59.038 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-18 19:58:59.038 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-18 19:58:59.039 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-18 19:58:59.043 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
2025-10-18 19:58:59.044 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-18 19:58:59.111 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-18 19:58:59.164 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-18 19:58:59.335 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-18 19:58:59.336 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-18 19:58:59.336 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-18 19:58:59.336 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@70f5f57d]
2025-10-18 19:58:59.336 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@70f5f57d]
2025-10-18 19:58:59.337 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@70f5f57d]]
2025-10-18 19:58:59.338 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-18 19:58:59.340 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 19:58:59.340 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 19:58:59.351 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-18 19:58:59.360 [main] INFO  com.tripplanner.App - Started App in 5.967 seconds (process running for 7.041)
2025-10-18 19:59:08.145 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-18 19:59:08.145 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-18 19:59:08.145 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-18 19:59:08.145 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-18 19:59:08.145 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-18 19:59:08.147 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@2b1a1a37
2025-10-18 19:59:08.148 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@79424f25
2025-10-18 19:59:08.148 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-18 19:59:08.148 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2025-10-18 19:59:08.177 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 19:59:08.223 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 19:59:08.229 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 19:59:08.232 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 19:59:08.234 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 19:59:08.272 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:11.591 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:11.613 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 19:59:11.661 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=2, userId='null', (truncated)...]
2025-10-18 19:59:11.705 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 19:59:11.706 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:11.816 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 19:59:11.818 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:12.139 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 19:59:12.139 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:12.140 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:12.140 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 19:59:12.140 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 19:59:12.140 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 19:59:12.140 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 19:59:12.140 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 19:59:12.141 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:12.141 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 19:59:12.922 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760797752917
2025-10-18 19:59:12.923 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760797752917
2025-10-18 19:59:12.924 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760797752917", parameters={masked}
2025-10-18 19:59:12.924 [http-nio-8080-exec-7] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@77d54a41
2025-10-18 19:59:12.927 [http-nio-8080-exec-7] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760797752917
2025-10-18 19:59:12.928 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 19:59:12.928 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:12.933 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/210/c0nibwho/websocket
2025-10-18 19:59:12.933 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/210/c0nibwho/websocket
2025-10-18 19:59:12.933 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/210/c0nibwho/websocket", parameters={}
2025-10-18 19:59:12.933 [http-nio-8080-exec-5] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@77d54a41
2025-10-18 19:59:12.936 [http-nio-8080-exec-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/210/c0nibwho/websocket
2025-10-18 19:59:12.943 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:12.967 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 19:59:12.984 [http-nio-8080-exec-5] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=c0nibwho]
2025-10-18 19:59:13.009 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=c0nibwho
2025-10-18 19:59:13.017 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=c0nibwho
2025-10-18 19:59:13.017 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=c0nibwho
2025-10-18 19:59:13.019 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=c0nibwho
2025-10-18 19:59:13.853 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:13.854 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 19:59:13.855 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 19:59:13.857 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 19:59:13.858 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:14.864 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:14.865 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 19:59:14.867 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=2, userId='null', (truncated)...]
2025-10-18 19:59:14.871 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 19:59:14.871 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:18.381 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=c0nibwho
2025-10-18 19:59:18.381 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=c0nibwho
2025-10-18 19:59:18.382 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=c0nibwho
2025-10-18 19:59:18.382 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=c0nibwho
2025-10-18 19:59:18.388 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 19:59:18.388 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:18.389 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:18.389 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 19:59:18.390 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 19:59:18.390 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 19:59:18.391 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 19:59:18.392 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 19:59:18.392 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:18.393 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 19:59:18.406 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=c0nibwho] closed with CloseStatus[code=1000, reason=null]
2025-10-18 19:59:18.406 [http-nio-8080-exec-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session c0nibwho
2025-10-18 19:59:18.407 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=c0nibwho
2025-10-18 19:59:18.407 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=c0nibwho}], simpSessionId=c0nibwho}]
2025-10-18 19:59:19.390 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760797759388
2025-10-18 19:59:19.391 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760797759388
2025-10-18 19:59:19.391 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760797759388", parameters={masked}
2025-10-18 19:59:19.391 [http-nio-8080-exec-6] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@77d54a41
2025-10-18 19:59:19.392 [http-nio-8080-exec-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760797759388
2025-10-18 19:59:19.392 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 19:59:19.392 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:19.395 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/563/40ujlr3p/websocket
2025-10-18 19:59:19.396 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/563/40ujlr3p/websocket
2025-10-18 19:59:19.396 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/563/40ujlr3p/websocket", parameters={}
2025-10-18 19:59:19.396 [http-nio-8080-exec-7] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@77d54a41
2025-10-18 19:59:19.396 [http-nio-8080-exec-7] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/563/40ujlr3p/websocket
2025-10-18 19:59:19.397 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:19.397 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 19:59:19.398 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=40ujlr3p]
2025-10-18 19:59:19.399 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=40ujlr3p
2025-10-18 19:59:19.401 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=40ujlr3p
2025-10-18 19:59:19.401 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=40ujlr3p
2025-10-18 19:59:19.401 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=40ujlr3p
2025-10-18 19:59:20.076 [http-nio-8080-exec-3] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:20.077 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 19:59:20.077 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 19:59:20.078 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 19:59:20.078 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:20.990 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:20.991 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 19:59:20.993 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=2, userId='null', (truncated)...]
2025-10-18 19:59:20.996 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 19:59:20.996 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:21.006 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:21.011 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:21.011 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:21.011 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 19:59:21.011 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 19:59:22.770 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:22.770 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 19:59:22.771 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 19:59:22.772 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 19:59:22.772 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:27.938 [MessageBroker-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [c0nibwho]
2025-10-18 19:59:33.952 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:33.953 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:33.953 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 19:59:33.953 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-18 19:59:33.958 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4, sender=user, t (truncated)...]
2025-10-18 19:59:35.708 [http-nio-8080-exec-10] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:35.708 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 19:59:35.708 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{id=4tCuJBPvSVeTw1j6cige, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this place (truncated)...]
2025-10-18 19:59:35.709 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-18 19:59:35.709 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:35.711 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat
2025-10-18 19:59:35.714 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat
2025-10-18 19:59:35.714 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat
2025-10-18 19:59:35.714 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat", parameters={}
2025-10-18 19:59:35.714 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#sendChatMessage(String, ChatRequest, HttpServletRequest)
2025-10-18 19:59:35.719 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedN (truncated)...]
2025-10-18 19:59:35.720 [http-nio-8080-exec-6] INFO  com.tripplanner.service.OrchestratorService - Routing chat request: ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedNodeId='null', text='Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}
2025-10-18 19:59:37.372 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 3 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:37.373 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting content generation with provider 1 (GeminiClient)
2025-10-18 19:59:37.373 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 19:59:37.373 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 19:59:37.373 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 19:59:37.373 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 19:59:37.373 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 19:59:37.373 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2502
2025-10-18 19:59:37.373 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 19:59:37.374 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an AI assistant that classifies user intents for travel itinerary management.

Context:
Itinerary: 4-day trip to Poland with 26 activities (estimated 48900 per person)
Days: 4
Currency: INR
D...
2025-10-18 19:59:37.375 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2783
2025-10-18 19:59:37.379 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 19:59:40.493 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 19:59:40.493 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 19:59:40.493 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Response Length: 764
2025-10-18 19:59:40.493 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"intent\": \"add_activity\",\n  \"taskType\": \"edit\",\n  \"entities\": {\n    \"activity_name\": \"Muzeum Sportu i Turystyki w Warszawie\",\n    \"day\": \"Day 4\"\n  },\n  \"confidence\": 0.98\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 712,
    "candidatesTokenCount": 75,
    "totalTokenCount": 919,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 712
      }
    ],
    "thoughtsTokenCount": 132
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "VKTzaJ_wGeyc1e8PmLCuyAQ"
}

2025-10-18 19:59:40.505 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-841331102_20251018_195940.json
2025-10-18 19:59:40.505 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 19:59:40.505 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Generated content length: 188
2025-10-18 19:59:40.505 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "intent": "add_activity",
  "taskType": "edit",
  "entities": {
    "activity_name": "Muzeum Sportu i Turystyki w Warszawie",
    "day": "Day 4"
  },
  "confidence": 0.98
}
```
2025-10-18 19:59:40.505 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 19:59:40.505 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentRegistry - Created execution plan for 'edit': 1 agents, primary: EditorAgent
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.service.OrchestratorService - Executing agent plan: Task: edit, Agents: 1, Fallback: true, MaxRetries: 2, Timeout: 60000ms
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION START ===
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Agent ID: f14373ae-00d1-4a21-bc22-68415d49b27c
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Request Type: Map
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Request Data: {chatRequest=ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedNodeId='null', text='Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b, scope=trip, text=Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Request Details: {chatRequest=ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedNodeId='null', text='Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b, scope=trip, text=Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-18 19:59:41.128 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - =============================
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f14373ae-00d1-4a21-bc22-68415d49b27c
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Status: queued
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Progress: 0
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Message: Agent queued for execution
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T14:29:41.130494700Z
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f14373ae-00d1-4a21-bc22-68415d49b27c
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Message: Agent started
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T14:29:41.130494700Z
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Executing agent-specific logic for: EDITOR
2025-10-18 19:59:41.130 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - EditorAgent executing for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f14373ae-00d1-4a21-bc22-68415d49b27c
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Message: Loading itinerary
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Step: load
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T14:29:41.131508300Z
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:41.131 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 19:59:42.410 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ItineraryMigrationService - Migrating node IDs for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:43.073 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ItineraryMigrationService - Successfully migrated itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b with 4 days and 27 total nodes
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f14373ae-00d1-4a21-bc22-68415d49b27c
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Progress: 40
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Message: Generating summary
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Step: summarize
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T14:29:43.074303200Z
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:43.074 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f14373ae-00d1-4a21-bc22-68415d49b27c
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Progress: 60
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Message: Generating changes
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Step: llm
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T14:29:43.075304400Z
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:43.075 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 8278
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an expert travel itinerary editor.

You must respond with valid JSON that matches this exact schema:
{
  "type": "object",
  "properties": {
    "ops": {
      "type": "array",
      "descript...
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 8877
2025-10-18 19:59:44.366 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 19:59:52.219 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 19:59:52.219 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 19:59:52.219 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Response Length: 1156
2025-10-18 19:59:52.219 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"ops\": [\n    {\n      \"op\": \"replace\",\n      \"id\": \"day4_node4\",\n      \"startTime\": \"15:00\",\n      \"endTime\": \"17:00\",\n      \"node\": {\n        \"title\": \"Muzeum Sportu i Turystyki w Warszawie\",\n        \"type\": \"attraction\",\n        \"location\": {\n          \"name\": \"Muzeum Sportu i Turystyki w Warszawie\",\n          \"address\": \"Wybrzee Gdyskie 4, 01-538 Warszawa, Poland\"\n        }\n      }\n    }\n  ],\n  \"day\": 4,\n  \"reason\": \"Scheduled visit to Muzeum Sportu i Turystyki w Warszawie on Day 4.\",\n  \"agent\": \"EditorAgent\"\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 2992,
    "candidatesTokenCount": 195,
    "totalTokenCount": 4084,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 2992
      }
    ],
    "thoughtsTokenCount": 897
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "YKTzaKydCK6n1e8P5vKD2Ac"
}

2025-10-18 19:59:52.222 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_2088443140_20251018_195952.json
2025-10-18 19:59:52.222 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 19:59:52.222 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Generated content length: 536
2025-10-18 19:59:52.222 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "ops": [
    {
      "op": "replace",
      "id": "day4_node4",
      "startTime": "15:00",
      "endTime": "17:00",
      "node": {
        "title": "Muzeum Sportu i Turystyki w Warszawie",
        "type": "attraction",
        "location": {
          "name": "Muzeum Sportu i Turystyki...
2025-10-18 19:59:52.222 [http-nio-8080-exec-6] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 19:59:52.222 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - === EDITOR AGENT - FULL LLM RESPONSE ===
2025-10-18 19:59:52.223 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - User Request: Muzeum Sportu i Turystyki w Warszawie - i want to visit this place on day 4
2025-10-18 19:59:52.223 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Raw Response: ```json
{
  "ops": [
    {
      "op": "replace",
      "id": "day4_node4",
      "startTime": "15:00",
      "endTime": "17:00",
      "node": {
        "title": "Muzeum Sportu i Turystyki w Warszawie",
        "type": "attraction",
        "location": {
          "name": "Muzeum Sportu i Turystyki w Warszawie",
          "address": "Wybrzee Gdyskie 4, 01-538 Warszawa, Poland"
        }
      }
    }
  ],
  "day": 4,
  "reason": "Scheduled visit to Muzeum Sportu i Turystyki w Warszawie on Day 4.",
  "agent": "EditorAgent"
}
```
2025-10-18 19:59:52.223 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - === END EDITOR AGENT RESPONSE ===
2025-10-18 19:59:52.231 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Successfully generated ChangeSet with 1 operations
2025-10-18 19:59:52.231 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 19:59:52.231 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f14373ae-00d1-4a21-bc22-68415d49b27c
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Message: Applying changes
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Step: apply
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T14:29:52.231670Z
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 19:59:52.232 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ChangeEngine - Applying changes for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:53.915 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ChangeEngine - Generated ID for replacement node: Muzeum Sportu i Turystyki w Warszawie -> day4_node8
2025-10-18 19:59:53.915 [http-nio-8080-exec-6] WARN  com.tripplanner.service.ChangeEngine - Could not find node with ID 'day4_node4', using fallback node 'day4_node1' for replace result
2025-10-18 19:59:53.916 [http-nio-8080-exec-6] INFO  com.tripplanner.service.RevisionService - Saving revision rev_1760797793915_82c70ad1 for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:54.640 [http-nio-8080-exec-6] INFO  com.tripplanner.service.RevisionService - Successfully saved revision rev_1760797793915_82c70ad1 for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:55.872 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ChangeEngine - Triggering auto-enrichment for 1 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f14373ae-00d1-4a21-bc22-68415d49b27c
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Message: Changes applied successfully
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Step: complete
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T14:29:55.876293Z
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:55.876 [AsyncTask-1] INFO  com.tripplanner.service.EnrichmentService - Starting async enrichment for 1 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f14373ae-00d1-4a21-bc22-68415d49b27c
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Status: completed
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Message: Agent completed successfully
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T14:29:55.876293Z
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION COMPLETED ===
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Result Type: ApplyResult
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - Result: com.tripplanner.service.ChangeEngine$ApplyResult@183bee5e
2025-10-18 19:59:55.876 [http-nio-8080-exec-6] INFO  com.tripplanner.agents.EditorAgent - =================================
2025-10-18 19:59:55.880 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 19:59:55.884 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [ChatResponse{intent='Changes applied successfully', message='Your itinerary has been updated.', chan (truncated)...]
2025-10-18 19:59:55.888 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 19:59:55.888 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:55.893 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:55.893 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 19:59:55.893 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 19:59:55.894 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-18 19:59:55.894 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{intent=Changes applied successfully, message=Your itinerary has been updated., changeSet=null, diff (truncated)...]
2025-10-18 19:59:56.671 [AsyncTask-1] INFO  com.tripplanner.service.EnrichmentService - Enriching 1 out of 1 nodes (others already have coordinates)
2025-10-18 19:59:56.677 [AsyncTask-1] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Muzeum%2520Sportu%2520i%2520Turystyki%2520w%2520Warszawie&key=
2025-10-18 19:59:56.687 [AsyncTask-1] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-18 19:59:57.221 [AsyncTask-1] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-18 19:59:57.223 [AsyncTask-1] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-18 19:59:57.226 [AsyncTask-1] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-18 19:59:57.226 [AsyncTask-1] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 1
2025-10-18 19:59:57.226 [AsyncTask-1] WARN  com.tripplanner.service.EnrichmentService - No place found for node day4_node8 (Muzeum Sportu i Turystyki w Warszawie)
2025-10-18 19:59:57.226 [AsyncTask-1] INFO  com.tripplanner.service.EnrichmentService - Successfully enriched 0 out of 1 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b (took 1350ms)
2025-10-18 19:59:58.243 [http-nio-8080-exec-7] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 19:59:58.244 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 19:59:58.244 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{applied=true, warnings=[], diff={added=[{nodeId=day4_node8, day=4, fields=null, title=Muzeum Sportu (truncated)...]
2025-10-18 19:59:58.245 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-18 19:59:58.246 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 19:59:59.332 [MessageBroker-6] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 43], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 43], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 11]
2025-10-18 20:00:32.718 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=40ujlr3p
2025-10-18 20:00:32.718 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=40ujlr3p
2025-10-18 20:00:32.719 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=40ujlr3p
2025-10-18 20:00:32.719 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=40ujlr3p
2025-10-18 20:00:32.730 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:00:32.730 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:00:32.731 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:00:32.731 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:00:32.731 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 20:00:32.731 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:00:32.731 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 20:00:32.731 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 20:00:32.731 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:00:32.731 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:00:32.783 [http-nio-8080-exec-9] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=40ujlr3p] closed with CloseStatus[code=1000, reason=null]
2025-10-18 20:00:32.783 [http-nio-8080-exec-9] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session 40ujlr3p
2025-10-18 20:00:32.784 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=40ujlr3p
2025-10-18 20:00:32.784 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=40ujlr3p}], simpSessionId=40ujlr3p}]
2025-10-18 20:00:33.731 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760797833729
2025-10-18 20:00:33.731 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760797833729
2025-10-18 20:00:33.731 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760797833729", parameters={masked}
2025-10-18 20:00:33.731 [http-nio-8080-exec-8] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@77d54a41
2025-10-18 20:00:33.731 [http-nio-8080-exec-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760797833729
2025-10-18 20:00:33.732 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:00:33.732 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:00:33.736 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/047/m32mqy1y/websocket
2025-10-18 20:00:33.736 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/047/m32mqy1y/websocket
2025-10-18 20:00:33.736 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/047/m32mqy1y/websocket", parameters={}
2025-10-18 20:00:33.736 [http-nio-8080-exec-10] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@77d54a41
2025-10-18 20:00:33.736 [http-nio-8080-exec-10] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/047/m32mqy1y/websocket
2025-10-18 20:00:33.737 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:00:33.737 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 20:00:33.738 [http-nio-8080-exec-10] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=m32mqy1y]
2025-10-18 20:00:33.740 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=m32mqy1y
2025-10-18 20:00:33.742 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=m32mqy1y
2025-10-18 20:00:33.742 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=m32mqy1y
2025-10-18 20:00:33.743 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=m32mqy1y
2025-10-18 20:00:34.676 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:00:34.677 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:00:34.680 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=4, userId='null', (truncated)...]
2025-10-18 20:00:34.682 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:00:34.682 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:00:35.043 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 4 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:00:35.044 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:00:35.044 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 20:00:35.044 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:00:35.045 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:00:37.951 [MessageBroker-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [40ujlr3p]
2025-10-18 20:01:20.789 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=m32mqy1y
2025-10-18 20:01:20.789 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=m32mqy1y
2025-10-18 20:01:20.789 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=m32mqy1y
2025-10-18 20:01:20.789 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=m32mqy1y
2025-10-18 20:01:20.795 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:01:20.795 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:01:20.796 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:01:20.796 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:01:20.796 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:01:20.796 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 20:01:20.796 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 20:01:20.796 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:01:20.796 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:01:20.796 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 20:01:20.810 [http-nio-8080-exec-9] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=m32mqy1y] closed with CloseStatus[code=1000, reason=null]
2025-10-18 20:01:20.810 [http-nio-8080-exec-9] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session m32mqy1y
2025-10-18 20:01:20.810 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=m32mqy1y
2025-10-18 20:01:20.810 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=m32mqy1y}], simpSessionId=m32mqy1y}]
2025-10-18 20:01:21.807 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760797881805
2025-10-18 20:01:21.807 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760797881805
2025-10-18 20:01:21.807 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760797881805", parameters={masked}
2025-10-18 20:01:21.807 [http-nio-8080-exec-8] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@77d54a41
2025-10-18 20:01:21.808 [http-nio-8080-exec-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760797881805
2025-10-18 20:01:21.808 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:01:21.808 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:01:21.812 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/389/xi1zlkof/websocket
2025-10-18 20:01:21.812 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/389/xi1zlkof/websocket
2025-10-18 20:01:21.812 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/389/xi1zlkof/websocket", parameters={}
2025-10-18 20:01:21.812 [http-nio-8080-exec-10] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@77d54a41
2025-10-18 20:01:21.813 [http-nio-8080-exec-10] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/389/xi1zlkof/websocket
2025-10-18 20:01:21.813 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:01:21.814 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 20:01:21.814 [http-nio-8080-exec-10] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=xi1zlkof]
2025-10-18 20:01:21.816 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=xi1zlkof
2025-10-18 20:01:21.818 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=xi1zlkof
2025-10-18 20:01:21.818 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=xi1zlkof
2025-10-18 20:01:21.819 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=xi1zlkof
2025-10-18 20:01:22.742 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:01:22.742 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:01:22.742 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=4, userId='null', (truncated)...]
2025-10-18 20:01:22.744 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:01:22.744 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:01:23.102 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 4 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:01:23.102 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:01:23.103 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 20:01:23.104 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:01:23.104 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:01:23.108 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:01:23.108 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:01:23.108 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:01:23.109 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 20:01:25.021 [http-nio-8080-exec-3] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 4 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:01:25.021 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:01:25.021 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 20:01:25.022 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:01:25.022 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:01:27.950 [MessageBroker-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [m32mqy1y]
2025-10-18 20:29:59.337 [MessageBroker-6] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 4 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(4)-CONNECTED(4)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 103], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 103], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 442]
2025-10-18 20:33:39.640 [SpringApplicationShutdownHook] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-10-18 20:33:40.335 [tomcat-shutdown] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Graceful shutdown complete
2025-10-18 20:33:40.338 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-18 20:33:40.339 [SpringApplicationShutdownHook] DEBUG o.s.w.s.s.t.session.WebSocketServerSockJsSession - Closing SockJS session xi1zlkof with CloseStatus[code=1001, reason=null]
2025-10-18 20:33:40.341 [SpringApplicationShutdownHook] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - Transport error in WebSocketServerSockJsSession[id=xi1zlkof]
java.io.IOException: java.nio.channels.ClosedChannelException
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:326)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsSession.sendCloseMessage(WsSession.java:778)
	at org.apache.tomcat.websocket.WsSession.doClose(WsSession.java:575)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:324)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:250)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:223)
	at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendText(WsRemoteEndpointBasic.java:48)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketSession.sendTextMessage(StandardWebSocketSession.java:217)
	at org.springframework.web.socket.adapter.AbstractWebSocketSession.sendMessage(AbstractWebSocketSession.java:108)
	at org.springframework.web.socket.sockjs.transport.session.WebSocketServerSockJsSession.writeFrameInternal(WebSocketServerSockJsSession.java:228)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.close(AbstractSockJsSession.java:188)
	at org.springframework.web.socket.handler.WebSocketSessionDecorator.close(WebSocketSessionDecorator.java:164)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.close(ConcurrentWebSocketSessionDecorator.java:279)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:308)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:321)
	at org.springframework.context.support.DefaultLifecycleProcessor.doStop(DefaultLifecycleProcessor.java:463)
	at org.springframework.context.support.DefaultLifecycleProcessor$LifecycleGroup.stop(DefaultLifecycleProcessor.java:618)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.context.support.DefaultLifecycleProcessor.stopBeans(DefaultLifecycleProcessor.java:432)
	at org.springframework.context.support.DefaultLifecycleProcessor.onClose(DefaultLifecycleProcessor.java:323)
	at org.springframework.context.support.AbstractApplicationContext.doClose(AbstractApplicationContext.java:1172)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.doClose(ServletWebServerApplicationContext.java:179)
	at org.springframework.context.support.AbstractApplicationContext.close(AbstractApplicationContext.java:1126)
	at org.springframework.boot.SpringApplicationShutdownHook.closeAndWait(SpringApplicationShutdownHook.java:147)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.boot.SpringApplicationShutdownHook.run(SpringApplicationShutdownHook.java:116)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: java.nio.channels.ClosedChannelException: null
	at org.apache.tomcat.util.net.NioChannel$1.write(NioChannel.java:282)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper$NioOperationState.run(NioEndpoint.java:1665)
	at org.apache.tomcat.util.net.SocketWrapperBase$OperationState.start(SocketWrapperBase.java:987)
	at org.apache.tomcat.util.net.SocketWrapperBase.vectoredOperation(SocketWrapperBase.java:1358)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1287)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1262)
	at org.apache.tomcat.websocket.server.WsRemoteEndpointImplServer.doWrite(WsRemoteEndpointImplServer.java:171)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.writeMessagePart(WsRemoteEndpointImplBase.java:521)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:313)
	... 24 common frames omitted
2025-10-18 20:33:40.348 [SpringApplicationShutdownHook] DEBUG o.s.w.s.s.t.session.WebSocketServerSockJsSession - Failure while sending SockJS close frame
java.io.IOException: java.nio.channels.ClosedChannelException
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:326)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:266)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlock(WsRemoteEndpointImplBase.java:250)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:223)
	at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendText(WsRemoteEndpointBasic.java:48)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketSession.sendTextMessage(StandardWebSocketSession.java:217)
	at org.springframework.web.socket.adapter.AbstractWebSocketSession.sendMessage(AbstractWebSocketSession.java:108)
	at org.springframework.web.socket.sockjs.transport.session.WebSocketServerSockJsSession.writeFrameInternal(WebSocketServerSockJsSession.java:228)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.close(AbstractSockJsSession.java:188)
	at org.springframework.web.socket.handler.WebSocketSessionDecorator.close(WebSocketSessionDecorator.java:164)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.close(ConcurrentWebSocketSessionDecorator.java:279)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:308)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:321)
	at org.springframework.context.support.DefaultLifecycleProcessor.doStop(DefaultLifecycleProcessor.java:463)
	at org.springframework.context.support.DefaultLifecycleProcessor$LifecycleGroup.stop(DefaultLifecycleProcessor.java:618)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.context.support.DefaultLifecycleProcessor.stopBeans(DefaultLifecycleProcessor.java:432)
	at org.springframework.context.support.DefaultLifecycleProcessor.onClose(DefaultLifecycleProcessor.java:323)
	at org.springframework.context.support.AbstractApplicationContext.doClose(AbstractApplicationContext.java:1172)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.doClose(ServletWebServerApplicationContext.java:179)
	at org.springframework.context.support.AbstractApplicationContext.close(AbstractApplicationContext.java:1126)
	at org.springframework.boot.SpringApplicationShutdownHook.closeAndWait(SpringApplicationShutdownHook.java:147)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.boot.SpringApplicationShutdownHook.run(SpringApplicationShutdownHook.java:116)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: java.nio.channels.ClosedChannelException: null
	at org.apache.tomcat.util.net.NioChannel$1.write(NioChannel.java:282)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper$NioOperationState.run(NioEndpoint.java:1665)
	at org.apache.tomcat.util.net.SocketWrapperBase$OperationState.start(SocketWrapperBase.java:987)
	at org.apache.tomcat.util.net.SocketWrapperBase.vectoredOperation(SocketWrapperBase.java:1358)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1287)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:1262)
	at org.apache.tomcat.websocket.server.WsRemoteEndpointImplServer.doWrite(WsRemoteEndpointImplServer.java:171)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.writeMessagePart(WsRemoteEndpointImplBase.java:521)
	at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendMessageBlockInternal(WsRemoteEndpointImplBase.java:313)
	... 24 common frames omitted
2025-10-18 20:33:40.353 [SpringApplicationShutdownHook] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=xi1zlkof] closed with CloseStatus[code=1001, reason=null]
2025-10-18 20:33:40.353 [SpringApplicationShutdownHook] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session xi1zlkof
2025-10-18 20:33:40.353 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-18 20:33:40.353 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopping...
2025-10-18 20:33:40.354 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@70f5f57d]]
2025-10-18 20:33:40.354 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@70f5f57d]
2025-10-18 20:33:40.354 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@70f5f57d]
2025-10-18 20:33:40.354 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopped.
2025-10-18 20:33:40.354 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 20:33:40.354 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 20:33:40.375 [SpringApplicationShutdownHook] INFO  com.tripplanner.service.GeminiClient - Gemini client cleanup completed
2025-10-18 20:33:40.375 [SpringApplicationShutdownHook] INFO  c.tripplanner.service.openrouter.OpenRouterClient - OpenRouter client cleanup completed
2025-10-18 20:33:58.298 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 21752 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-18 20:33:58.301 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-18 20:34:00.477 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-18 20:34:00.500 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-18 20:34:00.500 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-18 20:34:00.620 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-18 20:34:00.621 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2255 ms
2025-10-18 20:34:00.741 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-18 20:34:00.843 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-18 20:34:00.867 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-18 20:34:00.867 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: gemini
2025-10-18 20:34:00.869 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-18 20:34:00.869 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-18 20:34:01.077 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free | apiKey=MISSING
2025-10-18 20:34:01.081 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-18 20:34:01.086 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-18 20:34:01.087 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-18 20:34:01.087 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-18 20:34:01.087 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with Gemini as primary, OpenRouter as fallback
2025-10-18 20:34:01.087 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-18 20:34:01.090 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-18 20:34:01.090 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: GeminiClient (available: true)
2025-10-18 20:34:01.090 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: OpenRouterClient (available: false)
2025-10-18 20:34:01.090 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-18 20:34:01.197 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-18 20:34:01.199 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-18 20:34:02.371 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-18 20:34:02.553 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-18 20:34:02.553 [main] INFO  com.tripplanner.service.AgentRegistry - Found 11 agents to register
2025-10-18 20:34:02.554 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-18 20:34:02.554 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-18 20:34:02.554 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-18 20:34:02.555 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-18 20:34:02.555 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-18 20:34:02.555 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-18 20:34:02.555 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-18 20:34:02.556 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-18 20:34:02.556 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-18 20:34:02.556 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-18 20:34:02.556 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-18 20:34:02.556 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 11
2025-10-18 20:34:02.557 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-18 20:34:02.570 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-18 20:34:02.572 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-18 20:34:02.573 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-18 20:34:02.574 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-18 20:34:02.574 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-18 20:34:02.613 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-18 20:34:02.618 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-18 20:34:02.618 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-18 20:34:02.618 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-18 20:34:02.618 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-18 20:34:02.618 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-18 20:34:02.641 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-18 20:34:02.642 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-18 20:34:02.691 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-18 20:34:02.692 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-18 20:34:02.692 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-18 20:34:02.692 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-18 20:34:02.692 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-18 20:34:02.692 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-18 20:34:02.692 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-18 20:34:02.805 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-18 20:34:02.812 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-18 20:34:02.861 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-18 20:34:03.005 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 42 mappings in 'requestMappingHandlerMapping'
2025-10-18 20:34:03.065 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-18 20:34:03.103 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-18 20:34:03.214 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-18 20:34:03.303 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.AgentController:
	
2025-10-18 20:34:03.303 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-18 20:34:03.303 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-18 20:34:03.304 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-18 20:34:03.304 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-18 20:34:03.304 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-18 20:34:03.304 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-18 20:34:03.309 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
2025-10-18 20:34:03.310 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-18 20:34:03.393 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-18 20:34:03.467 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-18 20:34:03.717 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-18 20:34:03.717 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-18 20:34:03.717 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-18 20:34:03.717 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3980b44f]
2025-10-18 20:34:03.718 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3980b44f]
2025-10-18 20:34:03.718 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3980b44f]]
2025-10-18 20:34:03.719 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-18 20:34:03.719 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 20:34:03.719 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 20:34:03.738 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-18 20:34:03.749 [main] INFO  com.tripplanner.App - Started App in 6.241 seconds (process running for 7.299)
2025-10-18 20:35:03.723 [MessageBroker-1] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2025-10-18 20:36:19.420 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-18 20:36:19.421 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-18 20:36:19.421 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-18 20:36:19.421 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-18 20:36:19.421 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-18 20:36:19.423 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@7096d451
2025-10-18 20:36:19.423 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@46a97805
2025-10-18 20:36:19.423 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-18 20:36:19.423 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-10-18 20:36:19.440 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:36:19.465 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:36:19.468 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:36:19.471 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 20:36:19.472 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 20:36:19.493 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:36:22.443 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:36:22.472 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:36:22.515 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=4, userId='null', (truncated)...]
2025-10-18 20:36:22.561 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:36:22.562 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:22.626 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:36:22.935 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:36:22.935 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:36:22.936 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:36:22.936 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:36:22.936 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 20:36:22.936 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:36:22.937 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 20:36:22.937 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 20:36:22.937 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:36:22.937 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:36:23.643 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760799983638
2025-10-18 20:36:23.646 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760799983638
2025-10-18 20:36:23.646 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760799983638", parameters={masked}
2025-10-18 20:36:23.647 [http-nio-8080-exec-5] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@1dbc607d
2025-10-18 20:36:23.650 [http-nio-8080-exec-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760799983638
2025-10-18 20:36:23.652 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:36:23.652 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:23.657 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/702/iy2eud4l/websocket
2025-10-18 20:36:23.658 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/702/iy2eud4l/websocket
2025-10-18 20:36:23.658 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/702/iy2eud4l/websocket", parameters={}
2025-10-18 20:36:23.659 [http-nio-8080-exec-7] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@1dbc607d
2025-10-18 20:36:23.660 [http-nio-8080-exec-7] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/702/iy2eud4l/websocket
2025-10-18 20:36:23.668 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:23.698 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 20:36:23.721 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=iy2eud4l]
2025-10-18 20:36:23.746 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=iy2eud4l
2025-10-18 20:36:23.753 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=iy2eud4l
2025-10-18 20:36:23.753 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=iy2eud4l
2025-10-18 20:36:23.755 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=iy2eud4l
2025-10-18 20:36:24.766 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 4 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:36:24.768 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:36:24.768 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 20:36:24.771 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:36:24.772 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:25.710 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:36:25.711 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:36:25.713 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=4, userId='null', (truncated)...]
2025-10-18 20:36:25.716 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:36:25.716 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:32.104 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=iy2eud4l
2025-10-18 20:36:32.104 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=iy2eud4l
2025-10-18 20:36:32.104 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=iy2eud4l
2025-10-18 20:36:32.105 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=iy2eud4l
2025-10-18 20:36:32.113 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:36:32.112 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:36:32.113 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:36:32.113 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:36:32.113 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:36:32.113 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 20:36:32.114 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 20:36:32.114 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 20:36:32.114 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:36:32.114 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:36:32.133 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=iy2eud4l] closed with CloseStatus[code=1000, reason=null]
2025-10-18 20:36:32.133 [http-nio-8080-exec-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session iy2eud4l
2025-10-18 20:36:32.134 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=iy2eud4l
2025-10-18 20:36:32.134 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=iy2eud4l}], simpSessionId=iy2eud4l}]
2025-10-18 20:36:33.123 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760799993120
2025-10-18 20:36:33.123 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760799993120
2025-10-18 20:36:33.123 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760799993120", parameters={masked}
2025-10-18 20:36:33.124 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@1dbc607d
2025-10-18 20:36:33.125 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760799993120
2025-10-18 20:36:33.125 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:36:33.125 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:33.129 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/092/cccpglma/websocket
2025-10-18 20:36:33.130 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/092/cccpglma/websocket
2025-10-18 20:36:33.130 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/092/cccpglma/websocket", parameters={}
2025-10-18 20:36:33.130 [http-nio-8080-exec-5] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@1dbc607d
2025-10-18 20:36:33.130 [http-nio-8080-exec-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/092/cccpglma/websocket
2025-10-18 20:36:33.130 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:33.131 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 20:36:33.131 [http-nio-8080-exec-5] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=cccpglma]
2025-10-18 20:36:33.133 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=cccpglma
2025-10-18 20:36:33.135 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=cccpglma
2025-10-18 20:36:33.135 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=cccpglma
2025-10-18 20:36:33.135 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=cccpglma
2025-10-18 20:36:33.909 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 4 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:36:33.910 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:36:33.910 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 20:36:33.911 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:36:33.911 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:34.904 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:36:34.906 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:36:34.910 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=4, userId='null', (truncated)...]
2025-10-18 20:36:34.915 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:36:34.915 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:34.929 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:36:34.930 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:36:34.931 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:36:34.931 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 20:36:36.723 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 4 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:36:36.723 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:36:36.723 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 20:36:36.724 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:36:36.725 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:36:38.676 [MessageBroker-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [iy2eud4l]
2025-10-18 20:37:06.275 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:37:06.276 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:37:06.276 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:37:06.277 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-18 20:37:06.283 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{message=add commute to airport on day 4, sender=user, timestamp=1760800026257}]
2025-10-18 20:37:08.107 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:08.109 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:37:08.109 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{id=PD5i9HBO71wYd5QrnhBY, message=add commute to airport on day 4, sender=user, userId=PEoULmiNa2dBO (truncated)...]
2025-10-18 20:37:08.110 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-18 20:37:08.110 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:37:08.114 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat
2025-10-18 20:37:08.115 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat
2025-10-18 20:37:08.115 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat", parameters={}
2025-10-18 20:37:08.115 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#sendChatMessage(String, ChatRequest, HttpServletRequest)
2025-10-18 20:37:08.121 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedN (truncated)...]
2025-10-18 20:37:08.121 [http-nio-8080-exec-9] INFO  com.tripplanner.service.OrchestratorService - Routing chat request: ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedNodeId='null', text='add commute to airport on day 4', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}
2025-10-18 20:37:09.933 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 5 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:09.933 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting content generation with provider 1 (GeminiClient)
2025-10-18 20:37:09.933 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 20:37:09.933 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 20:37:09.934 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 20:37:09.934 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 20:37:09.934 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 20:37:09.934 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2540
2025-10-18 20:37:09.934 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 20:37:09.934 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an AI assistant that classifies user intents for travel itinerary management.

Context:
Itinerary: 4-day trip to Poland with 26 activities (estimated 48900 per person)
Days: 4
Currency: INR
D...
2025-10-18 20:37:09.936 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2823
2025-10-18 20:37:09.942 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 20:37:12.073 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 20:37:12.073 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 20:37:12.074 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Response Length: 747
2025-10-18 20:37:12.074 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"intent\": \"add_activity_to_itinerary\",\n  \"taskType\": \"edit\",\n  \"entities\": {\n    \"activity\": \"commute to airport\",\n    \"day\": \"4\"\n  },\n  \"confidence\": 0.98\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 719,
    "candidatesTokenCount": 70,
    "totalTokenCount": 865,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 719
      }
    ],
    "thoughtsTokenCount": 76
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "IK3zaIlZn6i-vQ-SjIawBQ"
}

2025-10-18 20:37:12.084 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-996619703_20251018_203712.json
2025-10-18 20:37:12.085 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 20:37:12.085 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Generated content length: 173
2025-10-18 20:37:12.085 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "intent": "add_activity_to_itinerary",
  "taskType": "edit",
  "entities": {
    "activity": "commute to airport",
    "day": "4"
  },
  "confidence": 0.98
}
```
2025-10-18 20:37:12.085 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 20:37:12.085 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-18 20:37:12.753 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentRegistry - Created execution plan for 'edit': 1 agents, primary: EditorAgent
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.OrchestratorService - Executing agent plan: Task: edit, Agents: 1, Fallback: true, MaxRetries: 2, Timeout: 60000ms
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION START ===
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Agent ID: cd9609d5-fa18-41cc-9566-b7d2dc6ff9ce
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Request Type: Map
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Request Data: {chatRequest=ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedNodeId='null', text='add commute to airport on day 4', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b, scope=trip, text=add commute to airport on day 4, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Request Details: {chatRequest=ChatRequest{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', scope='trip', day=null, selectedNodeId='null', text='add commute to airport on day 4', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_ba231c6a-0791-4520-b86f-c60fb598125b, scope=trip, text=add commute to airport on day 4, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - =============================
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent ID: cd9609d5-fa18-41cc-9566-b7d2dc6ff9ce
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Status: queued
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Progress: 0
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Message: Agent queued for execution
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 20:37:12.754 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T15:07:12.754512500Z
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent ID: cd9609d5-fa18-41cc-9566-b7d2dc6ff9ce
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Message: Agent started
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T15:07:12.755520300Z
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Executing agent-specific logic for: EDITOR
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - EditorAgent executing for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent ID: cd9609d5-fa18-41cc-9566-b7d2dc6ff9ce
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Message: Loading itinerary
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Step: load
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T15:07:12.755520300Z
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:12.755 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - === ITINERARY STATE AFTER MIGRATION (EditorAgent) ===
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Day 1: 7 nodes - IDs: [day1_node1, day1_node2, day1_node3, day1_node4, day1_node5, day1_node6, day1_node7]
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Day 2: 6 nodes - IDs: [day2_node1, day2_node2, day2_node3, day2_node4, day2_node5, day2_node6]
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Day 3: 7 nodes - IDs: [day3_node1, day3_node2, day3_node3, day3_node4, day3_node5, day3_node6, day3_node7]
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Day 4: 7 nodes - IDs: [day4_node1, day4_node2, day4_node3, day4_node8, day4_node5, day4_node6, day4_node7]
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - =======================================================
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent ID: cd9609d5-fa18-41cc-9566-b7d2dc6ff9ce
2025-10-18 20:37:14.149 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 20:37:14.150 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 20:37:14.150 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Progress: 40
2025-10-18 20:37:14.150 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Message: Generating summary
2025-10-18 20:37:14.150 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Step: summarize
2025-10-18 20:37:14.150 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T15:07:14.149168300Z
2025-10-18 20:37:14.150 [http-nio-8080-exec-9] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:14.150 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent ID: cd9609d5-fa18-41cc-9566-b7d2dc6ff9ce
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Progress: 60
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Message: Generating changes
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Step: llm
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T15:07:14.151169800Z
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:14.151 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 20:37:14.816 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-18 20:37:14.818 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-18 20:37:14.818 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-18 20:37:14.818 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-18 20:37:14.818 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-18 20:37:14.818 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 8234
2025-10-18 20:37:14.818 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-18 20:37:14.818 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an expert travel itinerary editor.

You must respond with valid JSON that matches this exact schema:
{
  "type": "object",
  "properties": {
    "ops": {
      "type": "array",
      "descript...
2025-10-18 20:37:14.819 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 8833
2025-10-18 20:37:14.819 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-18 20:37:33.566 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:37:33.569 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:37:33.569 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:37:33.569 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:37:33.570 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 20:37:33.570 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:37:33.570 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 20:37:33.570 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 20:37:33.570 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:33.570 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:37:35.347 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=cccpglma
2025-10-18 20:37:35.348 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=cccpglma
2025-10-18 20:37:35.348 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=cccpglma
2025-10-18 20:37:35.348 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=cccpglma
2025-10-18 20:37:35.382 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=cccpglma] closed with CloseStatus[code=1000, reason=null]
2025-10-18 20:37:35.382 [http-nio-8080-exec-7] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session cccpglma
2025-10-18 20:37:35.382 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=cccpglma
2025-10-18 20:37:35.382 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=cccpglma}], simpSessionId=cccpglma}]
2025-10-18 20:37:35.386 [http-nio-8080-exec-3] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 5 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:35.386 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:37:35.386 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 20:37:35.387 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:37:35.387 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:37:36.263 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:36.264 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:37:36.266 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=4, userId='null', (truncated)...]
2025-10-18 20:37:36.273 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:37:36.274 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:37:43.675 [MessageBroker-7] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [cccpglma]
2025-10-18 20:37:52.896 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-18 20:37:52.896 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-18 20:37:52.896 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Response Length: 1221
2025-10-18 20:37:52.896 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"ops\": [\n    {\n      \"op\": \"insert\",\n      \"id\": \"day4_commute_to_airport\",\n      \"after\": \"day4_node3\",\n      \"startTime\": \"14:10\",\n      \"endTime\": \"15:10\",\n      \"node\": {\n        \"title\": \"Commute to Airport\",\n        \"type\": \"transport\",\n        \"location\": {\n          \"name\": \"Warsaw Chopin Airport\",\n          \"address\": \"wirki i Wigury, 00-001 Warszawa, Poland\"\n        }\n      }\n    }\n  ],\n  \"day\": 4,\n  \"reason\": \"Added a 'Commute to Airport' activity on Day 4, placed after the last timed event in Warsaw, assuming departure from Warsaw.\",\n  \"agent\": \"EditorAgent\"\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 2979,
    "candidatesTokenCount": 206,
    "totalTokenCount": 7954,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 2979
      }
    ],
    "thoughtsTokenCount": 4769
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "SK3zaIegM_uIosUPiuu4iQU"
}

2025-10-18 20:37:52.898 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_894359408_20251018_203752.json
2025-10-18 20:37:52.898 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-18 20:37:52.898 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Generated content length: 595
2025-10-18 20:37:52.898 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "ops": [
    {
      "op": "insert",
      "id": "day4_commute_to_airport",
      "after": "day4_node3",
      "startTime": "14:10",
      "endTime": "15:10",
      "node": {
        "title": "Commute to Airport",
        "type": "transport",
        "location": {
          "name": "Wars...
2025-10-18 20:37:52.898 [http-nio-8080-exec-9] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-18 20:37:52.898 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - === EDITOR AGENT - FULL LLM RESPONSE ===
2025-10-18 20:37:52.898 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - User Request: add commute to airport on day 4
2025-10-18 20:37:52.898 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Raw Response: ```json
{
  "ops": [
    {
      "op": "insert",
      "id": "day4_commute_to_airport",
      "after": "day4_node3",
      "startTime": "14:10",
      "endTime": "15:10",
      "node": {
        "title": "Commute to Airport",
        "type": "transport",
        "location": {
          "name": "Warsaw Chopin Airport",
          "address": "wirki i Wigury, 00-001 Warszawa, Poland"
        }
      }
    }
  ],
  "day": 4,
  "reason": "Added a 'Commute to Airport' activity on Day 4, placed after the last timed event in Warsaw, assuming departure from Warsaw.",
  "agent": "EditorAgent"
}
```
2025-10-18 20:37:52.898 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - === END EDITOR AGENT RESPONSE ===
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Successfully generated ChangeSet with 1 operations
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent ID: cd9609d5-fa18-41cc-9566-b7d2dc6ff9ce
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Message: Applying changes
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Step: apply
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T15:07:52.905459400Z
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 20:37:52.905 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ChangeEngine - Applying changes for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b (using provided object)
2025-10-18 20:37:52.909 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ChangeEngine - Generated ID for new node: Commute to Airport -> day4_node9
2025-10-18 20:37:52.909 [http-nio-8080-exec-9] INFO  com.tripplanner.service.RevisionService - Saving revision rev_1760800072909_f85712e4 for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:53.311 [http-nio-8080-exec-9] INFO  com.tripplanner.service.RevisionService - Successfully saved revision rev_1760800072909_f85712e4 for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:55.007 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ChangeEngine - Triggering auto-enrichment for 1 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent ID: cd9609d5-fa18-41cc-9566-b7d2dc6ff9ce
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Message: Changes applied successfully
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Step: complete
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T15:07:55.011088400Z
2025-10-18 20:37:55.011 [AsyncTask-1] INFO  com.tripplanner.service.EnrichmentService - Starting async enrichment for 1 nodes in itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT ===
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent ID: cd9609d5-fa18-41cc-9566-b7d2dc6ff9ce
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Status: completed
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Message: Agent completed successfully
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-18T15:07:55.011088400Z
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] WARN  com.tripplanner.service.AgentEventBus - No SSE emitters found for itinerary: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.service.AgentEventBus - ==============================
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION COMPLETED ===
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Result Type: ApplyResult
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - Result: com.tripplanner.service.ChangeEngine$ApplyResult@223e4af1
2025-10-18 20:37:55.011 [http-nio-8080-exec-9] INFO  com.tripplanner.agents.EditorAgent - =================================
2025-10-18 20:37:55.013 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:37:55.018 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [ChatResponse{intent='Changes applied successfully', message='Your itinerary has been updated.', chan (truncated)...]
2025-10-18 20:37:55.022 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:37:55.022 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:37:55.027 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:37:55.028 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:37:55.028 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:37:55.028 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-18 20:37:55.029 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{intent=Changes applied successfully, message=Your itinerary has been updated., changeSet=null, diff (truncated)...]
2025-10-18 20:37:55.659 [AsyncTask-1] INFO  com.tripplanner.service.EnrichmentService - All 1 nodes already have coordinates, skipping enrichment
2025-10-18 20:37:57.444 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:37:57.445 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:37:57.445 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{applied=true, warnings=[], diff={added=[{nodeId=day4_node9, day=4, fields=null, title=Commute to Ai (truncated)...]
2025-10-18 20:37:57.446 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-18 20:37:57.446 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:38:06.201 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:38:06.201 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:38:06.202 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:38:06.202 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:38:06.202 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:38:06.202 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 20:38:06.202 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 20:38:06.202 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 20:38:06.202 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:38:06.203 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:38:07.203 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1760800087201
2025-10-18 20:38:07.203 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1760800087201
2025-10-18 20:38:07.203 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1760800087201", parameters={masked}
2025-10-18 20:38:07.203 [http-nio-8080-exec-4] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@1dbc607d
2025-10-18 20:38:07.204 [http-nio-8080-exec-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1760800087201
2025-10-18 20:38:07.204 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:38:07.204 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:38:07.207 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/943/3k4zsvrq/websocket
2025-10-18 20:38:07.207 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/943/3k4zsvrq/websocket
2025-10-18 20:38:07.207 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/943/3k4zsvrq/websocket", parameters={}
2025-10-18 20:38:07.207 [http-nio-8080-exec-6] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@1dbc607d
2025-10-18 20:38:07.208 [http-nio-8080-exec-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/943/3k4zsvrq/websocket
2025-10-18 20:38:07.208 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:38:07.208 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-18 20:38:07.209 [http-nio-8080-exec-6] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=3k4zsvrq]
2025-10-18 20:38:07.211 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=3k4zsvrq
2025-10-18 20:38:07.212 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-0 session=3k4zsvrq
2025-10-18 20:38:07.214 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-1 session=3k4zsvrq
2025-10-18 20:38:07.214 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_ba231c6a-0791-4520-b86f-c60fb598125b id=sub-2 session=3k4zsvrq
2025-10-18 20:38:08.284 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:38:08.285 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:38:08.285 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=5, userId='null', (truncated)...]
2025-10-18 20:38:08.287 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:38:08.287 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:38:08.657 [http-nio-8080-exec-10] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 6 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:38:08.657 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:38:08.657 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 20:38:08.658 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:38:08.658 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:40:00.199 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:40:00.199 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:40:00.200 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history
2025-10-18 20:40:00.200 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json
2025-10-18 20:40:00.200 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/chat/history", parameters={}
2025-10-18 20:40:00.200 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_ba231c6a-0791-4520-b86f-c60fb598125b/json", parameters={}
2025-10-18 20:40:00.200 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-18 20:40:00.200 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-18 20:40:00.200 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:40:00.200 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:40:02.695 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:40:02.696 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:40:02.697 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_ba231c6a-0791-4520-b86f-c60fb598125b', version=5, userId='null', (truncated)...]
2025-10-18 20:40:02.699 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:40:02.699 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:40:03.963 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 6 chat messages for itinerary it_ba231c6a-0791-4520-b86f-c60fb598125b
2025-10-18 20:40:03.963 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:40:03.963 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=3z2kHzIKcQZ8iLDfA5Ht, message=Muzeum Sportu i Turystyki w Warszawie - i want to visit this plac (truncated)...]
2025-10-18 20:40:03.964 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:40:03.964 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:47:42.492 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=3k4zsvrq
2025-10-18 20:47:42.492 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=3k4zsvrq
2025-10-18 20:47:42.492 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=3k4zsvrq
2025-10-18 20:47:42.493 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=3k4zsvrq
2025-10-18 20:47:42.498 [http-nio-8080-exec-1] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=3k4zsvrq] closed with CloseStatus[code=1000, reason=null]
2025-10-18 20:47:42.498 [http-nio-8080-exec-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session 3k4zsvrq
2025-10-18 20:47:42.498 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=3k4zsvrq
2025-10-18 20:47:42.498 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=3k4zsvrq}], simpSessionId=3k4zsvrq}]
2025-10-18 20:47:44.793 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries
2025-10-18 20:47:44.797 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-18 20:47:44.797 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-18 20:47:44.798 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-18 20:47:44.798 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-18 20:47:44.798 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-18 20:47:44.798 [http-nio-8080-exec-3] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:47:46.759 [http-nio-8080-exec-3] INFO  com.tripplanner.service.UserDataService - Found 12 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:47:46.763 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Found 12 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-18 20:47:46.764 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-18 20:47:46.772 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_ba231c6a-0791-4520-b86f-c60fb598125b, destination=Poland, Poland, startDate=2026 (truncated)...]
2025-10-18 20:47:46.776 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-18 20:47:46.776 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-18 20:47:48.675 [MessageBroker-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [3k4zsvrq]
2025-10-18 20:48:51.969 [SpringApplicationShutdownHook] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-10-18 20:48:53.559 [tomcat-shutdown] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Graceful shutdown complete
2025-10-18 20:48:53.563 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-18 20:48:53.564 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-18 20:48:53.564 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopping...
2025-10-18 20:48:53.564 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3980b44f]]
2025-10-18 20:48:53.564 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3980b44f]
2025-10-18 20:48:53.564 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3980b44f]
2025-10-18 20:48:53.564 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopped.
2025-10-18 20:48:53.564 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 20:48:53.564 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-18 20:48:53.592 [SpringApplicationShutdownHook] INFO  com.tripplanner.service.GeminiClient - Gemini client cleanup completed
2025-10-18 20:48:53.592 [SpringApplicationShutdownHook] INFO  c.tripplanner.service.openrouter.OpenRouterClient - OpenRouter client cleanup completed
