2025-10-25 01:16:32.281 [MessageBroker-6] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 8 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(8)-CONNECTED(8)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 0, completed tasks = 508]
2025-10-25 03:18:11.137 [MessageBroker-3] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 8 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(8)-CONNECTED(8)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 2322]
2025-10-25 07:33:50.228 [MessageBroker-8] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 8 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(8)-CONNECTED(8)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 0, completed tasks = 3425]
2025-10-25 07:34:02.369 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries
2025-10-25 07:34:02.670 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-25 07:34:02.671 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-25 07:34:02.671 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-25 07:34:02.671 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-25 07:34:02.671 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-25 07:34:02.672 [http-nio-8080-exec-10] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 07:34:04.891 [http-nio-8080-exec-10] INFO  com.tripplanner.service.UserDataService - Found 5 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 07:34:04.891 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Found 5 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 07:34:04.892 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 07:34:04.892 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, destination=Turkey, Turkey, startDate=2026 (truncated)...]
2025-10-25 07:34:04.894 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 07:34:04.894 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 07:57:03.175 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-25 07:57:03.177 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-25 07:57:03.177 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-25 07:57:03.177 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-25 07:57:03.178 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-25 07:57:03.178 [http-nio-8080-exec-6] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 07:57:05.265 [http-nio-8080-exec-6] INFO  com.tripplanner.service.UserDataService - Found 5 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 07:57:05.266 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Found 5 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 07:57:05.266 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 07:57:05.267 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, destination=Turkey, Turkey, startDate=2026 (truncated)...]
2025-10-25 07:57:05.269 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 07:57:05.269 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 08:03:50.228 [MessageBroker-8] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 8 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(8)-CONNECTED(8)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 6854]
2025-10-25 08:33:50.246 [MessageBroker-4] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 8 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(8)-CONNECTED(8)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 7215]
2025-10-25 09:03:50.259 [MessageBroker-2] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 8 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(8)-CONNECTED(8)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 7576]
2025-10-25 09:33:50.263 [MessageBroker-5] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 8 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(8)-CONNECTED(8)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 240], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 7937]
2025-10-25 09:58:25.221 [SpringApplicationShutdownHook] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-10-25 09:58:25.316 [tomcat-shutdown] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Graceful shutdown complete
2025-10-25 09:58:25.331 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-25 09:58:25.332 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-25 09:58:25.332 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopping...
2025-10-25 09:58:25.332 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@372f7bc]]
2025-10-25 09:58:25.332 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@372f7bc]
2025-10-25 09:58:25.332 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@372f7bc]
2025-10-25 09:58:25.332 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopped.
2025-10-25 09:58:25.332 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-25 09:58:25.332 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-25 09:58:25.369 [SpringApplicationShutdownHook] INFO  com.tripplanner.service.GeminiClient - Gemini client cleanup completed
2025-10-25 09:58:25.370 [SpringApplicationShutdownHook] INFO  c.tripplanner.service.openrouter.OpenRouterClient - OpenRouter client cleanup completed
2025-10-25 10:02:28.904 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 24128 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-25 10:02:28.908 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-25 10:02:30.871 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-25 10:02:30.890 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-25 10:02:30.890 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-25 10:02:30.983 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-25 10:02:30.984 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2010 ms
2025-10-25 10:02:31.109 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-25 10:02:31.214 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-25 10:02:31.256 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-25 10:02:31.256 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: gemini
2025-10-25 10:02:31.256 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-25 10:02:31.256 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-25 10:02:31.536 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free | apiKey=MISSING
2025-10-25 10:02:31.540 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-25 10:02:31.542 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-25 10:02:31.542 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-25 10:02:31.543 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-25 10:02:31.543 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with Gemini as primary, OpenRouter as fallback
2025-10-25 10:02:31.543 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-25 10:02:31.546 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-25 10:02:31.546 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: GeminiClient (available: true)
2025-10-25 10:02:31.548 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: OpenRouterClient (available: false)
2025-10-25 10:02:31.548 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-25 10:02:31.640 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-25 10:02:31.643 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-25 10:02:32.652 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-25 10:02:32.783 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-25 10:02:32.785 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-25 10:02:32.785 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-25 10:02:32.786 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-25 10:02:32.786 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-25 10:02:32.787 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-25 10:02:32.787 [main] INFO  com.tripplanner.service.AgentRegistry - Found 11 agents to register
2025-10-25 10:02:32.788 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-25 10:02:32.788 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-25 10:02:32.789 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-25 10:02:32.789 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-25 10:02:32.789 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-25 10:02:32.789 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-25 10:02:32.789 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-25 10:02:32.789 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-25 10:02:32.789 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-25 10:02:32.789 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-25 10:02:32.789 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-25 10:02:32.790 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 11
2025-10-25 10:02:32.790 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-25 10:02:32.817 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-25 10:02:32.819 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-25 10:02:32.819 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-25 10:02:32.819 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-25 10:02:32.820 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-25 10:02:32.820 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-25 10:02:32.831 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-25 10:02:32.832 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-25 10:02:32.864 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-25 10:02:32.864 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-25 10:02:32.864 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-25 10:02:32.864 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-25 10:02:32.864 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-25 10:02:32.864 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-25 10:02:32.864 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-25 10:02:32.963 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-25 10:02:32.967 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-25 10:02:32.991 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-25 10:02:33.097 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 37 mappings in 'requestMappingHandlerMapping'
2025-10-25 10:02:33.151 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-25 10:02:33.183 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-25 10:02:33.298 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-25 10:02:33.378 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-25 10:02:33.379 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-25 10:02:33.379 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-25 10:02:33.380 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-25 10:02:33.380 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-25 10:02:33.380 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-25 10:02:33.385 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
2025-10-25 10:02:33.386 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-25 10:02:33.469 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-25 10:02:33.546 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-25 10:02:33.784 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-25 10:02:33.784 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-25 10:02:33.784 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-25 10:02:33.784 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5d67b2b3]
2025-10-25 10:02:33.785 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5d67b2b3]
2025-10-25 10:02:33.785 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5d67b2b3]]
2025-10-25 10:02:33.786 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-25 10:02:33.787 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-25 10:02:33.787 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-25 10:02:33.804 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-25 10:02:33.815 [main] INFO  com.tripplanner.App - Started App in 5.72 seconds (process running for 6.994)
2025-10-25 10:02:58.431 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-25 10:02:58.432 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-25 10:02:58.432 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-25 10:02:58.432 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-25 10:02:58.432 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-25 10:02:58.433 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@6f430ea8
2025-10-25 10:02:58.434 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@5305f936
2025-10-25 10:02:58.434 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-25 10:02:58.434 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-10-25 10:02:58.465 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries
2025-10-25 10:02:59.018 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-25 10:02:59.024 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-25 10:02:59.028 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-25 10:02:59.031 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-25 10:02:59.052 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-25 10:02:59.052 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:02.093 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Found 5 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:02.095 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Found 5 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:02.123 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:02.131 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, destination=Turkey, Turkey, startDate=2026 (truncated)...]
2025-10-25 10:03:02.165 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:02.166 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:09.725 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/json
2025-10-25 10:03:09.733 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/json
2025-10-25 10:03:09.735 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/json
2025-10-25 10:03:09.735 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/json", parameters={}
2025-10-25 10:03:09.736 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:03:09.756 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_0964b247-9a8e-43f9-8140-d63bc108bfdd
2025-10-25 10:03:09.756 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:12.025 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_0964b247-9a8e-43f9-8140-d63bc108bfdd, status: completed
2025-10-25 10:03:12.033 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:12.079 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_0964b247-9a8e-43f9-8140-d63bc108bfdd', version=1, userId='null', (truncated)...]
2025-10-25 10:03:12.104 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:12.104 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:12.161 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/chat/history
2025-10-25 10:03:12.162 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/json
2025-10-25 10:03:12.163 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/json
2025-10-25 10:03:12.163 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/json", parameters={}
2025-10-25 10:03:12.163 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:03:12.164 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_0964b247-9a8e-43f9-8140-d63bc108bfdd
2025-10-25 10:03:12.164 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:12.166 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/chat/history
2025-10-25 10:03:12.167 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/chat/history
2025-10-25 10:03:12.167 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd/chat/history", parameters={}
2025-10-25 10:03:12.167 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:03:13.200 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761366793186
2025-10-25 10:03:13.204 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761366793186
2025-10-25 10:03:13.206 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761366793186", parameters={masked}
2025-10-25 10:03:13.207 [http-nio-8080-exec-8] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:03:13.213 [http-nio-8080-exec-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761366793186
2025-10-25 10:03:13.217 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:13.218 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:13.231 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/774/dxryhivj/websocket
2025-10-25 10:03:13.232 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/774/dxryhivj/websocket
2025-10-25 10:03:13.233 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/774/dxryhivj/websocket", parameters={}
2025-10-25 10:03:13.234 [http-nio-8080-exec-9] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:03:13.236 [http-nio-8080-exec-9] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/774/dxryhivj/websocket
2025-10-25 10:03:13.259 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:13.308 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:03:13.332 [http-nio-8080-exec-9] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=dxryhivj]
2025-10-25 10:03:13.359 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=dxryhivj
2025-10-25 10:03:13.368 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_0964b247-9a8e-43f9-8140-d63bc108bfdd id=sub-0 session=dxryhivj
2025-10-25 10:03:13.368 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_0964b247-9a8e-43f9-8140-d63bc108bfdd id=sub-1 session=dxryhivj
2025-10-25 10:03:13.371 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_0964b247-9a8e-43f9-8140-d63bc108bfdd id=sub-2 session=dxryhivj
2025-10-25 10:03:14.302 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_0964b247-9a8e-43f9-8140-d63bc108bfdd, status: completed
2025-10-25 10:03:14.305 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:14.307 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_0964b247-9a8e-43f9-8140-d63bc108bfdd', version=1, userId='null', (truncated)...]
2025-10-25 10:03:14.312 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:14.312 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:14.350 [http-nio-8080-exec-7] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_0964b247-9a8e-43f9-8140-d63bc108bfdd
2025-10-25 10:03:14.353 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:14.353 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-25 10:03:14.356 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:14.357 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:29.101 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=dxryhivj
2025-10-25 10:03:29.101 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=dxryhivj
2025-10-25 10:03:29.101 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=dxryhivj
2025-10-25 10:03:29.102 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=dxryhivj
2025-10-25 10:03:29.128 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=dxryhivj] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:03:29.128 [http-nio-8080-exec-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session dxryhivj
2025-10-25 10:03:29.129 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=dxryhivj
2025-10-25 10:03:29.129 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=dxryhivj}], simpSessionId=dxryhivj}]
2025-10-25 10:03:32.223 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd
2025-10-25 10:03:32.228 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing DELETE /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd
2025-10-25 10:03:32.229 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured DELETE /api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd
2025-10-25 10:03:32.229 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - DELETE "/api/v1/itineraries/it_0964b247-9a8e-43f9-8140-d63bc108bfdd", parameters={}
2025-10-25 10:03:32.229 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#delete(String, HttpServletRequest)
2025-10-25 10:03:32.229 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Deleting itinerary: it_0964b247-9a8e-43f9-8140-d63bc108bfdd
2025-10-25 10:03:32.230 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ItineraryService - Deleting itinerary: it_0964b247-9a8e-43f9-8140-d63bc108bfdd for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:32.230 [http-nio-8080-exec-4] INFO  com.tripplanner.service.UserDataService - Deleting itinerary it_0964b247-9a8e-43f9-8140-d63bc108bfdd for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:33.801 [MessageBroker-2] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 30], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 30], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 5]
2025-10-25 10:03:34.072 [http-nio-8080-exec-4] INFO  com.tripplanner.service.UserDataService - Successfully deleted trip metadata it_0964b247-9a8e-43f9-8140-d63bc108bfdd for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:34.461 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ItineraryService - Itinerary deleted: it_0964b247-9a8e-43f9-8140-d63bc108bfdd for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:34.462 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Itinerary deleted successfully: it_0964b247-9a8e-43f9-8140-d63bc108bfdd for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:34.464 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:34.464 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Nothing to write: null body
2025-10-25 10:03:34.465 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 204 NO_CONTENT
2025-10-25 10:03:34.465 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:34.480 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-25 10:03:34.481 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-25 10:03:34.481 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-25 10:03:34.481 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-25 10:03:34.482 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-25 10:03:34.482 [http-nio-8080-exec-6] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:34.913 [http-nio-8080-exec-6] INFO  com.tripplanner.service.UserDataService - Found 4 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:34.913 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Found 4 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:34.914 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:34.914 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, destination=Turkey, Turkey, startDate=2026 (truncated)...]
2025-10-25 10:03:34.915 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:34.915 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:36.948 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:03:36.956 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:03:36.957 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:03:36.957 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json", parameters={}
2025-10-25 10:03:36.959 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:03:36.959 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:03:36.959 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:38.249 [MessageBroker-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [dxryhivj]
2025-10-25 10:03:39.139 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, status: completed
2025-10-25 10:03:39.140 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:39.145 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', version=2, userId='null', (truncated)...]
2025-10-25 10:03:39.152 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:39.152 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:39.181 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:03:39.184 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:03:39.184 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:03:39.185 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json", parameters={}
2025-10-25 10:03:39.185 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:03:39.185 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:03:39.185 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:39.186 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:03:39.186 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:03:39.186 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history", parameters={}
2025-10-25 10:03:39.187 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:03:40.193 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761366820186
2025-10-25 10:03:40.195 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761366820186
2025-10-25 10:03:40.195 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761366820186", parameters={masked}
2025-10-25 10:03:40.197 [http-nio-8080-exec-1] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:03:40.198 [http-nio-8080-exec-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761366820186
2025-10-25 10:03:40.199 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:40.200 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:40.212 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/379/yqy0twki/websocket
2025-10-25 10:03:40.213 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/379/yqy0twki/websocket
2025-10-25 10:03:40.213 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/379/yqy0twki/websocket", parameters={}
2025-10-25 10:03:40.214 [http-nio-8080-exec-2] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:03:40.215 [http-nio-8080-exec-2] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/379/yqy0twki/websocket
2025-10-25 10:03:40.215 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:40.217 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:03:40.218 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=yqy0twki]
2025-10-25 10:03:40.221 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=yqy0twki
2025-10-25 10:03:40.225 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-0 session=yqy0twki
2025-10-25 10:03:40.225 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-1 session=yqy0twki
2025-10-25 10:03:40.226 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-2 session=yqy0twki
2025-10-25 10:03:41.491 [http-nio-8080-exec-7] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:03:41.492 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:41.492 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=F1MsR0O06lZPJgGhRook, message=my flight is on 4th day back to bangalore at 9 pm, sender=user, u (truncated)...]
2025-10-25 10:03:41.497 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:41.497 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:41.573 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, status: completed
2025-10-25 10:03:41.575 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:41.579 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', version=2, userId='null', (truncated)...]
2025-10-25 10:03:41.588 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:41.588 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:46.116 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=yqy0twki
2025-10-25 10:03:46.116 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=yqy0twki
2025-10-25 10:03:46.116 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=yqy0twki
2025-10-25 10:03:46.117 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=yqy0twki
2025-10-25 10:03:46.124 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:03:46.125 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:03:46.125 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:03:46.125 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history", parameters={}
2025-10-25 10:03:46.126 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:03:46.126 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:03:46.126 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json", parameters={}
2025-10-25 10:03:46.126 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:03:46.126 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:03:46.126 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:03:46.130 [http-nio-8080-exec-10] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=yqy0twki] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:03:46.130 [http-nio-8080-exec-10] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session yqy0twki
2025-10-25 10:03:46.130 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=yqy0twki
2025-10-25 10:03:46.130 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=yqy0twki}], simpSessionId=yqy0twki}]
2025-10-25 10:03:47.146 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761366827142
2025-10-25 10:03:47.147 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761366827142
2025-10-25 10:03:47.147 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761366827142", parameters={masked}
2025-10-25 10:03:47.147 [http-nio-8080-exec-1] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:03:47.148 [http-nio-8080-exec-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761366827142
2025-10-25 10:03:47.148 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:47.148 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:47.155 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/081/1fo445uv/websocket
2025-10-25 10:03:47.156 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/081/1fo445uv/websocket
2025-10-25 10:03:47.156 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/081/1fo445uv/websocket", parameters={}
2025-10-25 10:03:47.156 [http-nio-8080-exec-2] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:03:47.157 [http-nio-8080-exec-2] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/081/1fo445uv/websocket
2025-10-25 10:03:47.157 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:47.158 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:03:47.159 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=1fo445uv]
2025-10-25 10:03:47.161 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=1fo445uv
2025-10-25 10:03:47.163 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-0 session=1fo445uv
2025-10-25 10:03:47.164 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-1 session=1fo445uv
2025-10-25 10:03:47.164 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-2 session=1fo445uv
2025-10-25 10:03:47.848 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:03:47.849 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:47.849 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=F1MsR0O06lZPJgGhRook, message=my flight is on 4th day back to bangalore at 9 pm, sender=user, u (truncated)...]
2025-10-25 10:03:47.850 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:47.850 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:48.735 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, status: completed
2025-10-25 10:03:48.736 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:48.740 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', version=2, userId='null', (truncated)...]
2025-10-25 10:03:48.756 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:48.757 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:48.777 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:03:48.788 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:03:48.790 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:03:48.791 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history", parameters={}
2025-10-25 10:03:48.792 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:03:50.562 [http-nio-8080-exec-5] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:03:50.564 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:03:50.565 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=F1MsR0O06lZPJgGhRook, message=my flight is on 4th day back to bangalore at 9 pm, sender=user, u (truncated)...]
2025-10-25 10:03:50.567 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:03:50.567 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:03:53.252 [MessageBroker-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [yqy0twki]
2025-10-25 10:04:33.712 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:04:33.713 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:04:33.713 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history", parameters={}
2025-10-25 10:04:33.714 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-25 10:04:33.723 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{message=i want to visit one more restaurant on day 3, sender=user, timestamp=1761366873691}]
2025-10-25 10:04:36.386 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:36.387 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:04:36.387 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{id=pvXECb6VymeL5B9AZLuC, message=i want to visit one more restaurant on day 3, sender=user, userId= (truncated)...]
2025-10-25 10:04:36.389 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-25 10:04:36.389 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:04:36.395 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat
2025-10-25 10:04:36.404 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat
2025-10-25 10:04:36.405 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat
2025-10-25 10:04:36.405 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat", parameters={}
2025-10-25 10:04:36.405 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#sendChatMessage(String, ChatRequest, HttpServletRequest)
2025-10-25 10:04:36.414 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [ChatRequest{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', scope='trip', day=null, selectedN (truncated)...]
2025-10-25 10:04:36.414 [http-nio-8080-exec-4] INFO  com.tripplanner.service.OrchestratorService - Routing chat request: ChatRequest{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', scope='trip', day=null, selectedNodeId='null', text='i want to visit one more restaurant on day 3', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}
2025-10-25 10:04:38.097 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 3 chat messages for itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:38.099 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting content generation with provider 1 (GeminiClient)
2025-10-25 10:04:38.099 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:04:38.099 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:04:38.099 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:04:38.100 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:04:38.100 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:04:38.100 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2422
2025-10-25 10:04:38.100 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:04:38.101 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an AI assistant that classifies user intents for travel itinerary management.

Context:
Itinerary: 4-day trip to Turkey with 25 activities (estimated 55550 per person)
Days: 4
Currency: INR
D...
2025-10-25 10:04:38.106 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2703
2025-10-25 10:04:38.126 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:04:40.686 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:04:40.686 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:04:40.686 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Response Length: 740
2025-10-25 10:04:40.687 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"intent\": \"add_activity_to_day\",\n  \"taskType\": \"edit\",\n  \"entities\": {\n    \"activity_type\": \"restaurant\",\n    \"day\": \"3\"\n  },\n  \"confidence\": 0.98\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 689,
    "candidatesTokenCount": 68,
    "totalTokenCount": 918,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 689
      }
    ],
    "thoughtsTokenCount": 161
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "X1P8aImSH5Ca1e8Py6Kb0QI"
}

2025-10-25 10:04:40.700 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_682210308_20251025_100440.json
2025-10-25 10:04:40.700 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:04:40.700 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Generated content length: 164
2025-10-25 10:04:40.700 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "intent": "add_activity_to_day",
  "taskType": "edit",
  "entities": {
    "activity_type": "restaurant",
    "day": "3"
  },
  "confidence": 0.98
}
```
2025-10-25 10:04:40.700 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:04:40.700 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:04:41.344 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentRegistry - Created execution plan for 'edit': 1 agents, primary: EditorAgent
2025-10-25 10:04:41.344 [http-nio-8080-exec-4] INFO  com.tripplanner.service.OrchestratorService - Executing agent plan: Task: edit, Agents: 1, Fallback: true, MaxRetries: 2, Timeout: 60000ms
2025-10-25 10:04:41.345 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION START ===
2025-10-25 10:04:41.345 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-25 10:04:41.345 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Agent ID: 5554fad0-f1df-4a2d-b0aa-1c4c8f93cf27
2025-10-25 10:04:41.345 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:41.345 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Request Type: Map
2025-10-25 10:04:41.345 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Request Data: {chatRequest=ChatRequest{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', scope='trip', day=null, selectedNodeId='null', text='i want to visit one more restaurant on day 3', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, scope=trip, text=i want to visit one more restaurant on day 3, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-25 10:04:41.346 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Request Details: {chatRequest=ChatRequest{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', scope='trip', day=null, selectedNodeId='null', text='i want to visit one more restaurant on day 3', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, scope=trip, text=i want to visit one more restaurant on day 3, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-25 10:04:41.346 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - =============================
2025-10-25 10:04:41.347 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:04:41.347 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:41.347 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 5554fad0-f1df-4a2d-b0aa-1c4c8f93cf27
2025-10-25 10:04:41.347 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:04:41.347 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: queued
2025-10-25 10:04:41.347 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 0
2025-10-25 10:04:41.347 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Agent queued for execution
2025-10-25 10:04:41.347 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:04:41.347 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:34:41.347041800Z
2025-10-25 10:04:41.357 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f session=null payload={"updateType":"agent_progress","itineraryId":"it_c0322c0f-eb92-4ca6-af5d-8c7345b...(truncated)
2025-10-25 10:04:41.361 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:04:41.363 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:04:41.363 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:04:41.363 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:41.363 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 5554fad0-f1df-4a2d-b0aa-1c4c8f93cf27
2025-10-25 10:04:41.363 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Agent started
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:34:41.363387600Z
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f session=null payload={"updateType":"agent_progress","itineraryId":"it_c0322c0f-eb92-4ca6-af5d-8c7345b...(truncated)
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Executing agent-specific logic for: EDITOR
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - EditorAgent executing for itinerary: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 5554fad0-f1df-4a2d-b0aa-1c4c8f93cf27
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-25 10:04:41.364 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Loading itinerary
2025-10-25 10:04:41.365 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: load
2025-10-25 10:04:41.365 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:34:41.364380500Z
2025-10-25 10:04:41.365 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f session=null payload={"updateType":"agent_progress","itineraryId":"it_c0322c0f-eb92-4ca6-af5d-8c7345b...(truncated)
2025-10-25 10:04:41.365 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:04:41.365 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:04:42.713 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === ITINERARY STATE AFTER MIGRATION (EditorAgent) ===
2025-10-25 10:04:42.714 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Day 1: 7 nodes - IDs: [day1_node1, day1_node2, day1_node3, day1_node4, day1_node5, day1_node6, day1_node7]
2025-10-25 10:04:42.715 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Day 2: 6 nodes - IDs: [day2_node1, day2_node2, day2_node3, day2_node4, day2_node5, day2_node6]
2025-10-25 10:04:42.715 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Day 3: 6 nodes - IDs: [day3_node1, day3_node2, day3_node3, day3_node4, day3_node5, day3_node6]
2025-10-25 10:04:42.715 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Day 4: 6 nodes - IDs: [day4_node1, day4_node2, day4_node3, day4_node4, day4_node5, day4_node7]
2025-10-25 10:04:42.715 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - =======================================================
2025-10-25 10:04:42.717 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent - Itinerary data validation warnings for it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f:
2025-10-25 10:04:42.718 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent -   - Day 1: Node day1_node7 has invalid timing (start > end)
2025-10-25 10:04:42.718 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent -   - Day 2: Node day2_node6 has invalid timing (start > end)
2025-10-25 10:04:42.718 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent -   - Day 3: Node day3_node6 has invalid timing (start > end)
2025-10-25 10:04:42.718 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent -   - Day 4, position 5: Non-sequential node ID 'day4_node7' (expected 'day4_node6')
2025-10-25 10:04:42.718 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Itinerary data consistency validation passed with 4 warnings for it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:42.718 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:04:42.718 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:42.718 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 5554fad0-f1df-4a2d-b0aa-1c4c8f93cf27
2025-10-25 10:04:42.718 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:04:42.719 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:04:42.719 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 40
2025-10-25 10:04:42.719 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Generating summary
2025-10-25 10:04:42.719 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: summarize
2025-10-25 10:04:42.719 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:34:42.718557Z
2025-10-25 10:04:42.719 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f session=null payload={"updateType":"agent_progress","itineraryId":"it_c0322c0f-eb92-4ca6-af5d-8c7345b...(truncated)
2025-10-25 10:04:42.719 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:04:42.719 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:04:42.720 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 5554fad0-f1df-4a2d-b0aa-1c4c8f93cf27
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 60
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Generating changes
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: llm
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:34:42.720673600Z
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f session=null payload={"updateType":"agent_progress","itineraryId":"it_c0322c0f-eb92-4ca6-af5d-8c7345b...(truncated)
2025-10-25 10:04:42.722 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:04:42.723 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:04:43.664 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:04:43.664 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:04:43.664 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:04:43.664 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:04:43.664 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:04:43.664 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 8279
2025-10-25 10:04:43.664 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:04:43.664 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an expert travel itinerary editor.

You must respond with valid JSON that matches this exact schema:
{
  "type": "object",
  "properties": {
    "ops": {
      "type": "array",
      "descript...
2025-10-25 10:04:43.667 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 8878
2025-10-25 10:04:43.668 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:04:51.775 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:04:51.775 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:04:51.775 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Response Length: 1117
2025-10-25 10:04:51.775 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"ops\": [\n    {\n      \"op\": \"insert\",\n      \"id\": \"day3_node7\",\n      \"after\": \"day3_node4\",\n      \"startTime\": \"17:30\",\n      \"endTime\": \"18:30\",\n      \"node\": {\n        \"title\": \"Karaky Lokantas\",\n        \"type\": \"meal\",\n        \"location\": {\n          \"name\": \"Karaky Lokantas\",\n          \"address\": \"Karaky, Istanbul\"\n        }\n      }\n    }\n  ],\n  \"day\": 3,\n  \"reason\": \"Adding an additional restaurant on Day 3 as requested by the user.\",\n  \"agent\": \"EditorAgent\"\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 3009,
    "candidatesTokenCount": 180,
    "totalTokenCount": 4340,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 3009
      }
    ],
    "thoughtsTokenCount": 1151
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "Y1P8aL2zDrfAvr0Ph76qyQE"
}

2025-10-25 10:04:51.787 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-419805958_20251025_100451.json
2025-10-25 10:04:51.788 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:04:51.788 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Generated content length: 491
2025-10-25 10:04:51.788 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "ops": [
    {
      "op": "insert",
      "id": "day3_node7",
      "after": "day3_node4",
      "startTime": "17:30",
      "endTime": "18:30",
      "node": {
        "title": "Karaky Lokantas",
        "type": "meal",
        "location": {
          "name": "Karaky Lokantas",
   ...
2025-10-25 10:04:51.788 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:04:51.788 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === EDITOR AGENT - FULL LLM RESPONSE ===
2025-10-25 10:04:51.790 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - User Request: i want to visit one more restaurant on day 3
2025-10-25 10:04:51.790 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Raw Response: ```json
{
  "ops": [
    {
      "op": "insert",
      "id": "day3_node7",
      "after": "day3_node4",
      "startTime": "17:30",
      "endTime": "18:30",
      "node": {
        "title": "Karaky Lokantas",
        "type": "meal",
        "location": {
          "name": "Karaky Lokantas",
          "address": "Karaky, Istanbul"
        }
      }
    }
  ],
  "day": 3,
  "reason": "Adding an additional restaurant on Day 3 as requested by the user.",
  "agent": "EditorAgent"
}
```
2025-10-25 10:04:51.791 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === END EDITOR AGENT RESPONSE ===
2025-10-25 10:04:51.806 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Successfully generated ChangeSet with 1 operations
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 5554fad0-f1df-4a2d-b0aa-1c4c8f93cf27
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Applying changes
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: apply
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:34:51.807299500Z
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f session=null payload={"updateType":"agent_progress","itineraryId":"it_c0322c0f-eb92-4ca6-af5d-8c7345b...(truncated)
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:04:51.807 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChangeEngine - Applying changes for itinerary: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f (using provided object)
2025-10-25 10:04:51.814 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChangeEngine - Generated ID for new node: Karaky Lokantas -> day3_node7
2025-10-25 10:04:51.817 [http-nio-8080-exec-4] INFO  com.tripplanner.service.RevisionService - Saving revision rev_1761366891816_6b8005df for itinerary: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:52.247 [http-nio-8080-exec-4] INFO  com.tripplanner.service.RevisionService - Successfully saved revision rev_1761366891816_6b8005df for itinerary: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:53.792 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChangeEngine - Triggering auto-enrichment for 1 nodes in itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 5554fad0-f1df-4a2d-b0aa-1c4c8f93cf27
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Changes applied successfully
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: complete
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:34:53.796413500Z
2025-10-25 10:04:53.796 [AsyncTask-1] INFO  com.tripplanner.service.EnrichmentService - Starting async enrichment for 1 nodes in itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f session=null payload={"updateType":"agent_progress","itineraryId":"it_c0322c0f-eb92-4ca6-af5d-8c7345b...(truncated)
2025-10-25 10:04:53.796 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 5554fad0-f1df-4a2d-b0aa-1c4c8f93cf27
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: completed
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Agent completed successfully
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:34:53.797371200Z
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f session=null payload={"updateType":"agent_progress","itineraryId":"it_c0322c0f-eb92-4ca6-af5d-8c7345b...(truncated)
2025-10-25 10:04:53.797 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:04:53.798 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:04:53.798 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION COMPLETED ===
2025-10-25 10:04:53.798 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-25 10:04:53.798 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:53.798 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Result Type: ApplyResult
2025-10-25 10:04:53.798 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Result: com.tripplanner.service.ChangeEngine$ApplyResult@15ee6c16
2025-10-25 10:04:53.798 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - =================================
2025-10-25 10:04:53.802 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:04:53.806 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [ChatResponse{intent='Changes applied successfully', message='Your itinerary has been updated.', chan (truncated)...]
2025-10-25 10:04:53.809 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:04:53.809 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:04:53.817 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:04:53.817 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:04:53.817 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history", parameters={}
2025-10-25 10:04:53.817 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-25 10:04:53.818 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{intent=Changes applied successfully, message=Your itinerary has been updated., changeSet=null, diff (truncated)...]
2025-10-25 10:04:54.442 [AsyncTask-1] INFO  com.tripplanner.service.EnrichmentService - Enriching 1 out of 1 nodes (others already have coordinates)
2025-10-25 10:04:54.451 [AsyncTask-1] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Karak%25C3%25B6y%2520Lokantas%25C4%25B1&key=
2025-10-25 10:04:54.465 [AsyncTask-1] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:04:54.871 [AsyncTask-1] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:04:54.877 [AsyncTask-1] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:04:54.881 [AsyncTask-1] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:04:54.881 [AsyncTask-1] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 1
2025-10-25 10:04:54.881 [AsyncTask-1] WARN  com.tripplanner.service.EnrichmentService - No place found for node day3_node7 (Karaky Lokantas)
2025-10-25 10:04:54.881 [AsyncTask-1] INFO  com.tripplanner.service.EnrichmentService - Successfully enriched 0 out of 1 nodes in itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f (took 1085ms)
2025-10-25 10:04:56.104 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:04:56.106 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:04:56.106 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{applied=true, warnings=[], diff={added=[{nodeId=day3_node7, day=3, fields=null, title=Karaky Lokan (truncated)...]
2025-10-25 10:04:56.110 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-25 10:04:56.111 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:24.746 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=1fo445uv
2025-10-25 10:05:24.746 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=1fo445uv
2025-10-25 10:05:24.746 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=1fo445uv
2025-10-25 10:05:24.746 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=1fo445uv
2025-10-25 10:05:24.758 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:05:24.758 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:05:24.759 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:05:24.759 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json", parameters={}
2025-10-25 10:05:24.759 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:05:24.759 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history", parameters={}
2025-10-25 10:05:24.759 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:05:24.759 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:05:24.759 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:05:24.759 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:05:24.796 [http-nio-8080-exec-10] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=1fo445uv] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:05:24.796 [http-nio-8080-exec-10] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session 1fo445uv
2025-10-25 10:05:24.797 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=1fo445uv
2025-10-25 10:05:24.797 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=1fo445uv}], simpSessionId=1fo445uv}]
2025-10-25 10:05:25.759 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761366925757
2025-10-25 10:05:25.759 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761366925757
2025-10-25 10:05:25.759 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761366925757", parameters={masked}
2025-10-25 10:05:25.759 [http-nio-8080-exec-5] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:05:25.760 [http-nio-8080-exec-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761366925757
2025-10-25 10:05:25.760 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:05:25.760 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:25.764 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/852/0o3piqxm/websocket
2025-10-25 10:05:25.764 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/852/0o3piqxm/websocket
2025-10-25 10:05:25.764 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/852/0o3piqxm/websocket", parameters={}
2025-10-25 10:05:25.764 [http-nio-8080-exec-1] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:05:25.765 [http-nio-8080-exec-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/852/0o3piqxm/websocket
2025-10-25 10:05:25.765 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:25.766 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:05:25.766 [http-nio-8080-exec-1] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=0o3piqxm]
2025-10-25 10:05:25.768 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=0o3piqxm
2025-10-25 10:05:25.770 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-0 session=0o3piqxm
2025-10-25 10:05:25.770 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-1 session=0o3piqxm
2025-10-25 10:05:25.770 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-2 session=0o3piqxm
2025-10-25 10:05:26.805 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, status: completed
2025-10-25 10:05:26.806 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:05:26.811 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', version=3, userId='null', (truncated)...]
2025-10-25 10:05:26.820 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:05:26.820 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:28.531 [http-nio-8080-exec-6] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 4 chat messages for itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:05:28.531 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:05:28.531 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=F1MsR0O06lZPJgGhRook, message=my flight is on 4th day back to bangalore at 9 pm, sender=user, u (truncated)...]
2025-10-25 10:05:28.533 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:05:28.533 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:33.254 [MessageBroker-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [1fo445uv]
2025-10-25 10:05:33.450 [http-nio-8080-exec-4] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=0o3piqxm] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:05:33.450 [http-nio-8080-exec-4] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session 0o3piqxm
2025-10-25 10:05:33.450 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=0o3piqxm
2025-10-25 10:05:33.451 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=0o3piqxm}], simpSessionId=0o3piqxm}]
2025-10-25 10:05:35.836 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-25 10:05:35.836 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-25 10:05:35.836 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-25 10:05:35.836 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-25 10:05:35.837 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-25 10:05:35.837 [http-nio-8080-exec-9] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:05:36.243 [http-nio-8080-exec-9] INFO  com.tripplanner.service.UserDataService - Found 4 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:05:36.244 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Found 4 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:05:36.244 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:05:36.245 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, destination=Turkey, Turkey, startDate=2026 (truncated)...]
2025-10-25 10:05:36.245 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:05:36.245 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:38.374 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:05:38.374 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:05:38.374 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json", parameters={}
2025-10-25 10:05:38.375 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:05:38.375 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:05:38.375 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:05:40.287 [http-nio-8080-exec-8] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, status: completed
2025-10-25 10:05:40.288 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:05:40.289 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', version=3, userId='null', (truncated)...]
2025-10-25 10:05:40.292 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:05:40.292 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:40.326 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:05:40.326 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:05:40.326 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history
2025-10-25 10:05:40.326 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json
2025-10-25 10:05:40.326 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/chat/history", parameters={}
2025-10-25 10:05:40.326 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f/json", parameters={}
2025-10-25 10:05:40.326 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:05:40.327 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:05:40.327 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:05:40.327 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:05:41.397 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761366941395
2025-10-25 10:05:41.397 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761366941395
2025-10-25 10:05:41.397 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761366941395", parameters={masked}
2025-10-25 10:05:41.397 [http-nio-8080-exec-1] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:05:41.398 [http-nio-8080-exec-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761366941395
2025-10-25 10:05:41.398 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:05:41.398 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:41.401 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/785/eqsseevi/websocket
2025-10-25 10:05:41.401 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/785/eqsseevi/websocket
2025-10-25 10:05:41.401 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/785/eqsseevi/websocket", parameters={}
2025-10-25 10:05:41.401 [http-nio-8080-exec-2] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@731e0bff
2025-10-25 10:05:41.401 [http-nio-8080-exec-2] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/785/eqsseevi/websocket
2025-10-25 10:05:41.401 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:41.402 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:05:41.402 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=eqsseevi]
2025-10-25 10:05:41.405 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=eqsseevi
2025-10-25 10:05:41.407 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-0 session=eqsseevi
2025-10-25 10:05:41.407 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-1 session=eqsseevi
2025-10-25 10:05:41.407 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f id=sub-2 session=eqsseevi
2025-10-25 10:05:42.041 [http-nio-8080-exec-5] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 4 chat messages for itinerary it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f
2025-10-25 10:05:42.041 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:05:42.041 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=F1MsR0O06lZPJgGhRook, message=my flight is on 4th day back to bangalore at 9 pm, sender=user, u (truncated)...]
2025-10-25 10:05:42.042 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:05:42.042 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:43.253 [MessageBroker-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [0o3piqxm]
2025-10-25 10:05:43.435 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f, status: completed
2025-10-25 10:05:43.437 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:05:43.439 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_c0322c0f-eb92-4ca6-af5d-8c7345b2531f', version=3, userId='null', (truncated)...]
2025-10-25 10:05:43.445 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:05:43.445 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:05:59.845 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=eqsseevi
2025-10-25 10:05:59.845 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=eqsseevi
2025-10-25 10:05:59.845 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=eqsseevi
2025-10-25 10:05:59.845 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=eqsseevi
2025-10-25 10:05:59.897 [http-nio-8080-exec-4] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=eqsseevi] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:05:59.897 [http-nio-8080-exec-4] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session eqsseevi
2025-10-25 10:05:59.897 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=eqsseevi
2025-10-25 10:05:59.898 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=eqsseevi}], simpSessionId=eqsseevi}]
2025-10-25 10:06:08.240 [MessageBroker-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [eqsseevi]
2025-10-25 10:06:21.171 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries
2025-10-25 10:06:21.171 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries
2025-10-25 10:06:21.171 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries", parameters={}
2025-10-25 10:06:21.171 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#create(CreateItineraryReq, HttpServletRequest)
2025-10-25 10:06:21.193 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateItineraryReq(destination=Scotland, Scotland, United Kingdom, startLocation=Bengaluru, India, s (truncated)...]
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Creating itinerary with real-time updates
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Request: CreateItineraryReq(destination=Scotland, Scotland, United Kingdom, startLocation=Bengaluru, India, startDate=2026-01-24, endDate=2026-01-27, party=PartyDto(adults=1, children=0, infants=0, rooms=1), budgetTier=luxury, interests=[relaxation, nature, cuisine], constraints=[budgetFriendly], language=en)
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - === CREATE ITINERARY REQUEST ===
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Request Details:
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService -   Destination: Scotland, Scotland, United Kingdom
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService -   Start Date: 2026-01-24
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService -   End Date: 2026-01-27
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService -   Duration: 4 days
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService -   Budget Tier: luxury
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService -   Language: en
2025-10-25 10:06:21.239 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService -   Party: 1 adults, 0 children, 0 infants, 1 rooms
2025-10-25 10:06:21.240 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService -   Interests: relaxation, nature, cuisine
2025-10-25 10:06:21.240 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService -   Constraints: budgetFriendly
2025-10-25 10:06:21.240 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Creating initial itinerary and establishing ownership synchronously
2025-10-25 10:06:21.240 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - === ITINERARY INITIALIZATION SERVICE: CREATING INITIAL ITINERARY ===
2025-10-25 10:06:21.240 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:21.240 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - Destination: Scotland, Scotland, United Kingdom
2025-10-25 10:06:21.240 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:06:21.240 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - Step 1: Creating initial itinerary structure
2025-10-25 10:06:21.240 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - Step 2: Saving initial itinerary to ItineraryJsonService
2025-10-25 10:06:21.605 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - Step 3: Establishing ownership by saving trip metadata
2025-10-25 10:06:21.606 [http-nio-8080-exec-9] INFO  com.tripplanner.service.UserDataService - Saving trip metadata it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:06:23.119 [http-nio-8080-exec-9] INFO  com.tripplanner.service.UserDataService - Successfully saved trip metadata it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:06:23.120 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - === INITIAL ITINERARY CREATED AND OWNERSHIP ESTABLISHED ===
2025-10-25 10:06:23.120 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:23.120 [http-nio-8080-exec-9] INFO  c.t.service.ItineraryInitializationService - User can now access /itineraries/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1/json endpoint
2025-10-25 10:06:23.120 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Waiting 2 seconds for frontend SSE connection to establish...
2025-10-25 10:06:25.128 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Starting async itinerary generation for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1 with ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:25.128 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Starting pipeline generation
2025-10-25 10:06:25.128 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Generated executionId: exec_1761366985128 for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:25.130 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - === CREATE ITINERARY RESPONSE ===
2025-10-25 10:06:25.130 [AsyncTask-2] INFO  com.tripplanner.service.PipelineOrchestrator - === PIPELINE ORCHESTRATOR: STARTING ===
2025-10-25 10:06:25.130 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:06:25.130 [AsyncTask-2] INFO  com.tripplanner.service.PipelineOrchestrator - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:25.130 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:25.130 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - ExecutionId: exec_1761366985128
2025-10-25 10:06:25.130 [AsyncTask-2] INFO  com.tripplanner.service.PipelineOrchestrator - Destination: Scotland, Scotland, United Kingdom, Duration: 4 days
2025-10-25 10:06:25.130 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Status: generating
2025-10-25 10:06:25.131 [AsyncTask-2] INFO  com.tripplanner.service.PipelineOrchestrator - Parallel: true
2025-10-25 10:06:25.131 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Ownership established: YES
2025-10-25 10:06:25.131 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Async generation started: YES
2025-10-25 10:06:25.131 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Async callbacks attached: YES
2025-10-25 10:06:25.131 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - Error handling enabled: YES
2025-10-25 10:06:25.131 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - User can now access /itineraries/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1/json
2025-10-25 10:06:25.131 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ItineraryService - =====================================
2025-10-25 10:06:25.133 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 1: SKELETON GENERATION ===
2025-10-25 10:06:25.133 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase skeleton started: Creating day structure...
2025-10-25 10:06:25.133 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:06:25.133 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Starting skeleton generation with timeout: 120000 ms
2025-10-25 10:06:25.133 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Request details: destination=Scotland, Scotland, United Kingdom, duration=4 days
2025-10-25 10:06:25.134 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Enhanced itinerary creation response prepared: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:06:25.134 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Execution ID: exec_6e028c42-1102-4676-a239-d320ed6ecaba
2025-10-25 10:06:25.134 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Real-time updates will be sent via WebSocket
2025-10-25 10:06:25.134 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Estimated completion: 2025-10-25T10:07:24.131519300
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.PipelineOrchestrator - SkeletonPlannerAgent.generateSkeleton() started for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT ===
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating lightweight skeleton for 4 days
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Destination: Scotland, Scotland, United Kingdom
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f9224537-9f61-4b9a-9ee6-e64ac96e1c65
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 1 structure
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-25 10:06:25.135 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:36:25.135520300Z
2025-10-25 10:06:25.136 [Pipeline-100] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 1 with minimal prompt
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2955
2025-10-25 10:06:25.136 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:06:25.137 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-25 10:06:25.137 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3369
2025-10-25 10:06:25.137 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:06:25.140 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:06:25.140 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [ItineraryCreationResponse{itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, executionId='exec_6e028 (truncated)...]
2025-10-25 10:06:25.144 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:06:25.144 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:06:25.165 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1/json
2025-10-25 10:06:25.168 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1/json
2025-10-25 10:06:25.169 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1/json
2025-10-25 10:06:25.169 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1/json", parameters={}
2025-10-25 10:06:25.169 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:06:25.169 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:25.169 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:06:25.172 [http-nio-8080-exec-2] WARN  c.t.config.FirebaseAuthConfig$FirebaseAuthFilter - Missing or invalid Authorization header for path: /api/v1/agents/events/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:26.875 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, status: planning
2025-10-25 10:06:26.876 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:06:26.876 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1', version=1, userId='PEoULm (truncated)...]
2025-10-25 10:06:26.878 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:06:26.878 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:06:35.201 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:06:35.201 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:06:35.201 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Length: 2940
2025-10-25 10:06:35.201 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 1,\n  \"date\": \"2026-01-24\",\n  \"location\": \"Scotland, United Kingdom\",\n  \"summary\": \"Arrival and initial exploration of the destination.\",\n  \"nodes\": [\n    {\n      \"id\": \"day1_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Accommodation Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day1_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Activity\",\n      \"location\": {\n        \"name\": \"Local Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day1_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Local Eatery\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day1_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Exploration\",\n      \"location\": {\n        \"name\": \"Nature Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:00\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day1_node5\",\n      \"type\": \"transport\",\n      \"title\": \"Return to Accommodation Area\",\n      \"location\": {\n        \"name\": \"Local Roads\"\n      },\n      \"timing\": {\n        \"startTime\": \"17:00\",\n        \"endTime\": \"17:30\",\n        \"durationMin\": 30\n      }\n    },\n    {\n      \"id\": \"day1_node6\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner\",\n      \"location\": {\n        \"name\": \"Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"20:30\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day1_node7\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Hotel/Lodge\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:00\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 660\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 841,
    "candidatesTokenCount": 742,
    "totalTokenCount": 2462,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 841
      }
    ],
    "thoughtsTokenCount": 879
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "0lP8aPzWAcS01e8PyLyniQM"
}

2025-10-25 10:06:35.206 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-1730011522_20251025_100635.json
2025-10-25 10:06:35.207 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:06:35.208 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content length: 2066
2025-10-25 10:06:35.208 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 1,
  "date": "2026-01-24",
  "location": "Scotland, United Kingdom",
  "summary": "Arrival and initial exploration of the destination.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accomm...
2025-10-25 10:06:35.208 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:06:35.208 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:06:35.208 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-25 10:06:35.208 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 1
2025-10-25 10:06:35.209 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 1,
  "date": "2026-01-24",
  "location": "Scotland, United Kingdom",
  "summary": "Arrival and initial exploration of the destination.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node2",
      "type": "attraction",
      "title": "Morning Activity",
      "location": {
        "name": "Local Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day1_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node4",
      "type": "attraction",
      "title": "Afternoon Exploration",
      "location": {
        "name": "Nature Spot"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day1_node5",
      "type": "transport",
      "title": "Return to Accommodation Area",
      "location": {
        "name": "Local Roads"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "17:30",
        "durationMin": 30
      }
    },
    {
      "id": "day1_node6",
      "type": "meal",
      "title": "Dinner",
      "location": {
        "name": "Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day1_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel/Lodge"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
```
2025-10-25 10:06:35.209 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-25 10:06:35.213 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 1,
  "date": "2026-01-24",
  "location": "Scotland, United Kingdom",
  "summary": "Arrival and initial exploration of the destination.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node2",
      "type": "attraction",
      "title": "Morning Activity",
      "location": {
        "name": "Local Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day1_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node4",
      "type": "attraction",
      "title": "Afternoon Exploration",
      "location": {
        "name": "Nature Spot"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day1_node5",
      "type": "transport",
      "title": "Return to Accommodation Area",
      "location": {
        "name": "Local Roads"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "17:30",
        "durationMin": 30
      }
    },
    {
      "id": "day1_node6",
      "type": "meal",
      "title": "Dinner",
      "location": {
        "name": "Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day1_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel/Lodge"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
2025-10-25 10:06:35.646 [Pipeline-100] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"day_completed","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6c...(truncated)
2025-10-25 10:06:35.646 [Pipeline-100] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, day=1, activities=7
2025-10-25 10:06:35.646 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 1 created and saved
2025-10-25 10:06:35.646 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:06:35.646 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:35.647 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f9224537-9f61-4b9a-9ee6-e64ac96e1c65
2025-10-25 10:06:35.647 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:06:35.647 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:06:35.647 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Progress: 35
2025-10-25 10:06:35.647 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 2 structure
2025-10-25 10:06:35.647 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-25 10:06:35.647 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:36:35.646338100Z
2025-10-25 10:06:35.647 [Pipeline-100] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:06:35.647 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 2 with minimal prompt
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2955
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:06:35.648 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-25 10:06:35.649 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3369
2025-10-25 10:06:35.649 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:06:43.504 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:06:43.505 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:06:43.505 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Length: 3046
2025-10-25 10:06:43.505 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 2,\n  \"date\": \"2026-01-25\",\n  \"location\": \"Scotland, Scotland, United Kingdom\",\n  \"summary\": \"A day focused on relaxation and nature, with opportunities to experience local cuisine.\",\n  \"nodes\": [\n    {\n      \"id\": \"day2_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Breakfast Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day2_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Nature Experience\",\n      \"location\": {\n        \"name\": \"Nature Area Placeholder\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day2_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch\",\n      \"location\": {\n        \"name\": \"Lunch Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day2_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Relaxation Activity\",\n      \"location\": {\n        \"name\": \"Relaxation Place Placeholder\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:00\",\n        \"endTime\": \"16:30\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day2_node5\",\n      \"type\": \"transport\",\n      \"title\": \"Travel to Dinner Area\",\n      \"location\": {\n        \"name\": \"Transport Route Placeholder\"\n      },\n      \"timing\": {\n        \"startTime\": \"16:30\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 30\n      }\n    },\n    {\n      \"id\": \"day2_node6\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner\",\n      \"location\": {\n        \"name\": \"Dinner Venue\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"20:30\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day2_node7\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Accommodation Placeholder\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:00\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 660\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 841,
    "candidatesTokenCount": 754,
    "totalTokenCount": 2153,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 841
      }
    ],
    "thoughtsTokenCount": 558
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "2lP8aPvRFrfd1e8PsMSz4AI"
}

2025-10-25 10:06:43.513 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-5229958_20251025_100643.json
2025-10-25 10:06:43.514 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:06:43.515 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content length: 2172
2025-10-25 10:06:43.515 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 2,
  "date": "2026-01-25",
  "location": "Scotland, Scotland, United Kingdom",
  "summary": "A day focused on relaxation and nature, with opportunities to experience local cuisine.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast...
2025-10-25 10:06:43.515 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:06:43.515 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:06:43.515 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-25 10:06:43.516 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 2
2025-10-25 10:06:43.516 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 2,
  "date": "2026-01-25",
  "location": "Scotland, Scotland, United Kingdom",
  "summary": "A day focused on relaxation and nature, with opportunities to experience local cuisine.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Breakfast Spot"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node2",
      "type": "attraction",
      "title": "Morning Nature Experience",
      "location": {
        "name": "Nature Area Placeholder"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day2_node3",
      "type": "meal",
      "title": "Lunch",
      "location": {
        "name": "Lunch Spot"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation Activity",
      "location": {
        "name": "Relaxation Place Placeholder"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "16:30",
        "durationMin": 150
      }
    },
    {
      "id": "day2_node5",
      "type": "transport",
      "title": "Travel to Dinner Area",
      "location": {
        "name": "Transport Route Placeholder"
      },
      "timing": {
        "startTime": "16:30",
        "endTime": "17:00",
        "durationMin": 30
      }
    },
    {
      "id": "day2_node6",
      "type": "meal",
      "title": "Dinner",
      "location": {
        "name": "Dinner Venue"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day2_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Accommodation Placeholder"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
```
2025-10-25 10:06:43.516 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-25 10:06:43.523 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 2,
  "date": "2026-01-25",
  "location": "Scotland, Scotland, United Kingdom",
  "summary": "A day focused on relaxation and nature, with opportunities to experience local cuisine.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Breakfast Spot"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node2",
      "type": "attraction",
      "title": "Morning Nature Experience",
      "location": {
        "name": "Nature Area Placeholder"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day2_node3",
      "type": "meal",
      "title": "Lunch",
      "location": {
        "name": "Lunch Spot"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation Activity",
      "location": {
        "name": "Relaxation Place Placeholder"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "16:30",
        "durationMin": 150
      }
    },
    {
      "id": "day2_node5",
      "type": "transport",
      "title": "Travel to Dinner Area",
      "location": {
        "name": "Transport Route Placeholder"
      },
      "timing": {
        "startTime": "16:30",
        "endTime": "17:00",
        "durationMin": 30
      }
    },
    {
      "id": "day2_node6",
      "type": "meal",
      "title": "Dinner",
      "location": {
        "name": "Dinner Venue"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day2_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Accommodation Placeholder"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
2025-10-25 10:06:45.360 [Pipeline-100] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"day_completed","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6c...(truncated)
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, day=2, activities=7
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 2 created and saved
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f9224537-9f61-4b9a-9ee6-e64ac96e1c65
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Progress: 50
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 3 structure
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:36:45.360567500Z
2025-10-25 10:06:45.360 [Pipeline-100] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 3 with minimal prompt
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:06:45.360 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:06:45.361 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:06:45.361 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:06:45.361 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:06:45.361 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2955
2025-10-25 10:06:45.361 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:06:45.361 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-25 10:06:45.361 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3369
2025-10-25 10:06:45.361 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:06:56.771 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:06:56.771 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:06:56.771 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Length: 3088
2025-10-25 10:06:56.771 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 3,\n  \"date\": \"2026-01-26\",\n  \"location\": \"Scotland, United Kingdom\",\n  \"summary\": \"A day focused on relaxation, enjoying natural landscapes, and savoring local cuisine in Scotland.\",\n  \"nodes\": [\n    {\n      \"id\": \"day3_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Accommodation Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day3_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Nature Exploration\",\n      \"location\": {\n        \"name\": \"Scenic Natural Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day3_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Local Eatery\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day3_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Relaxation or Culinary Discovery\",\n      \"location\": {\n        \"name\": \"Relaxation Spot or Food Experience Venue\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:30\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day3_node5\",\n      \"type\": \"transport\",\n      \"title\": \"Transfer to Dinner Location\",\n      \"location\": {\n        \"name\": \"Between Areas\"\n      },\n      \"timing\": {\n        \"startTime\": \"17:00\",\n        \"endTime\": \"17:30\",\n        \"durationMin\": 30\n      }\n    },\n    {\n      \"id\": \"day3_node6\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner Experience\",\n      \"location\": {\n        \"name\": \"Fine Dining Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"18:30\",\n        \"endTime\": \"20:30\",\n        \"durationMin\": 120\n      }\n    },\n    {\n      \"id\": \"day3_node7\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Luxury Hotel/Lodge\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:00\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 660\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 841,
    "candidatesTokenCount": 767,
    "totalTokenCount": 2840,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 841
      }
    ],
    "thoughtsTokenCount": 1232
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "3FP8aJTnMa6C1e8PhNuR-Qs"
}

2025-10-25 10:06:56.773 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_1719551606_20251025_100656.json
2025-10-25 10:06:56.774 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:06:56.774 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content length: 2213
2025-10-25 10:06:56.774 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 3,
  "date": "2026-01-26",
  "location": "Scotland, United Kingdom",
  "summary": "A day focused on relaxation, enjoying natural landscapes, and savoring local cuisine in Scotland.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast...
2025-10-25 10:06:56.774 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:06:56.774 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:06:56.774 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-25 10:06:56.774 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 3
2025-10-25 10:06:56.774 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 3,
  "date": "2026-01-26",
  "location": "Scotland, United Kingdom",
  "summary": "A day focused on relaxation, enjoying natural landscapes, and savoring local cuisine in Scotland.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node2",
      "type": "attraction",
      "title": "Morning Nature Exploration",
      "location": {
        "name": "Scenic Natural Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation or Culinary Discovery",
      "location": {
        "name": "Relaxation Spot or Food Experience Venue"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node5",
      "type": "transport",
      "title": "Transfer to Dinner Location",
      "location": {
        "name": "Between Areas"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "17:30",
        "durationMin": 30
      }
    },
    {
      "id": "day3_node6",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Fine Dining Restaurant"
      },
      "timing": {
        "startTime": "18:30",
        "endTime": "20:30",
        "durationMin": 120
      }
    },
    {
      "id": "day3_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel/Lodge"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
```
2025-10-25 10:06:56.775 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-25 10:06:56.778 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 3,
  "date": "2026-01-26",
  "location": "Scotland, United Kingdom",
  "summary": "A day focused on relaxation, enjoying natural landscapes, and savoring local cuisine in Scotland.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node2",
      "type": "attraction",
      "title": "Morning Nature Exploration",
      "location": {
        "name": "Scenic Natural Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation or Culinary Discovery",
      "location": {
        "name": "Relaxation Spot or Food Experience Venue"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node5",
      "type": "transport",
      "title": "Transfer to Dinner Location",
      "location": {
        "name": "Between Areas"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "17:30",
        "durationMin": 30
      }
    },
    {
      "id": "day3_node6",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Fine Dining Restaurant"
      },
      "timing": {
        "startTime": "18:30",
        "endTime": "20:30",
        "durationMin": 120
      }
    },
    {
      "id": "day3_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel/Lodge"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
2025-10-25 10:06:58.601 [Pipeline-100] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"day_completed","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6c...(truncated)
2025-10-25 10:06:58.602 [Pipeline-100] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, day=3, activities=7
2025-10-25 10:06:58.602 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 3 created and saved
2025-10-25 10:06:58.602 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:06:58.602 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:06:58.602 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f9224537-9f61-4b9a-9ee6-e64ac96e1c65
2025-10-25 10:06:58.602 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:06:58.602 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:06:58.603 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Progress: 65
2025-10-25 10:06:58.603 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 4 structure
2025-10-25 10:06:58.603 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-25 10:06:58.603 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:36:58.602922700Z
2025-10-25 10:06:58.606 [Pipeline-100] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 4 with minimal prompt
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2955
2025-10-25 10:06:58.607 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:06:58.608 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-25 10:06:58.608 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3369
2025-10-25 10:06:58.608 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:07:07.574 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:07:07.575 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:07:07.575 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Length: 2655
2025-10-25 10:07:07.575 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 4,\n  \"date\": \"2026-01-27\",\n  \"location\": \"Scotland, United Kingdom\",\n  \"summary\": \"Day focusing on relaxation and nature experiences.\",\n  \"nodes\": [\n    {\n      \"id\": \"day4_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Accommodation Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day4_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Nature Walk/Relaxation\",\n      \"location\": {\n        \"name\": \"Natural Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day4_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Local Eatery\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day4_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Scenic Viewpoint/Activity\",\n      \"location\": {\n        \"name\": \"Scenic Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:00\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day4_node5\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner Experience\",\n      \"location\": {\n        \"name\": \"Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"20:30\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day4_node6\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Hotel/Lodge\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:00\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 660\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 841,
    "candidatesTokenCount": 654,
    "totalTokenCount": 2362,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 841
      }
    ],
    "thoughtsTokenCount": 867
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "8lP8aP2AGKSgvr0PnZCkgQk"
}

2025-10-25 10:07:07.580 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-850634126_20251025_100707.json
2025-10-25 10:07:07.582 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:07:07.582 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1824
2025-10-25 10:07:07.582 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 4,
  "date": "2026-01-27",
  "location": "Scotland, United Kingdom",
  "summary": "Day focusing on relaxation and nature experiences.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommo...
2025-10-25 10:07:07.583 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:07:07.583 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:07:07.583 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-25 10:07:07.583 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 4
2025-10-25 10:07:07.583 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 4,
  "date": "2026-01-27",
  "location": "Scotland, United Kingdom",
  "summary": "Day focusing on relaxation and nature experiences.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node2",
      "type": "attraction",
      "title": "Morning Nature Walk/Relaxation",
      "location": {
        "name": "Natural Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day4_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node4",
      "type": "attraction",
      "title": "Afternoon Scenic Viewpoint/Activity",
      "location": {
        "name": "Scenic Spot"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day4_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day4_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel/Lodge"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
```
2025-10-25 10:07:07.583 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-25 10:07:07.588 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 4,
  "date": "2026-01-27",
  "location": "Scotland, United Kingdom",
  "summary": "Day focusing on relaxation and nature experiences.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Accommodation Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node2",
      "type": "attraction",
      "title": "Morning Nature Walk/Relaxation",
      "location": {
        "name": "Natural Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day4_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Local Eatery"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node4",
      "type": "attraction",
      "title": "Afternoon Scenic Viewpoint/Activity",
      "location": {
        "name": "Scenic Spot"
      },
      "timing": {
        "startTime": "14:00",
        "endTime": "17:00",
        "durationMin": 180
      }
    },
    {
      "id": "day4_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day4_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel/Lodge"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
2025-10-25 10:07:08.118 [Pipeline-100] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"day_completed","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6c...(truncated)
2025-10-25 10:07:08.119 [Pipeline-100] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, day=4, activities=6
2025-10-25 10:07:08.119 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 4 created and saved
2025-10-25 10:07:08.119 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:07:08.119 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:08.119 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent ID: f9224537-9f61-4b9a-9ee6-e64ac96e1c65
2025-10-25 10:07:08.119 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:07:08.120 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:07:08.120 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-25 10:07:08.120 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Message: Skeleton complete
2025-10-25 10:07:08.120 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_complete
2025-10-25 10:07:08.120 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:37:08.119574100Z
2025-10-25 10:07:08.121 [Pipeline-100] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:08.121 [Pipeline-100] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:07:09.485 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON COMPLETE ===
2025-10-25 10:07:09.485 [Pipeline-100] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generated 4 days with 27 total node placeholders
2025-10-25 10:07:09.485 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Skeleton generation completed successfully for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:09.485 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 1 complete: 4 days created (44354 ms)
2025-10-25 10:07:09.485 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase skeleton completed in 44354 ms
2025-10-25 10:07:09.485 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:09.485 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 2: POPULATION ===
2025-10-25 10:07:09.485 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase population started: Populating node details...
2025-10-25 10:07:09.487 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:09.488 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"phase_transition","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738...(truncated)
2025-10-25 10:07:09.488 [Pipeline-99] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, skeletonpopulation, progress=40%
2025-10-25 10:07:09.488 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Running population agents in PARALLEL
2025-10-25 10:07:09.489 [Pipeline-103] INFO  com.tripplanner.service.PipelineOrchestrator - [ActivityAgent] Starting...
2025-10-25 10:07:09.489 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT ===
2025-10-25 10:07:09.489 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - Populating attraction nodes for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:09.489 [Pipeline-100] INFO  com.tripplanner.service.PipelineOrchestrator - [TransportAgent] Starting...
2025-10-25 10:07:09.489 [Pipeline-104] INFO  com.tripplanner.service.PipelineOrchestrator - [MealAgent] Starting...
2025-10-25 10:07:09.489 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT ===
2025-10-25 10:07:09.489 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT ===
2025-10-25 10:07:09.489 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - Populating transport nodes for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:09.489 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - Populating meal nodes for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - Found 8 attraction nodes to populate
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - Found 3 transport nodes to populate
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - Found 12 meal nodes to populate
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - Calling AI to populate 3 transport segments
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - Calling AI to populate 8 attractions
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - Calling AI to populate 12 meals
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2659
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel expert specializing in attractions and activities.

Your task: Suggest SPECIFIC attractions for placeholder activity nodes.

CRITICAL: Use the EXACT node IDs provided in the user prom...
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 3127
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2270
2025-10-25 10:07:09.490 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a culinary travel expert specializing in dining recommendations.

Your task: Suggest SPECIFIC restaurants and dining places for meal slots.

CRITICAL: Use the EXACT node IDs provided in the us...
2025-10-25 10:07:09.490 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2974
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:07:09.490 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a transportation and logistics expert for travel planning.

Your task: Suggest SPECIFIC transport modes and routes for getting around.

Guidelines:
1. Suggest practical transport modes based o...
2025-10-25 10:07:09.491 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:07:09.491 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3461
2025-10-25 10:07:09.491 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:07:09.491 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2581
2025-10-25 10:07:09.491 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:07:21.374 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:07:21.374 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:07:21.374 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Response Length: 4286
2025-10-25 10:07:21.374 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"attractions\": [\n    {\n      \"nodeId\": \"day1_node2\",\n      \"title\": \"Royal Botanic Garden Edinburgh\",\n      \"description\": \"Escape into a world of diverse flora at one of the world's leading botanic gardens. Wander through stunning glasshouses, explore themed gardens, and enjoy the peaceful atmosphere right in the heart of the city.\",\n      \"category\": \"park\",\n      \"durationMinutes\": 150,\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day1_node4\",\n      \"title\": \"Traditional Scottish Pub Experience\",\n      \"description\": \"Immerse yourself in Scottish culture with an evening at a traditional pub. Enjoy hearty local cuisine, sample a wide selection of whiskies or local ales, and perhaps catch some live folk music.\",\n      \"category\": \"experience\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"Edinburgh (e.g., The World's End Pub)\"\n    },\n    {\n      \"nodeId\": \"day2_node2\",\n      \"title\": \"Edinburgh Castle\",\n      \"description\": \"Perched atop an extinct volcanic rock, Edinburgh Castle is Scotland's most iconic landmark. Explore centuries of Scottish history, from royal residences to military strongholds, and enjoy panoramic views of the city.\",\n      \"category\": \"landmark\",\n      \"durationMinutes\": 210,\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day2_node4\",\n      \"title\": \"Holyrood Park and Arthur's Seat\",\n      \"description\": \"Discover a unique natural landscape within the city at Holyrood Park. Take a refreshing hike up Arthur's Seat, an ancient volcano, for breathtaking 360-degree views of Edinburgh and beyond.\",\n      \"category\": \"nature\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day3_node2\",\n      \"title\": \"Loch Lomond & The Trossachs National Park\",\n      \"description\": \"Embark on a scenic journey into Scotland's first National Park. Enjoy the stunning landscapes of lochs, glens, and mountains, perhaps taking a relaxing boat cruise on Loch Lomond or a gentle walk along its shores.\",\n      \"category\": \"nature\",\n      \"durationMinutes\": 240,\n      \"locationName\": \"Loch Lomond\"\n    },\n    {\n      \"nodeId\": \"day3_node4\",\n      \"title\": \"Glengoyne Distillery Tour & Tasting\",\n      \"description\": \"Unwind with a fascinating tour of the Glengoyne Distillery, known for its unpeated single malt whisky. Learn about the traditional distillation process, explore the grounds, and indulge in a guided tasting of their exquisite spirits.\",\n      \"category\": \"experience\",\n      \"durationMinutes\": 120,\n      \"locationName\": \"Killearn, near Loch Lomond\"\n    },\n    {\n      \"nodeId\": \"day4_node2\",\n      \"title\": \"Kelvingrove Art Gallery and Museum\",\n      \"description\": \"Spend a captivating morning at one of Scotland's most beloved museums, housing an astonishing collection of art and natural history. From Salvador Dal's 'Christ of St John of the Cross' to a full-sized Asian elephant, there's something for everyone.\",\n      \"category\": \"museum\",\n      \"durationMinutes\": 210,\n      \"locationName\": \"Glasgow\"\n    },\n    {\n      \"nodeId\": \"day4_node4\",\n      \"title\": \"Glasgow Botanic Gardens and Kibble Palace\",\n      \"description\": \"Find tranquility in the beautiful Glasgow Botanic Gardens, a green oasis in the city. Explore the magnificent Kibble Palace, a stunning Victorian glasshouse filled with exotic plants from around the world.\",\n      \"category\": \"park\",\n      \"durationMinutes\": 150,\n      \"locationName\": \"Glasgow\"\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 788,
    "candidatesTokenCount": 911,
    "totalTokenCount": 2725,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 788
      }
    ],
    "thoughtsTokenCount": 1026
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "AFT8aJOyDvu-vr0P5NOW8As"
}

2025-10-25 10:07:21.381 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-1272896087_20251025_100721.json
2025-10-25 10:07:21.383 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:07:21.384 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Generated content length: 3490
2025-10-25 10:07:21.384 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Royal Botanic Garden Edinburgh",
      "description": "Escape into a world of diverse flora at one of the world's leading botanic gardens. Wander through stunning glasshouses, explore themed gardens, and enjoy the peace...
2025-10-25 10:07:21.384 [Pipeline-103] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:07:21.384 [Pipeline-103] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:07:21.386 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT - FULL LLM RESPONSE ===
2025-10-25 10:07:21.386 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - Contexts to populate: 8
2025-10-25 10:07:21.386 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - Raw Response: ```json
{
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Royal Botanic Garden Edinburgh",
      "description": "Escape into a world of diverse flora at one of the world's leading botanic gardens. Wander through stunning glasshouses, explore themed gardens, and enjoy the peaceful atmosphere right in the heart of the city.",
      "category": "park",
      "durationMinutes": 150,
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day1_node4",
      "title": "Traditional Scottish Pub Experience",
      "description": "Immerse yourself in Scottish culture with an evening at a traditional pub. Enjoy hearty local cuisine, sample a wide selection of whiskies or local ales, and perhaps catch some live folk music.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "Edinburgh (e.g., The World's End Pub)"
    },
    {
      "nodeId": "day2_node2",
      "title": "Edinburgh Castle",
      "description": "Perched atop an extinct volcanic rock, Edinburgh Castle is Scotland's most iconic landmark. Explore centuries of Scottish history, from royal residences to military strongholds, and enjoy panoramic views of the city.",
      "category": "landmark",
      "durationMinutes": 210,
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day2_node4",
      "title": "Holyrood Park and Arthur's Seat",
      "description": "Discover a unique natural landscape within the city at Holyrood Park. Take a refreshing hike up Arthur's Seat, an ancient volcano, for breathtaking 360-degree views of Edinburgh and beyond.",
      "category": "nature",
      "durationMinutes": 180,
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day3_node2",
      "title": "Loch Lomond & The Trossachs National Park",
      "description": "Embark on a scenic journey into Scotland's first National Park. Enjoy the stunning landscapes of lochs, glens, and mountains, perhaps taking a relaxing boat cruise on Loch Lomond or a gentle walk along its shores.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Loch Lomond"
    },
    {
      "nodeId": "day3_node4",
      "title": "Glengoyne Distillery Tour & Tasting",
      "description": "Unwind with a fascinating tour of the Glengoyne Distillery, known for its unpeated single malt whisky. Learn about the traditional distillation process, explore the grounds, and indulge in a guided tasting of their exquisite spirits.",
      "category": "experience",
      "durationMinutes": 120,
      "locationName": "Killearn, near Loch Lomond"
    },
    {
      "nodeId": "day4_node2",
      "title": "Kelvingrove Art Gallery and Museum",
      "description": "Spend a captivating morning at one of Scotland's most beloved museums, housing an astonishing collection of art and natural history. From Salvador Dal's 'Christ of St John of the Cross' to a full-sized Asian elephant, there's something for everyone.",
      "category": "museum",
      "durationMinutes": 210,
      "locationName": "Glasgow"
    },
    {
      "nodeId": "day4_node4",
      "title": "Glasgow Botanic Gardens and Kibble Palace",
      "description": "Find tranquility in the beautiful Glasgow Botanic Gardens, a green oasis in the city. Explore the magnificent Kibble Palace, a stunning Victorian glasshouse filled with exotic plants from around the world.",
      "category": "park",
      "durationMinutes": 150,
      "locationName": "Glasgow"
    }
  ]
}
```
2025-10-25 10:07:21.386 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - === END ACTIVITY AGENT RESPONSE ===
2025-10-25 10:07:21.386 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - Cleaned Response: {
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Royal Botanic Garden Edinburgh",
      "description": "Escape into a world of diverse flora at one of the world's leading botanic gardens. Wander through stunning glasshouses, explore themed gardens, and enjoy the peaceful atmosphere right in the heart of the city.",
      "category": "park",
      "durationMinutes": 150,
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day1_node4",
      "title": "Traditional Scottish Pub Experience",
      "description": "Immerse yourself in Scottish culture with an evening at a traditional pub. Enjoy hearty local cuisine, sample a wide selection of whiskies or local ales, and perhaps catch some live folk music.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "Edinburgh (e.g., The World's End Pub)"
    },
    {
      "nodeId": "day2_node2",
      "title": "Edinburgh Castle",
      "description": "Perched atop an extinct volcanic rock, Edinburgh Castle is Scotland's most iconic landmark. Explore centuries of Scottish history, from royal residences to military strongholds, and enjoy panoramic views of the city.",
      "category": "landmark",
      "durationMinutes": 210,
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day2_node4",
      "title": "Holyrood Park and Arthur's Seat",
      "description": "Discover a unique natural landscape within the city at Holyrood Park. Take a refreshing hike up Arthur's Seat, an ancient volcano, for breathtaking 360-degree views of Edinburgh and beyond.",
      "category": "nature",
      "durationMinutes": 180,
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day3_node2",
      "title": "Loch Lomond & The Trossachs National Park",
      "description": "Embark on a scenic journey into Scotland's first National Park. Enjoy the stunning landscapes of lochs, glens, and mountains, perhaps taking a relaxing boat cruise on Loch Lomond or a gentle walk along its shores.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Loch Lomond"
    },
    {
      "nodeId": "day3_node4",
      "title": "Glengoyne Distillery Tour & Tasting",
      "description": "Unwind with a fascinating tour of the Glengoyne Distillery, known for its unpeated single malt whisky. Learn about the traditional distillation process, explore the grounds, and indulge in a guided tasting of their exquisite spirits.",
      "category": "experience",
      "durationMinutes": 120,
      "locationName": "Killearn, near Loch Lomond"
    },
    {
      "nodeId": "day4_node2",
      "title": "Kelvingrove Art Gallery and Museum",
      "description": "Spend a captivating morning at one of Scotland's most beloved museums, housing an astonishing collection of art and natural history. From Salvador Dal's 'Christ of St John of the Cross' to a full-sized Asian elephant, there's something for everyone.",
      "category": "museum",
      "durationMinutes": 210,
      "locationName": "Glasgow"
    },
    {
      "nodeId": "day4_node4",
      "title": "Glasgow Botanic Gardens and Kibble Palace",
      "description": "Find tranquility in the beautiful Glasgow Botanic Gardens, a green oasis in the city. Explore the magnificent Kibble Palace, a stunning Victorian glasshouse filled with exotic plants from around the world.",
      "category": "park",
      "durationMinutes": 150,
      "locationName": "Glasgow"
    }
  ]
}
2025-10-25 10:07:21.891 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - Saved itinerary with populated attractions
2025-10-25 10:07:21.891 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT COMPLETE ===
2025-10-25 10:07:21.891 [Pipeline-103] INFO  com.tripplanner.agents.ActivityAgent - Populated 8 attractions
2025-10-25 10:07:21.891 [Pipeline-103] INFO  com.tripplanner.service.PipelineOrchestrator - [ActivityAgent] Complete
2025-10-25 10:07:26.937 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:07:26.938 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:07:26.938 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Length: 2847
2025-10-25 10:07:26.938 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"transports\": [\n    {\n      \"nodeId\": \"day1_node5\",\n      \"title\": \"Rideshare/Taxi from Nature Spot to Restaurant\",\n      \"description\": \"For getting from a nature spot to a restaurant in Scotland, a rideshare (like Uber/Bolt in major cities) or a local taxi is often the most practical and convenient option, especially if the nature spot is not directly on a public transport route. This offers door-to-door service. If you've rented a car for exploring nature, driving yourself would be the primary option. In more rural areas, pre-booking a local taxi via phone or through your accommodation is recommended to ensure availability. Cost-saving tip: Share a ride if traveling with others.\",\n      \"mode\": \"rideshare\",\n      \"durationMinutes\": 25\n    },\n    {\n      \"nodeId\": \"day2_node5\",\n      \"title\": \"Public Bus to Dinner Venue (City)\",\n      \"description\": \"Within major Scottish cities like Edinburgh or Glasgow, public buses (and trams in Edinburgh) offer an economical and efficient way to get around. Check Google Maps or local transport apps (e.g., 'Lothian Buses' for Edinburgh, 'First Bus' for Glasgow) for routes and real-time information. You can typically pay with contactless card, Apple/Google Pay, or exact cash. A day ticket can be cost-effective if making multiple journeys. For a quicker or late-night option, a taxi or rideshare (Uber/Bolt) would be suitable.\",\n      \"mode\": \"bus\",\n      \"durationMinutes\": 30\n    },\n    {\n      \"nodeId\": \"day3_node5\",\n      \"title\": \"Taxi to Fine Dining Restaurant\",\n      \"description\": \"When heading to a fine dining restaurant, especially if dressed up, a taxi or rideshare provides the utmost convenience and comfort. It ensures a direct, door-to-door journey without concerns about weather or public transport schedules. Book via local taxi apps, Uber/Bolt (in major cities), or ask your hotel concierge to arrange one. Pre-booking might be advisable for popular dining times or if you're in a less urban area. Cost-saving tip: If the distance is very short (under 1km) and weather permits, walking could be an option, but for fine dining, comfort is usually prioritized.\",\n      \"mode\": \"taxi\",\n      \"durationMinutes\": 20\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 614,
    "candidatesTokenCount": 545,
    "totalTokenCount": 2983,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 614
      }
    ],
    "thoughtsTokenCount": 1824
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "9VP8aNalG_Knvr0PhPv5iAM"
}

2025-10-25 10:07:26.945 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_400004060_20251025_100726.json
2025-10-25 10:07:26.946 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:07:26.946 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content length: 2216
2025-10-25 10:07:26.946 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "transports": [
    {
      "nodeId": "day1_node5",
      "title": "Rideshare/Taxi from Nature Spot to Restaurant",
      "description": "For getting from a nature spot to a restaurant in Scotland, a rideshare (like Uber/Bolt in major cities) or a local taxi is often the most practical a...
2025-10-25 10:07:26.946 [Pipeline-100] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:07:26.946 [Pipeline-100] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:07:26.947 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT - FULL LLM RESPONSE ===
2025-10-25 10:07:26.947 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - Contexts to populate: 3
2025-10-25 10:07:26.947 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - Raw Response: ```json
{
  "transports": [
    {
      "nodeId": "day1_node5",
      "title": "Rideshare/Taxi from Nature Spot to Restaurant",
      "description": "For getting from a nature spot to a restaurant in Scotland, a rideshare (like Uber/Bolt in major cities) or a local taxi is often the most practical and convenient option, especially if the nature spot is not directly on a public transport route. This offers door-to-door service. If you've rented a car for exploring nature, driving yourself would be the primary option. In more rural areas, pre-booking a local taxi via phone or through your accommodation is recommended to ensure availability. Cost-saving tip: Share a ride if traveling with others.",
      "mode": "rideshare",
      "durationMinutes": 25
    },
    {
      "nodeId": "day2_node5",
      "title": "Public Bus to Dinner Venue (City)",
      "description": "Within major Scottish cities like Edinburgh or Glasgow, public buses (and trams in Edinburgh) offer an economical and efficient way to get around. Check Google Maps or local transport apps (e.g., 'Lothian Buses' for Edinburgh, 'First Bus' for Glasgow) for routes and real-time information. You can typically pay with contactless card, Apple/Google Pay, or exact cash. A day ticket can be cost-effective if making multiple journeys. For a quicker or late-night option, a taxi or rideshare (Uber/Bolt) would be suitable.",
      "mode": "bus",
      "durationMinutes": 30
    },
    {
      "nodeId": "day3_node5",
      "title": "Taxi to Fine Dining Restaurant",
      "description": "When heading to a fine dining restaurant, especially if dressed up, a taxi or rideshare provides the utmost convenience and comfort. It ensures a direct, door-to-door journey without concerns about weather or public transport schedules. Book via local taxi apps, Uber/Bolt (in major cities), or ask your hotel concierge to arrange one. Pre-booking might be advisable for popular dining times or if you're in a less urban area. Cost-saving tip: If the distance is very short (under 1km) and weather permits, walking could be an option, but for fine dining, comfort is usually prioritized.",
      "mode": "taxi",
      "durationMinutes": 20
    }
  ]
}
```
2025-10-25 10:07:26.947 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - === END TRANSPORT AGENT RESPONSE ===
2025-10-25 10:07:26.948 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - Cleaned Response: {
  "transports": [
    {
      "nodeId": "day1_node5",
      "title": "Rideshare/Taxi from Nature Spot to Restaurant",
      "description": "For getting from a nature spot to a restaurant in Scotland, a rideshare (like Uber/Bolt in major cities) or a local taxi is often the most practical and convenient option, especially if the nature spot is not directly on a public transport route. This offers door-to-door service. If you've rented a car for exploring nature, driving yourself would be the primary option. In more rural areas, pre-booking a local taxi via phone or through your accommodation is recommended to ensure availability. Cost-saving tip: Share a ride if traveling with others.",
      "mode": "rideshare",
      "durationMinutes": 25
    },
    {
      "nodeId": "day2_node5",
      "title": "Public Bus to Dinner Venue (City)",
      "description": "Within major Scottish cities like Edinburgh or Glasgow, public buses (and trams in Edinburgh) offer an economical and efficient way to get around. Check Google Maps or local transport apps (e.g., 'Lothian Buses' for Edinburgh, 'First Bus' for Glasgow) for routes and real-time information. You can typically pay with contactless card, Apple/Google Pay, or exact cash. A day ticket can be cost-effective if making multiple journeys. For a quicker or late-night option, a taxi or rideshare (Uber/Bolt) would be suitable.",
      "mode": "bus",
      "durationMinutes": 30
    },
    {
      "nodeId": "day3_node5",
      "title": "Taxi to Fine Dining Restaurant",
      "description": "When heading to a fine dining restaurant, especially if dressed up, a taxi or rideshare provides the utmost convenience and comfort. It ensures a direct, door-to-door journey without concerns about weather or public transport schedules. Book via local taxi apps, Uber/Bolt (in major cities), or ask your hotel concierge to arrange one. Pre-booking might be advisable for popular dining times or if you're in a less urban area. Cost-saving tip: If the distance is very short (under 1km) and weather permits, walking could be an option, but for fine dining, comfort is usually prioritized.",
      "mode": "taxi",
      "durationMinutes": 20
    }
  ]
}
2025-10-25 10:07:28.829 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - Saved itinerary with populated transport
2025-10-25 10:07:28.830 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT COMPLETE ===
2025-10-25 10:07:28.830 [Pipeline-100] INFO  com.tripplanner.agents.TransportAgent - Populated 3 transport segments
2025-10-25 10:07:28.830 [Pipeline-100] INFO  com.tripplanner.service.PipelineOrchestrator - [TransportAgent] Complete
2025-10-25 10:07:38.173 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:07:38.174 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:07:38.174 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Response Length: 6216
2025-10-25 10:07:38.174 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"meals\": [\n    {\n      \"nodeId\": \"day1_node1\",\n      \"title\": \"The Scran & Scallie\",\n      \"description\": \"Enjoy a sophisticated gastropub experience at this Michelin-starred pub by Tom Kitchin and Dominic Jack. Indulge in elevated Scottish comfort food, from delicious fish and chips to seasonal game, all in a warm, welcoming setting perfect for a hearty lunch.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day1_node3\",\n      \"title\": \"Howies Victoria Street\",\n      \"description\": \"Savor authentic Scottish cuisine in a charming, historic setting. Howies is renowned for its commitment to local produce, offering classic dishes like haggis, neeps and tatties, or succulent venison, all prepared with a traditional touch.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day1_node6\",\n      \"title\": \"Civerinos Slice\",\n      \"description\": \"Dive into a vibrant, casual atmosphere with New York-style pizza by the slice or a whole pie. Perfect for a relaxed evening meal, Civerinos offers creative toppings and classic favorites, making it a lively spot for delicious Italian comfort food.\",\n      \"cuisineType\": \"italian\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day2_node1\",\n      \"title\": \"Oink Hog Roast\",\n      \"description\": \"Experience a true Scottish street food delight with a delicious hog roast roll. Choose your preferred stuffing and sauce for a succulent, flavorful pork sandwich that's quick, satisfying, and authentically local.\",\n      \"cuisineType\": \"street_food\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day2_node3\",\n      \"title\": \"The Witchery by the Castle\",\n      \"description\": \"Indulge in an unforgettable fine dining experience at this iconic, opulent restaurant located beside Edinburgh Castle. Renowned for its theatrical atmosphere and exquisite Scottish dishes, expect a luxurious meal featuring the finest local ingredients.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day2_node6\",\n      \"title\": \"Maki & Ramen\",\n      \"description\": \"Warm up with a comforting bowl of authentic Japanese ramen or explore a selection of freshly made sushi and izakaya-style small plates. This lively spot offers a taste of Tokyo in the heart of Scotland, perfect for a flavorful and casual dinner.\",\n      \"cuisineType\": \"japanese\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day3_node1\",\n      \"title\": \"Cafe Gandolfi\",\n      \"description\": \"Step into a Glasgow institution known for its distinctive wooden interiors and warm ambiance. Enjoy a delicious lunch featuring Scottish classics with a European twist, from hearty soups to fresh seafood, all served with genuine Glaswegian hospitality.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Glasgow\"\n    },\n    {\n      \"nodeId\": \"day3_node3\",\n      \"title\": \"Ubiquitous Chip\",\n      \"description\": \"Discover a true culinary landmark in Glasgow, famous for pioneering modern Scottish cuisine since 1971. Dine in their stunning courtyard or cozy brasserie, enjoying innovative dishes crafted from the best seasonal and local produce.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Glasgow\"\n    },\n    {\n      \"nodeId\": \"day3_node6\",\n      \"title\": \"Mother India's Cafe\",\n      \"description\": \"Experience Indian dining with a unique twist, offering a tapas-style menu perfect for sharing and trying a variety of exquisite curries and small plates. This bustling restaurant delivers authentic flavors in a relaxed, communal setting.\",\n      \"cuisineType\": \"indian\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Glasgow\"\n    },\n    {\n      \"nodeId\": \"day4_node1\",\n      \"title\": \"Union of Genius\",\n      \"description\": \"Grab a quick, wholesome, and delicious lunch at Edinburgh's first gourmet soup cafe. With a rotating daily menu of creative and hearty soups, often served with freshly baked bread, it's the perfect stop for a nourishing meal.\",\n      \"cuisineType\": \"cafe\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day4_node3\",\n      \"title\": \"Aizle\",\n      \"description\": \"Embark on a unique culinary journey at Aizle, where the menu is dictated by the freshest seasonal ingredients available. Enjoy a multi-course tasting experience that highlights modern Scottish produce with innovative techniques, promising a truly memorable meal.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Edinburgh\"\n    },\n    {\n      \"nodeId\": \"day4_node5\",\n      \"title\": \"The Last Drop\",\n      \"description\": \"Conclude your Scottish adventure with a relaxed dinner at a lively pub brimming with character and history. Enjoy classic pub fare, including delicious burgers and traditional Scottish dishes, alongside a great selection of local beers and spirits.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Edinburgh\"\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 1008,
    "candidatesTokenCount": 1318,
    "totalTokenCount": 4709,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 1008
      }
    ],
    "thoughtsTokenCount": 2383
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "EVT8aOUWtefV7w_HoprhAg"
}

2025-10-25 10:07:38.182 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-599404454_20251025_100738.json
2025-10-25 10:07:38.183 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:07:38.183 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Generated content length: 5274
2025-10-25 10:07:38.183 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "The Scran & Scallie",
      "description": "Enjoy a sophisticated gastropub experience at this Michelin-starred pub by Tom Kitchin and Dominic Jack. Indulge in elevated Scottish comfort food, from delicious fish and chips to ...
2025-10-25 10:07:38.183 [Pipeline-104] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:07:38.183 [Pipeline-104] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:07:38.184 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT - FULL LLM RESPONSE ===
2025-10-25 10:07:38.184 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - Contexts to populate: 12
2025-10-25 10:07:38.184 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - Raw Response: ```json
{
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "The Scran & Scallie",
      "description": "Enjoy a sophisticated gastropub experience at this Michelin-starred pub by Tom Kitchin and Dominic Jack. Indulge in elevated Scottish comfort food, from delicious fish and chips to seasonal game, all in a warm, welcoming setting perfect for a hearty lunch.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day1_node3",
      "title": "Howies Victoria Street",
      "description": "Savor authentic Scottish cuisine in a charming, historic setting. Howies is renowned for its commitment to local produce, offering classic dishes like haggis, neeps and tatties, or succulent venison, all prepared with a traditional touch.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day1_node6",
      "title": "Civerinos Slice",
      "description": "Dive into a vibrant, casual atmosphere with New York-style pizza by the slice or a whole pie. Perfect for a relaxed evening meal, Civerinos offers creative toppings and classic favorites, making it a lively spot for delicious Italian comfort food.",
      "cuisineType": "italian",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day2_node1",
      "title": "Oink Hog Roast",
      "description": "Experience a true Scottish street food delight with a delicious hog roast roll. Choose your preferred stuffing and sauce for a succulent, flavorful pork sandwich that's quick, satisfying, and authentically local.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day2_node3",
      "title": "The Witchery by the Castle",
      "description": "Indulge in an unforgettable fine dining experience at this iconic, opulent restaurant located beside Edinburgh Castle. Renowned for its theatrical atmosphere and exquisite Scottish dishes, expect a luxurious meal featuring the finest local ingredients.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day2_node6",
      "title": "Maki & Ramen",
      "description": "Warm up with a comforting bowl of authentic Japanese ramen or explore a selection of freshly made sushi and izakaya-style small plates. This lively spot offers a taste of Tokyo in the heart of Scotland, perfect for a flavorful and casual dinner.",
      "cuisineType": "japanese",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day3_node1",
      "title": "Cafe Gandolfi",
      "description": "Step into a Glasgow institution known for its distinctive wooden interiors and warm ambiance. Enjoy a delicious lunch featuring Scottish classics with a European twist, from hearty soups to fresh seafood, all served with genuine Glaswegian hospitality.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Glasgow"
    },
    {
      "nodeId": "day3_node3",
      "title": "Ubiquitous Chip",
      "description": "Discover a true culinary landmark in Glasgow, famous for pioneering modern Scottish cuisine since 1971. Dine in their stunning courtyard or cozy brasserie, enjoying innovative dishes crafted from the best seasonal and local produce.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Glasgow"
    },
    {
      "nodeId": "day3_node6",
      "title": "Mother India's Cafe",
      "description": "Experience Indian dining with a unique twist, offering a tapas-style menu perfect for sharing and trying a variety of exquisite curries and small plates. This bustling restaurant delivers authentic flavors in a relaxed, communal setting.",
      "cuisineType": "indian",
      "mealType": "dinner",
      "locationName": "Glasgow"
    },
    {
      "nodeId": "day4_node1",
      "title": "Union of Genius",
      "description": "Grab a quick, wholesome, and delicious lunch at Edinburgh's first gourmet soup cafe. With a rotating daily menu of creative and hearty soups, often served with freshly baked bread, it's the perfect stop for a nourishing meal.",
      "cuisineType": "cafe",
      "mealType": "lunch",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day4_node3",
      "title": "Aizle",
      "description": "Embark on a unique culinary journey at Aizle, where the menu is dictated by the freshest seasonal ingredients available. Enjoy a multi-course tasting experience that highlights modern Scottish produce with innovative techniques, promising a truly memorable meal.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day4_node5",
      "title": "The Last Drop",
      "description": "Conclude your Scottish adventure with a relaxed dinner at a lively pub brimming with character and history. Enjoy classic pub fare, including delicious burgers and traditional Scottish dishes, alongside a great selection of local beers and spirits.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    }
  ]
}
```
2025-10-25 10:07:38.184 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - === END MEAL AGENT RESPONSE ===
2025-10-25 10:07:38.185 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - Cleaned Response: {
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "The Scran & Scallie",
      "description": "Enjoy a sophisticated gastropub experience at this Michelin-starred pub by Tom Kitchin and Dominic Jack. Indulge in elevated Scottish comfort food, from delicious fish and chips to seasonal game, all in a warm, welcoming setting perfect for a hearty lunch.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day1_node3",
      "title": "Howies Victoria Street",
      "description": "Savor authentic Scottish cuisine in a charming, historic setting. Howies is renowned for its commitment to local produce, offering classic dishes like haggis, neeps and tatties, or succulent venison, all prepared with a traditional touch.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day1_node6",
      "title": "Civerinos Slice",
      "description": "Dive into a vibrant, casual atmosphere with New York-style pizza by the slice or a whole pie. Perfect for a relaxed evening meal, Civerinos offers creative toppings and classic favorites, making it a lively spot for delicious Italian comfort food.",
      "cuisineType": "italian",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day2_node1",
      "title": "Oink Hog Roast",
      "description": "Experience a true Scottish street food delight with a delicious hog roast roll. Choose your preferred stuffing and sauce for a succulent, flavorful pork sandwich that's quick, satisfying, and authentically local.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day2_node3",
      "title": "The Witchery by the Castle",
      "description": "Indulge in an unforgettable fine dining experience at this iconic, opulent restaurant located beside Edinburgh Castle. Renowned for its theatrical atmosphere and exquisite Scottish dishes, expect a luxurious meal featuring the finest local ingredients.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day2_node6",
      "title": "Maki & Ramen",
      "description": "Warm up with a comforting bowl of authentic Japanese ramen or explore a selection of freshly made sushi and izakaya-style small plates. This lively spot offers a taste of Tokyo in the heart of Scotland, perfect for a flavorful and casual dinner.",
      "cuisineType": "japanese",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day3_node1",
      "title": "Cafe Gandolfi",
      "description": "Step into a Glasgow institution known for its distinctive wooden interiors and warm ambiance. Enjoy a delicious lunch featuring Scottish classics with a European twist, from hearty soups to fresh seafood, all served with genuine Glaswegian hospitality.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Glasgow"
    },
    {
      "nodeId": "day3_node3",
      "title": "Ubiquitous Chip",
      "description": "Discover a true culinary landmark in Glasgow, famous for pioneering modern Scottish cuisine since 1971. Dine in their stunning courtyard or cozy brasserie, enjoying innovative dishes crafted from the best seasonal and local produce.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Glasgow"
    },
    {
      "nodeId": "day3_node6",
      "title": "Mother India's Cafe",
      "description": "Experience Indian dining with a unique twist, offering a tapas-style menu perfect for sharing and trying a variety of exquisite curries and small plates. This bustling restaurant delivers authentic flavors in a relaxed, communal setting.",
      "cuisineType": "indian",
      "mealType": "dinner",
      "locationName": "Glasgow"
    },
    {
      "nodeId": "day4_node1",
      "title": "Union of Genius",
      "description": "Grab a quick, wholesome, and delicious lunch at Edinburgh's first gourmet soup cafe. With a rotating daily menu of creative and hearty soups, often served with freshly baked bread, it's the perfect stop for a nourishing meal.",
      "cuisineType": "cafe",
      "mealType": "lunch",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day4_node3",
      "title": "Aizle",
      "description": "Embark on a unique culinary journey at Aizle, where the menu is dictated by the freshest seasonal ingredients available. Enjoy a multi-course tasting experience that highlights modern Scottish produce with innovative techniques, promising a truly memorable meal.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    },
    {
      "nodeId": "day4_node5",
      "title": "The Last Drop",
      "description": "Conclude your Scottish adventure with a relaxed dinner at a lively pub brimming with character and history. Enjoy classic pub fare, including delicious burgers and traditional Scottish dishes, alongside a great selection of local beers and spirits.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Edinburgh"
    }
  ]
}
2025-10-25 10:07:38.830 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - Saved itinerary with populated meals
2025-10-25 10:07:38.830 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT COMPLETE ===
2025-10-25 10:07:38.830 [Pipeline-104] INFO  com.tripplanner.agents.MealAgent - Populated 12 meals
2025-10-25 10:07:38.831 [Pipeline-104] INFO  com.tripplanner.service.PipelineOrchestrator - [MealAgent] Complete
2025-10-25 10:07:38.831 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - All population agents completed successfully
2025-10-25 10:07:38.831 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 2 complete (29346 ms)
2025-10-25 10:07:38.831 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase population completed in 29346 ms
2025-10-25 10:07:38.832 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:38.833 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 3: ENRICHMENT ===
2025-10-25 10:07:38.833 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase ENRICHMENT started: Adding location details...
2025-10-25 10:07:38.834 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:38.835 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"phase_transition","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738...(truncated)
2025-10-25 10:07:38.835 [Pipeline-99] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, unknownENRICHMENT, progress=0%
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - === AGENT EXECUTION START ===
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Agent Kind: ENRICHMENT
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Request Type: ApplyResult
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Request Data: {taskType=enrich}
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Request Details: {taskType=enrich}
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - =============================
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:07:38.837 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:38.838 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:07:38.838 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:07:38.838 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: queued
2025-10-25 10:07:38.838 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 0
2025-10-25 10:07:38.838 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Agent queued for execution
2025-10-25 10:07:38.838 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:07:38.838 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:37:38.837354700Z
2025-10-25 10:07:38.839 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Agent started
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:07:38.839 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:37:38.839367Z
2025-10-25 10:07:38.840 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:38.840 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:07:38.840 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Executing agent-specific logic for: ENRICHMENT
2025-10-25 10:07:38.840 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - === ENRICHMENT AGENT PROCESSING ===
2025-10-25 10:07:38.840 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:40.215 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:07:40.215 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:40.215 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:07:40.215 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:07:40.215 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:07:40.215 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-25 10:07:40.215 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Loading itinerary
2025-10-25 10:07:40.215 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: loading
2025-10-25 10:07:40.215 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:37:40.215597Z
2025-10-25 10:07:40.216 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:40.216 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:07:40.216 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:07:40.216 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:40.217 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:07:40.217 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:07:40.217 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:07:40.217 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-25 10:07:40.217 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Enriching places with Google Places data
2025-10-25 10:07:40.217 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: ENRICHMENT
2025-10-25 10:07:40.217 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:37:40.216687400Z
2025-10-25 10:07:40.218 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:40.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:07:40.219 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Edinburgh&key=
2025-10-25 10:07:40.219 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:07:40.499 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:07:40.499 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:07:40.500 [Pipeline-103] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:07:40.500 [Pipeline-103] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 2
2025-10-25 10:07:40.501 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Edinburgh&key=
2025-10-25 10:07:40.502 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:07:40.798 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:07:40.799 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:07:40.799 [Pipeline-103] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:07:40.799 [Pipeline-103] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 3
2025-10-25 10:07:40.800 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Edinburgh&key=
2025-10-25 10:07:40.800 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:07:40.913 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:07:40.914 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:07:40.915 [Pipeline-103] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:07:40.915 [Pipeline-103] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 4
2025-10-25 10:07:40.917 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Edinburgh%2520(e.g.,%2520The%2520World's%2520End%2520Pub)&key=
2025-10-25 10:07:40.917 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:07:41.213 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:07:41.213 [Pipeline-103] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:07:41.214 [Pipeline-103] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:07:41.214 [Pipeline-103] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 5
2025-10-25 10:07:41.214 [Pipeline-103] ERROR com.tripplanner.service.GooglePlacesService - Google Places API failure threshold reached (5), opening circuit breaker
2025-10-25 10:07:41.214 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day1_node6 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.214 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node1 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.214 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node2 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.215 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node3 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.215 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node4 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.215 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node6 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.215 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node1 (Glasgow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.215 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node2 (Loch Lomond): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.215 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node3 (Glasgow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.215 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node4 (Killearn, near Loch Lomond): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.217 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node6 (Glasgow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.217 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node1 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.217 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node2 (Glasgow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.217 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node3 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.217 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node4 (Glasgow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.217 [Pipeline-103] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node5 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:07:41.217 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Created 0 ENRICHMENT operations
2025-10-25 10:07:41.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:07:41.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:41.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:07:41.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:07:41.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:07:41.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 40
2025-10-25 10:07:41.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Validating opening hours
2025-10-25 10:07:41.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: validation
2025-10-25 10:07:41.218 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:37:41.218070600Z
2025-10-25 10:07:41.219 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:41.219 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:07:41.220 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:07:41.220 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:41.220 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:07:41.220 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:07:41.220 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:07:41.221 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 60
2025-10-25 10:07:41.221 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Calculating pacing
2025-10-25 10:07:41.221 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: pacing
2025-10-25 10:07:41.221 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:37:41.220060900Z
2025-10-25 10:07:41.222 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:41.222 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:07:41.224 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:07:41.225 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:41.225 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:07:41.225 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:07:41.225 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:07:41.225 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-25 10:07:41.225 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Computing transit durations
2025-10-25 10:07:41.225 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: transit
2025-10-25 10:07:41.225 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:37:41.224017500Z
2025-10-25 10:07:41.226 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:41.226 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:07:41.227 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:07:41.227 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:41.227 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:07:41.227 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:07:41.227 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:07:41.227 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 90
2025-10-25 10:07:41.227 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Applying enrichments
2025-10-25 10:07:41.227 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: applying
2025-10-25 10:07:41.227 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:37:41.227014200Z
2025-10-25 10:07:41.228 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:07:41.228 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:07:41.228 [Pipeline-103] INFO  com.tripplanner.service.ChangeEngine - Applying changes for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:07:41.864 [Pipeline-103] INFO  com.tripplanner.service.ChangeEngine - === ITINERARY STATE IN CHANGE ENGINE ===
2025-10-25 10:07:41.865 [Pipeline-103] INFO  com.tripplanner.service.ChangeEngine - Day 1: 7 nodes - IDs: [day1_node1, day1_node2, day1_node3, day1_node4, day1_node5, day1_node6, day1_node7]
2025-10-25 10:07:41.865 [Pipeline-103] INFO  com.tripplanner.service.ChangeEngine - Day 2: 7 nodes - IDs: [day2_node1, day2_node2, day2_node3, day2_node4, day2_node5, day2_node6, day2_node7]
2025-10-25 10:07:41.865 [Pipeline-103] INFO  com.tripplanner.service.ChangeEngine - Day 3: 7 nodes - IDs: [day3_node1, day3_node2, day3_node3, day3_node4, day3_node5, day3_node6, day3_node7]
2025-10-25 10:07:41.866 [Pipeline-103] INFO  com.tripplanner.service.ChangeEngine - Day 4: 6 nodes - IDs: [day4_node1, day4_node2, day4_node3, day4_node4, day4_node5, day4_node6]
2025-10-25 10:07:41.866 [Pipeline-103] INFO  com.tripplanner.service.ChangeEngine - =========================================
2025-10-25 10:08:02.563 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.563 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node1_to_day1_node2, op=update_edge
2025-10-25 10:08:02.563 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.563 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node2_to_day1_node3, op=update_edge
2025-10-25 10:08:02.563 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.563 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node3_to_day1_node4, op=update_edge
2025-10-25 10:08:02.564 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.564 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node4_to_day1_node5, op=update_edge
2025-10-25 10:08:02.564 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.564 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node5_to_day1_node6, op=update_edge
2025-10-25 10:08:02.564 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.564 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node6_to_day1_node7, op=update_edge
2025-10-25 10:08:02.565 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.565 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node1_to_day2_node2, op=update_edge
2025-10-25 10:08:02.565 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.565 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node2_to_day2_node3, op=update_edge
2025-10-25 10:08:02.565 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.565 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node3_to_day2_node4, op=update_edge
2025-10-25 10:08:02.565 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.565 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node4_to_day2_node5, op=update_edge
2025-10-25 10:08:02.565 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node5_to_day2_node6, op=update_edge
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node6_to_day2_node7, op=update_edge
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node1_to_day3_node2, op=update_edge
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node2_to_day3_node3, op=update_edge
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node3_to_day3_node4, op=update_edge
2025-10-25 10:08:02.566 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node4_to_day3_node5, op=update_edge
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node5_to_day3_node6, op=update_edge
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node6_to_day3_node7, op=update_edge
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node1_to_day4_node2, op=update_edge
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node2_to_day4_node3, op=update_edge
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.567 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node3_to_day4_node4, op=update_edge
2025-10-25 10:08:02.568 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.568 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node4_to_day4_node5, op=update_edge
2025-10-25 10:08:02.568 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:08:02.568 [Pipeline-103] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node5_to_day4_node6, op=update_edge
2025-10-25 10:08:02.569 [Pipeline-103] INFO  com.tripplanner.service.RevisionService - Saving revision rev_1761367082568_34f6dbf0 for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:08:03.075 [Pipeline-103] INFO  com.tripplanner.service.RevisionService - Successfully saved revision rev_1761367082568_34f6dbf0 for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:08:04.598 [Pipeline-103] INFO  com.tripplanner.service.ChangeEngine - Triggering auto-enrichment for 23 nodes in itinerary it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Enrichment complete
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: complete
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:38:04.599664800Z
2025-10-25 10:08:04.599 [AsyncTask-3] INFO  com.tripplanner.service.EnrichmentService - Starting async enrichment for 23 nodes in itinerary it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:08:04.599 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - === ENRICHMENT COMPLETE ===
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Applied 46 ENRICHMENT operations
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - New version: 2
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 32d7c747-7937-4f05-8443-8f17bb45e358
2025-10-25 10:08:04.599 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Status: completed
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Message: Agent completed successfully
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:38:04.599664800Z
2025-10-25 10:08:04.600 [Pipeline-103] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - === AGENT EXECUTION COMPLETED ===
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Agent Kind: ENRICHMENT
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Result Type: ApplyResult
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - Result: com.tripplanner.service.ChangeEngine$ApplyResult@2a4d5aaf
2025-10-25 10:08:04.600 [Pipeline-103] INFO  com.tripplanner.agents.EnrichmentAgent - =================================
2025-10-25 10:08:04.601 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 3 complete (25769 ms)
2025-10-25 10:08:04.601 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase ENRICHMENT completed in 25769 ms
2025-10-25 10:08:04.601 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:08:04.601 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 4: COST ESTIMATION ===
2025-10-25 10:08:04.601 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase cost_estimation started: Estimating costs...
2025-10-25 10:08:04.601 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:08:04.602 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"phase_transition","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738...(truncated)
2025-10-25 10:08:04.602 [Pipeline-99] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, unknowncost_estimation, progress=0%
2025-10-25 10:08:04.602 [Pipeline-99] INFO  com.tripplanner.agents.CostEstimatorAgent - === COST ESTIMATOR AGENT ===
2025-10-25 10:08:04.602 [Pipeline-99] INFO  com.tripplanner.agents.CostEstimatorAgent - Estimating costs for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
2025-10-25 10:08:05.234 [AsyncTask-3] INFO  com.tripplanner.service.EnrichmentService - Enriching 16 out of 23 nodes (others already have coordinates)
2025-10-25 10:08:05.235 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node2 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.235 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node3 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.235 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node4 (Edinburgh (e.g., The World's End Pub)): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.236 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node6 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.236 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node2 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.236 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node3 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.236 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node4 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.236 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node6 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.236 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node2 (Loch Lomond): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.237 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node3 (Glasgow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.237 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node4 (Killearn, near Loch Lomond): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.237 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node6 (Glasgow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.237 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node2 (Glasgow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.237 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node3 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.237 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node4 (Glasgow): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.238 [AsyncTask-3] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node5 (Edinburgh): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:08:05.238 [AsyncTask-3] INFO  com.tripplanner.service.EnrichmentService - Successfully enriched 0 out of 16 nodes in itinerary it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 (took 639ms)
2025-10-25 10:08:06.542 [Pipeline-99] INFO  com.tripplanner.agents.CostEstimatorAgent - === COST ESTIMATOR COMPLETE ===
2025-10-25 10:08:06.543 [Pipeline-99] INFO  com.tripplanner.agents.CostEstimatorAgent - Estimated costs for 27 nodes
2025-10-25 10:08:06.543 [Pipeline-99] INFO  com.tripplanner.agents.CostEstimatorAgent - Total estimated cost: 49450 per person
2025-10-25 10:08:06.543 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 4 complete (1943 ms)
2025-10-25 10:08:06.543 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase cost_estimation completed in 1943 ms
2025-10-25 10:08:06.543 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:08:06.543 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 5: FINALIZATION ===
2025-10-25 10:08:06.544 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase finalization started: Finalizing itinerary...
2025-10-25 10:08:06.544 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:08:06.544 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"phase_transition","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738...(truncated)
2025-10-25 10:08:06.544 [Pipeline-99] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, enrichmentfinalization, progress=90%
2025-10-25 10:08:08.582 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - === PIPELINE COMPLETE ===
2025-10-25 10:08:08.582 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Total time: 103451 ms
2025-10-25 10:08:08.583 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Days: 4, Nodes: 27
2025-10-25 10:08:08.583 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Phase finalization completed in 33329 ms
2025-10-25 10:08:08.583 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"agent_progress","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01738b6...(truncated)
2025-10-25 10:08:08.583 [Pipeline-99] INFO  com.tripplanner.service.PipelineOrchestrator - Pipeline complete in 103451 ms
2025-10-25 10:08:09.305 [Pipeline-99] ERROR com.tripplanner.service.ItineraryJsonService - Attempted to save itinerary it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 with null or empty userId
2025-10-25 10:08:09.305 [Pipeline-99] ERROR com.tripplanner.service.ItineraryJsonService - Stack trace for null userId:
java.lang.Exception: UserId is null
	at com.tripplanner.service.ItineraryJsonService.saveMasterItinerary(ItineraryJsonService.java:161)
	at com.tripplanner.service.PipelineOrchestrator.publishPipelineComplete(PipelineOrchestrator.java:401)
	at com.tripplanner.service.PipelineOrchestrator.lambda$generateItinerary$2(PipelineOrchestrator.java:165)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-25 10:08:09.311 [Pipeline-99] ERROR com.tripplanner.service.ItineraryJsonService - Unexpected error saving master itinerary it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
java.lang.IllegalStateException: Cannot save itinerary without userId. Itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
	at com.tripplanner.service.ItineraryJsonService.saveMasterItinerary(ItineraryJsonService.java:162)
	at com.tripplanner.service.PipelineOrchestrator.publishPipelineComplete(PipelineOrchestrator.java:401)
	at com.tripplanner.service.PipelineOrchestrator.lambda$generateItinerary$2(PipelineOrchestrator.java:165)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-25 10:08:09.312 [Pipeline-99] ERROR com.tripplanner.service.PipelineOrchestrator - Failed to update itinerary status to completed: Failed to save master itinerary: Cannot save itinerary without userId. Itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
java.lang.RuntimeException: Failed to save master itinerary: Cannot save itinerary without userId. Itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
	at com.tripplanner.service.ItineraryJsonService.saveMasterItinerary(ItineraryJsonService.java:198)
	at com.tripplanner.service.PipelineOrchestrator.publishPipelineComplete(PipelineOrchestrator.java:401)
	at com.tripplanner.service.PipelineOrchestrator.lambda$generateItinerary$2(PipelineOrchestrator.java:165)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: java.lang.IllegalStateException: Cannot save itinerary without userId. Itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1
	at com.tripplanner.service.ItineraryJsonService.saveMasterItinerary(ItineraryJsonService.java:162)
	... 6 common frames omitted
2025-10-25 10:08:10.518 [Pipeline-99] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1 session=null payload={"updateType":"generation_complete","itineraryId":"it_0f7e01b2-25c5-47b3-b6be-01...(truncated)
2025-10-25 10:08:10.519 [Pipeline-99] INFO  com.tripplanner.service.AgentEventPublisher - Published generation complete event via WebSocket: itinerary=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, days=4, total_nodes=27
2025-10-25 10:08:10.519 [AsyncTask-2] INFO  com.tripplanner.service.ItineraryService - Pipeline generation completed successfully for itinerary: it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, executionId: exec_1761366985128
2025-10-25 10:23:07.434 [SpringApplicationShutdownHook] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-10-25 10:23:07.757 [tomcat-shutdown] INFO  o.s.boot.web.embedded.tomcat.GracefulShutdown - Graceful shutdown complete
2025-10-25 10:23:07.761 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel removed SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-25 10:23:07.761 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-25 10:23:07.761 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopping...
2025-10-25 10:23:07.761 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5d67b2b3]]
2025-10-25 10:23:07.762 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5d67b2b3]
2025-10-25 10:23:07.762 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5d67b2b3]
2025-10-25 10:23:07.762 [SpringApplicationShutdownHook] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Stopped.
2025-10-25 10:23:07.762 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - clientInboundChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-25 10:23:07.762 [SpringApplicationShutdownHook] DEBUG org.springframework.web.SimpLogging - brokerChannel removed UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-25 10:23:07.772 [SpringApplicationShutdownHook] INFO  com.tripplanner.service.GeminiClient - Gemini client cleanup completed
2025-10-25 10:23:07.772 [SpringApplicationShutdownHook] INFO  c.tripplanner.service.openrouter.OpenRouterClient - OpenRouter client cleanup completed
2025-10-25 10:23:16.196 [main] INFO  com.tripplanner.App - Starting App using Java 17.0.15 with PID 30640 (C:\Users\rites\Documents\AgenticItineraryPlanner\build\classes\java\main started by rites in C:\Users\rites\Documents\AgenticItineraryPlanner)
2025-10-25 10:23:16.200 [main] INFO  com.tripplanner.App - No active profile set, falling back to 1 default profile: "default"
2025-10-25 10:23:17.534 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-25 10:23:17.551 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat]
2025-10-25 10:23:17.552 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-10-25 10:23:17.621 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-25 10:23:17.622 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1382 ms
2025-10-25 10:23:17.717 [main] INFO  com.tripplanner.config.FirestoreConfig - Firebase initialized for project: tripaiplanner-4c951
2025-10-25 10:23:17.792 [main] DEBUG o.springframework.web.filter.ForwardedHeaderFilter - Filter 'forwardedHeaderFilter' configured for use
2025-10-25 10:23:17.823 [main] INFO  com.tripplanner.config.AiClientConfig - === AI CLIENT CONFIGURATION ===
2025-10-25 10:23:17.823 [main] INFO  com.tripplanner.config.AiClientConfig - AI provider: gemini
2025-10-25 10:23:17.823 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter API key configured: false
2025-10-25 10:23:17.823 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini API key configured: false
2025-10-25 10:23:17.962 [main] INFO  c.tripplanner.service.openrouter.OpenRouterClient - Initialized OpenRouter client with model: qwen/qwen-2.5-72b-instruct:free | apiKey=MISSING
2025-10-25 10:23:17.965 [main] INFO  com.tripplanner.service.GeminiClient - Initializing Gemini client with model: gemini-2.5-flash
2025-10-25 10:23:17.966 [main] INFO  com.tripplanner.service.GeminiClient - Gemini client initialized successfully with 150s request timeout
2025-10-25 10:23:17.967 [main] INFO  com.tripplanner.config.AiClientConfig - OpenRouter client available: false
2025-10-25 10:23:17.967 [main] INFO  com.tripplanner.config.AiClientConfig - Gemini client available: true
2025-10-25 10:23:17.967 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with Gemini as primary, OpenRouter as fallback
2025-10-25 10:23:17.967 [main] INFO  com.tripplanner.config.AiClientConfig - Creating ResilientAiClient with 2 providers
2025-10-25 10:23:17.971 [main] INFO  com.tripplanner.service.ai.ResilientAiClient - ResilientAiClient initialized with 2 providers
2025-10-25 10:23:17.971 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 1: GeminiClient (available: true)
2025-10-25 10:23:17.971 [main] INFO  com.tripplanner.service.ai.ResilientAiClient -   Provider 2: OpenRouterClient (available: false)
2025-10-25 10:23:17.971 [main] INFO  com.tripplanner.config.AiClientConfig - ResilientAiClient created successfully
2025-10-25 10:23:18.038 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore project ID set to: tripaiplanner-4c951
2025-10-25 10:23:18.041 [main] INFO  com.tripplanner.config.FirestoreConfig - Configured Firestore credentials from firestore_credentials.json
2025-10-25 10:23:18.771 [main] INFO  com.tripplanner.config.FirestoreConfig - Firestore initialized for project: tripaiplanner-4c951 (emulator: false)
2025-10-25 10:23:18.868 [main] INFO  com.tripplanner.service.AiClientLLMProvider - Initialized AiClientLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-25 10:23:18.869 [main] INFO  com.tripplanner.service.GeminiLLMProvider - Initialized GeminiLLMProvider with AI client: ResilientAiClient [Model: gemini-2.5-flash, Temperature: 0.70, Max Tokens: 65535, Provider: OpenRouter, Model: qwen/qwen-2.5-72b-instruct:free, Temperature: 0.70, Max Tokens: 8192]
2025-10-25 10:23:18.870 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: ai-client
2025-10-25 10:23:18.870 [main] INFO  com.tripplanner.service.LLMService - Registered LLM provider: gemini
2025-10-25 10:23:18.870 [main] INFO  com.tripplanner.service.LLMService - LLMService initialized with 2 providers
2025-10-25 10:23:18.871 [main] INFO  com.tripplanner.service.AgentRegistry - === AGENT REGISTRY INITIALIZATION ===
2025-10-25 10:23:18.871 [main] INFO  com.tripplanner.service.AgentRegistry - Found 11 agents to register
2025-10-25 10:23:18.872 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: activityagent -> ActivityAgent with capabilities: [populate_attractions]
2025-10-25 10:23:18.872 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: bookingagent -> BookingAgent with capabilities: [book]
2025-10-25 10:23:18.872 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: costestimatoragent -> CostEstimatorAgent with capabilities: [estimate_costs]
2025-10-25 10:23:18.872 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: daybydayplanneragent -> DayByDayPlannerAgent with capabilities: [plan]
2025-10-25 10:23:18.872 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: editoragent -> EditorAgent with capabilities: [edit]
2025-10-25 10:23:18.872 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: enrichmentagent -> EnrichmentAgent with capabilities: [enrich]
2025-10-25 10:23:18.872 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: explainagent -> ExplainAgent with capabilities: [explain]
2025-10-25 10:23:18.873 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: mealagent -> MealAgent with capabilities: [populate_meals]
2025-10-25 10:23:18.873 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: placesagent -> PlacesAgent with capabilities: [search]
2025-10-25 10:23:18.873 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: skeletonplanneragent -> SkeletonPlannerAgent with capabilities: [skeleton]
2025-10-25 10:23:18.873 [main] INFO  com.tripplanner.service.AgentRegistry - Registered agent: transportagent -> TransportAgent with capabilities: [populate_transport]
2025-10-25 10:23:18.873 [main] INFO  com.tripplanner.service.AgentRegistry - Total registered agents: 11
2025-10-25 10:23:18.873 [main] INFO  com.tripplanner.service.AgentRegistry - =====================================
2025-10-25 10:23:18.892 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CREATING DEDICATED TASK EXECUTOR ===
2025-10-25 10:23:18.894 [main] INFO  com.tripplanner.config.WebSocketConfig - WebSocket TaskExecutor configured:
2025-10-25 10:23:18.894 [main] INFO  com.tripplanner.config.WebSocketConfig -   Core Pool Size: 2
2025-10-25 10:23:18.894 [main] INFO  com.tripplanner.config.WebSocketConfig -   Max Pool Size: 10
2025-10-25 10:23:18.894 [main] INFO  com.tripplanner.config.WebSocketConfig -   Queue Capacity: 50
2025-10-25 10:23:18.894 [main] INFO  com.tripplanner.config.WebSocketConfig -   Thread Name Prefix: WebSocket-
2025-10-25 10:23:18.909 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: CONFIGURING MESSAGE BROKER ===
2025-10-25 10:23:18.909 [main] INFO  com.tripplanner.config.WebSocketConfig - Message broker configured successfully
2025-10-25 10:23:18.935 [main] INFO  com.tripplanner.config.AsyncConfig - === ASYNC CONFIG: CREATING PRIMARY TASK EXECUTOR ===
2025-10-25 10:23:18.935 [main] INFO  com.tripplanner.config.AsyncConfig - Primary TaskExecutor configured:
2025-10-25 10:23:18.935 [main] INFO  com.tripplanner.config.AsyncConfig -   Core Pool Size: 5
2025-10-25 10:23:18.935 [main] INFO  com.tripplanner.config.AsyncConfig -   Max Pool Size: 20
2025-10-25 10:23:18.935 [main] INFO  com.tripplanner.config.AsyncConfig -   Queue Capacity: 100
2025-10-25 10:23:18.935 [main] INFO  com.tripplanner.config.AsyncConfig -   Thread Name Prefix: AsyncTask-
2025-10-25 10:23:18.935 [main] INFO  com.tripplanner.config.AsyncConfig -   Keep Alive Seconds: 60
2025-10-25 10:23:19.002 [main] INFO  com.tripplanner.config.WebSocketConfig - === WEBSOCKET CONFIG: REGISTERING STOMP ENDPOINTS ===
2025-10-25 10:23:19.005 [main] INFO  com.tripplanner.config.WebSocketConfig - STOMP endpoints registered successfully
2025-10-25 10:23:19.026 [main] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Patterns [/ws/**] in 'stompWebSocketHandlerMapping'
2025-10-25 10:23:19.105 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 37 mappings in 'requestMappingHandlerMapping'
2025-10-25 10:23:19.134 [main] DEBUG o.s.web.servlet.handler.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-25 10:23:19.157 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-10-25 10:23:19.226 [main] DEBUG o.s.security.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-10-25 10:23:19.279 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ChatController:
	
2025-10-25 10:23:19.279 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.DocumentationController:
	
2025-10-25 10:23:19.279 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.HealthController:
	
2025-10-25 10:23:19.279 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ItinerariesController:
	
2025-10-25 10:23:19.280 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.PingController:
	
2025-10-25 10:23:19.280 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.ToolsController:
	
2025-10-25 10:23:19.284 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	c.t.c.WebSocketController:
	{[MESSAGE],[/itinerary/{itineraryId}]}: handleItineraryUpdate(String,Map)
	{[SUBSCRIBE],[/topic/itinerary/{itineraryId}]}: handleSubscription(String)
	{[MESSAGE],[/chat]}: handleChatMessage(Map)
2025-10-25 10:23:19.285 [main] DEBUG o.s.w.s.m.WebSocketAnnotationMethodMessageHandler - 
	o.s.b.a.w.s.e.BasicErrorController:
	
2025-10-25 10:23:19.339 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-25 10:23:19.379 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-25 10:23:19.521 [main] DEBUG org.springframework.web.SimpLogging - clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]]
2025-10-25 10:23:19.521 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]]
2025-10-25 10:23:19.521 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Starting...
2025-10-25 10:23:19.521 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@2699b656]
2025-10-25 10:23:19.522 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@2699b656]
2025-10-25 10:23:19.522 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@2699b656]]
2025-10-25 10:23:19.523 [main] INFO  o.s.m.simp.broker.SimpleBrokerMessageHandler - Started.
2025-10-25 10:23:19.523 [main] DEBUG org.springframework.web.SimpLogging - clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-25 10:23:19.523 [main] DEBUG org.springframework.web.SimpLogging - brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]
2025-10-25 10:23:19.535 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-10-25 10:23:19.542 [main] INFO  com.tripplanner.App - Started App in 3.875 seconds (process running for 4.494)
2025-10-25 10:23:47.372 [http-nio-8080-exec-1] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-25 10:23:47.373 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-25 10:23:47.373 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-25 10:23:47.373 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-25 10:23:47.374 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-25 10:23:47.375 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@147375b3
2025-10-25 10:23:47.375 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@3855b27e
2025-10-25 10:23:47.375 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-25 10:23:47.376 [http-nio-8080-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-10-25 10:23:47.884 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-25 10:23:47.930 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-25 10:23:47.933 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-25 10:23:47.935 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-25 10:23:47.953 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-25 10:23:47.953 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:23:50.728 [http-nio-8080-exec-1] INFO  com.tripplanner.service.UserDataService - Found 5 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:23:50.731 [http-nio-8080-exec-1] INFO  com.tripplanner.controller.ItinerariesController - Found 5 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:23:50.772 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:23:50.784 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_0f7e01b2-25c5-47b3-b6be-01738b6c6fb1, destination=Scotland, Scotland, United Kin (truncated)...]
2025-10-25 10:23:50.833 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:23:50.834 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:24:19.553 [MessageBroker-1] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2025-10-25 10:24:40.795 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries
2025-10-25 10:24:40.796 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries
2025-10-25 10:24:40.796 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries", parameters={}
2025-10-25 10:24:40.797 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#create(CreateItineraryReq, HttpServletRequest)
2025-10-25 10:24:40.843 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateItineraryReq(destination=Sydney, New South Wales, Australia, startLocation=Bengaluru, India, s (truncated)...]
2025-10-25 10:24:40.885 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Creating itinerary with real-time updates
2025-10-25 10:24:40.885 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Request: CreateItineraryReq(destination=Sydney, New South Wales, Australia, startLocation=Bengaluru, India, startDate=2026-01-24, endDate=2026-01-27, party=PartyDto(adults=1, children=0, infants=0, rooms=1), budgetTier=luxury, interests=[relaxation, nature, cuisine], constraints=[budgetFriendly], language=en)
2025-10-25 10:24:40.885 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - === CREATE ITINERARY REQUEST ===
2025-10-25 10:24:40.885 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Request Details:
2025-10-25 10:24:40.885 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService -   Destination: Sydney, New South Wales, Australia
2025-10-25 10:24:40.885 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService -   Start Date: 2026-01-24
2025-10-25 10:24:40.885 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService -   End Date: 2026-01-27
2025-10-25 10:24:40.886 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService -   Duration: 4 days
2025-10-25 10:24:40.886 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService -   Budget Tier: luxury
2025-10-25 10:24:40.886 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService -   Language: en
2025-10-25 10:24:40.886 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService -   Party: 1 adults, 0 children, 0 infants, 1 rooms
2025-10-25 10:24:40.886 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService -   Interests: relaxation, nature, cuisine
2025-10-25 10:24:40.886 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService -   Constraints: budgetFriendly
2025-10-25 10:24:40.887 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Creating initial itinerary and establishing ownership synchronously
2025-10-25 10:24:40.887 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - === ITINERARY INITIALIZATION SERVICE: CREATING INITIAL ITINERARY ===
2025-10-25 10:24:40.887 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:40.887 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - Destination: Sydney, New South Wales, Australia
2025-10-25 10:24:40.887 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:24:40.887 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - Step 1: Creating initial itinerary structure
2025-10-25 10:24:40.889 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - Step 2: Saving initial itinerary to ItineraryJsonService
2025-10-25 10:24:41.352 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - Step 3: Establishing ownership by saving trip metadata
2025-10-25 10:24:41.353 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Saving trip metadata it_02ad2629-8022-4b7b-b9fc-02e00555e58a for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:24:42.854 [http-nio-8080-exec-2] INFO  com.tripplanner.service.UserDataService - Successfully saved trip metadata it_02ad2629-8022-4b7b-b9fc-02e00555e58a for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:24:42.855 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - === INITIAL ITINERARY CREATED AND OWNERSHIP ESTABLISHED ===
2025-10-25 10:24:42.855 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:42.856 [http-nio-8080-exec-2] INFO  c.t.service.ItineraryInitializationService - User can now access /itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json endpoint
2025-10-25 10:24:42.856 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Waiting 2 seconds for frontend SSE connection to establish...
2025-10-25 10:24:44.864 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Starting async itinerary generation for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1 with ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:44.865 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Starting pipeline generation
2025-10-25 10:24:44.866 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Generated executionId: exec_1761368084866 for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:44.883 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - === PIPELINE ORCHESTRATOR: STARTING ===
2025-10-25 10:24:44.884 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:44.884 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - === CREATE ITINERARY RESPONSE ===
2025-10-25 10:24:44.885 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - Destination: Sydney, New South Wales, Australia, Duration: 4 days
2025-10-25 10:24:44.885 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - User ID: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:24:44.885 [AsyncTask-1] INFO  com.tripplanner.service.PipelineOrchestrator - Parallel: true
2025-10-25 10:24:44.885 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:44.886 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - ExecutionId: exec_1761368084866
2025-10-25 10:24:44.886 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Status: generating
2025-10-25 10:24:44.886 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Ownership established: YES
2025-10-25 10:24:44.887 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Async generation started: YES
2025-10-25 10:24:44.887 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Async callbacks attached: YES
2025-10-25 10:24:44.888 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - Error handling enabled: YES
2025-10-25 10:24:44.888 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - User can now access /itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:24:44.888 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ItineraryService - =====================================
2025-10-25 10:24:44.893 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 1: SKELETON GENERATION ===
2025-10-25 10:24:44.893 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase skeleton started: Creating day structure...
2025-10-25 10:24:44.901 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Enhanced itinerary creation response prepared: it_02ad2629-8022-4b7b-b9fc-02e00555e58a for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:24:44.902 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Execution ID: exec_b08d1e6c-fbb1-4b42-9459-fff8e74eb889
2025-10-25 10:24:44.902 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Real-time updates will be sent via WebSocket
2025-10-25 10:24:44.902 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Estimated completion: 2025-10-25T10:25:43.889152200
2025-10-25 10:24:44.923 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:24:44.935 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:24:44.936 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [ItineraryCreationResponse{itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, executionId='exec_b08d1 (truncated)...]
2025-10-25 10:24:44.943 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Starting skeleton generation with timeout: 120000 ms
2025-10-25 10:24:44.943 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Request details: destination=Sydney, New South Wales, Australia, duration=4 days
2025-10-25 10:24:44.946 [Pipeline-76] INFO  com.tripplanner.service.PipelineOrchestrator - SkeletonPlannerAgent.generateSkeleton() started for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:44.947 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT ===
2025-10-25 10:24:44.947 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating lightweight skeleton for 4 days
2025-10-25 10:24:44.947 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Destination: Sydney, New South Wales, Australia
2025-10-25 10:24:44.948 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:24:44.948 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:24:44.948 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:24:44.948 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:44.949 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 01c4bf18-cf9a-4c09-9745-0786124f3cac
2025-10-25 10:24:44.949 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:24:44.949 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:24:44.949 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-25 10:24:44.949 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 1 structure
2025-10-25 10:24:44.950 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-25 10:24:44.950 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:54:44.948040300Z
2025-10-25 10:24:44.951 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:24:44.951 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:24:44.952 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 1 with minimal prompt
2025-10-25 10:24:44.952 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:24:44.953 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:24:44.953 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:24:44.953 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:24:44.953 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:24:44.954 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:24:44.954 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2955
2025-10-25 10:24:44.954 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:24:44.955 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-25 10:24:44.956 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3369
2025-10-25 10:24:44.963 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:24:44.999 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:24:45.007 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:24:45.008 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:24:45.008 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:24:45.009 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:24:45.021 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761368085010
2025-10-25 10:24:45.023 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761368085010
2025-10-25 10:24:45.024 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761368085010", parameters={masked}
2025-10-25 10:24:45.025 [http-nio-8080-exec-5] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:24:45.025 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:45.025 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:24:45.030 [http-nio-8080-exec-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761368085010
2025-10-25 10:24:45.032 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:24:45.032 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:24:45.040 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/351/54bnml54/websocket
2025-10-25 10:24:45.041 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/351/54bnml54/websocket
2025-10-25 10:24:45.041 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/351/54bnml54/websocket", parameters={}
2025-10-25 10:24:45.041 [http-nio-8080-exec-6] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:24:45.043 [http-nio-8080-exec-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/351/54bnml54/websocket
2025-10-25 10:24:45.056 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:24:45.077 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:24:45.093 [http-nio-8080-exec-6] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=54bnml54]
2025-10-25 10:24:45.142 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=54bnml54
2025-10-25 10:24:45.150 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=54bnml54
2025-10-25 10:24:45.150 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=54bnml54
2025-10-25 10:24:45.151 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=54bnml54
2025-10-25 10:24:47.018 [http-nio-8080-exec-4] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: planning
2025-10-25 10:24:47.020 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:24:47.031 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=1, userId='PEoULm (truncated)...]
2025-10-25 10:24:47.037 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:24:47.037 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:24:52.717 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:24:52.718 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:24:52.718 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Length: 3095
2025-10-25 10:24:52.718 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 1,\n  \"date\": \"2026-01-24\",\n  \"location\": \"Sydney, New South Wales, Australia\",\n  \"summary\": \"Arrival and initial exploration of Sydney focusing on relaxation and cuisine.\",\n  \"nodes\": [\n    {\n      \"id\": \"day1_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast at Accommodation\",\n      \"location\": {\n        \"name\": \"Hotel Dining\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day1_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Nature Walk/Coastal Exploration\",\n      \"location\": {\n        \"name\": \"Local Scenic Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day1_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Waterfront Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day1_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Relaxation/Spa Experience\",\n      \"location\": {\n        \"name\": \"Luxury Wellness Center\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:30\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day1_node5\",\n      \"type\": \"transport\",\n      \"title\": \"Return to Accommodation/Freshen Up\",\n      \"location\": {\n        \"name\": \"To Accommodation\"\n      },\n      \"timing\": {\n        \"startTime\": \"17:00\",\n        \"endTime\": \"18:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day1_node6\",\n      \"type\": \"meal\",\n      \"title\": \"Fine Dining Dinner Experience\",\n      \"location\": {\n        \"name\": \"Upscale Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:30\",\n        \"endTime\": \"21:30\",\n        \"durationMin\": 120\n      }\n    },\n    {\n      \"id\": \"day1_node7\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Luxury Hotel\"\n      },\n      \"timing\": {\n        \"startTime\": \"22:00\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 600\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 842,
    "candidatesTokenCount": 767,
    "totalTokenCount": 2085,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 842
      }
    ],
    "thoughtsTokenCount": 476
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "G1j8aP3xIsKC1e8Py4fKiAs"
}

2025-10-25 10:24:52.735 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_1397334381_20251025_102452.json
2025-10-25 10:24:52.736 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:24:52.736 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content length: 2221
2025-10-25 10:24:52.736 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 1,
  "date": "2026-01-24",
  "location": "Sydney, New South Wales, Australia",
  "summary": "Arrival and initial exploration of Sydney focusing on relaxation and cuisine.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast at Accomm...
2025-10-25 10:24:52.736 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:24:52.736 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:24:52.737 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-25 10:24:52.737 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 1
2025-10-25 10:24:52.737 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 1,
  "date": "2026-01-24",
  "location": "Sydney, New South Wales, Australia",
  "summary": "Arrival and initial exploration of Sydney focusing on relaxation and cuisine.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast at Accommodation",
      "location": {
        "name": "Hotel Dining"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node2",
      "type": "attraction",
      "title": "Morning Nature Walk/Coastal Exploration",
      "location": {
        "name": "Local Scenic Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day1_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Waterfront Restaurant"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation/Spa Experience",
      "location": {
        "name": "Luxury Wellness Center"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day1_node5",
      "type": "transport",
      "title": "Return to Accommodation/Freshen Up",
      "location": {
        "name": "To Accommodation"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "18:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node6",
      "type": "meal",
      "title": "Fine Dining Dinner Experience",
      "location": {
        "name": "Upscale Restaurant"
      },
      "timing": {
        "startTime": "19:30",
        "endTime": "21:30",
        "durationMin": 120
      }
    },
    {
      "id": "day1_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel"
      },
      "timing": {
        "startTime": "22:00",
        "endTime": "08:00",
        "durationMin": 600
      }
    }
  ]
}
```
2025-10-25 10:24:52.737 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-25 10:24:52.740 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 1,
  "date": "2026-01-24",
  "location": "Sydney, New South Wales, Australia",
  "summary": "Arrival and initial exploration of Sydney focusing on relaxation and cuisine.",
  "nodes": [
    {
      "id": "day1_node1",
      "type": "meal",
      "title": "Breakfast at Accommodation",
      "location": {
        "name": "Hotel Dining"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node2",
      "type": "attraction",
      "title": "Morning Nature Walk/Coastal Exploration",
      "location": {
        "name": "Local Scenic Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day1_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Waterfront Restaurant"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation/Spa Experience",
      "location": {
        "name": "Luxury Wellness Center"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day1_node5",
      "type": "transport",
      "title": "Return to Accommodation/Freshen Up",
      "location": {
        "name": "To Accommodation"
      },
      "timing": {
        "startTime": "17:00",
        "endTime": "18:00",
        "durationMin": 60
      }
    },
    {
      "id": "day1_node6",
      "type": "meal",
      "title": "Fine Dining Dinner Experience",
      "location": {
        "name": "Upscale Restaurant"
      },
      "timing": {
        "startTime": "19:30",
        "endTime": "21:30",
        "durationMin": 120
      }
    },
    {
      "id": "day1_node7",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel"
      },
      "timing": {
        "startTime": "22:00",
        "endTime": "08:00",
        "durationMin": 600
      }
    }
  ]
}
2025-10-25 10:24:53.210 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"day_completed","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e00555...(truncated)
2025-10-25 10:24:53.211 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:24:53.214 [Pipeline-76] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, day=1, activities=7
2025-10-25 10:24:53.215 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 1 created and saved
2025-10-25 10:24:53.215 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:24:53.215 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:24:53.215 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 01c4bf18-cf9a-4c09-9745-0786124f3cac
2025-10-25 10:24:53.215 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:24:53.216 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:24:53.216 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 35
2025-10-25 10:24:53.216 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 2 structure
2025-10-25 10:24:53.216 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-25 10:24:53.216 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:54:53.215181400Z
2025-10-25 10:24:53.218 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:24:53.218 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:24:53.218 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:24:53.218 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 2 with minimal prompt
2025-10-25 10:24:53.218 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:24:53.219 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:24:53.219 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:24:53.219 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:24:53.219 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:24:53.219 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:24:53.219 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2955
2025-10-25 10:24:53.219 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:24:53.219 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-25 10:24:53.220 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3369
2025-10-25 10:24:53.220 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:25:04.505 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:25:04.505 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:25:04.505 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Length: 2708
2025-10-25 10:25:04.505 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 2,\n  \"date\": \"2026-01-25\",\n  \"location\": \"Sydney, New South Wales, Australia\",\n  \"summary\": \"Day 2 itinerary outline focusing on relaxation, nature, and cuisine.\",\n  \"nodes\": [\n    {\n      \"id\": \"day2_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast at Hotel/Local Cafe\",\n      \"location\": {\n        \"name\": \"Breakfast Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day2_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Nature Exploration\",\n      \"location\": {\n        \"name\": \"Nature Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:30\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day2_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Lunch Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"13:00\",\n        \"endTime\": \"14:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day2_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Relaxation Activity\",\n      \"location\": {\n        \"name\": \"Relaxation Venue\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:30\",\n        \"endTime\": \"17:30\",\n        \"durationMin\": 180\n      }\n    },\n    {\n      \"id\": \"day2_node5\",\n      \"type\": \"meal\",\n      \"title\": \"Dinner Experience\",\n      \"location\": {\n        \"name\": \"Dinner Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"21:00\",\n        \"durationMin\": 120\n      }\n    },\n    {\n      \"id\": \"day2_node6\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Accommodation Venue\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:30\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 630\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 842,
    "candidatesTokenCount": 662,
    "totalTokenCount": 2627,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 842
      }
    ],
    "thoughtsTokenCount": 1123
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "J1j8aPq7EOjQ1e8PxNGk2A0"
}

2025-10-25 10:25:04.507 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-1172851351_20251025_102504.json
2025-10-25 10:25:04.507 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:25:04.507 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1876
2025-10-25 10:25:04.507 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 2,
  "date": "2026-01-25",
  "location": "Sydney, New South Wales, Australia",
  "summary": "Day 2 itinerary outline focusing on relaxation, nature, and cuisine.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast at Hotel/Local Caf...
2025-10-25 10:25:04.507 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:25:04.507 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:25:04.507 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-25 10:25:04.507 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 2
2025-10-25 10:25:04.508 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 2,
  "date": "2026-01-25",
  "location": "Sydney, New South Wales, Australia",
  "summary": "Day 2 itinerary outline focusing on relaxation, nature, and cuisine.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast at Hotel/Local Cafe",
      "location": {
        "name": "Breakfast Spot"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node2",
      "type": "attraction",
      "title": "Morning Nature Exploration",
      "location": {
        "name": "Nature Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day2_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Lunch Spot"
      },
      "timing": {
        "startTime": "13:00",
        "endTime": "14:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation Activity",
      "location": {
        "name": "Relaxation Venue"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:30",
        "durationMin": 180
      }
    },
    {
      "id": "day2_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Dinner Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "21:00",
        "durationMin": 120
      }
    },
    {
      "id": "day2_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Accommodation Venue"
      },
      "timing": {
        "startTime": "21:30",
        "endTime": "08:00",
        "durationMin": 630
      }
    }
  ]
}
```
2025-10-25 10:25:04.508 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-25 10:25:04.509 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 2,
  "date": "2026-01-25",
  "location": "Sydney, New South Wales, Australia",
  "summary": "Day 2 itinerary outline focusing on relaxation, nature, and cuisine.",
  "nodes": [
    {
      "id": "day2_node1",
      "type": "meal",
      "title": "Breakfast at Hotel/Local Cafe",
      "location": {
        "name": "Breakfast Spot"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node2",
      "type": "attraction",
      "title": "Morning Nature Exploration",
      "location": {
        "name": "Nature Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:30",
        "durationMin": 180
      }
    },
    {
      "id": "day2_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Lunch Spot"
      },
      "timing": {
        "startTime": "13:00",
        "endTime": "14:00",
        "durationMin": 60
      }
    },
    {
      "id": "day2_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation Activity",
      "location": {
        "name": "Relaxation Venue"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:30",
        "durationMin": 180
      }
    },
    {
      "id": "day2_node5",
      "type": "meal",
      "title": "Dinner Experience",
      "location": {
        "name": "Dinner Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "21:00",
        "durationMin": 120
      }
    },
    {
      "id": "day2_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Accommodation Venue"
      },
      "timing": {
        "startTime": "21:30",
        "endTime": "08:00",
        "durationMin": 630
      }
    }
  ]
}
2025-10-25 10:25:05.044 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"day_completed","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e00555...(truncated)
2025-10-25 10:25:05.044 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:05.044 [Pipeline-76] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, day=2, activities=6
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 2 created and saved
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 01c4bf18-cf9a-4c09-9745-0786124f3cac
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 50
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 3 structure
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:05.045009600Z
2025-10-25 10:25:05.045 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:05.045 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 3 with minimal prompt
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2955
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:25:05.045 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-25 10:25:05.046 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3369
2025-10-25 10:25:05.046 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:25:13.853 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:25:13.853 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:25:13.853 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Length: 2703
2025-10-25 10:25:13.853 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 3,\n  \"date\": \"2026-01-26\",\n  \"location\": \"Sydney, New South Wales, Australia\",\n  \"summary\": \"Day 3 focuses on relaxation, nature, and culinary experiences in Sydney.\",\n  \"nodes\": [\n    {\n      \"id\": \"day3_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Breakfast\",\n      \"location\": {\n        \"name\": \"Morning Meal Venue\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day3_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Nature Exploration\",\n      \"location\": {\n        \"name\": \"Natural Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day3_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Lunch Break\",\n      \"location\": {\n        \"name\": \"Lunch Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"13:30\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day3_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Relaxation Activity\",\n      \"location\": {\n        \"name\": \"Leisure Location\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:30\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day3_node5\",\n      \"type\": \"meal\",\n      \"title\": \"Evening Dining Experience\",\n      \"location\": {\n        \"name\": \"Dinner Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"20:30\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day3_node6\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Hotel/Accommodation\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:00\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 660\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 842,
    "candidatesTokenCount": 660,
    "totalTokenCount": 2370,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 842
      }
    ],
    "thoughtsTokenCount": 868
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "MFj8aOioLLee1e8P6aHFsAE"
}

2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_551930213_20251025_102513.json
2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1872
2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 3,
  "date": "2026-01-26",
  "location": "Sydney, New South Wales, Australia",
  "summary": "Day 3 focuses on relaxation, nature, and culinary experiences in Sydney.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "locat...
2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 3
2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 3,
  "date": "2026-01-26",
  "location": "Sydney, New South Wales, Australia",
  "summary": "Day 3 focuses on relaxation, nature, and culinary experiences in Sydney.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Morning Meal Venue"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node2",
      "type": "attraction",
      "title": "Morning Nature Exploration",
      "location": {
        "name": "Natural Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Lunch Spot"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation Activity",
      "location": {
        "name": "Leisure Location"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node5",
      "type": "meal",
      "title": "Evening Dining Experience",
      "location": {
        "name": "Dinner Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day3_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel/Accommodation"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
```
2025-10-25 10:25:13.855 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-25 10:25:13.857 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 3,
  "date": "2026-01-26",
  "location": "Sydney, New South Wales, Australia",
  "summary": "Day 3 focuses on relaxation, nature, and culinary experiences in Sydney.",
  "nodes": [
    {
      "id": "day3_node1",
      "type": "meal",
      "title": "Breakfast",
      "location": {
        "name": "Morning Meal Venue"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node2",
      "type": "attraction",
      "title": "Morning Nature Exploration",
      "location": {
        "name": "Natural Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node3",
      "type": "meal",
      "title": "Lunch Break",
      "location": {
        "name": "Lunch Spot"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "13:30",
        "durationMin": 60
      }
    },
    {
      "id": "day3_node4",
      "type": "attraction",
      "title": "Afternoon Relaxation Activity",
      "location": {
        "name": "Leisure Location"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day3_node5",
      "type": "meal",
      "title": "Evening Dining Experience",
      "location": {
        "name": "Dinner Restaurant"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "20:30",
        "durationMin": 90
      }
    },
    {
      "id": "day3_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Hotel/Accommodation"
      },
      "timing": {
        "startTime": "21:00",
        "endTime": "08:00",
        "durationMin": 660
      }
    }
  ]
}
2025-10-25 10:25:14.297 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"day_completed","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e00555...(truncated)
2025-10-25 10:25:14.297 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:14.298 [Pipeline-76] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, day=3, activities=6
2025-10-25 10:25:14.298 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 3 created and saved
2025-10-25 10:25:14.298 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:14.298 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:14.298 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 01c4bf18-cf9a-4c09-9745-0786124f3cac
2025-10-25 10:25:14.298 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:25:14.298 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:14.298 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 65
2025-10-25 10:25:14.298 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Creating day 4 structure
2025-10-25 10:25:14.299 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_generation
2025-10-25 10:25:14.299 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:14.298587400Z
2025-10-25 10:25:14.299 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:14.299 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:14.299 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generating skeleton for day 4 with minimal prompt
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2955
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:25:14.300 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel planning assistant creating a DAY STRUCTURE SKELETON.

IMPORTANT: Generate ONLY the basic structure, NOT detailed information.

Your job:
1. Create time slots for the day (morning to ...
2025-10-25 10:25:14.301 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3369
2025-10-25 10:25:14.301 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:25:24.331 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:25:24.331 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:25:24.332 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Length: 2744
2025-10-25 10:25:24.332 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"dayNumber\": 4,\n  \"date\": \"2026-01-27\",\n  \"location\": \"Sydney, New South Wales, Australia\",\n  \"summary\": \"A relaxed final day in Sydney focusing on nature, luxury dining, and winding down.\",\n  \"nodes\": [\n    {\n      \"id\": \"day4_node1\",\n      \"type\": \"meal\",\n      \"title\": \"Luxury Breakfast\",\n      \"location\": {\n        \"name\": \"Hotel Dining Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"08:00\",\n        \"endTime\": \"09:00\",\n        \"durationMin\": 60\n      }\n    },\n    {\n      \"id\": \"day4_node2\",\n      \"type\": \"attraction\",\n      \"title\": \"Morning Relaxation / Nature Experience\",\n      \"location\": {\n        \"name\": \"Scenic Outdoor Area\"\n      },\n      \"timing\": {\n        \"startTime\": \"09:30\",\n        \"endTime\": \"12:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day4_node3\",\n      \"type\": \"meal\",\n      \"title\": \"Gourmet Lunch\",\n      \"location\": {\n        \"name\": \"Local Restaurant\"\n      },\n      \"timing\": {\n        \"startTime\": \"12:30\",\n        \"endTime\": \"14:00\",\n        \"durationMin\": 90\n      }\n    },\n    {\n      \"id\": \"day4_node4\",\n      \"type\": \"attraction\",\n      \"title\": \"Afternoon Leisure / Final Views\",\n      \"location\": {\n        \"name\": \"Relaxation Spot\"\n      },\n      \"timing\": {\n        \"startTime\": \"14:30\",\n        \"endTime\": \"17:00\",\n        \"durationMin\": 150\n      }\n    },\n    {\n      \"id\": \"day4_node5\",\n      \"type\": \"meal\",\n      \"title\": \"Farewell Dinner\",\n      \"location\": {\n        \"name\": \"High-End Dining Establishment\"\n      },\n      \"timing\": {\n        \"startTime\": \"19:00\",\n        \"endTime\": \"21:00\",\n        \"durationMin\": 120\n      }\n    },\n    {\n      \"id\": \"day4_node6\",\n      \"type\": \"accommodation\",\n      \"title\": \"Overnight Stay\",\n      \"location\": {\n        \"name\": \"Luxury Hotel\"\n      },\n      \"timing\": {\n        \"startTime\": \"21:30\",\n        \"endTime\": \"08:00\",\n        \"durationMin\": 630\n      }\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 842,
    "candidatesTokenCount": 673,
    "totalTokenCount": 2558,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 842
      }
    ],
    "thoughtsTokenCount": 1043
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "O1j8aJ_uC_6yvr0P3JnFsAw"
}

2025-10-25 10:25:24.334 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-2018255519_20251025_102524.json
2025-10-25 10:25:24.334 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:25:24.334 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content length: 1912
2025-10-25 10:25:24.334 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "dayNumber": 4,
  "date": "2026-01-27",
  "location": "Sydney, New South Wales, Australia",
  "summary": "A relaxed final day in Sydney focusing on nature, luxury dining, and winding down.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Luxury Breakfa...
2025-10-25 10:25:24.334 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:25:24.334 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:25:24.334 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON PLANNER AGENT - FULL LLM RESPONSE ===
2025-10-25 10:25:24.335 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Day: 4
2025-10-25 10:25:24.335 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Raw Response: ```json
{
  "dayNumber": 4,
  "date": "2026-01-27",
  "location": "Sydney, New South Wales, Australia",
  "summary": "A relaxed final day in Sydney focusing on nature, luxury dining, and winding down.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Luxury Breakfast",
      "location": {
        "name": "Hotel Dining Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node2",
      "type": "attraction",
      "title": "Morning Relaxation / Nature Experience",
      "location": {
        "name": "Scenic Outdoor Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day4_node3",
      "type": "meal",
      "title": "Gourmet Lunch",
      "location": {
        "name": "Local Restaurant"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "14:00",
        "durationMin": 90
      }
    },
    {
      "id": "day4_node4",
      "type": "attraction",
      "title": "Afternoon Leisure / Final Views",
      "location": {
        "name": "Relaxation Spot"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day4_node5",
      "type": "meal",
      "title": "Farewell Dinner",
      "location": {
        "name": "High-End Dining Establishment"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "21:00",
        "durationMin": 120
      }
    },
    {
      "id": "day4_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel"
      },
      "timing": {
        "startTime": "21:30",
        "endTime": "08:00",
        "durationMin": 630
      }
    }
  ]
}
```
2025-10-25 10:25:24.335 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === END SKELETON PLANNER RESPONSE ===
2025-10-25 10:25:24.337 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Cleaned Response: {
  "dayNumber": 4,
  "date": "2026-01-27",
  "location": "Sydney, New South Wales, Australia",
  "summary": "A relaxed final day in Sydney focusing on nature, luxury dining, and winding down.",
  "nodes": [
    {
      "id": "day4_node1",
      "type": "meal",
      "title": "Luxury Breakfast",
      "location": {
        "name": "Hotel Dining Area"
      },
      "timing": {
        "startTime": "08:00",
        "endTime": "09:00",
        "durationMin": 60
      }
    },
    {
      "id": "day4_node2",
      "type": "attraction",
      "title": "Morning Relaxation / Nature Experience",
      "location": {
        "name": "Scenic Outdoor Area"
      },
      "timing": {
        "startTime": "09:30",
        "endTime": "12:00",
        "durationMin": 150
      }
    },
    {
      "id": "day4_node3",
      "type": "meal",
      "title": "Gourmet Lunch",
      "location": {
        "name": "Local Restaurant"
      },
      "timing": {
        "startTime": "12:30",
        "endTime": "14:00",
        "durationMin": 90
      }
    },
    {
      "id": "day4_node4",
      "type": "attraction",
      "title": "Afternoon Leisure / Final Views",
      "location": {
        "name": "Relaxation Spot"
      },
      "timing": {
        "startTime": "14:30",
        "endTime": "17:00",
        "durationMin": 150
      }
    },
    {
      "id": "day4_node5",
      "type": "meal",
      "title": "Farewell Dinner",
      "location": {
        "name": "High-End Dining Establishment"
      },
      "timing": {
        "startTime": "19:00",
        "endTime": "21:00",
        "durationMin": 120
      }
    },
    {
      "id": "day4_node6",
      "type": "accommodation",
      "title": "Overnight Stay",
      "location": {
        "name": "Luxury Hotel"
      },
      "timing": {
        "startTime": "21:30",
        "endTime": "08:00",
        "durationMin": 630
      }
    }
  ]
}
2025-10-25 10:25:24.837 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"day_completed","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e00555...(truncated)
2025-10-25 10:25:24.838 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:24.838 [Pipeline-76] INFO  com.tripplanner.service.AgentEventPublisher - Published day completed event via WebSocket: itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, day=4, activities=6
2025-10-25 10:25:24.839 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Skeleton day 4 created and saved
2025-10-25 10:25:24.839 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:24.839 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:24.839 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 01c4bf18-cf9a-4c09-9745-0786124f3cac
2025-10-25 10:25:24.840 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: PLANNER
2025-10-25 10:25:24.841 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:24.841 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-25 10:25:24.841 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Skeleton complete
2025-10-25 10:25:24.842 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: skeleton_complete
2025-10-25 10:25:24.843 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:24.839638600Z
2025-10-25 10:25:24.845 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:24.846 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:24.847 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:26.153 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - === SKELETON COMPLETE ===
2025-10-25 10:25:26.155 [Pipeline-76] INFO  com.tripplanner.agents.SkeletonPlannerAgent - Generated 4 days with 25 total node placeholders
2025-10-25 10:25:26.156 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Skeleton generation completed successfully for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:26.156 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 1 complete: 4 days created (41271 ms)
2025-10-25 10:25:26.158 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase skeleton completed in 41271 ms
2025-10-25 10:25:26.159 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:26.160 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:26.160 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 2: POPULATION ===
2025-10-25 10:25:26.160 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase population started: Populating node details...
2025-10-25 10:25:26.162 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:26.162 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:26.164 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"phase_transition","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e00...(truncated)
2025-10-25 10:25:26.164 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:26.165 [Pipeline-75] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, skeletonpopulation, progress=40%
2025-10-25 10:25:26.166 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Running population agents in PARALLEL
2025-10-25 10:25:26.171 [Pipeline-90] INFO  com.tripplanner.service.PipelineOrchestrator - [ActivityAgent] Starting...
2025-10-25 10:25:26.171 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT ===
2025-10-25 10:25:26.172 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - Populating attraction nodes for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:26.173 [Pipeline-76] INFO  com.tripplanner.service.PipelineOrchestrator - [TransportAgent] Starting...
2025-10-25 10:25:26.173 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT ===
2025-10-25 10:25:26.174 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - Populating transport nodes for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:26.174 [Pipeline-91] INFO  com.tripplanner.service.PipelineOrchestrator - [MealAgent] Starting...
2025-10-25 10:25:26.175 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT ===
2025-10-25 10:25:26.175 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - Populating meal nodes for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:26.177 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - Found 1 transport nodes to populate
2025-10-25 10:25:26.175 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - Found 8 attraction nodes to populate
2025-10-25 10:25:26.177 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - Found 12 meal nodes to populate
2025-10-25 10:25:26.178 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - Calling AI to populate 8 attractions
2025-10-25 10:25:26.180 [Pipeline-90] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:25:26.180 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:25:26.180 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:25:26.180 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - Calling AI to populate 12 meals
2025-10-25 10:25:26.180 [Pipeline-91] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:25:26.181 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:25:26.181 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:25:26.181 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:25:26.181 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:25:26.181 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:25:26.181 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 3137
2025-10-25 10:25:26.181 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:25:26.181 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a culinary travel expert specializing in dining recommendations.

Your task: Suggest SPECIFIC restaurants and dining places for meal slots.

CRITICAL: Use the EXACT node IDs provided in the us...
2025-10-25 10:25:26.181 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - Calling AI to populate 1 transport segments
2025-10-25 10:25:26.181 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:25:26.182 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:25:26.182 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting structured content generation with provider 1 (GeminiClient)
2025-10-25 10:25:26.182 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 3471
2025-10-25 10:25:26.182 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:25:26.182 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2669
2025-10-25 10:25:26.182 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:25:26.182 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a travel expert specializing in attractions and activities.

Your task: Suggest SPECIFIC attractions for placeholder activity nodes.

CRITICAL: Use the EXACT node IDs provided in the user prom...
2025-10-25 10:25:26.182 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:25:26.183 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2984
2025-10-25 10:25:26.183 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:25:26.183 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:25:26.183 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:25:26.183 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:25:26.183 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:25:26.183 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:25:26.183 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2063
2025-10-25 10:25:26.183 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:25:26.184 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are a transportation and logistics expert for travel planning.

Your task: Suggest SPECIFIC transport modes and routes for getting around.

Guidelines:
1. Suggest practical transport modes based o...
2025-10-25 10:25:26.186 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2368
2025-10-25 10:25:26.187 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:25:37.590 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:25:37.590 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:25:37.590 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Length: 1481
2025-10-25 10:25:37.590 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"transports\": [\n    {\n      \"nodeId\": \"day1_node5\",\n      \"title\": \"Rideshare/Taxi to Upscale Restaurant\",\n      \"description\": \"For a comfortable and direct transfer from a luxury wellness center to an upscale restaurant in Sydney, a rideshare service or taxi is highly recommended. This option offers door-to-door convenience, perfect for an evening out where time and comfort are priorities. Simply request a vehicle via an app like Uber, Ola, or DiDi from the entrance of your wellness center. Taxis are also readily available and can be hailed or booked via the 13cabs app. While walking might be an option depending on the exact locations, a rideshare/taxi ensures you arrive promptly and in style, especially if dressed for an upscale experience. Expect some evening traffic, but the journey should be swift.\",\n      \"mode\": \"rideshare\",\n      \"durationMinutes\": 10\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 528,
    "candidatesTokenCount": 216,
    "totalTokenCount": 2124,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 528
      }
    ],
    "thoughtsTokenCount": 1380
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "SFj8aPiUHqWe1e8Pmpnb4AI"
}

2025-10-25 10:25:37.597 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_21512947_20251025_102537.json
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content length: 900
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "transports": [
    {
      "nodeId": "day1_node5",
      "title": "Rideshare/Taxi to Upscale Restaurant",
      "description": "For a comfortable and direct transfer from a luxury wellness center to an upscale restaurant in Sydney, a rideshare service or taxi is highly recommended. This...
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT - FULL LLM RESPONSE ===
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - Contexts to populate: 1
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - Raw Response: ```json
{
  "transports": [
    {
      "nodeId": "day1_node5",
      "title": "Rideshare/Taxi to Upscale Restaurant",
      "description": "For a comfortable and direct transfer from a luxury wellness center to an upscale restaurant in Sydney, a rideshare service or taxi is highly recommended. This option offers door-to-door convenience, perfect for an evening out where time and comfort are priorities. Simply request a vehicle via an app like Uber, Ola, or DiDi from the entrance of your wellness center. Taxis are also readily available and can be hailed or booked via the 13cabs app. While walking might be an option depending on the exact locations, a rideshare/taxi ensures you arrive promptly and in style, especially if dressed for an upscale experience. Expect some evening traffic, but the journey should be swift.",
      "mode": "rideshare",
      "durationMinutes": 10
    }
  ]
}
```
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - === END TRANSPORT AGENT RESPONSE ===
2025-10-25 10:25:37.598 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - Cleaned Response: {
  "transports": [
    {
      "nodeId": "day1_node5",
      "title": "Rideshare/Taxi to Upscale Restaurant",
      "description": "For a comfortable and direct transfer from a luxury wellness center to an upscale restaurant in Sydney, a rideshare service or taxi is highly recommended. This option offers door-to-door convenience, perfect for an evening out where time and comfort are priorities. Simply request a vehicle via an app like Uber, Ola, or DiDi from the entrance of your wellness center. Taxis are also readily available and can be hailed or booked via the 13cabs app. While walking might be an option depending on the exact locations, a rideshare/taxi ensures you arrive promptly and in style, especially if dressed for an upscale experience. Expect some evening traffic, but the journey should be swift.",
      "mode": "rideshare",
      "durationMinutes": 10
    }
  ]
}
2025-10-25 10:25:38.081 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - Saved itinerary with populated transport
2025-10-25 10:25:38.082 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - === TRANSPORT AGENT COMPLETE ===
2025-10-25 10:25:38.082 [Pipeline-76] INFO  com.tripplanner.agents.TransportAgent - Populated 1 transport segments
2025-10-25 10:25:38.082 [Pipeline-76] INFO  com.tripplanner.service.PipelineOrchestrator - [TransportAgent] Complete
2025-10-25 10:25:41.114 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:25:41.114 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:25:41.114 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Response Length: 5950
2025-10-25 10:25:41.114 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"meals\": [\n    {\n      \"nodeId\": \"day1_node1\",\n      \"title\": \"Sydney Fish Market\",\n      \"description\": \"Dive into the freshest catch of the day at Australia's largest working fish market. Enjoy succulent oysters, grilled seafood, or classic fish and chips in a vibrant, bustling atmosphere by the water.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Pyrmont\"\n    },\n    {\n      \"nodeId\": \"day1_node3\",\n      \"title\": \"The Glenmore Hotel (Rooftop)\",\n      \"description\": \"Experience classic Australian pub fare with an unbeatable view of the Sydney Opera House and Harbour Bridge. Enjoy hearty burgers, steaks, or fresh salads while soaking in the iconic Sydney skyline from this historic rooftop.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"The Rocks\"\n    },\n    {\n      \"nodeId\": \"day1_node6\",\n      \"title\": \"Mr. Wong\",\n      \"description\": \"Indulge in sophisticated Cantonese cuisine in a grand, 1930s Shanghai-inspired setting. Known for its exquisite dim sum, Peking duck, and extensive menu of modern Chinese dishes, it's a vibrant and popular dining spot.\",\n      \"cuisineType\": \"chinese\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"CBD\"\n    },\n    {\n      \"nodeId\": \"day2_node1\",\n      \"title\": \"Spice Alley, Kensington Street\",\n      \"description\": \"Embark on a culinary journey through Asia at this vibrant outdoor food precinct. Choose from a variety of authentic hawker-style dishes, from Malaysian laksa to Japanese ramen, in a lively, lantern-lit laneway.\",\n      \"cuisineType\": \"street_food\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Chippendale\"\n    },\n    {\n      \"nodeId\": \"day2_node3\",\n      \"title\": \"Aria Restaurant Sydney\",\n      \"description\": \"Savor contemporary Australian fine dining with breathtaking views of the Sydney Opera House and Harbour Bridge. Chef Matt Moran's menu highlights seasonal, locally sourced ingredients in an elegant setting perfect for a special evening.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Circular Quay\"\n    },\n    {\n      \"nodeId\": \"day2_node5\",\n      \"title\": \"Totti's\",\n      \"description\": \"Enjoy simple, delicious Italian food in a relaxed, buzzing atmosphere. Famous for its wood-fired bread and antipasti, its the perfect spot for sharing plates and enjoying a lively evening with friends.\",\n      \"cuisineType\": \"italian\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Bondi\"\n    },\n    {\n      \"nodeId\": \"day3_node1\",\n      \"title\": \"The Grounds of Alexandria\",\n      \"description\": \"Escape to this enchanting urban oasis for a delightful lunch amidst lush gardens and a charming farmyard. Enjoy farm-to-table dishes, freshly baked pastries, and exceptional coffee in a truly unique setting.\",\n      \"cuisineType\": \"cafe\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Alexandria\"\n    },\n    {\n      \"nodeId\": \"day3_node3\",\n      \"title\": \"Icebergs Dining Room and Bar\",\n      \"description\": \"Dine with an iconic view of Bondi Beach and its famous ocean pool. This elegant restaurant offers refined Italian cuisine with a modern Australian twist, making it an unforgettable dining experience by the sea.\",\n      \"cuisineType\": \"italian\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Bondi Beach\"\n    },\n    {\n      \"nodeId\": \"day3_node5\",\n      \"title\": \"Golden Century Seafood Restaurant\",\n      \"description\": \"Experience authentic Cantonese seafood in a bustling, late-night setting popular with locals and chefs alike. Choose your live seafood from tanks and have it expertly prepared, a true Sydney institution.\",\n      \"cuisineType\": \"chinese\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Sussex Street, Chinatown\"\n    },\n    {\n      \"nodeId\": \"day4_node1\",\n      \"title\": \"Bill's, Surry Hills\",\n      \"description\": \"Savor a relaxed yet sophisticated lunch at Bill Granger's original cafe, famous for its fresh, simple, and utterly delicious modern Australian fare. Indulge in their iconic ricotta hotcakes or a vibrant salad.\",\n      \"cuisineType\": \"cafe\",\n      \"mealType\": \"lunch\",\n      \"locationName\": \"Surry Hills\"\n    },\n    {\n      \"nodeId\": \"day4_node3\",\n      \"title\": \"Quay\",\n      \"description\": \"Embark on an extraordinary culinary journey at one of Sydney's most celebrated restaurants. Chef Peter Gilmore's innovative menu, paired with unparalleled views of the Sydney Harbour, creates an unforgettable fine dining experience.\",\n      \"cuisineType\": \"international\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"Circular Quay\"\n    },\n    {\n      \"nodeId\": \"day4_node5\",\n      \"title\": \"Rockpool Bar & Grill\",\n      \"description\": \"Indulge in a sophisticated steakhouse experience in a stunning art deco setting. Neil Perry's Rockpool offers premium, wood-fired meats, fresh seafood, and an extensive wine list for an elegant final dinner.\",\n      \"cuisineType\": \"local\",\n      \"mealType\": \"dinner\",\n      \"locationName\": \"CBD\"\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 1011,
    "candidatesTokenCount": 1295,
    "totalTokenCount": 3601,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 1011
      }
    ],
    "thoughtsTokenCount": 1295
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "S1j8aPPWPMShvr0P0Iu4-Qo"
}

2025-10-25 10:25:41.118 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-240886927_20251025_102541.json
2025-10-25 10:25:41.119 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:25:41.119 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Generated content length: 5007
2025-10-25 10:25:41.119 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "Sydney Fish Market",
      "description": "Dive into the freshest catch of the day at Australia's largest working fish market. Enjoy succulent oysters, grilled seafood, or classic fish and chips in a vibrant, bustling atmosph...
2025-10-25 10:25:41.119 [Pipeline-91] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:25:41.119 [Pipeline-91] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:25:41.119 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT - FULL LLM RESPONSE ===
2025-10-25 10:25:41.120 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - Contexts to populate: 12
2025-10-25 10:25:41.120 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - Raw Response: ```json
{
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "Sydney Fish Market",
      "description": "Dive into the freshest catch of the day at Australia's largest working fish market. Enjoy succulent oysters, grilled seafood, or classic fish and chips in a vibrant, bustling atmosphere by the water.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Pyrmont"
    },
    {
      "nodeId": "day1_node3",
      "title": "The Glenmore Hotel (Rooftop)",
      "description": "Experience classic Australian pub fare with an unbeatable view of the Sydney Opera House and Harbour Bridge. Enjoy hearty burgers, steaks, or fresh salads while soaking in the iconic Sydney skyline from this historic rooftop.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "The Rocks"
    },
    {
      "nodeId": "day1_node6",
      "title": "Mr. Wong",
      "description": "Indulge in sophisticated Cantonese cuisine in a grand, 1930s Shanghai-inspired setting. Known for its exquisite dim sum, Peking duck, and extensive menu of modern Chinese dishes, it's a vibrant and popular dining spot.",
      "cuisineType": "chinese",
      "mealType": "dinner",
      "locationName": "CBD"
    },
    {
      "nodeId": "day2_node1",
      "title": "Spice Alley, Kensington Street",
      "description": "Embark on a culinary journey through Asia at this vibrant outdoor food precinct. Choose from a variety of authentic hawker-style dishes, from Malaysian laksa to Japanese ramen, in a lively, lantern-lit laneway.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Chippendale"
    },
    {
      "nodeId": "day2_node3",
      "title": "Aria Restaurant Sydney",
      "description": "Savor contemporary Australian fine dining with breathtaking views of the Sydney Opera House and Harbour Bridge. Chef Matt Moran's menu highlights seasonal, locally sourced ingredients in an elegant setting perfect for a special evening.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Circular Quay"
    },
    {
      "nodeId": "day2_node5",
      "title": "Totti's",
      "description": "Enjoy simple, delicious Italian food in a relaxed, buzzing atmosphere. Famous for its wood-fired bread and antipasti, its the perfect spot for sharing plates and enjoying a lively evening with friends.",
      "cuisineType": "italian",
      "mealType": "dinner",
      "locationName": "Bondi"
    },
    {
      "nodeId": "day3_node1",
      "title": "The Grounds of Alexandria",
      "description": "Escape to this enchanting urban oasis for a delightful lunch amidst lush gardens and a charming farmyard. Enjoy farm-to-table dishes, freshly baked pastries, and exceptional coffee in a truly unique setting.",
      "cuisineType": "cafe",
      "mealType": "lunch",
      "locationName": "Alexandria"
    },
    {
      "nodeId": "day3_node3",
      "title": "Icebergs Dining Room and Bar",
      "description": "Dine with an iconic view of Bondi Beach and its famous ocean pool. This elegant restaurant offers refined Italian cuisine with a modern Australian twist, making it an unforgettable dining experience by the sea.",
      "cuisineType": "italian",
      "mealType": "dinner",
      "locationName": "Bondi Beach"
    },
    {
      "nodeId": "day3_node5",
      "title": "Golden Century Seafood Restaurant",
      "description": "Experience authentic Cantonese seafood in a bustling, late-night setting popular with locals and chefs alike. Choose your live seafood from tanks and have it expertly prepared, a true Sydney institution.",
      "cuisineType": "chinese",
      "mealType": "dinner",
      "locationName": "Sussex Street, Chinatown"
    },
    {
      "nodeId": "day4_node1",
      "title": "Bill's, Surry Hills",
      "description": "Savor a relaxed yet sophisticated lunch at Bill Granger's original cafe, famous for its fresh, simple, and utterly delicious modern Australian fare. Indulge in their iconic ricotta hotcakes or a vibrant salad.",
      "cuisineType": "cafe",
      "mealType": "lunch",
      "locationName": "Surry Hills"
    },
    {
      "nodeId": "day4_node3",
      "title": "Quay",
      "description": "Embark on an extraordinary culinary journey at one of Sydney's most celebrated restaurants. Chef Peter Gilmore's innovative menu, paired with unparalleled views of the Sydney Harbour, creates an unforgettable fine dining experience.",
      "cuisineType": "international",
      "mealType": "dinner",
      "locationName": "Circular Quay"
    },
    {
      "nodeId": "day4_node5",
      "title": "Rockpool Bar & Grill",
      "description": "Indulge in a sophisticated steakhouse experience in a stunning art deco setting. Neil Perry's Rockpool offers premium, wood-fired meats, fresh seafood, and an extensive wine list for an elegant final dinner.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "CBD"
    }
  ]
}
```
2025-10-25 10:25:41.121 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - === END MEAL AGENT RESPONSE ===
2025-10-25 10:25:41.123 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - Cleaned Response: {
  "meals": [
    {
      "nodeId": "day1_node1",
      "title": "Sydney Fish Market",
      "description": "Dive into the freshest catch of the day at Australia's largest working fish market. Enjoy succulent oysters, grilled seafood, or classic fish and chips in a vibrant, bustling atmosphere by the water.",
      "cuisineType": "local",
      "mealType": "lunch",
      "locationName": "Pyrmont"
    },
    {
      "nodeId": "day1_node3",
      "title": "The Glenmore Hotel (Rooftop)",
      "description": "Experience classic Australian pub fare with an unbeatable view of the Sydney Opera House and Harbour Bridge. Enjoy hearty burgers, steaks, or fresh salads while soaking in the iconic Sydney skyline from this historic rooftop.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "The Rocks"
    },
    {
      "nodeId": "day1_node6",
      "title": "Mr. Wong",
      "description": "Indulge in sophisticated Cantonese cuisine in a grand, 1930s Shanghai-inspired setting. Known for its exquisite dim sum, Peking duck, and extensive menu of modern Chinese dishes, it's a vibrant and popular dining spot.",
      "cuisineType": "chinese",
      "mealType": "dinner",
      "locationName": "CBD"
    },
    {
      "nodeId": "day2_node1",
      "title": "Spice Alley, Kensington Street",
      "description": "Embark on a culinary journey through Asia at this vibrant outdoor food precinct. Choose from a variety of authentic hawker-style dishes, from Malaysian laksa to Japanese ramen, in a lively, lantern-lit laneway.",
      "cuisineType": "street_food",
      "mealType": "lunch",
      "locationName": "Chippendale"
    },
    {
      "nodeId": "day2_node3",
      "title": "Aria Restaurant Sydney",
      "description": "Savor contemporary Australian fine dining with breathtaking views of the Sydney Opera House and Harbour Bridge. Chef Matt Moran's menu highlights seasonal, locally sourced ingredients in an elegant setting perfect for a special evening.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "Circular Quay"
    },
    {
      "nodeId": "day2_node5",
      "title": "Totti's",
      "description": "Enjoy simple, delicious Italian food in a relaxed, buzzing atmosphere. Famous for its wood-fired bread and antipasti, its the perfect spot for sharing plates and enjoying a lively evening with friends.",
      "cuisineType": "italian",
      "mealType": "dinner",
      "locationName": "Bondi"
    },
    {
      "nodeId": "day3_node1",
      "title": "The Grounds of Alexandria",
      "description": "Escape to this enchanting urban oasis for a delightful lunch amidst lush gardens and a charming farmyard. Enjoy farm-to-table dishes, freshly baked pastries, and exceptional coffee in a truly unique setting.",
      "cuisineType": "cafe",
      "mealType": "lunch",
      "locationName": "Alexandria"
    },
    {
      "nodeId": "day3_node3",
      "title": "Icebergs Dining Room and Bar",
      "description": "Dine with an iconic view of Bondi Beach and its famous ocean pool. This elegant restaurant offers refined Italian cuisine with a modern Australian twist, making it an unforgettable dining experience by the sea.",
      "cuisineType": "italian",
      "mealType": "dinner",
      "locationName": "Bondi Beach"
    },
    {
      "nodeId": "day3_node5",
      "title": "Golden Century Seafood Restaurant",
      "description": "Experience authentic Cantonese seafood in a bustling, late-night setting popular with locals and chefs alike. Choose your live seafood from tanks and have it expertly prepared, a true Sydney institution.",
      "cuisineType": "chinese",
      "mealType": "dinner",
      "locationName": "Sussex Street, Chinatown"
    },
    {
      "nodeId": "day4_node1",
      "title": "Bill's, Surry Hills",
      "description": "Savor a relaxed yet sophisticated lunch at Bill Granger's original cafe, famous for its fresh, simple, and utterly delicious modern Australian fare. Indulge in their iconic ricotta hotcakes or a vibrant salad.",
      "cuisineType": "cafe",
      "mealType": "lunch",
      "locationName": "Surry Hills"
    },
    {
      "nodeId": "day4_node3",
      "title": "Quay",
      "description": "Embark on an extraordinary culinary journey at one of Sydney's most celebrated restaurants. Chef Peter Gilmore's innovative menu, paired with unparalleled views of the Sydney Harbour, creates an unforgettable fine dining experience.",
      "cuisineType": "international",
      "mealType": "dinner",
      "locationName": "Circular Quay"
    },
    {
      "nodeId": "day4_node5",
      "title": "Rockpool Bar & Grill",
      "description": "Indulge in a sophisticated steakhouse experience in a stunning art deco setting. Neil Perry's Rockpool offers premium, wood-fired meats, fresh seafood, and an extensive wine list for an elegant final dinner.",
      "cuisineType": "local",
      "mealType": "dinner",
      "locationName": "CBD"
    }
  ]
}
2025-10-25 10:25:41.642 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - Saved itinerary with populated meals
2025-10-25 10:25:41.643 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - === MEAL AGENT COMPLETE ===
2025-10-25 10:25:41.643 [Pipeline-91] INFO  com.tripplanner.agents.MealAgent - Populated 12 meals
2025-10-25 10:25:41.643 [Pipeline-91] INFO  com.tripplanner.service.PipelineOrchestrator - [MealAgent] Complete
2025-10-25 10:25:43.167 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:25:43.167 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:25:43.167 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Response Length: 4333
2025-10-25 10:25:43.167 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"attractions\": [\n    {\n      \"nodeId\": \"day1_node2\",\n      \"title\": \"Sydney Opera House (Exterior & The Rocks)\",\n      \"description\": \"Witness the architectural marvel of the Sydney Opera House from its exterior, perfect for stunning photos. Afterwards, take a leisurely stroll through The Rocks, Sydney's oldest neighbourhood, and find a charming spot for dinner with harbour views.\",\n      \"category\": \"landmark\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"Sydney Harbour / The Rocks\"\n    },\n    {\n      \"nodeId\": \"day1_node4\",\n      \"title\": \"Darling Harbour Evening Stroll\",\n      \"description\": \"Enjoy a relaxing evening walk around Darling Harbour. Admire the vibrant lights reflecting on the water, soak in the lively atmosphere, and perhaps find a cozy spot for a nightcap or dessert.\",\n      \"category\": \"entertainment\",\n      \"durationMinutes\": 90,\n      \"locationName\": \"Darling Harbour\"\n    },\n    {\n      \"nodeId\": \"day2_node2\",\n      \"title\": \"Royal Botanic Garden Sydney\",\n      \"description\": \"Escape into nature at the Royal Botanic Garden, a tranquil oasis offering stunning views of the Sydney Opera House and Harbour Bridge. Spend a few hours wandering through diverse plant collections and enjoying the peaceful surroundings.\",\n      \"category\": \"park\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"Mrs Macquaries Rd, Sydney\"\n    },\n    {\n      \"nodeId\": \"day2_node4\",\n      \"title\": \"Bondi Beach Relaxation\",\n      \"description\": \"Experience the iconic Bondi Beach, a perfect spot for relaxation and enjoying Sydney's coastal beauty. You can sunbathe, take a dip in the ocean, or simply enjoy a leisurely walk along the famous sands.\",\n      \"category\": \"nature\",\n      \"durationMinutes\": 240,\n      \"locationName\": \"Bondi Beach\"\n    },\n    {\n      \"nodeId\": \"day3_node2\",\n      \"title\": \"Taronga Zoo Sydney\",\n      \"description\": \"Embark on a wildlife adventure at Taronga Zoo, home to a diverse range of Australian and exotic animals. Enjoy breathtaking panoramic views of Sydney Harbour as you explore the exhibits and attend keeper talks.\",\n      \"category\": \"nature\",\n      \"durationMinutes\": 240,\n      \"locationName\": \"Mosman\"\n    },\n    {\n      \"nodeId\": \"day3_node4\",\n      \"title\": \"Queen Victoria Building (QVB) & High Tea\",\n      \"description\": \"Step back in time within the magnificent Queen Victoria Building, an architectural masterpiece filled with boutiques. Indulge in a luxurious high tea experience at one of its elegant cafes, combining relaxation with a touch of sophistication.\",\n      \"category\": \"experience\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"George St, Sydney\"\n    },\n    {\n      \"nodeId\": \"day4_node2\",\n      \"title\": \"Manly Beach & Scenic Ferry Ride\",\n      \"description\": \"Enjoy a picturesque ferry ride from Circular Quay to Manly, offering stunning views of Sydney Harbour. Once in Manly, relax on the beautiful beach, explore the vibrant Corso, or stroll along the coastal walk.\",\n      \"category\": \"nature\",\n      \"durationMinutes\": 240,\n      \"locationName\": \"Manly\"\n    },\n    {\n      \"nodeId\": \"day4_node4\",\n      \"title\": \"The Rocks Culinary Exploration\",\n      \"description\": \"Delight your taste buds with a culinary exploration in The Rocks. Discover hidden cafes, historical pubs, and world-class restaurants offering diverse cuisine, perfect for a memorable farewell dinner or a gourmet tasting experience.\",\n      \"category\": \"cuisine\",\n      \"durationMinutes\": 180,\n      \"locationName\": \"The Rocks, Sydney\"\n    }\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 791,
    "candidatesTokenCount": 893,
    "totalTokenCount": 3338,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 791
      }
    ],
    "thoughtsTokenCount": 1654
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "Tlj8aJY-hrXV7w-T-NfIAg"
}

2025-10-25 10:25:43.168 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-1162095709_20251025_102543.json
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Generated content length: 3538
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Sydney Opera House (Exterior & The Rocks)",
      "description": "Witness the architectural marvel of the Sydney Opera House from its exterior, perfect for stunning photos. Afterwards, take a leisurely stroll through Th...
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT - FULL LLM RESPONSE ===
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - Contexts to populate: 8
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - Raw Response: ```json
{
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Sydney Opera House (Exterior & The Rocks)",
      "description": "Witness the architectural marvel of the Sydney Opera House from its exterior, perfect for stunning photos. Afterwards, take a leisurely stroll through The Rocks, Sydney's oldest neighbourhood, and find a charming spot for dinner with harbour views.",
      "category": "landmark",
      "durationMinutes": 180,
      "locationName": "Sydney Harbour / The Rocks"
    },
    {
      "nodeId": "day1_node4",
      "title": "Darling Harbour Evening Stroll",
      "description": "Enjoy a relaxing evening walk around Darling Harbour. Admire the vibrant lights reflecting on the water, soak in the lively atmosphere, and perhaps find a cozy spot for a nightcap or dessert.",
      "category": "entertainment",
      "durationMinutes": 90,
      "locationName": "Darling Harbour"
    },
    {
      "nodeId": "day2_node2",
      "title": "Royal Botanic Garden Sydney",
      "description": "Escape into nature at the Royal Botanic Garden, a tranquil oasis offering stunning views of the Sydney Opera House and Harbour Bridge. Spend a few hours wandering through diverse plant collections and enjoying the peaceful surroundings.",
      "category": "park",
      "durationMinutes": 180,
      "locationName": "Mrs Macquaries Rd, Sydney"
    },
    {
      "nodeId": "day2_node4",
      "title": "Bondi Beach Relaxation",
      "description": "Experience the iconic Bondi Beach, a perfect spot for relaxation and enjoying Sydney's coastal beauty. You can sunbathe, take a dip in the ocean, or simply enjoy a leisurely walk along the famous sands.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Bondi Beach"
    },
    {
      "nodeId": "day3_node2",
      "title": "Taronga Zoo Sydney",
      "description": "Embark on a wildlife adventure at Taronga Zoo, home to a diverse range of Australian and exotic animals. Enjoy breathtaking panoramic views of Sydney Harbour as you explore the exhibits and attend keeper talks.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Mosman"
    },
    {
      "nodeId": "day3_node4",
      "title": "Queen Victoria Building (QVB) & High Tea",
      "description": "Step back in time within the magnificent Queen Victoria Building, an architectural masterpiece filled with boutiques. Indulge in a luxurious high tea experience at one of its elegant cafes, combining relaxation with a touch of sophistication.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "George St, Sydney"
    },
    {
      "nodeId": "day4_node2",
      "title": "Manly Beach & Scenic Ferry Ride",
      "description": "Enjoy a picturesque ferry ride from Circular Quay to Manly, offering stunning views of Sydney Harbour. Once in Manly, relax on the beautiful beach, explore the vibrant Corso, or stroll along the coastal walk.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Manly"
    },
    {
      "nodeId": "day4_node4",
      "title": "The Rocks Culinary Exploration",
      "description": "Delight your taste buds with a culinary exploration in The Rocks. Discover hidden cafes, historical pubs, and world-class restaurants offering diverse cuisine, perfect for a memorable farewell dinner or a gourmet tasting experience.",
      "category": "cuisine",
      "durationMinutes": 180,
      "locationName": "The Rocks, Sydney"
    }
  ]
}
```
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - === END ACTIVITY AGENT RESPONSE ===
2025-10-25 10:25:43.169 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - Cleaned Response: {
  "attractions": [
    {
      "nodeId": "day1_node2",
      "title": "Sydney Opera House (Exterior & The Rocks)",
      "description": "Witness the architectural marvel of the Sydney Opera House from its exterior, perfect for stunning photos. Afterwards, take a leisurely stroll through The Rocks, Sydney's oldest neighbourhood, and find a charming spot for dinner with harbour views.",
      "category": "landmark",
      "durationMinutes": 180,
      "locationName": "Sydney Harbour / The Rocks"
    },
    {
      "nodeId": "day1_node4",
      "title": "Darling Harbour Evening Stroll",
      "description": "Enjoy a relaxing evening walk around Darling Harbour. Admire the vibrant lights reflecting on the water, soak in the lively atmosphere, and perhaps find a cozy spot for a nightcap or dessert.",
      "category": "entertainment",
      "durationMinutes": 90,
      "locationName": "Darling Harbour"
    },
    {
      "nodeId": "day2_node2",
      "title": "Royal Botanic Garden Sydney",
      "description": "Escape into nature at the Royal Botanic Garden, a tranquil oasis offering stunning views of the Sydney Opera House and Harbour Bridge. Spend a few hours wandering through diverse plant collections and enjoying the peaceful surroundings.",
      "category": "park",
      "durationMinutes": 180,
      "locationName": "Mrs Macquaries Rd, Sydney"
    },
    {
      "nodeId": "day2_node4",
      "title": "Bondi Beach Relaxation",
      "description": "Experience the iconic Bondi Beach, a perfect spot for relaxation and enjoying Sydney's coastal beauty. You can sunbathe, take a dip in the ocean, or simply enjoy a leisurely walk along the famous sands.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Bondi Beach"
    },
    {
      "nodeId": "day3_node2",
      "title": "Taronga Zoo Sydney",
      "description": "Embark on a wildlife adventure at Taronga Zoo, home to a diverse range of Australian and exotic animals. Enjoy breathtaking panoramic views of Sydney Harbour as you explore the exhibits and attend keeper talks.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Mosman"
    },
    {
      "nodeId": "day3_node4",
      "title": "Queen Victoria Building (QVB) & High Tea",
      "description": "Step back in time within the magnificent Queen Victoria Building, an architectural masterpiece filled with boutiques. Indulge in a luxurious high tea experience at one of its elegant cafes, combining relaxation with a touch of sophistication.",
      "category": "experience",
      "durationMinutes": 180,
      "locationName": "George St, Sydney"
    },
    {
      "nodeId": "day4_node2",
      "title": "Manly Beach & Scenic Ferry Ride",
      "description": "Enjoy a picturesque ferry ride from Circular Quay to Manly, offering stunning views of Sydney Harbour. Once in Manly, relax on the beautiful beach, explore the vibrant Corso, or stroll along the coastal walk.",
      "category": "nature",
      "durationMinutes": 240,
      "locationName": "Manly"
    },
    {
      "nodeId": "day4_node4",
      "title": "The Rocks Culinary Exploration",
      "description": "Delight your taste buds with a culinary exploration in The Rocks. Discover hidden cafes, historical pubs, and world-class restaurants offering diverse cuisine, perfect for a memorable farewell dinner or a gourmet tasting experience.",
      "category": "cuisine",
      "durationMinutes": 180,
      "locationName": "The Rocks, Sydney"
    }
  ]
}
2025-10-25 10:25:43.685 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - Saved itinerary with populated attractions
2025-10-25 10:25:43.686 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - === ACTIVITY AGENT COMPLETE ===
2025-10-25 10:25:43.686 [Pipeline-90] INFO  com.tripplanner.agents.ActivityAgent - Populated 8 attractions
2025-10-25 10:25:43.686 [Pipeline-90] INFO  com.tripplanner.service.PipelineOrchestrator - [ActivityAgent] Complete
2025-10-25 10:25:43.686 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - All population agents completed successfully
2025-10-25 10:25:43.686 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 2 complete (17530 ms)
2025-10-25 10:25:43.686 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase population completed in 17530 ms
2025-10-25 10:25:43.688 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:43.688 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:43.688 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 3: ENRICHMENT ===
2025-10-25 10:25:43.688 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase ENRICHMENT started: Adding location details...
2025-10-25 10:25:43.689 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:43.689 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:43.695 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"phase_transition","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e00...(truncated)
2025-10-25 10:25:43.695 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:43.695 [Pipeline-75] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, unknownENRICHMENT, progress=0%
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - === AGENT EXECUTION START ===
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Agent Kind: ENRICHMENT
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Request Type: ApplyResult
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Request Data: {taskType=enrich}
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Request Details: {taskType=enrich}
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - =============================
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: queued
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 0
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Agent queued for execution
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:43.698590800Z
2025-10-25 10:25:43.698 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:43.698 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Agent started
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:25:43.698 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:43.698590800Z
2025-10-25 10:25:43.699 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:43.699 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:43.699 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:43.699 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Executing agent-specific logic for: ENRICHMENT
2025-10-25 10:25:43.699 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - === ENRICHMENT AGENT PROCESSING ===
2025-10-25 10:25:43.699 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:45.192 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:45.192 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:45.192 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:25:45.192 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:25:45.192 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:45.192 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-25 10:25:45.192 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Loading itinerary
2025-10-25 10:25:45.192 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: loading
2025-10-25 10:25:45.192 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:45.192781900Z
2025-10-25 10:25:45.194 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:45.194 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:45.194 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:45.195 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:45.195 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:45.195 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:25:45.195 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:25:45.195 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:45.195 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-25 10:25:45.195 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Enriching places with Google Places data
2025-10-25 10:25:45.195 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: ENRICHMENT
2025-10-25 10:25:45.195 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:45.195778300Z
2025-10-25 10:25:45.195 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:45.196 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:45.196 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:45.225 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Pyrmont&key=
2025-10-25 10:25:45.248 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:25:45.790 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:25:45.791 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:25:45.793 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:25:45.793 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 1
2025-10-25 10:25:45.794 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Sydney%2520Harbour%2520/%2520The%2520Rocks&key=
2025-10-25 10:25:45.794 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:25:46.034 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:25:46.035 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:25:46.035 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:25:46.035 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 2
2025-10-25 10:25:46.036 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=The%2520Rocks&key=
2025-10-25 10:25:46.036 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:25:46.015 [http-nio-8080-exec-10] DEBUG o.s.s.w.firewall.HttpStatusRequestRejectedHandler - Rejecting request due to: The request was rejected because the URL contained a potentially malicious String "//"
org.springframework.security.web.firewall.RequestRejectedException: The request was rejected because the URL contained a potentially malicious String "//"
	at org.springframework.security.web.firewall.StrictHttpFirewall.rejectedBlocklistedUrls(StrictHttpFirewall.java:548)
	at org.springframework.security.web.firewall.StrictHttpFirewall.getFirewalledRequest(StrictHttpFirewall.java:518)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:211)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.tripplanner.config.FirebaseAuthConfig$FirebaseAuthFilter.doFilterInternal(FirebaseAuthConfig.java:55)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-25 10:25:46.054 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /error
2025-10-25 10:25:46.055 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured OPTIONS /error
2025-10-25 10:25:46.055 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - "ERROR" dispatch for OPTIONS "/error", parameters={}
2025-10-25 10:25:46.056 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to org.springframework.boot.autoconfigure.web.servlet.error.BasicErrorController#error(HttpServletRequest)
2025-10-25 10:25:46.065 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Exiting from "ERROR" dispatch, status 403
2025-10-25 10:25:46.065 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:25:46.157 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:25:46.158 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:25:46.158 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:25:46.158 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 3
2025-10-25 10:25:46.159 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=Darling%2520Harbour&key=
2025-10-25 10:25:46.159 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:25:46.472 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:25:46.473 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:25:46.473 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:25:46.473 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 4
2025-10-25 10:25:46.474 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - HTTP GET https://maps.googleapis.com/maps/api/place/textsearch/json?query=CBD&key=
2025-10-25 10:25:46.474 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Accept=[application/json, application/*+json]
2025-10-25 10:25:46.602 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Response 200 OK
2025-10-25 10:25:46.602 [Pipeline-76] DEBUG org.springframework.web.client.RestTemplate - Reading to [com.tripplanner.dto.PlaceSearchResponse]
2025-10-25 10:25:46.604 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API returned status: REQUEST_DENIED
2025-10-25 10:25:46.604 [Pipeline-76] WARN  com.tripplanner.service.GooglePlacesService - Google Places API failure recorded. Consecutive failures: 5
2025-10-25 10:25:46.604 [Pipeline-76] ERROR com.tripplanner.service.GooglePlacesService - Google Places API failure threshold reached (5), opening circuit breaker
2025-10-25 10:25:46.604 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node1 (Chippendale): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.604 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node2 (Mrs Macquaries Rd, Sydney): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node3 (Circular Quay): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node4 (Bondi Beach): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day2_node5 (Bondi): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node1 (Alexandria): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node2 (Mosman): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node3 (Bondi Beach): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node4 (George St, Sydney): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day3_node5 (Sussex Street, Chinatown): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node1 (Surry Hills): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node2 (Manly): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node3 (Circular Quay): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node4 (The Rocks, Sydney): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] ERROR com.tripplanner.agents.EnrichmentAgent - Failed to search place for node day4_node5 (CBD): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:25:46.605 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Created 0 ENRICHMENT operations
2025-10-25 10:25:46.605 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:46.605 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:46.605 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:25:46.605 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:25:46.605 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:46.606 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 40
2025-10-25 10:25:46.606 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Validating opening hours
2025-10-25 10:25:46.606 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: validation
2025-10-25 10:25:46.606 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:46.605244600Z
2025-10-25 10:25:46.606 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:46.606 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:46.606 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:46.607 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:46.607 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:46.607 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:25:46.607 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:25:46.607 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:46.607 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 60
2025-10-25 10:25:46.607 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Calculating pacing
2025-10-25 10:25:46.607 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: pacing
2025-10-25 10:25:46.607 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:46.607250500Z
2025-10-25 10:25:46.610 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:46.610 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:46.610 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:46.611 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:46.611 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:46.611 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:25:46.611 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:25:46.611 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:46.611 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-25 10:25:46.611 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Computing transit durations
2025-10-25 10:25:46.611 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: transit
2025-10-25 10:25:46.611 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:46.611488500Z
2025-10-25 10:25:46.611 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:46.612 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:46.612 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:46.614 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:25:46.614 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:46.614 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:25:46.614 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:25:46.614 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:25:46.614 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 90
2025-10-25 10:25:46.614 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Applying enrichments
2025-10-25 10:25:46.614 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: applying
2025-10-25 10:25:46.614 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:55:46.614047700Z
2025-10-25 10:25:46.615 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:25:46.615 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:25:46.615 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:25:46.615 [Pipeline-76] INFO  com.tripplanner.service.ChangeEngine - Applying changes for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:47.066 [http-nio-8080-exec-1] DEBUG o.s.s.w.firewall.HttpStatusRequestRejectedHandler - Rejecting request due to: The request was rejected because the URL contained a potentially malicious String "//"
org.springframework.security.web.firewall.RequestRejectedException: The request was rejected because the URL contained a potentially malicious String "//"
	at org.springframework.security.web.firewall.StrictHttpFirewall.rejectedBlocklistedUrls(StrictHttpFirewall.java:548)
	at org.springframework.security.web.firewall.StrictHttpFirewall.getFirewalledRequest(StrictHttpFirewall.java:518)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:211)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.tripplanner.config.FirebaseAuthConfig$FirebaseAuthFilter.doFilterInternal(FirebaseAuthConfig.java:55)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-25 10:25:47.069 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /error
2025-10-25 10:25:47.069 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured OPTIONS /error
2025-10-25 10:25:47.069 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - "ERROR" dispatch for OPTIONS "/error", parameters={}
2025-10-25 10:25:47.069 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to org.springframework.boot.autoconfigure.web.servlet.error.BasicErrorController#error(HttpServletRequest)
2025-10-25 10:25:47.070 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Exiting from "ERROR" dispatch, status 403
2025-10-25 10:25:47.071 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:25:47.236 [Pipeline-76] INFO  com.tripplanner.service.ChangeEngine - === ITINERARY STATE IN CHANGE ENGINE ===
2025-10-25 10:25:47.238 [Pipeline-76] INFO  com.tripplanner.service.ChangeEngine - Day 1: 7 nodes - IDs: [day1_node1, day1_node2, day1_node3, day1_node4, day1_node5, day1_node6, day1_node7]
2025-10-25 10:25:47.238 [Pipeline-76] INFO  com.tripplanner.service.ChangeEngine - Day 2: 6 nodes - IDs: [day2_node1, day2_node2, day2_node3, day2_node4, day2_node5, day2_node6]
2025-10-25 10:25:47.238 [Pipeline-76] INFO  com.tripplanner.service.ChangeEngine - Day 3: 6 nodes - IDs: [day3_node1, day3_node2, day3_node3, day3_node4, day3_node5, day3_node6]
2025-10-25 10:25:47.238 [Pipeline-76] INFO  com.tripplanner.service.ChangeEngine - Day 4: 6 nodes - IDs: [day4_node1, day4_node2, day4_node3, day4_node4, day4_node5, day4_node6]
2025-10-25 10:25:47.238 [Pipeline-76] INFO  com.tripplanner.service.ChangeEngine - =========================================
2025-10-25 10:25:49.078 [http-nio-8080-exec-3] DEBUG o.s.s.w.firewall.HttpStatusRequestRejectedHandler - Rejecting request due to: The request was rejected because the URL contained a potentially malicious String "//"
org.springframework.security.web.firewall.RequestRejectedException: The request was rejected because the URL contained a potentially malicious String "//"
	at org.springframework.security.web.firewall.StrictHttpFirewall.rejectedBlocklistedUrls(StrictHttpFirewall.java:548)
	at org.springframework.security.web.firewall.StrictHttpFirewall.getFirewalledRequest(StrictHttpFirewall.java:518)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:211)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.tripplanner.config.FirebaseAuthConfig$FirebaseAuthFilter.doFilterInternal(FirebaseAuthConfig.java:55)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-25 10:25:49.080 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /error
2025-10-25 10:25:49.080 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured OPTIONS /error
2025-10-25 10:25:49.080 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - "ERROR" dispatch for OPTIONS "/error", parameters={}
2025-10-25 10:25:49.080 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to org.springframework.boot.autoconfigure.web.servlet.error.BasicErrorController#error(HttpServletRequest)
2025-10-25 10:25:49.081 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Exiting from "ERROR" dispatch, status 403
2025-10-25 10:25:49.081 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:25:53.088 [http-nio-8080-exec-5] DEBUG o.s.s.w.firewall.HttpStatusRequestRejectedHandler - Rejecting request due to: The request was rejected because the URL contained a potentially malicious String "//"
org.springframework.security.web.firewall.RequestRejectedException: The request was rejected because the URL contained a potentially malicious String "//"
	at org.springframework.security.web.firewall.StrictHttpFirewall.rejectedBlocklistedUrls(StrictHttpFirewall.java:548)
	at org.springframework.security.web.firewall.StrictHttpFirewall.getFirewalledRequest(StrictHttpFirewall.java:518)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:211)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.tripplanner.config.FirebaseAuthConfig$FirebaseAuthFilter.doFilterInternal(FirebaseAuthConfig.java:55)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-25 10:25:53.090 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /error
2025-10-25 10:25:53.090 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured OPTIONS /error
2025-10-25 10:25:53.092 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - "ERROR" dispatch for OPTIONS "/error", parameters={}
2025-10-25 10:25:53.092 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to org.springframework.boot.autoconfigure.web.servlet.error.BasicErrorController#error(HttpServletRequest)
2025-10-25 10:25:53.092 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Exiting from "ERROR" dispatch, status 403
2025-10-25 10:25:53.092 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:25:53.152 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:25:53.155 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:25:53.156 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:25:53.156 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:25:53.157 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:53.157 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:25:55.718 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:25:55.720 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:25:55.739 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=1, userId='null', (truncated)...]
2025-10-25 10:25:55.741 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:25:55.741 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:25:55.796 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:25:55.796 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:25:55.797 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:25:55.797 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:25:55.798 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:25:55.798 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:55.798 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:25:55.802 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:25:55.803 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:25:55.803 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:25:55.803 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:25:57.856 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:25:57.856 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:25:57.857 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=1, userId='null', (truncated)...]
2025-10-25 10:25:57.859 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:25:57.860 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:25:59.355 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:25:59.356 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:25:59.356 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-25 10:25:59.357 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:25:59.357 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node1_to_day1_node2, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node2_to_day1_node3, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node3_to_day1_node4, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node4_to_day1_node5, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node5_to_day1_node6, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day1_node6_to_day1_node7, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node1_to_day2_node2, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node2_to_day2_node3, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node3_to_day2_node4, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node4_to_day2_node5, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day2_node5_to_day2_node6, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node1_to_day3_node2, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node2_to_day3_node3, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node3_to_day3_node4, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node4_to_day3_node5, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day3_node5_to_day3_node6, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node1_to_day4_node2, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node2_to_day4_node3, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node3_to_day4_node4, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node4_to_day4_node5, op=update_edge
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge update has null day number
2025-10-25 10:26:06.951 [Pipeline-76] ERROR com.tripplanner.service.ChangeEngine - Edge operation details: id=day4_node5_to_day4_node6, op=update_edge
2025-10-25 10:26:06.953 [Pipeline-76] INFO  com.tripplanner.service.RevisionService - Saving revision rev_1761368166951_a4fac1b3 for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:26:08.297 [Pipeline-76] INFO  com.tripplanner.service.RevisionService - Successfully saved revision rev_1761368166951_a4fac1b3 for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:26:08.912 [Pipeline-76] INFO  com.tripplanner.service.ChangeEngine - Triggering auto-enrichment for 21 nodes in itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Enrichment complete
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: complete
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:56:08.913059900Z
2025-10-25 10:26:08.913 [AsyncTask-2] INFO  com.tripplanner.service.EnrichmentService - Starting async enrichment for 21 nodes in itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:26:08.913 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:26:08.913 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - === ENRICHMENT COMPLETE ===
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Applied 42 ENRICHMENT operations
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - New version: 2
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 9bfe05bc-a2ad-471c-b449-68e813ad49e8
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: ENRICHMENT
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Status: completed
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Message: Agent completed successfully
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:26:08.913 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:56:08.913059900Z
2025-10-25 10:26:08.914 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:26:08.914 [Pipeline-76] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:08.914 [Pipeline-76] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:26:08.914 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - === AGENT EXECUTION COMPLETED ===
2025-10-25 10:26:08.914 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Agent Kind: ENRICHMENT
2025-10-25 10:26:08.914 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:26:08.914 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Result Type: ApplyResult
2025-10-25 10:26:08.914 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - Result: com.tripplanner.service.ChangeEngine$ApplyResult@4a2d3c06
2025-10-25 10:26:08.914 [Pipeline-76] INFO  com.tripplanner.agents.EnrichmentAgent - =================================
2025-10-25 10:26:08.914 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 3 complete (25228 ms)
2025-10-25 10:26:08.914 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase ENRICHMENT completed in 25228 ms
2025-10-25 10:26:08.914 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:26:08.915 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:08.915 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 4: COST ESTIMATION ===
2025-10-25 10:26:08.915 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase cost_estimation started: Estimating costs...
2025-10-25 10:26:08.915 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:26:08.915 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:08.916 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"phase_transition","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e00...(truncated)
2025-10-25 10:26:08.916 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:08.916 [Pipeline-75] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, unknowncost_estimation, progress=0%
2025-10-25 10:26:08.916 [Pipeline-75] INFO  com.tripplanner.agents.CostEstimatorAgent - === COST ESTIMATOR AGENT ===
2025-10-25 10:26:08.916 [Pipeline-75] INFO  com.tripplanner.agents.CostEstimatorAgent - Estimating costs for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:26:10.270 [AsyncTask-2] INFO  com.tripplanner.service.EnrichmentService - Enriching 16 out of 21 nodes (others already have coordinates)
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node2 (Sydney Harbour / The Rocks): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node3 (The Rocks): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node4 (Darling Harbour): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day1_node6 (CBD): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node2 (Mrs Macquaries Rd, Sydney): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node3 (Circular Quay): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node4 (Bondi Beach): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day2_node5 (Bondi): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node2 (Mosman): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node3 (Bondi Beach): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node4 (George St, Sydney): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day3_node5 (Sussex Street, Chinatown): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node2 (Manly): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node3 (Circular Quay): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node4 (The Rocks, Sydney): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] ERROR com.tripplanner.service.EnrichmentService - Failed to enrich node day4_node5 (CBD): Google Places API circuit breaker is open. Service temporarily unavailable.
2025-10-25 10:26:10.270 [AsyncTask-2] INFO  com.tripplanner.service.EnrichmentService - Successfully enriched 0 out of 16 nodes in itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a (took 1357ms)
2025-10-25 10:26:10.761 [Pipeline-75] INFO  com.tripplanner.agents.CostEstimatorAgent - === COST ESTIMATOR COMPLETE ===
2025-10-25 10:26:10.761 [Pipeline-75] INFO  com.tripplanner.agents.CostEstimatorAgent - Estimated costs for 25 nodes
2025-10-25 10:26:10.762 [Pipeline-75] INFO  com.tripplanner.agents.CostEstimatorAgent - Total estimated cost: 49450 per person
2025-10-25 10:26:10.762 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase 4 complete (1848 ms)
2025-10-25 10:26:10.762 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase cost_estimation completed in 1848 ms
2025-10-25 10:26:10.762 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:26:10.762 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:10.762 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - === PHASE 5: FINALIZATION ===
2025-10-25 10:26:10.762 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase finalization started: Finalizing itinerary...
2025-10-25 10:26:10.763 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:26:10.763 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:10.763 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"phase_transition","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e00...(truncated)
2025-10-25 10:26:10.763 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:10.763 [Pipeline-75] INFO  com.tripplanner.service.AgentEventPublisher - Published phase transition event via WebSocket: itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, enrichmentfinalization, progress=90%
2025-10-25 10:26:12.713 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - === PIPELINE COMPLETE ===
2025-10-25 10:26:12.713 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Total time: 87827 ms
2025-10-25 10:26:12.713 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Days: 4, Nodes: 25
2025-10-25 10:26:12.713 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Phase finalization completed in 21329 ms
2025-10-25 10:26:12.714 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:26:12.714 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:12.714 [Pipeline-75] INFO  com.tripplanner.service.PipelineOrchestrator - Pipeline complete in 87827 ms
2025-10-25 10:26:13.424 [Pipeline-75] WARN  com.tripplanner.service.PipelineOrchestrator - UserId not found in itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a, attempting to retrieve from metadata
2025-10-25 10:26:13.424 [Pipeline-75] ERROR com.tripplanner.service.PipelineOrchestrator - Cannot save itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a without userId - skipping status update
2025-10-25 10:26:14.640 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"generation_complete","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02...(truncated)
2025-10-25 10:26:14.640 [Pipeline-75] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:26:14.640 [Pipeline-75] INFO  com.tripplanner.service.AgentEventPublisher - Published generation complete event via WebSocket: itinerary=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, days=4, total_nodes=25
2025-10-25 10:26:14.640 [AsyncTask-1] INFO  com.tripplanner.service.ItineraryService - Pipeline generation completed successfully for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, executionId: exec_1761368084866
2025-10-25 10:28:31.429 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=54bnml54
2025-10-25 10:28:31.429 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=54bnml54
2025-10-25 10:28:31.429 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=54bnml54
2025-10-25 10:28:31.430 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=54bnml54
2025-10-25 10:28:31.440 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:28:31.442 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:28:31.442 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:28:31.442 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:28:31.442 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:28:31.442 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:28:31.442 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:28:31.443 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:28:31.443 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:28:31.443 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:28:31.448 [http-nio-8080-exec-6] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=54bnml54] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:28:31.448 [http-nio-8080-exec-6] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session 54bnml54
2025-10-25 10:28:31.449 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=54bnml54
2025-10-25 10:28:31.449 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=54bnml54}], simpSessionId=54bnml54}]
2025-10-25 10:28:32.482 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761368312460
2025-10-25 10:28:32.482 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761368312460
2025-10-25 10:28:32.482 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761368312460", parameters={masked}
2025-10-25 10:28:32.483 [http-nio-8080-exec-4] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:28:32.483 [http-nio-8080-exec-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761368312460
2025-10-25 10:28:32.484 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:28:32.484 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:28:32.497 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/618/zq4todmz/websocket
2025-10-25 10:28:32.498 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/618/zq4todmz/websocket
2025-10-25 10:28:32.498 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/618/zq4todmz/websocket", parameters={}
2025-10-25 10:28:32.498 [http-nio-8080-exec-7] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:28:32.498 [http-nio-8080-exec-7] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/618/zq4todmz/websocket
2025-10-25 10:28:32.498 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:28:32.499 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:28:32.499 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=zq4todmz]
2025-10-25 10:28:32.501 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=zq4todmz
2025-10-25 10:28:32.505 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=zq4todmz
2025-10-25 10:28:32.505 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=zq4todmz
2025-10-25 10:28:32.505 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=zq4todmz
2025-10-25 10:28:33.182 [http-nio-8080-exec-5] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:28:33.183 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:28:33.184 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-25 10:28:33.186 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:28:33.186 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:28:34.371 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:28:34.372 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:28:34.376 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=1, userId='null', (truncated)...]
2025-10-25 10:28:34.384 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:28:34.384 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:28:34.403 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:28:34.412 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:28:34.412 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:28:34.413 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:28:34.413 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:28:36.116 [http-nio-8080-exec-2] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 0 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:28:36.118 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:28:36.118 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[]]
2025-10-25 10:28:36.121 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:28:36.122 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:28:40.063 [MessageBroker-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [54bnml54]
2025-10-25 10:29:08.456 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:29:08.458 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:29:08.458 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:29:08.458 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-25 10:29:08.460 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{message=remove the stay on day 4, i will travel to the airport to catch my flight, sender=user, tim (truncated)...]
2025-10-25 10:29:10.189 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:10.191 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:29:10.192 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch my (truncated)...]
2025-10-25 10:29:10.196 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-25 10:29:10.196 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:29:10.204 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat
2025-10-25 10:29:10.214 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat
2025-10-25 10:29:10.215 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat
2025-10-25 10:29:10.216 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat", parameters={}
2025-10-25 10:29:10.216 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#sendChatMessage(String, ChatRequest, HttpServletRequest)
2025-10-25 10:29:10.220 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [ChatRequest{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', scope='trip', day=null, selectedN (truncated)...]
2025-10-25 10:29:10.221 [http-nio-8080-exec-4] INFO  com.tripplanner.service.OrchestratorService - Routing chat request: ChatRequest{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', scope='trip', day=null, selectedNodeId='null', text='remove the stay on day 4, i will travel to the airport to catch my flight', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}
2025-10-25 10:29:12.020 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 1 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:12.021 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ai.ResilientAiClient - Attempting content generation with provider 1 (GeminiClient)
2025-10-25 10:29:12.021 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:29:12.021 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:29:12.021 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:29:12.021 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:29:12.021 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:29:12.021 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 2496
2025-10-25 10:29:12.021 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:29:12.021 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an AI assistant that classifies user intents for travel itinerary management.

Context:
Itinerary: 4-day trip to Sydney, New South Wales, Australia with 25 activities (estimated 49450 per per...
2025-10-25 10:29:12.022 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 2775
2025-10-25 10:29:12.023 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:29:14.060 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:29:14.060 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:29:14.060 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Response Length: 739
2025-10-25 10:29:14.060 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"intent\": \"remove_accommodation\",\n  \"taskType\": \"edit\",\n  \"entities\": {\n    \"activity_type\": \"stay\",\n    \"day\": \"Day 4\"\n  },\n  \"confidence\": 0.98\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 699,
    "candidatesTokenCount": 66,
    "totalTokenCount": 894,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 699
      }
    ],
    "thoughtsTokenCount": 129
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "IFn8aKrqNpO7vr0P5vmwkQM"
}

2025-10-25 10:29:14.065 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_2143304020_20251025_102914.json
2025-10-25 10:29:14.065 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:29:14.065 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Generated content length: 163
2025-10-25 10:29:14.065 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "intent": "remove_accommodation",
  "taskType": "edit",
  "entities": {
    "activity_type": "stay",
    "day": "Day 4"
  },
  "confidence": 0.98
}
```
2025-10-25 10:29:14.066 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:29:14.066 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ai.ResilientAiClient -  Provider 1 (GeminiClient) succeeded
2025-10-25 10:29:14.700 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentRegistry - Created execution plan for 'edit': 1 agents, primary: EditorAgent
2025-10-25 10:29:14.701 [http-nio-8080-exec-4] INFO  com.tripplanner.service.OrchestratorService - Executing agent plan: Task: edit, Agents: 1, Fallback: true, MaxRetries: 2, Timeout: 60000ms
2025-10-25 10:29:14.701 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION START ===
2025-10-25 10:29:14.701 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-25 10:29:14.701 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Agent ID: 3677a86b-914f-429c-9313-1cc601c952b5
2025-10-25 10:29:14.701 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:14.701 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Request Type: Map
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Request Data: {chatRequest=ChatRequest{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', scope='trip', day=null, selectedNodeId='null', text='remove the stay on day 4, i will travel to the airport to catch my flight', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, scope=trip, text=remove the stay on day 4, i will travel to the airport to catch my flight, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Request Details: {chatRequest=ChatRequest{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', scope='trip', day=null, selectedNodeId='null', text='remove the stay on day 4, i will travel to the airport to catch my flight', autoApply=false, userId='PEoULmiNa2dBOZrlBcXs8EZIkXs1'}, taskType=edit, autoApply=false, itineraryId=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, scope=trip, text=remove the stay on day 4, i will travel to the airport to catch my flight, selectedNodeId=null, userId=PEoULmiNa2dBOZrlBcXs8EZIkXs1, day=null}
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - =============================
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 3677a86b-914f-429c-9313-1cc601c952b5
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: queued
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 0
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Agent queued for execution
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:29:14.702 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:59:14.702620900Z
2025-10-25 10:29:14.704 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:29:14.704 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 3677a86b-914f-429c-9313-1cc601c952b5
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 10
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Agent started
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:29:14.705 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:59:14.705590800Z
2025-10-25 10:29:14.706 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:29:14.706 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:29:14.706 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:29:14.706 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Executing agent-specific logic for: EDITOR
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - EditorAgent executing for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 3677a86b-914f-429c-9313-1cc601c952b5
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 20
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Loading itinerary
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: load
2025-10-25 10:29:14.707 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:59:14.707982700Z
2025-10-25 10:29:14.709 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:29:14.709 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:29:14.709 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:29:16.009 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === ITINERARY STATE AFTER MIGRATION (EditorAgent) ===
2025-10-25 10:29:16.009 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Day 1: 7 nodes - IDs: [day1_node1, day1_node2, day1_node3, day1_node4, day1_node5, day1_node6, day1_node7]
2025-10-25 10:29:16.009 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Day 2: 6 nodes - IDs: [day2_node1, day2_node2, day2_node3, day2_node4, day2_node5, day2_node6]
2025-10-25 10:29:16.010 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Day 3: 6 nodes - IDs: [day3_node1, day3_node2, day3_node3, day3_node4, day3_node5, day3_node6]
2025-10-25 10:29:16.010 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Day 4: 6 nodes - IDs: [day4_node1, day4_node2, day4_node3, day4_node4, day4_node5, day4_node6]
2025-10-25 10:29:16.010 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - =======================================================
2025-10-25 10:29:16.011 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent - Itinerary data validation warnings for it_02ad2629-8022-4b7b-b9fc-02e00555e58a:
2025-10-25 10:29:16.011 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent -   - Day 1: Node day1_node7 has invalid timing (start > end)
2025-10-25 10:29:16.011 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent -   - Day 2: Node day2_node6 has invalid timing (start > end)
2025-10-25 10:29:16.011 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent -   - Day 3: Node day3_node6 has invalid timing (start > end)
2025-10-25 10:29:16.011 [http-nio-8080-exec-4] WARN  com.tripplanner.agents.EditorAgent -   - Day 4: Node day4_node6 has invalid timing (start > end)
2025-10-25 10:29:16.011 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Itinerary data consistency validation passed with 4 warnings for it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:16.011 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 3677a86b-914f-429c-9313-1cc601c952b5
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 40
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Generating summary
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: summarize
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:59:16.011754900Z
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:29:16.012 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:29:16.013 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:29:16.014 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:29:16.014 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:16.014 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 3677a86b-914f-429c-9313-1cc601c952b5
2025-10-25 10:29:16.014 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:29:16.014 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:29:16.014 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 60
2025-10-25 10:29:16.014 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Generating changes
2025-10-25 10:29:16.014 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: llm
2025-10-25 10:29:16.014 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:59:16.014754900Z
2025-10-25 10:29:16.015 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:29:16.015 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:29:16.015 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:29:16.780 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION REQUEST ===
2025-10-25 10:29:16.780 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Model: gemini-2.5-flash
2025-10-25 10:29:16.780 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Temperature: 0.7
2025-10-25 10:29:16.780 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Max Tokens: 65535
2025-10-25 10:29:16.780 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Mock Mode: false
2025-10-25 10:29:16.780 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - User Prompt Length: 8272
2025-10-25 10:29:16.780 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - System Prompt Length: 0
2025-10-25 10:29:16.780 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - User Prompt Preview: You are an expert travel itinerary editor.

You must respond with valid JSON that matches this exact schema:
{
  "type": "object",
  "properties": {
    "ops": {
      "type": "array",
      "descript...
2025-10-25 10:29:16.781 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Request Body Length: 8871
2025-10-25 10:29:16.781 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Sending request to Gemini API...
2025-10-25 10:29:18.964 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI API RESPONSE ===
2025-10-25 10:29:18.964 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Status Code: 200
2025-10-25 10:29:18.964 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Response Length: 817
2025-10-25 10:29:18.964 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Response Body: {
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"ops\": [\n    {\n      \"op\": \"delete\",\n      \"id\": \"day4_node6\"\n    }\n  ],\n  \"day\": 4,\n  \"reason\": \"Removed the overnight stay on Day 4 as the user will be traveling to the airport for a flight.\",\n  \"agent\": \"EditorAgent\"\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 2967,
    "candidatesTokenCount": 87,
    "totalTokenCount": 3111,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 2967
      }
    ],
    "thoughtsTokenCount": 57
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "JVn8aKe7Mv3Zvr0P9KfG6AI"
}

2025-10-25 10:29:18.970 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Saved Gemini response to: responses\gemini_response_-16910803_20251025_102918.json
2025-10-25 10:29:18.971 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - === GEMINI CONTENT GENERATION RESPONSE ===
2025-10-25 10:29:18.972 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Generated content length: 237
2025-10-25 10:29:18.972 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - Generated content preview: ```json
{
  "ops": [
    {
      "op": "delete",
      "id": "day4_node6"
    }
  ],
  "day": 4,
  "reason": "Removed the overnight stay on Day 4 as the user will be traveling to the airport for a flight.",
  "agent": "EditorAgent"
}
```
2025-10-25 10:29:18.972 [http-nio-8080-exec-4] INFO  com.tripplanner.service.GeminiClient - =========================================
2025-10-25 10:29:18.972 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === EDITOR AGENT - FULL LLM RESPONSE ===
2025-10-25 10:29:18.972 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - User Request: remove the stay on day 4, i will travel to the airport to catch my flight
2025-10-25 10:29:18.972 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Raw Response: ```json
{
  "ops": [
    {
      "op": "delete",
      "id": "day4_node6"
    }
  ],
  "day": 4,
  "reason": "Removed the overnight stay on Day 4 as the user will be traveling to the airport for a flight.",
  "agent": "EditorAgent"
}
```
2025-10-25 10:29:18.973 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === END EDITOR AGENT RESPONSE ===
2025-10-25 10:29:18.982 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Successfully generated ChangeSet with 1 operations
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 3677a86b-914f-429c-9313-1cc601c952b5
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 80
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Applying changes
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: apply
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:59:18.983085500Z
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:29:18.983 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:29:18.984 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:29:18.984 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChangeEngine - Applying changes for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a (using provided object)
2025-10-25 10:29:19.324 [http-nio-8080-exec-4] INFO  com.tripplanner.service.RevisionService - Saving revision rev_1761368359324_9ecfa160 for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:20.716 [http-nio-8080-exec-4] INFO  com.tripplanner.service.RevisionService - Successfully saved revision rev_1761368359324_9ecfa160 for itinerary: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:21.245 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:29:21.245 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:21.245 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 3677a86b-914f-429c-9313-1cc601c952b5
2025-10-25 10:29:21.245 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:29:21.245 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: running
2025-10-25 10:29:21.245 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-25 10:29:21.245 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Changes applied successfully
2025-10-25 10:29:21.245 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: complete
2025-10-25 10:29:21.247 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:59:21.245860900Z
2025-10-25 10:29:21.247 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - === PUBLISHING AGENT EVENT VIA WEBSOCKET ===
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent ID: 3677a86b-914f-429c-9313-1cc601c952b5
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Agent Kind: EDITOR
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Status: completed
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Progress: 100
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Message: Agent completed successfully
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Step: null
2025-10-25 10:29:21.248 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - Timestamp: 2025-10-25T04:59:21.248285300Z
2025-10-25 10:29:21.249 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Processing MESSAGE destination=/topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a session=null payload={"updateType":"agent_progress","itineraryId":"it_02ad2629-8022-4b7b-b9fc-02e0055...(truncated)
2025-10-25 10:29:21.249 [http-nio-8080-exec-4] DEBUG org.springframework.web.SimpLogging - Broadcasting to 1 sessions.
2025-10-25 10:29:21.249 [http-nio-8080-exec-4] INFO  com.tripplanner.service.AgentEventBus - ==========================================
2025-10-25 10:29:21.250 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - === AGENT EXECUTION COMPLETED ===
2025-10-25 10:29:21.250 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Agent Kind: EDITOR
2025-10-25 10:29:21.250 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Itinerary ID: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:21.250 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Result Type: ApplyResult
2025-10-25 10:29:21.250 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - Result: com.tripplanner.service.ChangeEngine$ApplyResult@743d4e1a
2025-10-25 10:29:21.250 [http-nio-8080-exec-4] INFO  com.tripplanner.agents.EditorAgent - =================================
2025-10-25 10:29:21.257 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:29:21.267 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [ChatResponse{intent='Changes applied successfully', message='Your itinerary has been updated.', chan (truncated)...]
2025-10-25 10:29:21.273 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:29:21.273 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:29:21.281 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing POST /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:29:21.281 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured POST /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:29:21.281 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - POST "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:29:21.282 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#saveChatMessage(String, Map, HttpServletRequest)
2025-10-25 10:29:21.283 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [{intent=Changes applied successfully, message=Your itinerary has been updated., changeSet=null, diff (truncated)...]
2025-10-25 10:29:23.106 [http-nio-8080-exec-7] INFO  com.tripplanner.service.ChatHistoryService - Saved chat message for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:29:23.107 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:29:23.108 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [{applied=true, warnings=[], diff={added=[], removed=[{nodeId=day4_node6, day=4, fields=null, title=n (truncated)...]
2025-10-25 10:29:23.110 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 201 CREATED
2025-10-25 10:29:23.110 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:38.628 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=zq4todmz
2025-10-25 10:32:38.628 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=zq4todmz
2025-10-25 10:32:38.628 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=zq4todmz
2025-10-25 10:32:38.629 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=zq4todmz
2025-10-25 10:32:38.650 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:32:38.650 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:32:38.650 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:32:38.651 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:32:38.651 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:32:38.651 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:32:38.651 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:32:38.651 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:32:38.651 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:32:38.651 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:32:38.698 [http-nio-8080-exec-6] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=zq4todmz] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:32:38.698 [http-nio-8080-exec-6] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session zq4todmz
2025-10-25 10:32:38.698 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=zq4todmz
2025-10-25 10:32:38.698 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=zq4todmz}], simpSessionId=zq4todmz}]
2025-10-25 10:32:39.673 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761368559669
2025-10-25 10:32:39.675 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761368559669
2025-10-25 10:32:39.675 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761368559669", parameters={masked}
2025-10-25 10:32:39.675 [http-nio-8080-exec-4] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:32:39.676 [http-nio-8080-exec-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761368559669
2025-10-25 10:32:39.676 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:32:39.676 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:39.682 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/406/to1intjl/websocket
2025-10-25 10:32:39.682 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/406/to1intjl/websocket
2025-10-25 10:32:39.682 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/406/to1intjl/websocket", parameters={}
2025-10-25 10:32:39.682 [http-nio-8080-exec-7] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:32:39.683 [http-nio-8080-exec-7] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/406/to1intjl/websocket
2025-10-25 10:32:39.683 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:39.683 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:32:39.684 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=to1intjl]
2025-10-25 10:32:39.686 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=to1intjl
2025-10-25 10:32:39.692 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=to1intjl
2025-10-25 10:32:39.692 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=to1intjl
2025-10-25 10:32:39.692 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=to1intjl
2025-10-25 10:32:41.175 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:32:41.175 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:32:41.176 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:32:41.178 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:32:41.178 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:42.224 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:32:42.224 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:32:42.224 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:32:42.225 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:32:42.226 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:44.982 [http-nio-8080-exec-5] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=to1intjl] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:32:44.982 [http-nio-8080-exec-5] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session to1intjl
2025-10-25 10:32:44.982 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=to1intjl
2025-10-25 10:32:44.982 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=to1intjl}], simpSessionId=to1intjl}]
2025-10-25 10:32:45.056 [MessageBroker-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [zq4todmz]
2025-10-25 10:32:48.488 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries
2025-10-25 10:32:48.489 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries
2025-10-25 10:32:48.489 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries", parameters={}
2025-10-25 10:32:48.489 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getAll(HttpServletRequest)
2025-10-25 10:32:48.490 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting all itineraries
2025-10-25 10:32:48.490 [http-nio-8080-exec-3] INFO  com.tripplanner.service.UserDataService - Fetching trip metadata for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:32:48.948 [http-nio-8080-exec-3] INFO  com.tripplanner.service.UserDataService - Found 6 trip metadata entries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:32:48.950 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Found 6 itineraries for user: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:32:48.950 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:32:48.950 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[ItineraryDto(id=it_02ad2629-8022-4b7b-b9fc-02e00555e58a, destination=Sydney, New South Wales, Austr (truncated)...]
2025-10-25 10:32:48.952 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:32:48.952 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:50.053 [MessageBroker-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [to1intjl]
2025-10-25 10:32:52.645 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:32:52.645 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:32:52.645 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:32:52.646 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:32:52.646 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:32:52.646 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:32:54.670 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:32:54.671 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:32:54.674 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:32:54.680 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:32:54.680 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:54.755 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:32:54.755 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:32:54.756 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:32:54.756 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:32:54.756 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:32:54.756 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:32:54.757 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:32:54.758 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:32:54.758 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:32:54.758 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:32:55.773 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761368575771
2025-10-25 10:32:55.774 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761368575771
2025-10-25 10:32:55.774 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761368575771", parameters={masked}
2025-10-25 10:32:55.774 [http-nio-8080-exec-7] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:32:55.775 [http-nio-8080-exec-7] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761368575771
2025-10-25 10:32:55.775 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:32:55.775 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:55.780 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/794/qbb50cno/websocket
2025-10-25 10:32:55.780 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/794/qbb50cno/websocket
2025-10-25 10:32:55.780 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/794/qbb50cno/websocket", parameters={}
2025-10-25 10:32:55.781 [http-nio-8080-exec-8] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:32:55.781 [http-nio-8080-exec-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/794/qbb50cno/websocket
2025-10-25 10:32:55.781 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:55.781 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:32:55.783 [http-nio-8080-exec-8] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=qbb50cno]
2025-10-25 10:32:55.785 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=qbb50cno
2025-10-25 10:32:55.789 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=qbb50cno
2025-10-25 10:32:55.789 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=qbb50cno
2025-10-25 10:32:55.789 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=qbb50cno
2025-10-25 10:32:56.773 [http-nio-8080-exec-6] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:32:56.773 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:32:56.773 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:32:56.775 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:32:56.775 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:32:57.077 [http-nio-8080-exec-4] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:32:57.077 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:32:57.077 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:32:57.078 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:32:57.078 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:33:05.254 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=qbb50cno
2025-10-25 10:33:05.254 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=qbb50cno
2025-10-25 10:33:05.254 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=qbb50cno
2025-10-25 10:33:05.254 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=qbb50cno
2025-10-25 10:33:05.266 [http-nio-8080-exec-3] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=qbb50cno] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:33:05.266 [http-nio-8080-exec-3] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session qbb50cno
2025-10-25 10:33:05.266 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=qbb50cno
2025-10-25 10:33:05.267 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=qbb50cno}], simpSessionId=qbb50cno}]
2025-10-25 10:33:15.054 [MessageBroker-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [qbb50cno]
2025-10-25 10:33:24.012 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:33:24.012 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:33:24.013 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:33:24.013 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:33:24.013 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:33:24.013 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:33:24.013 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:33:24.013 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:33:24.013 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:33:24.013 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:33:25.038 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761368605034
2025-10-25 10:33:25.039 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761368605034
2025-10-25 10:33:25.039 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761368605034", parameters={masked}
2025-10-25 10:33:25.040 [http-nio-8080-exec-8] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:33:25.041 [http-nio-8080-exec-8] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761368605034
2025-10-25 10:33:25.041 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:33:25.042 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:33:25.050 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/392/uklz22fk/websocket
2025-10-25 10:33:25.050 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/392/uklz22fk/websocket
2025-10-25 10:33:25.051 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/392/uklz22fk/websocket", parameters={}
2025-10-25 10:33:25.051 [http-nio-8080-exec-9] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:33:25.052 [http-nio-8080-exec-9] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/392/uklz22fk/websocket
2025-10-25 10:33:25.052 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:33:25.053 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:33:25.054 [http-nio-8080-exec-9] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=uklz22fk]
2025-10-25 10:33:25.058 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=uklz22fk
2025-10-25 10:33:25.062 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=uklz22fk
2025-10-25 10:33:25.063 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=uklz22fk
2025-10-25 10:33:25.063 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=uklz22fk
2025-10-25 10:33:25.822 [http-nio-8080-exec-7] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:33:25.823 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:33:25.824 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:33:25.826 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:33:25.826 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:33:26.643 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:33:26.644 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:33:26.646 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:33:26.651 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:33:26.651 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:37:49.989 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:37:49.989 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:37:49.990 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:37:49.990 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:37:49.990 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:37:49.990 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:37:49.990 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:37:49.990 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:37:49.990 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:37:49.990 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:37:51.490 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=uklz22fk
2025-10-25 10:37:51.490 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=uklz22fk
2025-10-25 10:37:51.490 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=uklz22fk
2025-10-25 10:37:51.491 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=uklz22fk
2025-10-25 10:37:51.502 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=uklz22fk] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:37:51.502 [http-nio-8080-exec-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session uklz22fk
2025-10-25 10:37:51.504 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=uklz22fk
2025-10-25 10:37:51.504 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=uklz22fk}], simpSessionId=uklz22fk}]
2025-10-25 10:37:52.505 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:37:52.506 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:37:52.507 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:37:52.509 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:37:52.510 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:37:53.583 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:37:53.583 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:37:53.583 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:37:53.584 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:37:53.584 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:38:00.061 [MessageBroker-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [uklz22fk]
2025-10-25 10:38:56.555 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:38:56.555 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:38:56.555 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:38:56.555 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:38:56.556 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:38:56.556 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:38:56.556 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:38:56.556 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:38:56.556 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:38:56.556 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:38:57.575 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761368937572
2025-10-25 10:38:57.575 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761368937572
2025-10-25 10:38:57.575 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761368937572", parameters={masked}
2025-10-25 10:38:57.575 [http-nio-8080-exec-5] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:38:57.575 [http-nio-8080-exec-5] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761368937572
2025-10-25 10:38:57.575 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:38:57.576 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:38:57.578 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/232/4h2fqwa1/websocket
2025-10-25 10:38:57.578 [http-nio-8080-exec-4] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/232/4h2fqwa1/websocket
2025-10-25 10:38:57.578 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/232/4h2fqwa1/websocket", parameters={}
2025-10-25 10:38:57.578 [http-nio-8080-exec-4] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:38:57.579 [http-nio-8080-exec-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/232/4h2fqwa1/websocket
2025-10-25 10:38:57.579 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:38:57.579 [http-nio-8080-exec-4] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:38:57.581 [http-nio-8080-exec-4] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=4h2fqwa1]
2025-10-25 10:38:57.582 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=4h2fqwa1
2025-10-25 10:38:57.585 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=4h2fqwa1
2025-10-25 10:38:57.585 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=4h2fqwa1
2025-10-25 10:38:57.585 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=4h2fqwa1
2025-10-25 10:38:58.643 [http-nio-8080-exec-10] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:38:58.645 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:38:58.646 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:38:58.657 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:38:58.658 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:38:58.894 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:38:58.895 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:38:58.896 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:38:58.898 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:38:58.898 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:38:58.907 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:38:58.909 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:38:58.910 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:38:58.910 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:39:00.755 [http-nio-8080-exec-3] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:39:00.756 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:39:00.757 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:39:00.761 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:39:00.761 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:40:58.088 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=4h2fqwa1
2025-10-25 10:40:58.088 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=4h2fqwa1
2025-10-25 10:40:58.089 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=4h2fqwa1
2025-10-25 10:40:58.089 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=4h2fqwa1
2025-10-25 10:40:58.100 [http-nio-8080-exec-4] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=4h2fqwa1] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:40:58.100 [http-nio-8080-exec-4] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session 4h2fqwa1
2025-10-25 10:40:58.100 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=4h2fqwa1
2025-10-25 10:40:58.100 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=4h2fqwa1}], simpSessionId=4h2fqwa1}]
2025-10-25 10:41:05.064 [MessageBroker-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [4h2fqwa1]
2025-10-25 10:42:48.835 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:42:48.836 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:42:48.836 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:42:48.836 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:42:48.836 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:42:48.837 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:42:51.418 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:42:51.418 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:42:51.419 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:42:51.420 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:42:51.420 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:42:51.582 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:42:51.583 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:42:51.583 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:42:51.583 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:42:51.583 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:42:51.583 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:42:51.583 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:42:51.584 [http-nio-8080-exec-10] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:42:51.584 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:42:51.584 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:42:52.607 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761369172603
2025-10-25 10:42:52.608 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761369172603
2025-10-25 10:42:52.608 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761369172603", parameters={masked}
2025-10-25 10:42:52.609 [http-nio-8080-exec-1] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:42:52.610 [http-nio-8080-exec-1] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761369172603
2025-10-25 10:42:52.610 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:42:52.610 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:42:52.616 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/335/y3lgoczs/websocket
2025-10-25 10:42:52.618 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/335/y3lgoczs/websocket
2025-10-25 10:42:52.618 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/335/y3lgoczs/websocket", parameters={}
2025-10-25 10:42:52.618 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:42:52.619 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/335/y3lgoczs/websocket
2025-10-25 10:42:52.620 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:42:52.621 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:42:52.622 [http-nio-8080-exec-3] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=y3lgoczs]
2025-10-25 10:42:52.625 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=y3lgoczs
2025-10-25 10:42:52.629 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=y3lgoczs
2025-10-25 10:42:52.629 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=y3lgoczs
2025-10-25 10:42:52.630 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=y3lgoczs
2025-10-25 10:42:53.565 [http-nio-8080-exec-2] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:42:53.567 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:42:53.569 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:42:53.575 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:42:53.575 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:42:53.588 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:42:53.589 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:42:53.589 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:42:53.589 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:42:53.590 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:42:53.590 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:42:55.256 [http-nio-8080-exec-10] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:42:55.257 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:42:55.257 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:42:55.257 [http-nio-8080-exec-10] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:42:55.258 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:42:55.261 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:42:55.261 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:42:55.261 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:42:55.261 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:42:55.285 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=y3lgoczs
2025-10-25 10:42:55.285 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=y3lgoczs
2025-10-25 10:42:55.286 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=y3lgoczs
2025-10-25 10:42:55.286 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=y3lgoczs
2025-10-25 10:42:55.310 [http-nio-8080-exec-9] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=y3lgoczs] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:42:55.310 [http-nio-8080-exec-9] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session y3lgoczs
2025-10-25 10:42:55.310 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=y3lgoczs
2025-10-25 10:42:55.310 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=y3lgoczs}], simpSessionId=y3lgoczs}]
2025-10-25 10:42:55.634 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:42:55.635 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:42:55.637 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:42:55.643 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:42:55.643 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:42:57.224 [http-nio-8080-exec-5] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:42:57.225 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:42:57.225 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:42:57.227 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:42:57.227 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:42:57.237 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:42:57.239 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:42:57.239 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:42:57.240 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:42:59.225 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:42:59.226 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:42:59.227 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:42:59.231 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:42:59.232 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:00.801 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:43:00.801 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:43:00.802 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:43:00.802 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:43:00.802 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:43:00.802 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:43:00.802 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:43:00.802 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:43:00.804 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:43:00.804 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:43:01.807 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761369181804
2025-10-25 10:43:01.808 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761369181804
2025-10-25 10:43:01.808 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761369181804", parameters={masked}
2025-10-25 10:43:01.808 [http-nio-8080-exec-6] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:43:01.809 [http-nio-8080-exec-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761369181804
2025-10-25 10:43:01.809 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:43:01.809 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:01.814 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/502/qmpvqe3j/websocket
2025-10-25 10:43:01.814 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/502/qmpvqe3j/websocket
2025-10-25 10:43:01.814 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/502/qmpvqe3j/websocket", parameters={}
2025-10-25 10:43:01.814 [http-nio-8080-exec-2] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:43:01.815 [http-nio-8080-exec-2] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/502/qmpvqe3j/websocket
2025-10-25 10:43:01.815 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:01.816 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:43:01.816 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=qmpvqe3j]
2025-10-25 10:43:01.819 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=qmpvqe3j
2025-10-25 10:43:01.821 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=qmpvqe3j
2025-10-25 10:43:01.821 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=qmpvqe3j
2025-10-25 10:43:01.821 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=qmpvqe3j
2025-10-25 10:43:02.244 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=qmpvqe3j
2025-10-25 10:43:02.244 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=qmpvqe3j
2025-10-25 10:43:02.245 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=qmpvqe3j
2025-10-25 10:43:02.245 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=qmpvqe3j
2025-10-25 10:43:02.276 [http-nio-8080-exec-7] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=qmpvqe3j] closed with CloseStatus[code=1000, reason=null]
2025-10-25 10:43:02.276 [http-nio-8080-exec-7] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session qmpvqe3j
2025-10-25 10:43:02.277 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=qmpvqe3j
2025-10-25 10:43:02.277 [WebSocket-1] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=qmpvqe3j}], simpSessionId=qmpvqe3j}]
2025-10-25 10:43:02.518 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:43:02.520 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:43:02.521 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:43:02.523 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:43:02.523 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:03.782 [http-nio-8080-exec-3] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:43:03.783 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:43:03.784 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:43:03.786 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:43:03.787 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:05.051 [MessageBroker-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [y3lgoczs]
2025-10-25 10:43:10.064 [MessageBroker-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [qmpvqe3j]
2025-10-25 10:43:25.408 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:43:25.408 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:43:25.409 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:43:25.409 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:43:25.409 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:43:25.409 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:43:25.409 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:43:25.409 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:43:25.410 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:43:25.410 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:43:26.412 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761369206411
2025-10-25 10:43:26.413 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761369206411
2025-10-25 10:43:26.413 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761369206411", parameters={masked}
2025-10-25 10:43:26.413 [http-nio-8080-exec-6] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:43:26.414 [http-nio-8080-exec-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761369206411
2025-10-25 10:43:26.414 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:43:26.414 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:26.420 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/942/bwxu1q00/websocket
2025-10-25 10:43:26.420 [http-nio-8080-exec-2] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/942/bwxu1q00/websocket
2025-10-25 10:43:26.420 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/942/bwxu1q00/websocket", parameters={}
2025-10-25 10:43:26.420 [http-nio-8080-exec-2] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 10:43:26.421 [http-nio-8080-exec-2] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/942/bwxu1q00/websocket
2025-10-25 10:43:26.421 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:26.421 [http-nio-8080-exec-2] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 10:43:26.422 [http-nio-8080-exec-2] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=bwxu1q00]
2025-10-25 10:43:26.424 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=bwxu1q00
2025-10-25 10:43:26.426 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=bwxu1q00
2025-10-25 10:43:26.427 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=bwxu1q00
2025-10-25 10:43:26.427 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=bwxu1q00
2025-10-25 10:43:27.445 [http-nio-8080-exec-5] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:43:27.445 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:43:27.446 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:43:27.447 [http-nio-8080-exec-5] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:43:27.448 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:27.454 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:43:27.455 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 10:43:27.455 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 10:43:27.455 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 10:43:27.456 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:43:27.456 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - User authenticated, checking ownership: PEoULmiNa2dBOZrlBcXs8EZIkXs1
2025-10-25 10:43:27.704 [http-nio-8080-exec-1] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:43:27.704 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:43:27.704 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:43:27.705 [http-nio-8080-exec-1] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:43:27.705 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:27.709 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:43:27.709 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:43:27.709 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:43:27.709 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:43:29.717 [http-nio-8080-exec-9] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 10:43:29.718 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:43:29.720 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 10:43:29.724 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:43:29.724 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:30.843 [http-nio-8080-exec-7] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:43:30.844 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:43:30.844 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:43:30.847 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:43:30.847 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:43:30.860 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:43:30.862 [http-nio-8080-exec-8] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 10:43:30.862 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 10:43:30.862 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 10:43:32.579 [http-nio-8080-exec-8] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 10:43:32.580 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 10:43:32.580 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 10:43:32.582 [http-nio-8080-exec-8] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 10:43:32.582 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 10:54:19.560 [MessageBroker-2] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 9 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(9)-CONNECTED(9)-DISCONNECT(7)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 280], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 280], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 409]
2025-10-25 11:24:19.565 [MessageBroker-6] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 9 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(9)-CONNECTED(9)-DISCONNECT(7)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 280], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 280], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 842]
2025-10-25 11:54:19.575 [MessageBroker-6] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 9 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(9)-CONNECTED(9)-DISCONNECT(7)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 280], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 280], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 1275]
2025-10-25 12:24:19.588 [MessageBroker-3] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 9 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(9)-CONNECTED(9)-DISCONNECT(7)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 280], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 280], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 1708]
2025-10-25 12:49:29.293 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-0 session=bwxu1q00
2025-10-25 12:49:29.293 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-1 session=bwxu1q00
2025-10-25 12:49:29.294 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing UNSUBSCRIBE id=sub-2 session=bwxu1q00
2025-10-25 12:49:29.294 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT receipt=close-3 session=bwxu1q00
2025-10-25 12:49:29.321 [http-nio-8080-exec-5] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 12:49:29.321 [http-nio-8080-exec-1] DEBUG org.springframework.security.web.FilterChainProxy - Securing OPTIONS /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 12:49:29.343 [http-nio-8080-exec-9] WARN  c.t.config.FirebaseAuthConfig$FirebaseAuthFilter - Invalid token for chat endpoint: /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history, continuing without auth
2025-10-25 12:49:29.344 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 12:49:29.346 [http-nio-8080-exec-9] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history
2025-10-25 12:49:29.346 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/chat/history", parameters={}
2025-10-25 12:49:29.347 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getChatHistory(String, HttpServletRequest)
2025-10-25 12:49:29.343 [http-nio-8080-exec-7] WARN  c.t.config.FirebaseAuthConfig$FirebaseAuthFilter - Invalid token for /json endpoint: /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
com.google.firebase.auth.FirebaseAuthException: Firebase ID token has expired. Get a fresh ID token and try again. See https://firebase.google.com/docs/auth/admin/verify-id-tokens for details on how to retrieve an ID token.
	at com.google.firebase.auth.FirebaseTokenVerifierImpl.newException(FirebaseTokenVerifierImpl.java:237)
	at com.google.firebase.auth.FirebaseTokenVerifierImpl.newException(FirebaseTokenVerifierImpl.java:232)
	at com.google.firebase.auth.FirebaseTokenVerifierImpl.checkContents(FirebaseTokenVerifierImpl.java:227)
	at com.google.firebase.auth.FirebaseTokenVerifierImpl.verifyToken(FirebaseTokenVerifierImpl.java:100)
	at com.google.firebase.auth.AbstractFirebaseAuth$3.execute(AbstractFirebaseAuth.java:307)
	at com.google.firebase.auth.AbstractFirebaseAuth$3.execute(AbstractFirebaseAuth.java:304)
	at com.google.firebase.internal.CallableOperation.call(CallableOperation.java:36)
	at com.google.firebase.auth.AbstractFirebaseAuth.verifyIdToken(AbstractFirebaseAuth.java:269)
	at com.google.firebase.auth.AbstractFirebaseAuth.verifyIdToken(AbstractFirebaseAuth.java:241)
	at com.tripplanner.config.FirebaseAuthConfig$FirebaseAuthFilter.doFilterInternal(FirebaseAuthConfig.java:72)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-10-25 12:49:29.348 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 12:49:29.349 [http-nio-8080-exec-7] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json
2025-10-25 12:49:29.349 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/api/v1/itineraries/it_02ad2629-8022-4b7b-b9fc-02e00555e58a/json", parameters={}
2025-10-25 12:49:29.349 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.tripplanner.controller.ItinerariesController#getItineraryJson(String, HttpServletRequest)
2025-10-25 12:49:29.352 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Getting normalized itinerary JSON: it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 12:49:29.373 [http-nio-8080-exec-8] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - WebSocketServerSockJsSession[id=bwxu1q00] closed with CloseStatus[code=1000, reason=null]
2025-10-25 12:49:29.373 [http-nio-8080-exec-8] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - Clearing session bwxu1q00
2025-10-25 12:49:29.373 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing DISCONNECT session=bwxu1q00
2025-10-25 12:49:29.373 [WebSocket-2] DEBUG o.s.w.socket.messaging.SubProtocolWebSocketHandler - No session for GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT_ACK, simpDisconnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=DISCONNECT, stompCommand=DISCONNECT, simpSessionAttributes={org.springframework.messaging.simp.SimpAttributes.COMPLETED=true}, simpSessionId=bwxu1q00}], simpSessionId=bwxu1q00}]
2025-10-25 12:49:30.354 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/info?t=1761376770349
2025-10-25 12:49:30.355 [http-nio-8080-exec-3] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/info?t=1761376770349
2025-10-25 12:49:30.356 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/info?t=1761376770349", parameters={masked}
2025-10-25 12:49:30.356 [http-nio-8080-exec-3] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 12:49:30.357 [http-nio-8080-exec-3] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/info?t=1761376770349
2025-10-25 12:49:30.359 [http-nio-8080-exec-3] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 12:49:30.359 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 12:49:30.367 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Securing GET /ws/431/g03gymlm/websocket
2025-10-25 12:49:30.367 [http-nio-8080-exec-6] DEBUG org.springframework.security.web.FilterChainProxy - Secured GET /ws/431/g03gymlm/websocket
2025-10-25 12:49:30.368 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - GET "/ws/431/g03gymlm/websocket", parameters={}
2025-10-25 12:49:30.368 [http-nio-8080-exec-6] DEBUG o.s.w.s.server.support.WebSocketHandlerMapping - Mapped to org.springframework.web.socket.sockjs.support.SockJsHttpRequestHandler@2e44cb34
2025-10-25 12:49:30.370 [http-nio-8080-exec-6] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Processing transport request: GET http://localhost:8080/ws/431/g03gymlm/websocket
2025-10-25 12:49:30.372 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 12:49:30.375 [http-nio-8080-exec-6] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 101 SWITCHING_PROTOCOLS
2025-10-25 12:49:30.378 [http-nio-8080-exec-6] DEBUG o.s.w.s.handler.LoggingWebSocketHandlerDecorator - New WebSocketServerSockJsSession[id=g03gymlm]
2025-10-25 12:49:30.381 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing CONNECT session=g03gymlm
2025-10-25 12:49:30.386 [WebSocket-1] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/itinerary/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-0 session=g03gymlm
2025-10-25 12:49:30.387 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/agent/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-1 session=g03gymlm
2025-10-25 12:49:30.387 [WebSocket-2] DEBUG org.springframework.web.SimpLogging - Processing SUBSCRIBE /topic/chat/it_02ad2629-8022-4b7b-b9fc-02e00555e58a id=sub-2 session=g03gymlm
2025-10-25 12:49:31.401 [http-nio-8080-exec-9] INFO  com.tripplanner.service.ChatHistoryService - Retrieved 2 chat messages for itinerary it_02ad2629-8022-4b7b-b9fc-02e00555e58a
2025-10-25 12:49:31.405 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 12:49:31.406 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [[{id=hkvkFuGbglnFjhk4Xhpy, message=remove the stay on day 4, i will travel to the airport to catch m (truncated)...]
2025-10-25 12:49:31.411 [http-nio-8080-exec-9] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 12:49:31.412 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 12:49:31.711 [http-nio-8080-exec-7] INFO  com.tripplanner.controller.ItinerariesController - Normalized itinerary found: it_02ad2629-8022-4b7b-b9fc-02e00555e58a, status: completed
2025-10-25 12:49:31.712 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-25 12:49:31.714 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.annotation.HttpEntityMethodProcessor - Writing [NormalizedItinerary{itineraryId='it_02ad2629-8022-4b7b-b9fc-02e00555e58a', version=2, userId='null', (truncated)...]
2025-10-25 12:49:31.718 [http-nio-8080-exec-7] DEBUG org.springframework.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-25 12:49:31.718 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-10-25 12:49:35.056 [MessageBroker-4] DEBUG o.s.w.s.s.transport.handler.DefaultSockJsService - Closed 1 sessions: [bwxu1q00]
2025-10-25 12:54:19.597 [MessageBroker-5] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 10 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(10)-CONNECTED(10)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 310], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 310], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 2140]
2025-10-25 13:24:19.613 [MessageBroker-4] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 10 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(10)-CONNECTED(10)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 310], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 310], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 2573]
2025-10-25 13:54:19.624 [MessageBroker-1] INFO  o.s.web.socket.config.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 10 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(10)-CONNECTED(10)-DISCONNECT(8)], stompBrokerRelay[null], inboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 310], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 310], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 3006]
